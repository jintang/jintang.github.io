title: 使用handsontable插件修改bug心得
date: 2016-10-18 10:33:32
tags: 
- handsontable
- jq
categories: jQuery
---
>这段日子有个坑爹的项目——南网，这篇文章就来纪念它。里面有用到一个jq插件：[handsontable](https://handsontable.com/),作用是生成一个类似excel的表格，不得不说功能十分强大，实现了类似excel的各种功能，使用的api也比较简单，然而...后面有些莫名其妙的bug，奈何于水平有限，其源码也太长(30000+)，各种嵌套，无法从正确的逻辑中找到出问题的地方，只能在关键的地方强制使用自己的逻辑，下面就说说怎么找这个bug关键的地方

### 平时修改bug
1. js的bug：我总是想一遍过程，整个流程构思的跑一遍，然后哪儿的逻辑出了问题或者疏忽了，自然就知道了对应的地方。
2. 页面的bug:google浏览器，你懂得。我对页面渲染理解着实不深，所以经常"不求甚解"。  

### 这次修改handsontable插件bug的经验
#### bug1:要渲染的数据很多，但是只显示了一部分:  
<svg height="597" version="1.1" width="417.171875" xmlns="http://www.w3.org/2000/svg" style="overflow: hidden; position: relative;" viewBox="0 0 417.171875 597" preserveAspectRatio="xMidYMid meet"><desc style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Created with Raphaël 2.1.2</desc><defs style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block-obj27" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><marker id="raphael-marker-endblock33-obj28" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block-obj27" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker></defs><rect x="0" y="0" width="383" height="55" r="20" rx="20" ry="20" fill="#ffffff" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="st" transform="matrix(1,0,0,1,18.0859,4)"></rect><text x="10" y="27.5" text-anchor="start" font="10px &quot;Arial&quot;" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 15px; line-height: normal; font-family: Arial;" id="stt" class="flowchartt" font-size="15px" transform="matrix(1,0,0,1,18.0859,4)" stroke-width="1"><tspan style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" dy="-3.5">根据官方demo发现handsontable是先渲染一部分数据，</tspan><tspan dy="18" x="10" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">然后滚动的时候渲染新数据</tspan></text><rect x="0" y="0" width="392" height="55" r="0" rx="0" ry="0" fill="#ffffff" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="op1" transform="matrix(1,0,0,1,13.5859,113)"></rect><text x="10" y="27.5" text-anchor="start" font="10px &quot;Arial&quot;" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 15px; line-height: normal; font-family: Arial;" id="op1t" class="flowchartt" font-size="15px" transform="matrix(1,0,0,1,13.5859,113)" stroke-width="1"><tspan style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" dy="-3.5">在页面上使用开发者工具查看handsontable的绑定事件，</tspan><tspan dy="18" x="10" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">发现事件:wheel</tspan></text><rect x="0" y="0" width="350" height="55" r="0" rx="0" ry="0" fill="#ffffff" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="op2" transform="matrix(1,0,0,1,34.5859,222)"></rect><text x="10" y="27.5" text-anchor="start" font="10px &quot;Arial&quot;" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 15px; line-height: normal; font-family: Arial;" id="op2t" class="flowchartt" font-size="15px" transform="matrix(1,0,0,1,34.5859,222)" stroke-width="1"><tspan style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" dy="-3.5">查看绑定事件的地方，发现嵌套多层，理不清楚，</tspan><tspan dy="18" x="10" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">转而在源码中搜索关键字:wheel</tspan></text><rect x="0" y="0" width="320.328125" height="37" r="0" rx="0" ry="0" fill="#ffffff" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="op3" transform="matrix(1,0,0,1,49.4219,340)"></rect><text x="10" y="18.5" text-anchor="start" font="10px &quot;Arial&quot;" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 15px; line-height: normal; font-family: Arial;" id="op3t" class="flowchartt" font-size="15px" transform="matrix(1,0,0,1,49.4219,340)" stroke-width="1"><tspan style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" dy="5.5">搜索发现wheel都与方法：onTableScroll()有关</tspan></text><rect x="0" y="0" width="357.328125" height="55" r="0" rx="0" ry="0" fill="#ffffff" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="op4" transform="matrix(1,0,0,1,30.9219,431)"></rect><text x="10" y="27.5" text-anchor="start" font="10px &quot;Arial&quot;" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 15px; line-height: normal; font-family: Arial;" id="op4t" class="flowchartt" font-size="15px" transform="matrix(1,0,0,1,30.9219,431)" stroke-width="1"><tspan style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" dy="-3.5">在onTableScroll()内打断点，查看代码执行的步骤，</tspan><tspan dy="18" x="10" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">通过对比官方demo发现步骤中不同的地方</tspan></text><rect x="0" y="0" width="411.171875" height="55" r="20" rx="20" ry="20" fill="#ffffff" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="end" transform="matrix(1,0,0,1,4,540)"></rect><text x="10" y="27.5" text-anchor="start" font="10px &quot;Arial&quot;" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 15px; line-height: normal; font-family: Arial;" id="endt" class="flowchartt" font-size="15px" transform="matrix(1,0,0,1,4,540)" stroke-width="1"><tspan style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" dy="-3.5">在自己使用handsontable的地方加一个全局变量:window.flag</tspan><tspan dy="18" x="10" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">，在onTableScroll()中使用此变量来强制执行正确的步骤</tspan><tspan dy="18" x="10" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></tspan></text><path fill="none" stroke="#000000" d="M209.5859375,59C209.5859375,59,209.5859375,98.65409994125366,209.5859375,110.00043908460066" stroke-width="2" marker-end="url(#raphael-marker-endblock33-obj28)" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><path fill="none" stroke="#000000" d="M209.5859375,168C209.5859375,168,209.5859375,207.65409994125366,209.5859375,219.00043908460066" stroke-width="2" marker-end="url(#raphael-marker-endblock33-obj28)" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><path fill="none" stroke="#000000" d="M209.5859375,277C209.5859375,277,209.5859375,324.48365688323975,209.5859375,337.0037617255002" stroke-width="2" marker-end="url(#raphael-marker-endblock33-obj28)" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><path fill="none" stroke="#000000" d="M209.5859375,377C209.5859375,377,209.5859375,416.65409994125366,209.5859375,428.00043908460066" stroke-width="2" marker-end="url(#raphael-marker-endblock33-obj28)" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><path fill="none" stroke="#000000" d="M209.5859375,486C209.5859375,486,209.5859375,525.6540999412537,209.5859375,537.0004390846007" stroke-width="2" marker-end="url(#raphael-marker-endblock33-obj28)" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path></svg>

> 注：使用全局变量window.flag是为了在其他地方不影响

<!-- more -->

#### bug2-n:双击编辑时弹框位置不对、点击某些单元格时却滚动到表格顶部、下拉列表的显示位置不对...
<svg height="752.75" version="1.1" width="792.625" xmlns="http://www.w3.org/2000/svg" style="overflow: hidden; position: relative;" viewBox="0 0 792.625 752.75" preserveAspectRatio="xMidYMid meet"><desc style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Created with Raphaël 2.1.2</desc><defs style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block-obj65" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><marker id="raphael-marker-endblock33-obj66" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block-obj65" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker></defs><rect x="0" y="0" width="379.171875" height="55" r="20" rx="20" ry="20" fill="#ffffff" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="st" transform="matrix(1,0,0,1,8.9141,49.625)"></rect><text x="10" y="27.5" text-anchor="start" font="10px &quot;Arial&quot;" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 15px; line-height: normal; font-family: Arial;" id="stt" class="flowchartt" font-size="15px" transform="matrix(1,0,0,1,8.9141,49.625)" stroke-width="1"><tspan style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" dy="-3.5">开发者工具查看绑定事件，找到可以搜索的关键字：</tspan><tspan dy="18" x="10" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">click、mousedown、mouseup、edit、select、render...</tspan></text><rect x="0" y="0" width="365" height="55" r="0" rx="0" ry="0" fill="#ffffff" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="op1" transform="matrix(1,0,0,1,16,204.25)"></rect><text x="10" y="27.5" text-anchor="start" font="10px &quot;Arial&quot;" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 15px; line-height: normal; font-family: Arial;" id="op1t" class="flowchartt" font-size="15px" transform="matrix(1,0,0,1,16,204.25)" stroke-width="1"><tspan style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" dy="-3.5">搜索关键字，在觉得有可能影响的地方都打上断点，</tspan><tspan dy="18" x="10" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">如果关键字是方法，那调用它的地方都有可能影响</tspan></text><rect x="0" y="0" width="389" height="37" r="0" rx="0" ry="0" fill="#ffffff" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="op2" transform="matrix(1,0,0,1,4,367.875)"></rect><text x="10" y="18.5" text-anchor="start" font="10px &quot;Arial&quot;" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 15px; line-height: normal; font-family: Arial;" id="op2t" class="flowchartt" font-size="15px" transform="matrix(1,0,0,1,4,367.875)" stroke-width="1"><tspan style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" dy="5.5">开始苦逼的调试，在触发哪个断点的时候导致了bug发生</tspan></text><path fill="#ffffff" stroke="#000000" d="M73.125,36.5625L0,73.125L146.25,146.25L292.5,73.125L146.25,0L0,73.125" stroke-width="2" id="cond" class="flowchart" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" transform="matrix(1,0,0,1,52.25,458.875)"></path><text x="78.125" y="73.125" text-anchor="start" font="10px &quot;Arial&quot;" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 15px; line-height: normal; font-family: Arial;" id="condt" class="flowchartt" font-size="15px" transform="matrix(1,0,0,1,52.25,458.875)" stroke-width="1"><tspan style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" dy="-12.5">是否由包含该断点</tspan><tspan dy="18" x="78.125" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">的方法里的步骤导致的，</tspan><tspan dy="18" x="78.125" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">是或否？</tspan></text><rect x="0" y="0" width="270" height="37" r="20" rx="20" ry="20" fill="#ffffff" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="e" transform="matrix(1,0,0,1,63.5,713.75)"></rect><text x="10" y="18.5" text-anchor="start" font="10px &quot;Arial&quot;" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 15px; line-height: normal; font-family: Arial;" id="et" class="flowchartt" font-size="15px" transform="matrix(1,0,0,1,63.5,713.75)" stroke-width="1"><tspan style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" dy="5.5">使用全局变量，在该步骤处"拨乱反正"</tspan><tspan dy="18" x="10" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></tspan></text><rect x="0" y="0" width="125" height="55" r="0" rx="0" ry="0" fill="#ffffff" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="op3" transform="matrix(1,0,0,1,530.75,504.5)"></rect><text x="10" y="27.5" text-anchor="start" font="10px &quot;Arial&quot;" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 15px; line-height: normal; font-family: Arial;" id="op3t" class="flowchartt" font-size="15px" transform="matrix(1,0,0,1,530.75,504.5)" stroke-width="1"><tspan style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" dy="-3.5">以包含该断点的</tspan><tspan dy="18" x="10" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">方法名为关键字</tspan></text><path fill="none" stroke="#000000" d="M198.5,104.625C198.5,104.625,198.5,184.60484662652016,198.5,201.24127956738812" stroke-width="2" marker-end="url(#raphael-marker-endblock33-obj66)" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><path fill="none" stroke="#000000" d="M198.5,259.25C198.5,259.25,198.5,347.3604063168168,198.5,364.8706286659108" stroke-width="2" marker-end="url(#raphael-marker-endblock33-obj66)" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><path fill="none" stroke="#000000" d="M198.5,404.875C198.5,404.875,198.5,444.52909994125366,198.5,455.87543908460066" stroke-width="2" marker-end="url(#raphael-marker-endblock33-obj66)" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><path fill="none" stroke="#000000" d="M198.5,605.125C198.5,605.125,198.5,693.2354063168168,198.5,710.7456286659108" stroke-width="2" marker-end="url(#raphael-marker-endblock33-obj66)" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><text x="203.5" y="615.125" text-anchor="start" font="10px &quot;Arial&quot;" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 15px; line-height: normal; font-family: Arial;" font-size="15px" stroke-width="1"><tspan style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" dy="5.5">yes</tspan></text><path fill="none" stroke="#000000" d="M344.75,532C344.75,532,503.8290500640869,532,527.7530478276312,532" stroke-width="2" marker-end="url(#raphael-marker-endblock33-obj66)" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><text x="349.75" y="522" text-anchor="start" font="10px &quot;Arial&quot;" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 15px; line-height: normal; font-family: Arial;" font-size="15px" stroke-width="1"><tspan style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" dy="5.5">no</tspan></text><path fill="none" stroke="#000000" d="M593.25,559.5C593.25,559.5,593.25,584.5,593.25,584.5C593.25,584.5,790.625,584.5,790.625,584.5C790.625,584.5,790.625,179.25,790.625,179.25C790.625,179.25,198.5,179.25,198.5,179.25C198.5,179.25,198.5,194.62344455718994,198.5,201.25924777425826" stroke-width="2" marker-end="url(#raphael-marker-endblock33-obj66)" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path></svg>  
**总结**:不清楚插件内部逻辑的情况下：搜索关键字，根据打的断点找到关键性代码  

为了找到关键代码，断点是打了n遍，每次都发现外层的方法已经产生了bug，如此循环多次之后才找到。感觉方法很笨，但却很有效，经验大概就是这样起作用。不知道谁有好点的找bug的方法吗，请留言。

**[1]** `hexo`竟然不支持`markdown`的流程图语法，上面的流程图是用其他`Markdown`编辑器生成的`html`  
**[2]** 每次用`eclipse`打包、启动`maven`管理的项目都忍不住吐槽，各种报错，浪费时间。最近终于换了`idea`，和`webstorm`是一家公司的，真强大啊，再也不用每次更新代码就打包了，而且`tomcat`还可以配置两个`module`，不用切来切去，真爽。附上[idea使用教程]()


