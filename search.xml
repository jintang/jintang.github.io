<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
    
    <entry>
      <title><![CDATA[js原生时间格式化]]></title>
      <url>https://jintang.github.io/2020/09/25/js%E5%8E%9F%E7%94%9F%E6%97%B6%E9%97%B4%E6%A0%BC%E5%BC%8F%E5%8C%96/</url>
      <content type="html"><![CDATA[<p>js 原生的时间格式化挺强的，内部用的是 <code>Intl.DateTimeFormat()</code> ,附 <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Intl/DateTimeFormat/DateTimeFormat" target="_blank" rel="noopener">文档</a> , <code>Intl</code> 对象是 <code>ECMAScript</code> 国际化 <code>API</code> 的名称空间，它提供语言敏感的字符串比较、数字格式化以及日期和时间格式化。</p><p>以下附实用：<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="string">'2020/9/25 09:40:50'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 日期</span></span><br><span class="line"><span class="built_in">console</span>.log(date.toLocaleDateString(<span class="string">"zh-CN"</span>));</span><br><span class="line"><span class="comment">// 2020/9/25</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 时间</span></span><br><span class="line"><span class="built_in">console</span>.log(date.toLocaleTimeString(<span class="string">"zh-CN"</span>, &#123;</span><br><span class="line">  hour12: <span class="literal">false</span></span><br><span class="line">&#125;));</span><br><span class="line"><span class="comment">// 09:40:50 </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// </span></span><br><span class="line"><span class="built_in">console</span>.log(date.toLocaleString(<span class="string">"zh-CN"</span>, &#123; </span><br><span class="line">  hour12: <span class="literal">false</span></span><br><span class="line"> &#125;));</span><br><span class="line"> <span class="comment">// 2020/9/25 09:40:50 </span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(date.toLocaleString(<span class="string">"hc"</span>, &#123; </span><br><span class="line">  hour12: <span class="literal">false</span>,</span><br><span class="line">  year: <span class="string">'numeric'</span>,</span><br><span class="line">  month: <span class="string">'2-digit'</span>,</span><br><span class="line">  day: <span class="string">'2-digit'</span>,</span><br><span class="line">  hour: <span class="string">'2-digit'</span>,</span><br><span class="line">  minute: <span class="string">'2-digit'</span>,</span><br><span class="line">  second: <span class="string">'2-digit'</span></span><br><span class="line"> &#125;));</span><br><span class="line"> <span class="comment">// 2020/09/25 09:40:50</span></span><br></pre></td></tr></table></figure><p></p><p><strong>Tip:</strong> 每个日期时间组件属性的默认值都是 <code>undefined</code>，但如果所有组件属性都未定义，则假定年、月和日为 <code>numeric</code> 。</p>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[EM算法]]></title>
      <url>https://jintang.github.io/2019/12/19/EM%E7%AE%97%E6%B3%95/</url>
      <content type="html"><![CDATA[<blockquote><p>引用自 <a href="https://github.com/NLP-LOVE/ML-NLP/tree/master/Machine%20Learning/6.%20EM" target="_blank" rel="noopener">NLP-LOVE/ML-NLP</a></p></blockquote><h2 id="什么是EM算法"><a href="#什么是EM算法" class="headerlink" title="什么是EM算法"></a>什么是EM算法</h2><p>数据挖掘十大算法之一的EM算法。</p><p>最大期望算法（Expectation-maximization algorithm，又译为期望最大化算法），是在概率模型中寻找参数最大似然估计或者最大后验估计的算法，其中概率模型依赖于无法观测的隐性变量。</p><p>最大期望算法经过两个步骤交替进行计算，</p><p><strong>第一步</strong>是计算期望（E），利用对隐藏变量的现有估计值，计算其最大似然估计值；<br><strong>第二步</strong>是最大化（M），最大化在E步上求得的最大似然值来计算参数的值。M步上找到的参数估计值被用于下一个E步计算中，这个过程不断交替进行。</p><p>极大似然估计用一句话概括就是：知道结果，反推条件θ。</p><a id="more"></a><h3 id="似然函数"><a href="#似然函数" class="headerlink" title="似然函数"></a>似然函数</h3><p>在数理统计学中，<strong>似然函数</strong>是一种关于统计模型中的参数的函数，表示模型参数中的似然性。“似然性”与“或然性”或“概率”意思相近，都是指某种事件发生的可能性。<strong>而极大似然就相当于最大可能的意思。</strong></p><p>比如你一位同学和一位猎人一起外出打猎，一只野兔从前方窜过。只听一声枪响，野兔应声到下，如果要你推测，这一发命中的子弹是谁打的？你就会想，只发一枪便打中，由于猎人命中的概率一般大于你那位同学命中的概率，从而推断出这一枪应该是猎人射中的。</p><p>这个例子所作的推断就体现了最大似然法的基本思想。</p><p><strong>多数情况下我们是根据已知条件来推算结果，而最大似然估计是已经知道了结果，然后寻求使该结果出现的可能性最大的条件，以此作为估计值。</strong></p><h3 id="极大似然函数的求解步骤"><a href="#极大似然函数的求解步骤" class="headerlink" title="极大似然函数的求解步骤"></a>极大似然函数的求解步骤</h3><p>假定我们要从10万个人当中抽取100个人来做身高统计，那么抽到这100个人的概率就是(概率连乘)：</p><p><img src="https://tang-blog-1257996120.cos.ap-chengdu.myqcloud.com/machine-learn/em_1.png" alt="em_1"></p><p>现在要求的就是这个 $\theta$ 值，也就是使得 $L(\theta)$ 的概率最大化，那么这时的参数 $\theta$ 就是所求。</p><p>为了便于分析，我们可以定义对数似然函数，将其变成连加的形式：</p><p><img src="https://tang-blog-1257996120.cos.ap-chengdu.myqcloud.com/machine-learn/em_2.png" alt="em_2"></p><p>对于求一个函数的极值，通过我们在本科所学的微积分知识，最直接的设想是求导，然后让导数为0，那么解这个方程得到的θ就是了（当然，前提是函数L(θ)连续可微）。但，如果θ是包含多个参数的向量那怎么处理呢？当然是求L(θ)对所有参数的偏导数，也就是梯度了，从而n个未知的参数，就有n个方程，方程组的解就是似然函数的极值点了，最终得到这n个参数的值。</p><p>求极大似然函数估计值的一般步骤：</p><ol><li>写出似然函数；</li><li>对似然函数取对数，并整理；</li><li>求导数，令导数为0，得到似然方程；</li><li>解似然方程，得到的参数即为所求；</li></ol><h3 id="EM算法"><a href="#EM算法" class="headerlink" title="EM算法"></a>EM算法</h3><p>两枚硬币A和B，假定随机抛掷后正面朝上概率分别为PA，PB。为了估计这两个硬币朝上的概率，咱们轮流抛硬币A和B，每一轮都连续抛5次，总共5轮：</p><table><thead><tr><th>硬币</th><th>结果</th><th>统计</th></tr></thead><tbody><tr><td>A</td><td>正正反正反</td><td>3正-2反</td></tr><tr><td>B</td><td>反反正正反</td><td>2正-3反</td></tr><tr><td>A</td><td>正反反反反</td><td>1正-4反</td></tr><tr><td>B</td><td>正反反正正</td><td>3正-2反</td></tr><tr><td>A</td><td>反正正反反</td><td>2正-3反</td></tr></tbody></table><p>硬币A被抛了15次，在第一轮、第三轮、第五轮分别出现了3次正、1次正、2次正，所以很容易估计出PA，类似的，PB也很容易计算出来(<strong>真实值</strong>)，如下：</p><p>PA = （3+1+2）/ 15 = 0.4<br>PB= （2+3）/10 = 0.5</p><p>问题来了，如果我们不知道抛的硬币是A还是B呢（即硬币种类是隐变量），然后再轮流抛五轮，得到如下结果：</p><table><thead><tr><th>硬币</th><th>结果</th><th>统计</th></tr></thead><tbody><tr><td>Unknown</td><td>正正反正反</td><td>3正-2反</td></tr><tr><td>Unknown</td><td>反反正正反</td><td>2正-3反</td></tr><tr><td>Unknown</td><td>正反反反反</td><td>1正-4反</td></tr><tr><td>Unknown</td><td>正反反正正</td><td>3正-2反</td></tr><tr><td>Unknown</td><td>反正正反反</td><td>2正-3反</td></tr></tbody></table><p>OK，问题变得有意思了。现在我们的目标没变，还是估计PA和PB，需要怎么做呢？</p><p>显然，此时我们多了一个硬币种类的隐变量，设为z，可以把它认为是一个5维的向量（z1,z2,z3,z4,z5)，代表每次投掷时所使用的硬币，比如z1，就代表第一轮投掷时使用的硬币是A还是B。</p><ul><li>但是，这个变量z不知道，就无法去估计PA和PB，所以，我们必须先估计出z，然后才能进一步估计PA和PB。</li><li>可要估计z，我们又得知道PA和PB，这样我们才能用极大似然概率法则去估计z，这不是鸡生蛋和蛋生鸡的问题吗，如何破？</li></ul><p>答案就是先随机初始化一个PA和PB，用它来估计z，然后基于z，还是按照最大似然概率法则去估计新的PA和PB，然后依次循环，如果新估计出来的PA和PB和我们真实值差别很大，直到<strong>PA和PB收敛到真实值为止。</strong></p><p>我们不妨这样，先随便给PA和PB赋一个值，比如：<br>硬币A正面朝上的概率PA = 0.2<br>硬币B正面朝上的概率PB = 0.7</p><p>然后，我们看看第一轮抛掷最可能是哪个硬币。<br>如果是硬币A，得出3正2反的概率为 0.2*0.2*0.2*0.8*0.8 = 0.00512<br>如果是硬币B，得出3正2反的概率为 0.7*0.7*0.7*0.3*0.3=0.03087<br>然后依次求出其他4轮中的相应概率。做成表格如下：</p><table><thead><tr><th>轮数</th><th>若是硬币A</th><th>若是硬币B</th></tr></thead><tbody><tr><td>1</td><td>0.00512，即0.2 0.2 0.2 0.8 0.8，3正-2反</td><td><strong>0.03087</strong>，3正-2反</td></tr><tr><td>2</td><td><strong>0.02048</strong>，即0.2 0.2 0.8 0.8 0.8，2正-3反</td><td>0.01323，2正-3反</td></tr><tr><td>3</td><td><strong>0.08192</strong>，即0.2 0.8 0.8 0.8 0.8，1正-4反</td><td>0.00567，1正-4反</td></tr><tr><td>4</td><td>0.00512，即0.2 0.2 0.2 0.8 0.8，3正-2反</td><td><strong>0.03087</strong>，3正-2反</td></tr><tr><td>5</td><td><strong>0.02048</strong>，即0.2 0.2 0.8 0.8 0.8，2正-3反</td><td>0.01323，2正-3反</td></tr></tbody></table><p>按照最大似然法则：<br>第1轮中最有可能的是<strong>硬币B</strong><br>第2轮中最有可能的是<strong>硬币A</strong><br>第3轮中最有可能的是<strong>硬币A</strong><br>第4轮中最有可能的是<strong>硬币B</strong><br>第5轮中最有可能的是<strong>硬币A</strong></p><p>我们就把概率更大，即更可能是A的，即第2轮、第3轮、第5轮出现正的次数2、1、2相加，除以A被抛的总次数15（A抛了三轮，每轮5次），作为z的估计值，B的计算方法类似。然后我们便可以按照最大似然概率法则来估计新的PA和PB。</p><p>PA = （2+1+2）/15 = 0.33<br>PB =（3+3）/10 = 0.6</p><p>设想我们是全知的神，知道每轮抛掷时的硬币就是如本文本节开头标示的那样，那么，PA和PB的最大似然估计就是0.4和0.5（下文中将这两个值称为PA和PB的真实值）。那么对比下我们初始化的PA和PB和新估计出的PA和PB：</p><table><thead><tr><th>初始化的PA</th><th>估计出的PA</th><th>真实的PA</th><th>初始化的PB</th><th>估计出的PB</th><th>真实的PB</th></tr></thead><tbody><tr><td>0.2</td><td>0.33</td><td>0.4</td><td>0.7</td><td>0.6</td><td>0.5</td></tr></tbody></table><p>就这样，不断迭代 不断接近真实值，这就是EM算法的奇妙之处。</p><p>可以期待，我们继续按照上面的思路，用估计出的PA和PB再来估计z，再用z来估计新的PA和PB，反复迭代下去，就可以最终得到PA = 0.4，PB=0.5，此时无论怎样迭代，PA和PB的值都会保持0.4和0.5不变，于是乎，我们就找到了PA和PB的最大似然估计。</p><p><strong>总结一下计算步骤：</strong></p><ol><li><p>随机初始化分布参数θ</p></li><li><p>E步，求Q函数，对于每一个i，计算根据上一次迭代的模型参数来计算出隐性变量的后验概率（其实就是隐性变量的期望），来作为隐藏变量的现估计值：</p><p><img src="http://wx1.sinaimg.cn/mw690/00630Defly1g57brmij1wj307l01cq2s.jpg" alt></p></li><li><p>M步，求使Q函数获得极大时的参数取值）将似然函数最大化以获得新的参数值</p><p><img src="http://wx1.sinaimg.cn/mw690/00630Defly1g57bswusk1j30de01s3yh.jpg" alt></p></li><li><p>然后循环重复2、3步直到收敛。</p></li></ol><p>详细的推导过程请参考文末的参考文献。</p><h2 id="采用-EM-算法求解的模型有哪些？"><a href="#采用-EM-算法求解的模型有哪些？" class="headerlink" title="采用 EM 算法求解的模型有哪些？"></a>采用 EM 算法求解的模型有哪些？</h2><p>用EM算法求解的模型一般有GMM或者协同过滤，k-means其实也属于EM。EM算法一定会收敛，但是可能收敛到局部最优，并不一定是极值。由于求和的项数将随着隐变量的数目指数上升，会给梯度计算带来麻烦。</p><h2 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h2><p>关于EM算法的应用其实很多，最广泛的就是GMM混合高斯模型、聚类、HMM等等。比如：<br><a href="https://github.com/NLP-LOVE/ML-NLP/tree/master/Machine%20Learning/6.%20EM/gmm_em" target="_blank" rel="noopener">高斯混合模型 EM 算法</a></p><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p><a href="https://blog.csdn.net/v_july_v/article/details/81708386" target="_blank" rel="noopener">如何通俗理解EM算法</a></p>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[机器学习算法—降维算法—PCA]]></title>
      <url>https://jintang.github.io/2019/08/27/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95%E2%80%94%E9%99%8D%E7%BB%B4%E7%AE%97%E6%B3%95%E2%80%94PCA/</url>
      <content type="html"><![CDATA[<blockquote><p>现实应用中属性维数经常成千上万。而许多学习方法都涉及距离计算，而高维空间会给距离计算带来很大的麻烦，例如当维数很高时甚至连计算内积都不再容易。</p><p>事实上，在高维情形下出现的数据样本稀疏、距离计算困难等问题，是所有机器学习方法共同面临的严重障碍，被称为 <strong>“维数灾难(curse of simensionality)”</strong>。缓解维数灾难的一个重要途径是 <strong>降维(dimension reduction)</strong> , 亦称 ”维数约简“, 即通过某种数学变换将原始高维属性空间转变为一个低维 ”子空间“(subspace)， 在这个子空间中样本密度大幅提高，距离计算也变得更为容易。</p><p>为什么可以降维呢？ 因为很多时候，人们观测或者收集到的数据样本虽然是高维的，但与学习任务密切相关的也许仅是某个低维分布，即高维空间的一个低维 ”嵌入“。例如：数据属性中存在噪声属性、相似属性或冗余属性等，<strong>对高维数据进行降维能在一定程度上达到提炼低维优质属性或降噪的效果。</strong></p><p>在很多算法中，降维算法成为了数据预处理的一部分，如 <code>PCA</code></p></blockquote><h3 id="降维算法简介"><a href="#降维算法简介" class="headerlink" title="降维算法简介"></a>降维算法简介</h3><p>目前已经存在大量的数据降维算法，可以从另个不同的维度对它们进行分类。按照是否有使用样本的标签值，可以将降维算法分为 <strong>有监督降维</strong> 和 <strong>无监督降维</strong> ；按照降维算法使用的映射函数，可以将算法分为 <strong>线性降维</strong> 与 <strong>非线性降维</strong> 。</p><ul><li><strong>无监督降维算法</strong> 不使用样本标签值，因此是一种无监督学习算法，其典型代表是 <code>PCA</code> 。<strong>有监督的降维算法</strong> 则使用了样本标签值，是一种有监督学习算法，其典型代表是 <code>LDA</code></li><li><strong>线性降维算法</strong> 根据样本集构造出线性函数完成向低维空间的映射。一般通过对向量 $x$ 进行线性变换即左乘一个投影矩阵 $W$ 而得到结果向量 $y$ ： $y = Wx$ ， <code>PCA</code> 和 <code>LDA</code> 都是 <strong>线性降维算法</strong> ; 非线性降维算法则构造一个非线性映射完成数据的降维。很多时候数据是非线性的，因此需要使用 <strong>非线性降维算法</strong> 以取得更好的效果，<code>LLE</code> 就是一种 <strong>非线性降维算法</strong></li></ul><p>对于 <strong>线性降维</strong>，我们主要使用 <strong>投影</strong> 的方法。对于 <strong>非线性降维</strong>， 我们主要使用 <strong>流形学习</strong>。<strong>流形学习（manifold learning）</strong> 是一种借助拓扑流形概念的降维方法，流形是指在局部与欧式空间同胚的空间，即在局部与欧式空间具有相同的性质，能用欧氏距离计算样本之间的距离。这样即使高维空间的分布十分复杂，但是在局部上依然满足欧式空间的性质，基于流形学习的降维正是这种 <strong>“邻域保持”</strong> 的思想。可以简单的将流形理解成二维空间的曲线，三维空间的曲面，等几何体在更高维空间的推广。</p><p>有时候， <strong>投影</strong> 并不是降维的最佳方法。在很多情况下，子空间可能会扭曲和转动，比如图所示的著名的瑞士卷数据集：<br><img src="https://tang-blog-1257996120.cos.ap-chengdu.myqcloud.com/machine-learn/swiss_roll_data.jpeg" alt="swiss_roll_data"><br>简单地将数据集投射到一个平面上会将瑞士卷的不同层叠在一起，如图左侧所示。但是，你真正想要的是展开瑞士卷所获取到的类似图右侧的 2D 数据集。这时候就需要使用 <strong>流形学习</strong>。<br><img src="https://tang-blog-1257996120.cos.ap-chengdu.myqcloud.com/machine-learn/swill_roll_reduce.jpeg" alt="swill_roll_reduce"></p><p>所以采用哪种方式降维，这一切都取决于数据集。</p><p>大概介绍一下几个比较出名的降维算法： <code>PCA</code> 、 <code>LDA</code> 、 <code>LLE</code></p><a id="more"></a><ul><li><p><code>PCA</code> ，Principle Component Analysis，即主成分分析法，是特征降维的最常用手段，是最基础的 <strong>无监督降维算法</strong> 。顾名思义， <code>PCA</code> 能从冗余特征中提取主要成分，在不太损失模型质量的情况下，提升了模型训练速度。</p><p>它的目标是通过某种线性投影，将高维的数据映射到低维的空间中表示，并期望在所投影的维度上数据的方差最大，以此使用较少的数据维度，同时保留住较多的原数据点的特性。</p><p>通俗的理解，如果把所有的点都映射到一起，那么几乎所有的信息（如点和点之间的距离关系）都丢失了，而如果映射后方差尽可能的大，那么数据点则会分散开来，以此来保留更多的信息。可以证明，PCA是丢失原始数据信息最少的一种线性降维方式。如图：<br><img src="https://tang-blog-1257996120.cos.ap-chengdu.myqcloud.com/machine-learn/pca_compare.jpeg" alt="pca_compare"><br>正如我们所看到的，投影到实线上保留了 <strong>最大方差</strong>。选择保持 <strong>最大方差</strong> 的轴看起来是合理的，因为它很可能比其他投影损失更少的信息。证明这种选择的另一种方法是，选择这个轴使得将原始数据集投影到该轴上的均方距离最小。这两种做法对应了 <code>PCA</code> 的两种性质，而且得到了相同的结果。</p></li><li><code>LDA</code> ， 线性判别分析, 一种 <strong>有监督的线性降维算法</strong> 。其基本思想是：将训练样本投影到一条直线上，使得同类的样例尽可能近，不同类的样例尽可能远。如图所示：<br><img src="https://tang-blog-1257996120.cos.ap-chengdu.myqcloud.com/machine-learn/lda.png" alt="lda"><br>对新的样本进行分类时，只需将该样本点投影到这条直线上，根据与各个类别的中心值进行比较，从而判定出新样本与哪个类别距离最近。</li><li><code>LLE</code> , manifold learning , 即局部线性嵌入。是一种经典的 <strong>流形学习</strong> 算法。它的目标是 保持邻域内样本之间的线性关系。</li></ul><p>降维除了可以加快训练速度外，在数据可视化方面也十分有用。降低特征维度到 2（或者 3）维从而可以在图中画出一个高维度的训练集，让我们可以通过视觉直观的发现一些非常重要的信息，比如 <strong>聚类</strong>。</p><h3 id="PCA算法原理"><a href="#PCA算法原理" class="headerlink" title="PCA算法原理"></a>PCA算法原理</h3><p><code>主成分分析（PCA）</code> 直接通过一个线性变换，将原始空间中的样本投影到新的低维空间中。简单来理解这一过程便是： <code>PCA</code> 采用一组新的基来表示样本点，其中每一个基向量都是原来基向量的线性组合，通过使用尽可能少的新基向量来表出样本，从而达到降维的目的。</p><p>根据 <code>PCA</code> 的目标，它有这两个重要的性质：</p><ul><li>最近重构性：样本点到超平面的距离足够近，即尽可能在超平面附近；</li><li>最大可分性：样本点在超平面上的投影尽可能地分散开来，即投影后的坐标具有区分性。满足上面所说的 <strong>最大方差理论</strong> 。</li></ul><p>举个例子：假设我们要将特征从 n 维度降到 k 维：PCA 首先找寻 k 个 n 维向量，然后将特征投影到这些向量构成的 k 维空间，并保证投影误差足够小。下图中中，为了将特征维度从三维降低到二位，PCA 就会先找寻两个三维向量 $u^{(1)}$ , $u^{(2)}$ ，二者构成了一个二维平面，然后将原来的三维特征投影到该二维平面上：<br><img src="https://tang-blog-1257996120.cos.ap-chengdu.myqcloud.com/machine-learn/PCA3D22D.png" alt="pca3d22d"></p><h4 id="PCA算法步骤"><a href="#PCA算法步骤" class="headerlink" title="PCA算法步骤"></a>PCA算法步骤</h4><p><strong>最近重构性与最大可分性虽然从不同的出发点来定义优化问题中的目标函数，但最终这两种特性得到了完全相同的优化问题。</strong> 所以可以得到以下推导：<br><img src="https://tang-blog-1257996120.cos.ap-chengdu.myqcloud.com/machine-learn/pca_derivation.png" alt="pca_derivation"><br>接着使用拉格朗日乘子法求解上面的优化问题，得到：<br><img src="https://tang-blog-1257996120.cos.ap-chengdu.myqcloud.com/machine-learn/pca_fangcha.png" alt="pca_xiefangcha"><br>因此只需对协方差矩阵进行特征值分解即可求解出投影矩阵 $W$ ，<code>PCA</code> 算法的整个流程如下图所示：<br><img src="https://tang-blog-1257996120.cos.ap-chengdu.myqcloud.com/machine-learn/pca-progress.png" alt="pca-progress"><br>所以我们的新样本是：<br>$$Z = XW$$</p><blockquote><p><strong>直观点的例子：</strong></p><ol><li>原始数据集矩阵 X：<br>$$\left[ \begin{array}{cc} 1 &amp; 1 &amp; 2 &amp; 4 &amp; 2 \\ 1 &amp; 3 &amp; 3 &amp; 4 &amp; 4 \end{array} \right]$$</li><li>中心化后：<br>$$\left[ \begin{array}{cc} -1 &amp; -1 &amp; 0 &amp; 2 &amp; 0 \\ -2 &amp; 0 &amp; 0 &amp; 1 &amp; 1 \end{array} \right]$$</li><li>再求协方差矩阵：<br>$$C = \frac15\left[ \begin{array}{cc} -1 &amp; -1 &amp; 0 &amp; 2 &amp; 0 \\ -2 &amp; 0 &amp; 0 &amp; 1 &amp; 1 \end{array} \right]\left[ \begin{array}{cc} -1 &amp; -2 \\ -1 &amp; 0 \\ 0 &amp; 0 \\ 2 &amp; 1 \\ 0 &amp; 1 \end{array} \right] = \left[ \begin{array}{cc} \frac65 &amp; \frac45 \\ \frac45 &amp; \frac65 \end{array} \right]$$</li><li>特征值：<br>$$λ_1 = 2, λ_2 = \frac25 $$</li><li>对应的特征向量:<br>$$c1 = \left[ \begin{array}{cc} \frac{1}{\sqrt2} \\ \frac{1}{\sqrt2} \end{array} \right], c2 = \left[ \begin{array}{cc} -\frac{1}{\sqrt2} \\ \frac{1}{\sqrt2} \end{array} \right]$$</li><li>标准化：<br>$$P = \left[ \begin{array}{cc} \frac{1}{\sqrt2} &amp; \frac{1}{\sqrt2} \\ -\frac{1}{\sqrt2} &amp; \frac{1}{\sqrt2} \end{array} \right]$$</li><li>选择较大特征值对应的特征向量：<br>$$W = \left[ \begin{array}{cc} \frac{1}{\sqrt2} &amp; \frac{1}{\sqrt2} \end{array} \right]$$</li><li>执行 <code>PCA</code> 变换：$Z=WX$ 得到的 Z 就是 <code>PCA</code> 降维后的值 数据集矩阵:<br>$$Z = \left[ \begin{array}{cc} \frac{1}{\sqrt2} &amp; \frac{1}{\sqrt2} \end{array} \right]\left[ \begin{array}{cc} -1 &amp; -1 &amp; 0 &amp; 2 &amp; 0 \\ -2 &amp; 0 &amp; 0 &amp; 1 &amp; 1 \end{array} \right] = \left[ \begin{array}{cc} -\frac{1}{\sqrt2} &amp; -\frac{1}{\sqrt2} &amp; 0 &amp; \frac{3}{\sqrt2} &amp; \frac{1}{\sqrt2} \end{array} \right]$$</li></ol></blockquote><h4 id="PCA-降维后的恢复"><a href="#PCA-降维后的恢复" class="headerlink" title="PCA 降维后的恢复"></a>PCA 降维后的恢复</h4><p>通过上面的步骤将数据进行了压缩，同样，可以通过逆向流程来恢复数据。由于：<br>$$Z=XW$$<br>因此：<br>$$X_{approx}=ZW^T$$<br>之所以用 Xapprox，是因为恢复后的数据会有一定的误差。如下图所示，左边为原始数据，右边为恢复后的数据。<br><img src="https://tang-blog-1257996120.cos.ap-chengdu.myqcloud.com/machine-learn/pca-recover.svg" alt="pca-recover"></p><h4 id="PCA-降到多少维才合适？"><a href="#PCA-降到多少维才合适？" class="headerlink" title="PCA 降到多少维才合适？"></a>PCA 降到多少维才合适？</h4><p>从 <code>PCA</code> 的执行流程中，我们知道，需要为 <code>PCA</code> 指定目的维度 $d’$ 。如果降维不多，则性能提升不大；如果目标维度太小，则又丢失了许多信息。</p><p>降维后低维空间的维数 $d’$ 通常由用户先指定， 或通过在 $d’$ 值不同的低维空间中对 <strong>$k$ 近邻分类器</strong>（或其他开销较小的学习算法） 进行交叉验证来选取较好的 $d’$ 值。对 <code>PCA</code> ，还可以从重构的角度来设置一个重构阈值，例如 $t = 95\% $ ，然后选择使得下式成立的最小的 $d’$ 值：</p><p><img src="https://tang-blog-1257996120.cos.ap-chengdu.myqcloud.com/machine-learn/d_formula.png" alt="d_formula"></p><h4 id="PCA-的作用和效果"><a href="#PCA-的作用和效果" class="headerlink" title="PCA 的作用和效果"></a>PCA 的作用和效果</h4><p>显然，低维空间和原始高维空间必有不同，因为对应于最小的 $d - d’$ 个特征值的特征向量被舍弃了，这是降维导致的结果。但舍弃这一部分信息往往是必要的： 一方面，舍弃这部分信息后使得样本的采样密度增大，这是降维的重要动机；另一方面，当数据收到噪声影响时，最小的特征值所对应的特征向量往往与噪声有关，将他们舍弃能在一定程度上起到去噪的作用。</p><h3 id="PCA算法实例"><a href="#PCA算法实例" class="headerlink" title="PCA算法实例"></a>PCA算法实例</h3><p>首先我们利用 <strong>奇异值分解</strong> 实现一个 <code>pca</code> 算法，我们也可以直接使用 <a href="https://scikit-learn.org/stable/modules/generated/sklearn.decomposition.PCA.html#sklearn.decomposition.PCA" target="_blank" rel="noopener">Scikit-Learn 的 PCA 类</a>，以供后面的实例使用， 代码如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding: utf8</span></span><br><span class="line"><span class="comment"># pca/pca.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">normalize</span><span class="params">(X)</span>:</span></span><br><span class="line">    <span class="string">"""数据标准化处理</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        X 样本</span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">        XNorm 标准化后的样本</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    XNorm = X.copy()</span><br><span class="line">    m,n = XNorm.shape</span><br><span class="line">    mean = np.mean(XNorm, axis=<span class="number">0</span>)</span><br><span class="line">    std = np.std(XNorm, axis=<span class="number">0</span>)</span><br><span class="line">    XNorm = (XNorm - mean) / std</span><br><span class="line">    <span class="keyword">return</span> XNorm</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">PCA</span><span class="params">(X, k = <span class="number">1</span>)</span>:</span></span><br><span class="line">    <span class="string">"""PCA</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        X 样本</span></span><br><span class="line"><span class="string">        k 目的维度</span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">        XNorm 标准化后的样本</span></span><br><span class="line"><span class="string">        Z 降维后的新样本</span></span><br><span class="line"><span class="string">        U U</span></span><br><span class="line"><span class="string">        UReduce 约减矩阵  Ureduce，即投影矩阵</span></span><br><span class="line"><span class="string">        S S</span></span><br><span class="line"><span class="string">        V V</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    m, n = X.shape</span><br><span class="line">    <span class="comment"># 数据中心化</span></span><br><span class="line">    XNorm = normalize(X)</span><br><span class="line">    <span class="comment"># 计算协方差矩阵</span></span><br><span class="line">    Coef = XNorm.T * XNorm/m</span><br><span class="line">    <span class="comment"># 奇异值分解</span></span><br><span class="line">    U, S, V = np.linalg.svd(Coef)</span><br><span class="line">    <span class="comment"># 取出前 k 个向量</span></span><br><span class="line">    UReduce = U[:, <span class="number">0</span>:k]</span><br><span class="line">    Z = XNorm * UReduce</span><br><span class="line">    <span class="keyword">return</span> XNorm, Z, U, UReduce, S, V</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">recover</span><span class="params">(UReduce, Z)</span>:</span></span><br><span class="line">    <span class="string">"""数据恢复</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        UReduce 约减矩阵  Ureduce，即投影矩阵</span></span><br><span class="line"><span class="string">        Z 降维后的样本</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">return</span> Z * UReduce.T</span><br></pre></td></tr></table></figure><h4 id="PCA-for-加速学习"><a href="#PCA-for-加速学习" class="headerlink" title="PCA for 加速学习"></a>PCA for 加速学习</h4><p>现在，我们手上有一个人脸数据集，每张图片大小为 32×32 ，以像素为特征，则每个特征向量的维度就为 1024 维：</p><p><img src="https://tang-blog-1257996120.cos.ap-chengdu.myqcloud.com/machine-learn/face_before_pca.png" alt="face_before_pca"></p><p>使用 <code>PCA</code> 进行降低特征维度到 100 维：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding: utf8</span></span><br><span class="line"><span class="comment"># pca/test_pca4visualization.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> pca</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span> scipy.io <span class="keyword">import</span> loadmat</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">display</span><span class="params">(images, width, height)</span>:</span></span><br><span class="line">    <span class="string">"""展示图片</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        images 图像样本</span></span><br><span class="line"><span class="string">        width 图像宽</span></span><br><span class="line"><span class="string">        height 图像高</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    m, n = images.shape</span><br><span class="line">    rows = int(np.floor(np.sqrt(m)))</span><br><span class="line">    cols = int(np.ceil(m / rows))</span><br><span class="line">    <span class="comment"># 图像拼接</span></span><br><span class="line">    dstImage = images.copy()</span><br><span class="line">    dstImage = np.zeros((rows * height, cols * width))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(rows):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(cols):</span><br><span class="line">            idx = cols * i + j</span><br><span class="line">            image = images[idx].reshape(height, width)</span><br><span class="line">            dstImage[i * height:i * height + height,</span><br><span class="line">                     j * width: j * width + width] = image</span><br><span class="line">    plt.imshow(dstImage.T, cmap=<span class="string">'gray'</span>)</span><br><span class="line">    plt.axis(<span class="string">'off'</span>)</span><br><span class="line">    plt.show()</span><br><span class="line"></span><br><span class="line">data = loadmat(<span class="string">'data/ex7faces.mat'</span>)</span><br><span class="line">X = np.mat(data[<span class="string">'X'</span>],dtype=np.float32)</span><br><span class="line">m, n = X.shape</span><br><span class="line"></span><br><span class="line"><span class="comment"># 展示原图</span></span><br><span class="line">display(X[<span class="number">0</span>:<span class="number">100</span>, :], <span class="number">32</span>, <span class="number">32</span>)</span><br><span class="line"></span><br><span class="line">XNorm, Z, U, UReduce, S, V = pca.PCA(X, k=<span class="number">100</span>)</span><br><span class="line">XRec = pca.recover(UReduce, Z)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示修复后的图，可以看出，PCA 损失了一部分细节</span></span><br><span class="line">display(XRec[<span class="number">0</span>:<span class="number">100</span>, :], <span class="number">32</span>, <span class="number">32</span>)</span><br></pre></td></tr></table></figure><p>结果如下, 可以看到，我们的人脸数据变得模糊，但是眼睛，鼻子，嘴唇等特征仍然可辨识：</p><p><img src="https://tang-blog-1257996120.cos.ap-chengdu.myqcloud.com/machine-learn/face_after_pca.png" alt="face_after_pca"></p><h4 id="PCA-for-数据可视化"><a href="#PCA-for-数据可视化" class="headerlink" title="PCA for 数据可视化"></a>PCA for 数据可视化</h4><p>我们有一张小鸟的图片，这是一个三通道彩色图像：</p><p><img src="https://tang-blog-1257996120.cos.ap-chengdu.myqcloud.com/machine-learn/bird_small.png" alt="bird"></p><p>我们将图片的像素按颜色进行聚类，并在三维空间观察聚类成果：</p><p><img src="https://tang-blog-1257996120.cos.ap-chengdu.myqcloud.com/machine-learn/3D_data.png" alt="3d_data"></p><p>似乎在三维空间可视化不是那么直观，借助于 <code>PCA</code> ，我们将聚类结果降到二维空间进行可视化：</p><p><img src="https://tang-blog-1257996120.cos.ap-chengdu.myqcloud.com/machine-learn/2D_data.png" alt="2d_data"></p><p>示例代码：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding: utf8</span></span><br><span class="line"><span class="comment"># pca/test_pca4visualization.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> kmeans</span><br><span class="line"><span class="keyword">import</span> pca</span><br><span class="line"><span class="keyword">from</span> scipy.io <span class="keyword">import</span> loadmat</span><br><span class="line"><span class="keyword">from</span> mpl_toolkits.mplot3d <span class="keyword">import</span> Axes3D</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> matplotlib.cm <span class="keyword">as</span> cmx</span><br><span class="line"><span class="keyword">import</span> matplotlib.colors <span class="keyword">as</span> colors</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getCmap</span><span class="params">(count)</span>:</span></span><br><span class="line">    color_norm  = colors.Normalize(vmin=<span class="number">0</span>, vmax=count<span class="number">-1</span>)</span><br><span class="line">    scalar_map = cmx.ScalarMappable(norm=color_norm, cmap=<span class="string">'hsv'</span>)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">map_index_to_rgb_color</span><span class="params">(index)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> scalar_map.to_rgba(index)</span><br><span class="line">    <span class="keyword">return</span> map_index_to_rgb_color</span><br><span class="line"></span><br><span class="line">fig = plt.figure()</span><br><span class="line">ax = fig.add_subplot(<span class="number">111</span>, projection=<span class="string">'3d'</span>)</span><br><span class="line"></span><br><span class="line">data = loadmat(<span class="string">'data/bird_small.mat'</span>)</span><br><span class="line">A = data[<span class="string">'A'</span>]</span><br><span class="line"></span><br><span class="line">A = A / <span class="number">255.0</span>;</span><br><span class="line"></span><br><span class="line">height, width, channels = A.shape</span><br><span class="line">X = np.mat(A.reshape(height * width, channels))</span><br><span class="line"></span><br><span class="line">m, n = X.shape</span><br><span class="line"></span><br><span class="line">clusterNum = <span class="number">16</span></span><br><span class="line">cmap = getCmap(clusterNum)</span><br><span class="line">centroids, clusterAssment = kmeans.kMeans(X, clusterNum)</span><br><span class="line"><span class="comment"># 随机选择 1000 个样本绘制</span></span><br><span class="line">sampleSize = <span class="number">1000</span></span><br><span class="line">sampleIndexs = np.random.choice(m, sampleSize)</span><br><span class="line">clusters = clusterAssment[sampleIndexs]</span><br><span class="line">samples = X[sampleIndexs]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 三维下观察</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(sampleSize):</span><br><span class="line">    x, y, z = samples[i,:].A[<span class="number">0</span>]</span><br><span class="line">    center = clusters[i, <span class="number">0</span>]</span><br><span class="line">    color = cmap(center)</span><br><span class="line">    ax.scatter([x], [y], [z], color=color, marker=<span class="string">'o'</span>)</span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 二维下观察</span></span><br><span class="line">reducedSamples = pca.PCA(samples, k=<span class="number">2</span>)[<span class="number">1</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(sampleSize):</span><br><span class="line">    x, y = reducedSamples[i,:].A[<span class="number">0</span>]</span><br><span class="line">    center = clusters[i, <span class="number">0</span>]</span><br><span class="line">    color = cmap(center)</span><br><span class="line">    plt.scatter([x], [y], color=color, marker=<span class="string">'o'</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><p></p><h3 id="PCA-引申"><a href="#PCA-引申" class="headerlink" title="PCA 引申"></a>PCA 引申</h3><p>线性降维方法假设聪高维空间到低维空间的函数映射都是线性的，然而，在不少现实任务中，可能需要非线性映射才能找到恰当的低维嵌入。例如：<br><img src="https://tang-blog-1257996120.cos.ap-chengdu.myqcloud.com/machine-learn/pca_k.png" alt="pca_k"><br>如上所示，如果直接使用线性降维方法对三维空间观察到的样本点进行降维，则将丢失原本的低维结构，我们需要的是 “本真二维结构”</p><p>在上面我们提到了 <strong>流形学习</strong> ，这儿我们还有另外一种方法，基于核技巧对线性降维方法进行 <strong>”核化“</strong> ，其实即先将样本映射到高维空间，再在高维空间中使用线性降维的方法。</p><p><code>PCA</code> 可以通过 <strong>核化</strong> 生成 <strong>核主成分分析（KPCA）</strong> ，它通常能够很好地保留投影后的簇，有时甚至可以展开分布近似于扭曲流形的数据集。</p><p>下图 展示了使用线性核， <code>RBF</code> 核， <code>sigmoid</code> 核 将瑞士卷降到 2 维。<br><img src="https://tang-blog-1257996120.cos.ap-chengdu.myqcloud.com/machine-learn/kpca.jpeg" alt="kpca"></p><p>选择最佳的 <strong>核方法</strong> 和 <strong>超参数值</strong> 是另外一部分复杂的部分，这儿简单带过，感兴趣的同学自己研究下。</p><blockquote><p><strong>参考链接：</strong></p><ul><li><a href="https://yoyoyohamapi.gitbooks.io/mit-ml/content/%E7%89%B9%E5%BE%81%E9%99%8D%E7%BB%B4/articles/PCA.html" target="_blank" rel="noopener">斯坦福机器学习笔记</a></li><li><a href="https://github.com/Vay-keen/Machine-learning-learning-notes" target="_blank" rel="noopener">周志华《机器学习》学习笔记</a></li></ul></blockquote>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Service Workers 简单实例与学习]]></title>
      <url>https://jintang.github.io/2019/07/12/Service-Workers-%E7%AE%80%E5%8D%95%E5%AE%9E%E4%BE%8B%E4%B8%8E%E5%AD%A6%E4%B9%A0/</url>
      <content type="html"><![CDATA[<blockquote><p><code>Service Workers</code> 可以让你的网页在离线模式下访问。 附几个链接：</p><ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Service_Worker_API/Using_Service_Workers" target="_blank" rel="noopener">Service Workers 使用文档</a></li><li><a href="https://developers.google.com/web/tools/workbox/guides/get-started" target="_blank" rel="noopener">Workbox</a>：快速构建 <code>Service Workers</code> 的工具</li><li><a href="https://medium.com/google-developer-experts/a-5-minute-intro-to-workbox-3-0-156803952b3e" target="_blank" rel="noopener">A 5 minute intro to Workbox 3.0</a></li></ul></blockquote><h3 id="前情提要"><a href="#前情提要" class="headerlink" title="前情提要"></a>前情提要</h3><ul><li>目前有的浏览器还不支持，比如 <code>IE</code> … 使用前请用 <a href="https://caniuse.com/#search=service%20worker" target="_blank" rel="noopener">caniuse</a> 查询支持情况</li><li><code>https</code> 的页面才支持。为了调试，本地 <code>localhost</code> 也可以</li></ul><p>通过观察拥有 <code>Service Workers</code> 的网站，比如说 <a href="https://996.icu" target="_blank" rel="noopener">996.ICU</a> ,通过打开 <strong>Chrome dev tools =&gt; Application =&gt; Service Workers</strong> 选项，可以看到这个网站注册了一个 <code>Service Workers</code>， 它使用的源文件是 <a href="https://996.icu/service-worker.js" target="_blank" rel="noopener">service-worker.js</a> ，点击打开可以看到里面的代码，这个很简单，而且使用 <code>workbox</code> 生成的。</p><p>其实我们的浏览器会记录所有访问过的网站里面有 <code>Service Workers</code> 的。在上面的调试窗口下，可以看到 <strong>996.icu</strong> 下面还有一个 <strong>Service workers from other domains</strong> 的选项，打开就可以看到其他使用 <code>Service Workers</code> 的网站了。我看了我访问过的那些网站， 除了 <a href="https://lodash.com/sw.js" target="_blank" rel="noopener">lodash 的 sw.js</a> 不知道用什么生成的外，其他的都用的是 <code>workbox</code> 生成的。</p><p>下面简单说一下步骤，简单明了，保证你一看就会。就以 <a href="https://github.com/jintangWang/frontend-nanodegree-mobile-portfolio" target="_blank" rel="noopener">frontend-nanodegree-mobile-portfolio</a>（这是上一篇博文<a href="https://jintang.github.io/2019/07/02/%E7%BD%91%E9%A1%B5%E5%85%B3%E9%94%AE%E6%B8%B2%E6%9F%93%E8%B7%AF%E5%BE%84/">网页关键渲染路径</a>中的实例仓库） 为例</p><a id="more"></a><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight q"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install workbox-cli --<span class="built_in">save</span>-<span class="built_in">dev</span></span><br></pre></td></tr></table></figure><h3 id="生成配置文件"><a href="#生成配置文件" class="headerlink" title="生成配置文件"></a>生成配置文件</h3><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">npx workbox wizard</span></span><br></pre></td></tr></table></figure><p>这个命令会产生交互式的操作，询问你要缓存的文件：<br><img src="https://tang-blog-1257996120.cos.ap-chengdu.myqcloud.com/workbox-wizard.png" alt="workbox-wizard"><br>在填写完之后会在根目录生成一个 <code>workbox-config.js</code>， 里面就是你选择的内容</p><h3 id="生成-sw-js"><a href="#生成-sw-js" class="headerlink" title="生成 sw.js"></a>生成 sw.js</h3><p>从上图可以看到，命令行提示你输入<br></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">workbox</span> <span class="selector-tag">generateSW</span> <span class="selector-tag">workbox-config</span><span class="selector-class">.js</span></span><br></pre></td></tr></table></figure><p></p><p>然后再 <code>dist/</code> 目录下就会多出一个 <code>sw.js</code> ，这就是我们需要的。</p><h3 id="注册-service-worker"><a href="#注册-service-worker" class="headerlink" title="注册 service worker"></a>注册 service worker</h3><p>在 <code>index.html</code> 下添加如下代码， 因为我 <code>dist/</code> 目录下的文件都是由 <code>src/</code> 下的文件生成的，所以我修改的是 <code>src/</code> 下的 <code>index.html</code> 并重新打包<br></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="actionscript"><span class="keyword">if</span> (<span class="string">'serviceWorker'</span> <span class="keyword">in</span> navigator) &#123;</span></span><br><span class="line"><span class="javascript">   <span class="built_in">window</span>.addEventListener(<span class="string">'load'</span>, () =&gt; &#123;</span></span><br><span class="line"><span class="actionscript">      navigator.serviceWorker.register(<span class="string">'/sw.js'</span>);</span></span><br><span class="line"><span class="undefined">   &#125;);</span></span><br><span class="line"><span class="undefined"> &#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><h3 id="部署并访问"><a href="#部署并访问" class="headerlink" title="部署并访问"></a>部署并访问</h3><p>本地启动服务测试一下，因为我这只是简单的静态页面，所以我用 <a href="http://www.browsersync.cn/" target="_blank" rel="noopener">Browsersync</a> 工具启动服务。</p><p><code>dist/</code> 目录下运行以下命令<br></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">browser-sync</span> <span class="selector-tag">start</span> <span class="selector-tag">--server</span> <span class="selector-tag">--files</span> "**<span class="comment">/*.css, **/</span>*<span class="selector-class">.html</span>, *<span class="selector-class">.html</span>"</span><br></pre></td></tr></table></figure><p></p><p>关闭网络后刷新页面，页面还是可以访问，说明缓存成功。</p><p>将这些代码重新部署到服务器上进行访问，这儿我用的是 <code>github pages</code> ，正好有 <code>https</code>。</p><p>在 <strong>Chrome dev tools =&gt; Network</strong> 下可以看到很多带有 ⚙️ 图标的请求，这些都是 <code>Service Workers</code> 的请求，同时可以在<strong>Chrome dev tools =&gt; Application =&gt; Service Workers</strong> 下看到当前网站注册的 <code>Service Workers</code>。</p><p><img src="https://tang-blog-1257996120.cos.ap-chengdu.myqcloud.com/service-worker-result.png" alt="service worker result"></p><p>最后附上该实例的 <a href="https://jintangwang.github.io/frontend-nanodegree-mobile-portfolio/dist/" target="_blank" rel="noopener">地址</a></p><h3 id="添加自己的-sw-js-的代码"><a href="#添加自己的-sw-js-的代码" class="headerlink" title="添加自己的 sw.js 的代码"></a>添加自己的 <code>sw.js</code> 的代码</h3><p>上面我们的 <code>sw.js</code> 是由命令行生成的。如果我们想添加点自己的代码，直接修改 <code>sw.js</code> 是不行的，因为每次重新运行命令行都会重新生成。做法如下：</p><ol><li><p>创建 <code>src-sw.js</code>,如：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">importScripts(<span class="string">"https://storage.googleapis.com/workbox-cdn/releases/4.3.1/workbox-sw.js"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自己的代码开始...</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'this is my custom service worker'</span>); </span><br><span class="line"><span class="comment">// 自己的代码结束...</span></span><br><span class="line"></span><br><span class="line">workbox.precaching.precacheAndRoute([]);</span><br></pre></td></tr></table></figure></li><li><p>在 <code>workbox-config.js</code> 底部添加一行;</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"swSrc"</span>: <span class="string">"src-sw.js"</span></span><br></pre></td></tr></table></figure></li><li><p>运行命令将预缓存的资源数组注入：</p><pre><code class="js"><span class="comment">// 会注入到我们写的 workbox.precaching.precacheAndRoute([]);</span>
<span class="comment">// 不能使用 workbox generateSW workbox-config.js 语句生成 sw.js 了。</span>
npx workbox injectManifest
</code></pre></li></ol><p>重新查看 <code>sw.js</code> 即可看到里面既有自己的代码，也有生成的关于缓存的代码。</p><h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><p>如果要缓存 <code>api</code> 请求，要使用 <code>workbox.routing.registerRoute()</code> 。此处不再详述。</p>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[网页关键渲染路径]]></title>
      <url>https://jintang.github.io/2019/07/02/%E7%BD%91%E9%A1%B5%E5%85%B3%E9%94%AE%E6%B8%B2%E6%9F%93%E8%B7%AF%E5%BE%84/</url>
      <content type="html"><![CDATA[<blockquote><p>详细请阅读 <a href="https://developers.google.com/web/fundamentals/performance/critical-rendering-path/" target="_blank" rel="noopener">google文档</a> ，这儿记录一些关键的总结<br><code>udacity</code> 有个课程也讲得很详细： <a href="https://classroom.udacity.com/courses/ud884" target="_blank" rel="noopener">课程</a></p></blockquote><h3 id="浏览器首次渲染的几个步骤"><a href="#浏览器首次渲染的几个步骤" class="headerlink" title="浏览器首次渲染的几个步骤"></a>浏览器首次渲染的几个步骤</h3><ol><li>处理 <code>HTML</code> 标记并构建 <code>DOM</code> 树。</li><li>处理 <code>CSS</code> 标记并构建 <code>CSSOM</code> 树。</li><li>将 <code>DOM</code> 与 <code>CSSOM</code> 合并成一个渲染树。渲染树不包括不可见的元素（如： <code>header</code> 下所有，<code>display:none;</code> 的元素，但包括 <code>visibility:hidden;</code> 的元素）</li><li>Layout : 根据渲染树来布局，以计算每个节点的几何信息。</li><li>Paint : 将各个节点绘制到屏幕上。</li></ol><p><strong>优化关键渲染路径就是指最大限度缩短执行上述第 1 步至第 5 步耗费的总时间。</strong> 这样一来，就能尽快将内容渲染到屏幕上，此外还能缩短首次渲染后屏幕刷新的时间，即为交互式内容实现更高的刷新率。</p><a id="more"></a><h3 id="检测并分析"><a href="#检测并分析" class="headerlink" title="检测并分析"></a>检测并分析</h3><h4 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h4><ol><li><a href="https://chrome.google.com/webstore/detail/lighthouse/blipmdconlkpinefehnmjammfjpmpbjk" target="_blank" rel="noopener">Lighthouse Chrome 扩展程序</a></li><li><p><code>Navigation Timing API</code>:</p><p>首先了解一下页面加载时的浏览器事件：<br><img src="https://tang-blog-1257996120.cos.ap-chengdu.myqcloud.com/browser-timing.png" alt="浏览器加载过程"><br>几个关键的事件：</p><ul><li><code>domInteractive</code> 表示 DOM 准备就绪的时间点。</li><li><code>domContentLoaded</code> 一般表示 DOM 和 CSSOM 均准备就绪的时间点。(如果没有阻塞解析器的 JavaScript，则 <code>DOMContentLoaded</code> 将在 <code>domInteractive</code> 后立即触发。)</li><li><p><code>domComplete</code> 表示网页及其所有子资源都准备就绪的时间点。</p><p>示例代码：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Critical Path: Measure<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width,initial-scale=1"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"style.css"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">measureCRP</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> t = <span class="built_in">window</span>.performance.timing,</span></span><br><span class="line"><span class="undefined">        interactive = t.domInteractive - t.domLoading,</span></span><br><span class="line"><span class="undefined">        dcl = t.domContentLoadedEventStart - t.domLoading,</span></span><br><span class="line"><span class="undefined">        complete = t.domComplete - t.domLoading;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> stats = <span class="built_in">document</span>.createElement(<span class="string">'p'</span>);</span></span><br><span class="line"><span class="actionscript">        stats.textContent = <span class="string">'interactive: '</span> + interactive + <span class="string">'ms, '</span> +</span></span><br><span class="line"><span class="actionscript">            <span class="string">'dcl: '</span> + dcl + <span class="string">'ms, complete: '</span> + complete + <span class="string">'ms'</span>;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">document</span>.body.appendChild(stats);</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">onload</span>=<span class="string">"measureCRP()"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>Hello <span class="tag">&lt;<span class="name">span</span>&gt;</span>web performance<span class="tag">&lt;/<span class="name">span</span>&gt;</span> students!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"awesome-photo.jpg"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul></li></ol><h4 id="实例分析"><a href="#实例分析" class="headerlink" title="实例分析"></a>实例分析</h4><p>还是看 <a href="https://developers.google.com/web/fundamentals/performance/critical-rendering-path/analyzing-crp" target="_blank" rel="noopener">google开发文档</a> ，特别详细清晰。</p><h3 id="优化方案"><a href="#优化方案" class="headerlink" title="优化方案"></a>优化方案</h3><p>当有 block 的资源时， <strong>CRP(Critical Rendering Path)</strong> 如图：<br><img src="https://tang-blog-1257996120.cos.ap-chengdu.myqcloud.com/crp-process.png" alt="crp-progress"></p><p>所以，我们<strong>优化关键渲染路径的常规步骤如下：</strong></p><ol><li>对关键路径进行分析和特性描述，三个关键渲染路径指标：资源数、字节数、长度。</li><li>最大限度减少关键资源的数量：删除它们，延迟它们的下载，将它们标记为异步等。</li><li>优化关键字节数以缩短下载时间（往返次数，<code>Tcp</code> 会对大文件进行多次往返）。</li><li>优化其余关键资源的加载顺序：您需要尽早下载所有关键资产，以缩短关键路径长度。</li></ol><blockquote><p>注意： 这些资源并不是 blocked : images</p></blockquote><h4 id="优化-JavaScript-的使用"><a href="#优化-JavaScript-的使用" class="headerlink" title="优化 JavaScript 的使用"></a>优化 JavaScript 的使用</h4><p>无论我们使用 <code>&lt;script&gt;</code> 标记还是内联 <code>JavaScript</code> 代码段，您都可以期待两者能够以相同方式工作。 在两种情况下，浏览器都会先暂停构建 <code>DOM</code> 并执行脚本，然后才会处理剩余文档。</p><p>由于 <code>JavaScript</code> 还可以操作 <code>CSS</code> ，阻塞解析器的 <code>JavaScript</code> 会强制浏览器等待 <code>CSSOM</code> 构建完成并暂停 <code>DOM</code> 的构建，继而大大延迟首次渲染的时间。 <strong>如果是外部 <code>JavaScript</code> 文件，浏览器必须停下来，等待从磁盘、缓存或远程服务器获取脚本，这就可能给关键渲染路径增加数十至数千毫秒的延迟。</strong></p><p><strong>所以</strong>， <code>JavaScript</code> 资源会阻塞解析器，除非将其标记为 <code>async</code> 或通过专门的 <code>JavaScript</code> 代码段进行添加。</p><ol><li><p>使用异步 <code>JavaScript</code> 资源<br>向某些 <code>script</code> 标记添加异步关键字 <code>async</code> ，如分析工具的 <code>Js</code> 。这样就不会 block <code>DOM</code> 的构建，也不会 block <code>CSSOM</code> 的构建。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"app.js"</span> <span class="attr">async</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在之前没有 <code>async</code> 的时候，我们一般将脚本写在 <code>onload</code> 事件里，这样可以减少 block 的时间。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// do something</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>延迟解析非必需的 <code>JavaScript</code><br>为了最大限度减少浏览器渲染网页的工作量，应延迟任何非必需的脚本（即对构建首次渲染的可见内容无关紧要的脚本）。</p></li><li>避免运行时间长的 <code>JavaScript</code><br>运行时间长的 <code>JavaScript</code> 会阻止浏览器构建 <code>DOM</code> 、 <code>CSSOM</code> 以及渲染网页，所以任何对首次渲染无关紧要的初始化逻辑和功能都应延后执行。如果需要运行较长的初始化序列，请考虑将其拆分为若干阶段，以便浏览器可以间隔处理其他事件。</li></ol><h4 id="优化-CSS-的使用"><a href="#优化-CSS-的使用" class="headerlink" title="优化 CSS 的使用"></a>优化 CSS 的使用</h4><p><code>CSS</code> 是构建渲染树的必备元素，首次构建网页时， <code>JavaScript</code> 常常受阻于 CSS。确保将任何非必需的 <code>CSS</code> 都标记为非关键资源（例如打印和其他媒体查询），并应确保尽可能减少关键 <code>CSS</code> 的数量，以及尽可能缩短传送时间。</p><ol><li>将 <code>CSS</code> 置于文档 <code>head</code> 标签内<br>尽早在 <code>HTML</code> 文档内指定所有 <code>CSS</code> 资源，以便浏览器尽早发现 <code>&lt;link&gt;</code> 标记并尽早发出 <code>CSS</code> 请求。</li><li>避免使用 <code>CSS import</code><br>一个样式表可以使用 <code>CSS import (@import)</code> 指令从另一样式表文件导入规则。不过，应避免使用这些指令，因为它们会在关键路径中增加往返次数：只有在收到并解析完带有 <code>@import</code> 规则的 <code>CSS</code> 样式表之后，才会发现导入的 <code>CSS</code> 资源。</li><li>内联阻塞渲染的 <code>CSS</code><br>为获得最佳性能，您可能会考虑将关键 <code>CSS</code> 直接内联到 <code>HTML</code> 文档内。这样做不会增加关键路径中的往返次数，并且如果实现得当，在只有 <code>HTML</code> 是阻塞渲染的资源时，可实现“一次往返”关键路径长度。</li><li><p>通过媒体查询减少会 block 首次加载的 <code>CSS</code> 。如：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"style.css"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"style-print.css"</span> <span class="attr">media</span>=<span class="string">"print"</span>&gt;</span></span><br></pre></td></tr></table></figure><p>这样的话， 浏览器仍然会下载两个 <code>CSS</code> 文件，但是首次关键路径渲染不会让 <code>style-print.css</code> block 住， 只有在 <code>print</code> (打印) 时才会渲染 <code>style-print.css</code> ，</p></li></ol><h3 id="综合实例"><a href="#综合实例" class="headerlink" title="综合实例"></a>综合实例</h3><p>这儿有个题目： <a href="https://github.com/udacity/frontend-nanodegree-mobile-portfolio" target="_blank" rel="noopener">udacity/frontend-nanodegree-mobile-portfolio</a></p><p>这是我的作业： <a href="https://github.com/jintangWang/frontend-nanodegree-mobile-portfolio" target="_blank" rel="noopener">jintangWang/frontend-nanodegree-mobile-portfolio</a></p><h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><ul><li>迁徙到 <code>http2</code></li><li><code>webpack</code> 代码拆分</li><li>…</li></ul>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[flutter 使用 CI 打包]]></title>
      <url>https://jintang.github.io/2019/06/03/flutter%20%E4%BD%BF%E7%94%A8%20CI%20%E6%89%93%E5%8C%85/</url>
      <content type="html"><![CDATA[<blockquote><p><code>CI</code> (continuous integration) : 持续集成。用来做一些自动化工作，比如程序的打包，单元测试，部署等。</p><ul><li>我最常用的 <code>git</code> 仓库是 <code>Github</code> , <code>Travis CI</code> 对 <code>Github</code> 支持的特别好，使用非常方便。</li><li>公司的仓库在 <code>Gitlab</code> 上， <code>Gitlab</code>自己内部集成了 <code>Gitlab CI</code>。</li></ul><p>本文主要介绍这两种 <code>CI</code> 自动化打包部署 <code>flutter apk</code></p></blockquote><h2 id="Travis-CI"><a href="#Travis-CI" class="headerlink" title="Travis CI"></a>Travis CI</h2><p><code>Travis CI</code> 与 <code>Github</code> 结合比较紧密，对 <code>GitHub</code> 上的开源Repo是免费的，私有Repo收费。</p><p><code>Travis CI</code> 有两个网址，一个是 <a href="https://travis-ci.org" target="_blank" rel="noopener">travis-ci.org</a> ， 另一个是 <a href="https://travis-ci.com/" target="_blank" rel="noopener">travis-ci.com</a> 。 官方推荐使用 <code>travis-ci.com</code> ， 告诉我们 <code>travis-ci.org</code> 后面会全部迁徙到 <code>travis-ci.com</code> 。 目前在两个网址都可以实现效果，没啥区别，但不能同时使用。</p><p>下面以 <code>travis-ci.org</code> 为例，反正我刚开始用的时候就选了这个，索性 “将错就错”</p><h3 id="激活要运行-CI-的仓库"><a href="#激活要运行-CI-的仓库" class="headerlink" title="激活要运行 CI 的仓库"></a>激活要运行 CI 的仓库</h3><p>使用 <code>github</code> 账号登录 <code>travis-ci.org</code> ， 在个人设置中心可以看到自己在 <code>github</code> 上的仓库， 打开对应的开关即可激活。如图: <img src="https://tang-blog-1257996120.cos.ap-chengdu.myqcloud.com/ci/travis_active.png" alt="travis_active"></p><h3 id="travis-yml"><a href="#travis-yml" class="headerlink" title=".travis.yml"></a><code>.travis.yml</code></h3><p>在项目根目录下添加 <code>.travis.yml</code>, <code>travis</code> 提供了多种语言要用的例子， 可以参考<a href="https://docs.travis-ci.com/user/language-specific/" target="_blank" rel="noopener">这儿</a>。这儿想实现一个 <code>flutter</code> 打包 <code>apk</code> 的 <code>CI</code> , 我们可以参照它提供的 <code>android</code> 例子。 但是 <code>flutter</code> 和 <code>android</code> 都更新的太快了，所以例子上用的都是老的 <code>android</code> 。</p><p>这是我的 <code>.travis.yml</code> ， 基于最新的 <code>flutter</code> 版本（目前稳定版是 <code>flutter 1.5.4</code> ）与 <code>android28</code> 进行打包。我这儿暂时没有加签名…<br><a id="more"></a></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">os:</span> <span class="string">linux</span></span><br><span class="line"><span class="attr">language:</span> <span class="string">android</span></span><br><span class="line"><span class="comment"># android 相关的证书</span></span><br><span class="line"><span class="attr">licenses:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">android-sdk-preview-license-.+</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">android-sdk-license-.+</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">google-gdk-license-.+</span></span><br><span class="line"><span class="comment"># android 相关环境</span></span><br><span class="line"><span class="attr">android:</span></span><br><span class="line"><span class="attr">  components:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">tools</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">platform-tools</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">build-tools-28.0.3</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">android-28</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">sys-img-armeabi-v7a-google_apis-28</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">extra-android-m2repository</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">extra-google-m2repository</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">extra-google-android-support</span></span><br><span class="line"><span class="attr">jdk:</span> <span class="string">oraclejdk8</span></span><br><span class="line"><span class="attr">sudo:</span> <span class="literal">false</span></span><br><span class="line"><span class="comment"># 运行 ci 的 docker 容器</span></span><br><span class="line"><span class="attr">addons:</span></span><br><span class="line"><span class="attr">  apt:</span></span><br><span class="line"><span class="attr">    sources:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">ubuntu-toolchain-r-test</span></span><br><span class="line"><span class="attr">    packages:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">libstdc++6</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">fonts-droid</span></span><br><span class="line"><span class="comment"># flutter doctor --android-licenses 要求先运行下面这条语句， yes | 表示后面的命令如果需要你输入 y/n 会自动帮你输入 y</span></span><br><span class="line"><span class="attr">before_install:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="literal">yes</span> <span class="string">| sdkmanager --update</span></span><br><span class="line"><span class="string"></span><span class="attr">before_script:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">git</span> <span class="string">clone</span> <span class="attr">https://github.com/flutter/flutter.git</span> <span class="bullet">-b</span> <span class="string">stable</span> <span class="bullet">--depth</span> <span class="number">1</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">export</span> <span class="string">PATH="$PATH:`pwd`/flutter/bin"</span></span><br><span class="line"><span class="attr">script:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">flutter</span> <span class="string">packages</span> <span class="string">get</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">flutter</span> <span class="string">precache</span></span><br><span class="line">  <span class="comment"># 由于用的新的 android , 需要接受额外的一些证书</span></span><br><span class="line"><span class="bullet">  -</span> <span class="literal">yes</span> <span class="string">| flutter doctor --android-licenses</span></span><br><span class="line"><span class="string">  - flutter doctor &amp;&amp; flutter -v build apk</span></span><br><span class="line"><span class="string"># 缓存</span></span><br><span class="line"><span class="string"></span><span class="attr">cache:</span></span><br><span class="line"><span class="attr">  directories:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">"$HOME/.pub-cache"</span></span><br></pre></td></tr></table></figure><p>每次提交代码后就会自动触发 <code>CI</code>, 可以在 <code>travis-ci.org</code> 下你的仓库中看到。比如我的这个 <a href="https://travis-ci.org/jintangWang/my_app" target="_blank" rel="noopener">demo</a> ,可以看到</p><h3 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h3><p>如果需要自动打包到 <code>github</code> ，我们还需要在 <code>.travis.yml</code> 中添加部署的代码。</p><h4 id="本地安装-travis"><a href="#本地安装-travis" class="headerlink" title="本地安装 travis"></a>本地安装 travis</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gem install travis</span><br></pre></td></tr></table></figure><h4 id="生成部署命令"><a href="#生成部署命令" class="headerlink" title="生成部署命令"></a>生成部署命令</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">travis setup releases</span><br></pre></td></tr></table></figure><p>会要求你输入你的 <code>github</code> 账号， <code>github</code> 密码，<code>apk</code> 相对于项目根目录的路径，后面的直接选择回车表示 yes 就行了。 结果如图： <img src="https://tang-blog-1257996120.cos.ap-chengdu.myqcloud.com/ci/travis_release.png" alt="travis_release"></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">deploy:</span></span><br><span class="line"><span class="attr">  provider:</span> <span class="string">releases</span></span><br><span class="line"><span class="attr">  api_key:</span></span><br><span class="line"><span class="attr">    secure:</span> <span class="string">lASdvkCQ58SnGHwtaDk9s6ibWdQrnfxrnkNv3igt4fkLGMZknsDf821w1X+U+tcI7pP/vgJ4f4ijQAzmpAmt5WX6j2YBvMKWA8Wz7xQvs4iPL45uA3bD4FZcssQM9HHuKgBQnUyQ5nIcyEj8RRDFXiBGGVLmus2bEjocHThyH4B9BreWAaW0wudOwUoTmRmHCLNmoD1lgiraDT47piJFXGdlPNy3bUfHpKy9uetXVkDTVzYGm2mqYn/PAfhgnd67/xKUwXuCbBFTIdOYQ3VMfIl9vzZ3B1bMgYJNv2Qg9/9ueW6AwQbjVbakSw+cXIW+PjOD9TERE2PDxQ+5z6bWkHEdr5CzJ7RudMJ1pBdZFiA346XKhUZnMJdkMQy7NLu3g3yk655/iPAzWPOaqh0mps3KPxpWfFQd2UtPPig94Fg+EgzwttxdHZVRWIeXG/JLTFBfJl+ZLcwM90UAxk0iGgSnFmonvB/x6kGYFj0aNzsZR+BRvl7SkxW+gZfwu3c27l/Ib7fl6WiiVaZrTPJq1As5xc4eIbXJhHxLHouXiqQl096NK4Nm5NvISFhOL6MCxK8bDGoQhAKg+ewMOgBYDlPBqZ7jV3+wzx9iuIBXqSeN1WumUrGEkc3y7BIaoFSv2btnNgkWiSjWufoICkgf1aPRSSbK+nmO94uaYQ9265A=</span></span><br><span class="line"><span class="attr">  file:</span> <span class="string">build/app/outputs/apk/release/app-release.apk</span></span><br><span class="line"><span class="attr">  on:</span></span><br><span class="line"><span class="attr">    repo:</span> <span class="string">jintangWang/my_app</span></span><br><span class="line">    <span class="comment"># 上面的是生成的，我们再添加上下面的配置</span></span><br><span class="line">    <span class="comment"># 只有给 commit 打上 tag 才会触发 部署</span></span><br><span class="line"><span class="attr">    tags:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># 防止上传的 apk 被删除</span></span><br><span class="line"><span class="attr">  skip_cleanup:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><p><strong>最后</strong>: 提交一个打了 <code>tag</code> 的 <code>commit</code> （不然不会触发部署），<code>build</code> 成功之后会自动部署到 <code>github</code> 仓库的 <a href="https://github.com/jintangWang/my_app/releases" target="_blank" rel="noopener">release</a> 下。完整的例子就在我的这个<a href="https://github.com/jintangWang/my_app" target="_blank" rel="noopener">仓库</a></p><h2 id="Gitlab-CI"><a href="#Gitlab-CI" class="headerlink" title="Gitlab CI"></a>Gitlab CI</h2><h3 id="Gitlab-Runner"><a href="#Gitlab-Runner" class="headerlink" title="Gitlab Runner"></a>Gitlab Runner</h3><p><code>Gitlab Runner</code> 用于跑我们的 <code>CI</code> 脚本并将结果返回给 <code>Gitlab</code> 。</p><p>这里我们选择使用 <code>docker</code> 作为我们的 <code>runner</code> 。你也可以选择其他 <code>runner</code> , 比如： <code>macOS</code> 本地、 <code>windows</code> 本地、 <code>linux</code> 本地 … 具体可以看 <a href="https://docs.gitlab.com/runner/" target="_blank" rel="noopener">这儿</a></p><h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><p>我是 <code>macOS</code> 系统，用下面的步骤安装 <code>runner</code> 。其他系统可以查看 <a href="https://docs.gitlab.com/runner/install/docker.html" target="_blank" rel="noopener">官方文档</a></p><ul><li>首先要确保你本地有 <code>docker</code> 并启动。这儿不再赘述，我已经安装了。</li><li><p>运行 <code>gitlab-runner</code> 镜像生成容器，本地找不到此镜像会从网上下载。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name gitlab-runner --restart always \</span><br><span class="line">-v /Users/Shared/gitlab-runner/config:/etc/gitlab-runner \</span><br><span class="line">-v /var/run/docker.sock:/var/run/docker.sock \</span><br><span class="line">gitlab/gitlab-runner:latest</span><br></pre></td></tr></table></figure><p>大概解释一下：</p><ul><li><code>--name</code> 表示为这个容器指定名称，后面的 <code>gitlab-runner</code> 是我们设定的容器名称。</li><li><code>-v</code> 表示挂载卷。</li><li><p>最后面的 <code>gitlab/gitlab-runner:latest</code> 是下载的镜像名。</p><p>更多 <a href="https://www.runoob.com/docker/docker-command-manual.html" target="_blank" rel="noopener">docker 命令</a> 请自行查阅。完成后可以通过 <code>docker ps</code> 看到正在运行的 <code>docker</code> 容器，里面有一个名称为 <code>gitlab-runner</code> 。</p></li></ul></li></ul><h4 id="注册"><a href="#注册" class="headerlink" title="注册"></a>注册</h4><p>其他系统注册查看 <a href="https://docs.gitlab.com/runner/register/index.html#docker" target="_blank" rel="noopener">这儿</a></p><blockquote><p>注册用的 <code>url</code> 和 <code>token</code> 在 仓库—— <code>Settings</code> —— <code>CI/CD</code>下的 <code>Runners</code> —— <code>Specific Runners</code> 下可以看到，如图： <img src="https://tang-blog-1257996120.cos.ap-chengdu.myqcloud.com/ci/runner-regist.png" alt="runner-regist"></p></blockquote><ul><li><p>注册命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --rm -t -i -v /Users/Shared/gitlab-runner/config:/etc/gitlab-runner gitlab/gitlab-runner register</span><br></pre></td></tr></table></figure></li><li><p>输入 <code>gitlab</code> 实例的 <code>url</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Please enter the gitlab-ci coordinator URL (e.g. https://gitlab.com )</span><br><span class="line">http://gitlab.ziggurat.cn/</span><br></pre></td></tr></table></figure></li><li><p>输入 <code>token</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">lease enter the gitlab-ci token <span class="keyword">for</span> this runner</span><br><span class="line">xxx(上面图片中得到的 token )</span><br></pre></td></tr></table></figure></li><li><p>填写描述</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Please enter the gitlab-ci description <span class="keyword">for</span> this runner</span><br><span class="line">flutter build apk</span><br></pre></td></tr></table></figure></li><li><p>填写 tag</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Please enter the gitlab-ci tags <span class="keyword">for</span> this runner (comma separated):</span><br><span class="line">flutter, apk</span><br></pre></td></tr></table></figure></li><li><p>填写执行器</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Please enter the executor: docker-ssh+machine, kubernetes, docker-ssh, virtualbox, docker+machine, ssh, docker, parallels, shell:</span><br><span class="line">docker</span><br></pre></td></tr></table></figure></li><li><p>填写执行 <code>CI</code> 使用的 <code>docker</code> 镜像</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Please enter the Docker image (eg. ruby:2.1):</span><br><span class="line">alpine:latest</span><br></pre></td></tr></table></figure><p><code>alpine:latest</code> 是一个非常小的 <code>docker</code> 镜像，<code>linux</code> 系统。由于我们一般会在 <code>.gitlab-ci.yml</code> 中声明 <code>docker</code> 镜像，而且那个优先级比这儿的高。所以一般填写 <code>alpine:latest</code> 就行了</p></li></ul><p>这些步骤完成后就可以在上面图片的下面看到你注册成功的 <code>runner</code>， 如图： <img src="https://tang-blog-1257996120.cos.ap-chengdu.myqcloud.com/ci/registed_runner.png" alt="registed_runner"></p><p>这个命令会在注册完成后运行起来这个 <code>docker</code> 镜像，你可以通过 <code>docker ps</code> 看到。所以图上那个 <code>Runner</code> 是 <code>active</code> 状态。</p><blockquote><ul><li>我这儿只能使用 <code>Specific Runners</code> 。 我使用的 <code>gitlab</code> 实例是公司注册的，管理员可以通过设置为某个仓库打开 <code>Shared Runners</code>。个人在 <code>gitlab.com</code> 里开源项目可以直接使用 <code>Shared Runners</code></li><li><code>Gitlab Runner</code> 只需要安装一次，对于不同项目的 <code>CI</code> ，可以使用同一个 <code>docker</code> 镜像，只需要第一次注册一下，后面直接运行就可以了。</li></ul></blockquote><h3 id="gitlab-ci-yml"><a href="#gitlab-ci-yml" class="headerlink" title=".gitlab-ci.yml"></a><code>.gitlab-ci.yml</code></h3><p>在注册完 <code>runner</code> 后，我们需要在项目的根目录下创建一个文件 <code>.gitlab-ci.yml</code> 。 在里面编写将要在 <code>runner</code> 里面执行的命令，完成之后每次提交都会触发我们的 <code>CI</code> 脚本，在仓库的 <code>Pipelines</code> 下就可以看到我们正在跑的 <code>CI</code>。</p><p>这儿我们使用 <code>fastlane</code> 给 <code>flutter</code> 项目进行打包。 <a href="https://docs.fastlane.tools/" target="_blank" rel="noopener">fastlane</a> 是一个自动构建 <code>Android</code> 和 <code>iOS</code> app 的工具。由于本地打包 <code>iOS</code> 特别麻烦， 而 <code>fastlane</code> 针对两个平台有基本统一的简单操作，<code>flutter</code> 官方也推荐 <a href="https://flutter.dev/docs/deployment/fastlane-cd" target="_blank" rel="noopener">fastlane 部署</a>。So ， 你懂得…</p><p>我的 <code>.gitlab-ci.yml</code> 中对于 <code>apk</code> 的打包只有简单的两句， 因为关于 <code>fastlane</code> 的配置文件与脚本我都已经在本地生成并上传了 <a href="https://gitlab.com/jintangWang/test_fastlane" target="_blank" rel="noopener">demo仓库</a> 里面，这儿只实现 <code>Andriod</code> 的无签名打包，感兴趣的可以看 <a href="https://gitlab.com/jintangWang/test_fastlane/tree/master/android/fastlane" target="_blank" rel="noopener">fastlane 相关文件</a>。</p><p><code>.gitlab-ci.yml</code> : <a href="https://docs.gitlab.com/ee/ci/yaml/#when" target="_blank" rel="noopener">官方语法说明</a><br></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用此镜像运行打包</span></span><br><span class="line"><span class="attr">image:</span> <span class="string">cirrusci/flutter</span></span><br><span class="line"></span><br><span class="line"><span class="attr">stages:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">build</span></span><br><span class="line"></span><br><span class="line"><span class="attr">before_script:</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">export</span> <span class="string">FLUTTER_STORAGE_BASE_URL=https://storage.flutter-io.cn</span></span><br><span class="line"></span><br><span class="line"><span class="attr">build-apk:</span></span><br><span class="line"><span class="attr">  stage:</span> <span class="string">build</span></span><br><span class="line"><span class="attr">  script:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">cd</span> <span class="string">android</span></span><br><span class="line">  <span class="comment"># 该镜像已经包含了fastlane</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">fastlane</span> <span class="string">android</span> <span class="string">release</span></span><br><span class="line">  <span class="comment"># 要上传的包</span></span><br><span class="line"><span class="attr">  artifacts:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">"app-release-$CI_COMMIT_SHORT_SHA.apk"</span></span><br><span class="line"><span class="attr">    paths:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">build/app/outputs/apk/release/app-release.apk</span></span><br><span class="line"><span class="attr">    expire_in:</span> <span class="number">1</span> <span class="string">week</span> <span class="comment"># 过期时间</span></span><br></pre></td></tr></table></figure><p></p><h3 id="完成"><a href="#完成" class="headerlink" title="完成"></a>完成</h3><p>只要你有新的 <code>push</code> ， 在 <code>gitlab</code> 上就会触发 <code>pipeline</code> ， 如果正常通过，就应该是这样的： <img src="https://tang-blog-1257996120.cos.ap-chengdu.myqcloud.com/ci/gitlab_result.png" alt="gitlab_result"><br>由于 <code>.gitlab-ci.yml</code> 有部署命令，所以还可以下载打包好的 <code>apk</code>。 点击右侧的云朵图标就可以看到我们上传的 <code>artifact</code> 了，点击就可以下载了</p><h3 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h3><ol><li>新的提交之后没有触发 <code>pipeline</code><br>如图，<img src="https://tang-blog-1257996120.cos.ap-chengdu.myqcloud.com/ci/runner_set_btn.png" alt="runner_set_btn"><br>打开 <code>runner</code> 的设置页面， 检查一下是否设置了 <strong>Run untagged jobs</strong> ，我的是这样的：<br><img src="https://tang-blog-1257996120.cos.ap-chengdu.myqcloud.com/ci/runner_set.png" alt="runner_set"></li><li><p>The Job is stuck because you don’t have any active runners<br>检查下本地运行的 <code>docker</code> 容器，正常是有两个，如图： <img src="https://tang-blog-1257996120.cos.ap-chengdu.myqcloud.com/ci/runner_docker.png" alt="runner_docker"><br>如果有多余的，删除掉并重启 <code>gitlab-runner</code> （这是我们前面注册 <code>runner</code> 时的容器名称）：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker restart gitlab-runner</span><br></pre></td></tr></table></figure></li><li><p>ERROR: Uploading artifacts to coordinator… error<br>在最后上传包的时候总是报这个错。在经过多次实验以后发现是我司注册的 <code>gitlab</code> 实例的问题，需要管理员设置允许的 <code>artifact</code> 大小，可以参考 <a href="https://docs.gitlab.com/ee/user/admin_area/settings/continuous_integration.html" target="_blank" rel="noopener">这儿</a>，我司应该有限制这个。 而我之前创建的仓库就在我司的 <code>gitlab</code> 实例上，所以导致我的 <code>artifact</code> 一直上传失败… 真是醉了…</p><p>最后将 <code>demo</code> 转到了 <a href="https://gitlab.com" target="_blank" rel="noopener">https://gitlab.com</a> , 重新提交，打包和部署都成功。自己也没重新注册 <code>runner</code> ，直接使用了 <code>Shared Runners</code> 。当然这个有点限制，对开源项目限制了 2000分钟/月。</p></li></ol><p><strong>总结：</strong> <code>CI</code> 是个好东西，可以做好多方便的东西，可以自动化部署博客啊等等。更多精彩，值得探索…</p>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[dart需知]]></title>
      <url>https://jintang.github.io/2019/04/24/dart%E9%9C%80%E7%9F%A5/</url>
      <content type="html"><![CDATA[<p>谷歌开发了 <code>dart</code> 语言，目前已经可以用作 <code>web</code> 端 和 移动端(<code>flutter</code>)，在谷歌的展望中以后还可以做桌面端，大一统啊。 此处记录下一些基本又重要，自己会选择性忽视和经常要用的点。</p><p>特点：</p><ul><li>基于类，面向对象，类可以继承，但只可以单继承</li><li>接口实现（多态），抽象类，泛型</li><li>单线程（拥有异步处理）</li><li>动态类型(类似 <code>js</code> ，拥有 <code>var</code>) 或 类型注解(使用 静态类型关键字 来声明变量，以获得严格的类型检查)。我们可以这样编写我们的代码，在函数的入口，即定义函数的参数时使用 类型注解；而在函数内部，当类型并不重要时使用 动态类型。</li></ul><a id="more"></a><h3 id="基本类型相关"><a href="#基本类型相关" class="headerlink" title="基本类型相关"></a>基本类型相关</h3><ol><li><code>double</code> 是 64 位</li><li><code>String</code> 是 UTF16</li></ol><h3 id="StringBuffer"><a href="#StringBuffer" class="headerlink" title="StringBuffer"></a>StringBuffer</h3><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">main() &#123;</span><br><span class="line">  <span class="built_in">StringBuffer</span> sb = <span class="keyword">new</span> <span class="built_in">StringBuffer</span>();</span><br><span class="line">  sb.write(<span class="string">"Hello"</span>);</span><br><span class="line">  sb.writeAll([<span class="string">'space'</span>, <span class="string">'and'</span>, <span class="string">'more'</span>]);</span><br><span class="line"> </span><br><span class="line">  <span class="built_in">print</span>(sb);</span><br><span class="line">  <span class="built_in">print</span>(sb.toString());</span><br><span class="line">  </span><br><span class="line">  sb.clear();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="List"><a href="#List" class="headerlink" title="List"></a>List</h3><p>常用方法使用 <code>js</code> 作为比较。</p><ol><li><p><code>foreach</code> 类似 <code>js</code> 的 <code>foreach</code><br>如果想遍历时获取 <code>index</code> , 转为 <code>{&#39;index&#39;: item}</code> 的对象遍历， 完成之后再转为 list :</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">list.asMap().forEach((index, item) &#123;</span><br><span class="line">    <span class="comment">// do something...</span></span><br><span class="line">&#125;).toList()</span><br></pre></td></tr></table></figure></li><li><p><code>map</code> 类似 <code>js</code> 的 <code>map</code></p></li><li><code>where</code> 类似 <code>js</code> 的 <code>filter</code>： 删选符合要求的元素</li><li><code>any</code> 类似 <code>js</code> 的 <code>every</code>： 检测列表中是否所有元素都满足要求</li></ol><h3 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h3><p>两个特点：没有顺序，唯一元素<br></p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Set</span> english  = <span class="keyword">new</span> <span class="built_in">Set</span>();</span><br><span class="line">english.add(<span class="string">'door'</span>);</span><br><span class="line">english.add(<span class="string">'car'</span>);</span><br><span class="line">english.add(<span class="string">'door'</span>);</span><br><span class="line">english.add(<span class="string">'lunar'</span>);</span><br><span class="line">english.add(<span class="string">'era'</span>);</span><br><span class="line"><span class="built_in">print</span>(english); <span class="comment">// &#123;door, car, lunar, era&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Set</span> spanish = <span class="keyword">new</span> <span class="built_in">Set</span>();</span><br><span class="line">spanish.addAll([<span class="string">'era'</span>, <span class="string">'lunar'</span>, <span class="string">'hola'</span>]);</span><br><span class="line"><span class="built_in">print</span>(spanish); <span class="comment">//  &#123;era, lunar, hola&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(english.intersection(spanish)); <span class="comment">//  &#123;lunar, era&#125;</span></span><br><span class="line"><span class="built_in">print</span>(english.difference(spanish));   <span class="comment">//  &#123;door, car&#125;</span></span><br><span class="line"><span class="built_in">print</span>(english.union(spanish)); <span class="comment">// &#123;door, car, lunar, era, hola&#125;</span></span><br></pre></td></tr></table></figure><p></p><h3 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h3><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Map</span> joe = &#123;</span><br><span class="line">    <span class="string">"name"</span>  : <span class="string">"Joe"</span>,</span><br><span class="line">    <span class="string">"email"</span> : <span class="string">"joe@somewhere.com"</span> </span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">print</span>(joe); <span class="comment">// &#123;name: Joe, email: joe@somewhere.com&#125; </span></span><br><span class="line"></span><br><span class="line">joe.putIfAbsent(<span class="string">'email'</span>, () =&gt; <span class="string">'a@b.com'</span>);</span><br><span class="line"><span class="built_in">print</span>(joe); <span class="comment">// &#123;name: Joe, email: joe@somewhere.com&#125;</span></span><br><span class="line">joe.putIfAbsent(<span class="string">'birthdate'</span>, () =&gt; <span class="keyword">new</span> <span class="built_in">DateTime</span>.now());</span><br><span class="line"><span class="built_in">print</span>(joe);</span><br><span class="line"><span class="comment">// &#123;name: Joe, email: joe@somewhere.com, birthdate: 2014-02-25 20:53:04.548&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(joe.containsKey(<span class="string">'email'</span>)); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><h3 id="setTimeout"><a href="#setTimeout" class="headerlink" title="setTimeout"></a>setTimeout</h3><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'dart:async'</span>;</span><br><span class="line"></span><br><span class="line">main() &#123;</span><br><span class="line">  <span class="keyword">new</span> Timer(<span class="keyword">new</span> <span class="built_in">Duration</span>(seconds: <span class="number">1</span>), () =&gt; <span class="built_in">print</span>(<span class="string">"timeout"</span>));</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">"end main"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="iterator-与-Iterable"><a href="#iterator-与-Iterable" class="headerlink" title="iterator 与 Iterable"></a>iterator 与 Iterable</h3><p><code>iterator</code>：<br></p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> names = [<span class="string">'Foo'</span>, <span class="string">'Bar'</span>, <span class="string">'Qux'</span>];</span><br><span class="line"><span class="keyword">var</span> it = names.iterator;</span><br><span class="line">  <span class="keyword">while</span> (it.moveNext()) &#123;</span><br><span class="line">    <span class="keyword">var</span> n = it.current;</span><br><span class="line">    <span class="built_in">print</span>(n); <span class="comment">// Foo Bar Qux</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p></p><p><code>Iterable</code>:<br></p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> numbers = <span class="keyword">new</span> <span class="built_in">Iterable</span>.generate(<span class="number">5</span>, (i) =&gt; i);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> n <span class="keyword">in</span> numbers) &#123;</span><br><span class="line">   <span class="built_in">print</span>(n); <span class="comment">// 0 1 2 3 4</span></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p></p>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[计算机知识]]></title>
      <url>https://jintang.github.io/2019/04/10/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9F%A5%E8%AF%86/</url>
      <content type="html"><![CDATA[<blockquote><p>看 <a href>Crash Course</a> 得到的一部分知识。讲的真好，翻译的也真好。</p></blockquote><h3 id="集成电路IC"><a href="#集成电路IC" class="headerlink" title="集成电路IC"></a>集成电路IC</h3><p>每两年左右，随着材料和制造技术的发展，同样大小的空间，IC能塞进两倍数量的晶体管。这就是 <strong>摩尔定律</strong></p><h3 id="操作系统"><a href="#操作系统" class="headerlink" title="操作系统"></a>操作系统</h3><ul><li>操作系统可以运行多个程序，但是当我们切换程序的时候我们不希望丢失数据，所以每个程序有指定的内存区。</li><li>但有的程序在使用过程中需要更多地内存，所以就会向操作系统提出申请分配更多地内存。如果同意，就会分配另外的内存，但是由于程序都有指定的内存区，所以新分配内存和之前指定的内存就不是连续的。为了解决这个问题，出现了<strong>虚拟内存</strong>， 虚拟内存和真实内存是映射关系，虽然程序的实际内存是不连续的，但是虚拟内存是连续的，从 0 到 xxxx</li><li>由于程序有不同的内存，所以可以<strong>内存保护</strong>。不同的程序无法访问其他程序的内存。早期的 <code>windows</code> 由于缺乏内存保护，有时候程序的不当使用会导致系统崩溃，从而引发蓝屏</li></ul><h3 id="文件系统"><a href="#文件系统" class="headerlink" title="文件系统"></a>文件系统</h3><p>文件的本质是一段二进制，通常在前面的几位是文件头，描述了文件的大小，描述了如图片文件的行列数（什么时候换行）…</p><ul><li>为了方便扩展文件大小，硬盘上分为一个个存储块，每个文件占用一个或多个存储块，文件占用的存储块随着文件顺序排列，当文件变大的时候分配新的未使用的存储快</li><li>为了记录文件所对应存储快，文件同层下会有一个目录文件，记录了当前目录下所有文件的相关信息：创建时间、修改时间、是否是目录、所在的存储块…<ul><li><code>windows</code> 删除文件的时候其实只是删除了目录文件下对该文件的记录，让我们无法看到，而没有在在硬盘上的删除该文件。所以我们可以通过有些工具恢复删除的文件</li><li><code>windows</code> 上同一块存储上移动文件特别快，原因是因为只需要在原来目录下的目录文件中删除该文件信息，然后再目标目录下的目录文件中添加该文件信息即可。而不是在存储结构上真实的移动</li><li><code>windows</code> 在多次进行文件的删除、修改、迁移之后，会使得很多文件在存储上占用的存储块都是不连续的。而 <strong>碎片整理</strong> 就是从新让文件在存储上顺序排列的过程（ <code>SSD</code> 不需要 <strong>碎片整理</strong> ）</li></ul></li></ul><h3 id="压缩"><a href="#压缩" class="headerlink" title="压缩"></a>压缩</h3><p>图片颜色用 红绿蓝 三种颜色合成表示，每个颜色都是 1 个字节， 所以一个 16px 的图片 占用的内存是 16 * 3 = 48 字节。我们可以用以下方法实现减少内存。<br><a id="more"></a></p><h4 id="无损压缩"><a href="#无损压缩" class="headerlink" title="无损压缩"></a>无损压缩</h4><ul><li>游程编码（Run-Length Encoding），常用于出现很多重复值的文件。比如一个图片颜色是 “黄黄黄绿绿绿…” 这种格式，可以改为 “3黄3绿…” 这种格式的代码，保持格式一致。就减少了很少内存。这是 <strong>无损压缩</strong></li><li>用一种更紧凑的方式表示数据。我们需要一个字典，存储 “代码” 和 “数据” 的关系。这次图片不按像素分，而是按照块分，将每种块换算成不同的代码。根据块出现在文件中的频率，用 “霍夫曼树” 进行排练。这也是一种 <strong>无损压缩</strong>。<ul><li>定义 :<ul><li>首先，列出所有块和出现频率，每轮选取两个最低频率的块，组成一个树</li><li>然后，将上一步的树和其他的块排列，选取两个频率最低的块，组成树</li><li>…</li><li>最后的整个树就叫做 “霍夫曼树”</li></ul></li><li>实例 ：<ul><li>一个文件分为： YY(黄黄)、WY（白黄）、BY（黑黄）、BB（黑黑）</li><li>按 “霍夫曼树” 排列为 <img src="https://tang-blog-1257996120.cos.ap-chengdu.myqcloud.com/crash%20course/huofuman_tree.jpg" alt="houfuman_tree"></li></ul></li><li>将每个块翻译为代码，且由于在树中的位置不同，这些代码是不会重复的，结果最后为：<img src="https://tang-blog-1257996120.cos.ap-chengdu.myqcloud.com/crash%20course/houfuman_code.png" alt="houfuman_code">。48 字节的图片转换为了 14 位 的 10110000111100 , 在前面加上字典，就完成了整个压缩，结果是 30 字节。</li></ul></li></ul><p>几乎所有的无损压缩格式都由上面两个方法组合起来使用，比如： <code>GIF , PNG , PDF , ZIP</code></p><h4 id="有损压缩"><a href="#有损压缩" class="headerlink" title="有损压缩"></a>有损压缩</h4><p>丢掉人类无法识别的数据，这种删除人类无法感知的数据的方法叫做 “感知编码” ，比如：</p><ul><li>声音有损压缩，去除超声波，以主要精度表示人声，次要精度表示低声波。如 skype 打电话，网速慢的时候压缩会去除更多数据，所以 skype 打电话像机器人。没有压缩的音频格式有 <code>WAV 、 FLAC</code> ， 压缩的有 <code>MP3</code> 等，占用内存小了 10 倍</li><li>图片有损压缩， 如 <code>JPEG</code> ， 删除人类无法感知的。</li><li>视频压缩：视频本质是一长串图片，但是视频每一帧之间的差别是很小的。很多视频格式<strong>只存帧之间变化的部分</strong>。<code>NPEG-4</code> 是常见标准，可以比原图片小 20 - 200 倍。</li></ul><h3 id="屏幕显示"><a href="#屏幕显示" class="headerlink" title="屏幕显示"></a>屏幕显示</h3><ul><li>阴极射线管 （<code>CRT</code>）:把电子发射到 有磷光体涂层的屏幕了，当电子撞击涂层时，会发光几分之一秒。电子可以用磁场控制。所以可以用两种方法绘制<ul><li>引到电子束描绘出形状，叫做 “尺量扫描”</li><li>按固定路径，一行行扫描，从上到下，从左往右，不断重复。只在特定的点打开电子束，叫做 “光栅扫描”</li></ul></li><li>位图显示，内存中的位对应屏幕上的像素。</li></ul><h3 id="3D-图形"><a href="#3D-图形" class="headerlink" title="3D 图形"></a>3D 图形</h3><h4 id="线框渲染"><a href="#线框渲染" class="headerlink" title="线框渲染"></a>线框渲染</h4><p>把 3D 坐标拍平到 2D屏幕上，叫 <strong>线框渲染</strong>， 常用方法有：</p><ul><li>正交投影： 立方体的各个边，在投影中互相平行</li><li>透视投射： 在真实的 3D 世界中，平行线段会在远处收敛于一点。如图：<img src="https://tang-blog-1257996120.cos.ap-chengdu.myqcloud.com/crash%20course/toushi_toushe.png" alt="透视投射"></li></ul><h4 id="填充图形"><a href="#填充图形" class="headerlink" title="填充图形"></a>填充图形</h4><p><strong>3D</strong> 图形除了线框渲染，还需要填充</p><p>简单的 <strong>3D</strong> 图形可以用矩形用作最小组成单元。对于复杂的 <strong>3D</strong> 投射，一般使用三角形用作最小组成单元。因为 3 个点可以确定唯一的一个面。</p><p>下面是几种填充算法：</p><ul><li>扫描线算法<ol><li>先读三角形的3个点， 找最大和最小的 Y 值，只在这两点间工作。如图 <img src="https://tang-blog-1257996120.cos.ap-chengdu.myqcloud.com/crash%20course/scan_origin.png" alt="初始图形"></li><li>然后从上往下，每次一行，计算每一行与三角形相交的2个点。因为是三角形，如果相交一条边，必然相交另一条边</li><li>一直到扫到底部完成，结果如图 <img src="https://tang-blog-1257996120.cos.ap-chengdu.myqcloud.com/crash%20course/scan_finish.png" alt="扫描线结果"></li></ol></li></ul><p><strong>算法缺点：</strong></p><ul><li>扫描线算法：<ul><li>边缘锯齿</li></ul></li></ul><p><strong>缺点解决方案：</strong></p><ul><li>减轻锯齿：<ul><li>抗锯齿： 字体和图标常用。通过判断三角形切过像素的程度，来调整颜色，具体做法如下：<ul><li>如果像素在三角形内部，就直接涂颜色</li><li>如果三角形划过像素，颜色就浅一些，达到一种边缘羽化的效果，结果如图： <img src="https://tang-blog-1257996120.cos.ap-chengdu.myqcloud.com/crash%20course/scan_yuhua.png" alt="scan_yuhua"></li></ul></li></ul></li></ul><h4 id="实际渲染过程"><a href="#实际渲染过程" class="headerlink" title="实际渲染过程"></a>实际渲染过程</h4><p>由于图形重叠形成遮挡，所以渲染过程有这么几种：</p><ul><li><strong>画家算法渲染：</strong> 用排序算法将远处的先渲染，然后根据距离再渲染近的。因为画家也是先画背景，再画近的，所以叫 <strong>画家算法</strong> 。</li><li><strong>深度缓冲(Z-buffering)渲染：</strong>不用排序，所以比前面的算法快。具体步骤：<ul><li>算法会记录每个像素距离屏幕的位置，在内存中存有一个数字矩阵，每个元素总是记录距离屏幕的最小值。</li><li>矩阵中每个元素的初始值是无限大，然后类似于扫描线算法进行扫描三角形，总是记录更低的值。假如A三角形距离屏幕为20，由于 20 &lt; “无限大” ，所以记录为20。依次记录完所有的三角形，由于记录的总是最小值，所以跟渲染三角形的顺序没有关系。 如图： <img src="https://tang-blog-1257996120.cos.ap-chengdu.myqcloud.com/crash%20course/z_buffering.png" alt="z-buffering"></li></ul></li></ul><h3 id="计算机网络"><a href="#计算机网络" class="headerlink" title="计算机网络"></a>计算机网络</h3><h4 id="基础概念与过程"><a href="#基础概念与过程" class="headerlink" title="基础概念与过程"></a>基础概念与过程</h4><ul><li>指数退避：一个局域网中的不同计算机使用同一载体传输数据时，相互堵塞，各个计算机会等待随机时间后重新发送，如果还堵塞，等待时间指数增长，再次发送，直到网络从新疏通。</li><li>交换机： 为了使得同一载体中的计算机少一点，用交换机将同一个局域网分割成两个更小的局域网。互联网就是这样组成的。</li><li>路由： 从一台计算机到另外一台计算机路径一般要好几条，从途中也会经过很多点，可以根据实际情况（比如有条不能用了）选择不同的路由到达目的地，使得通信更可靠，更能容错。一些机构，如军队会购买专有网络连接到数据中心。<ul><li>跳数：消息沿着路由跳转的次数，跳数会记录在消息中，如果哪条消息跳数很高，就说明路由出现了错误。可以用 traceroute 查看跳转的次数</li></ul></li><li>数据包： 从一台计算机发送信息到另外一台计算机的数据我们称之为报文，但报文可能会很大，所以一个报文没传递完时会占用其中一条路，导致后面的报文阻塞。解决方法是将报文拆分为很小的数据包传递</li></ul><h4 id="一些协议"><a href="#一些协议" class="headerlink" title="一些协议"></a>一些协议</h4><ul><li><code>IP</code> (internet protocol): 网络上定位计算机，将数据发给指定的计算机。定义了报文的格式。</li><li><code>UDP</code> : 计算机接收到数据后，通过端口号发给应用程序。典型特征：“端口号”、“校验和”。数据丢失没有修复措施</li><li><code>TCP</code> : 优化后的 <code>UDP</code> ，也具有 “端口号”、“校验和” ， 同时还具有 “数据包有序性”、“数据包接受后发送确认码” … so, <code>TCP</code> 可以处理乱序和丢失数据包，没有接收到确认码就重发，并根据网络情况调整同时发送数据包的个数，即传输 速率</li></ul><h4 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h4><ul><li><code>DNS</code> (domain name system) :值得一提的是，它存储的是树状结构</li><li><code>OSI</code> 七层协议：<ul><li>物理层： 线路里的电信号、无线网络里的无线信号</li><li>数据链路层： 负责操控 “物理层” 。 有： MAC 地址、碰撞检测、指数退避（如：一个局域网中的不同计算机使用同一载体传输数据时，相互堵塞，各个计算机会等待随机时间后重新发送，如果还堵塞，等待时间指数增长，再次发送，直到网络从新疏通。）</li><li>网络层： 负责报文交换和路由</li><li>传输层： UDP/TCP</li><li>会话层: 用 UDP/TCP 创建连接，传递信息，然后关闭连接，这个过程就是会话。 查询 DNS 或看网页时 就会发生这一套流程。</li><li>表示层：</li><li>应用层：</li></ul></li><li>反向链接：连接到该网页的链接。用来判断网页质量，如果反向链接多，说明质量高。搜索引擎刚出现时有人通过在网页里添加各种关键字（但无实际内容）来欺骗搜索引擎，后面 google 优化算法，通过反向链接来推荐网页</li></ul><h3 id="计算机安全"><a href="#计算机安全" class="headerlink" title="计算机安全"></a>计算机安全</h3>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[flutter 父子通信]]></title>
      <url>https://jintang.github.io/2019/04/02/flutter-%E7%88%B6%E5%AD%90%E9%80%9A%E4%BF%A1/</url>
      <content type="html"><![CDATA[<blockquote><p>很早之前看过一句话，最近又重新看到。一个程序员，应该花80%的时间做代码设计、画UML图、画时序图，20%的时间写code和debug。而我恰恰相反，是不是得改变一下做法了？</p></blockquote><p><code>flutter</code> 做出来的 App 性能非常好，比 <code>react-native</code> 好太多了，基本和原生一样。<code>flutter</code> 里面的组件叫做 <code>Widget</code> ，名称不同，思想一样，下面是一些组件通信的技巧。</p><h3 id="子组件调用父组件的函数"><a href="#子组件调用父组件的函数" class="headerlink" title="子组件调用父组件的函数"></a>子组件调用父组件的函数</h3><p>这个简单，父组件给子组件传递回调函数参数，子组件在需要的地方调用传进来的回调函数即可</p><h3 id="父组件调用子组件的函数"><a href="#父组件调用子组件的函数" class="headerlink" title="父组件调用子组件的函数"></a>父组件调用子组件的函数</h3><h4 id="globalKey"><a href="#globalKey" class="headerlink" title="globalKey"></a>globalKey</h4><p>类似于 <code>vue</code> 中的 <code>refs</code> ， 可以直接获取子组件 <code>state</code> 的引用</p><p>示例代码：</p><p><code>main.dart</code>:<br></p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'package:flutter/material.dart'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. 创建 globalKey</span></span><br><span class="line">GlobalKey&lt;HomePageState&gt; globalKey = GlobalKey();</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyApp</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> MaterialApp(</span><br><span class="line">      home: Scaffold(</span><br><span class="line">        appBar: AppBar(</span><br><span class="line">          leading: IconButton(</span><br><span class="line">            icon: Icon(Icons.help),</span><br><span class="line">            onPressed: () &#123;</span><br><span class="line">              <span class="comment">// 3. 通过 globalKey 的 currentState 获取方法</span></span><br><span class="line">             globalKey.currentState.methodA();</span><br><span class="line">            &#125;,</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">        <span class="comment">// 2. 给子组件传递一个 globalKey</span></span><br><span class="line">        body: HomePage(key: globalKey),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><a id="more"></a><p><code>home.dart</code>:<br></p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HomePage</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  HomePage(&#123;Key key&#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  HomePageState createState() =&gt; HomePageState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HomePageState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">HomePage</span>&gt; </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Container();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">void</span> methodA() &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p><strong>注意：</strong> <code>GlobalKey</code> 使用在 使用 <code>AutomaticKeepAliveClientMixin</code> 的 <code>TabBarView</code> 上会出问题。假如有 3 个 tab ，如果从第1个直接切换到第3个，会提示使用了重复的 <code>GlobalKey</code>。我是用的是 <code>flutter 1.0</code> ，此问题还没有解决，参见<a href="https://github.com/flutter/flutter/issues/27010" target="_blank" rel="noopener">这儿</a>。 <code>flutter 1.2</code> 已经出来了，但是此 <code>Issue</code> 还没有关闭</p><h4 id="Stream"><a href="#Stream" class="headerlink" title="Stream"></a>Stream</h4><p>订阅管理模式，类似 <strong>EventBus</strong> 。通过 <code>sink</code> 发送事件，<code>listen()</code> 监听事件。</p><p>严格来说，这不是父调用子函数,而是通过事件监听。</p><p>示例代码： 注意查看上面代码有数字标志注释的代码</p><p><code>home.dart</code>:<br></p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Home</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  HomeState createState =&gt; HomeState();</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HomeState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">Home</span>&gt; <span class="title">with</span> <span class="title">SingleTickerProviderStateMixin</span> </span>&#123;</span><br><span class="line">  <span class="built_in">int</span> _tabIndex = <span class="number">0</span>;</span><br><span class="line">  TabController controller;</span><br><span class="line">  <span class="keyword">static</span> StreamController streamController;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> initState() &#123;</span><br><span class="line">    <span class="keyword">super</span>.initState();</span><br><span class="line">    <span class="comment">// 1. 创建一个 广播 streamController ，可以订阅多个事件。（还可以创建 单订阅 stream）</span></span><br><span class="line">    streamController = StreamController.broadcast();</span><br><span class="line">    ConnectionListener.init(context);</span><br><span class="line">    controller = <span class="keyword">new</span> TabController(length: <span class="number">3</span>, vsync: <span class="keyword">this</span>)</span><br><span class="line">      ..addListener(() &#123;</span><br><span class="line">        setState(() &#123;</span><br><span class="line">          <span class="keyword">this</span>._tabIndex = controller.index;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// indexIsChanging是为了防止切换tab时触发两次</span></span><br><span class="line">        <span class="keyword">if</span> (controller.indexIsChanging &amp;&amp; controller.index &lt; <span class="number">2</span>) &#123;</span><br><span class="line">          <span class="keyword">if</span> (controller.index == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// 2. 触发广播， 并传递一个字符串标识符</span></span><br><span class="line">            streamController.sink.add(<span class="string">'refresh_wallet'</span>);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> dispose() &#123;</span><br><span class="line">      controller.dispose();</span><br><span class="line">      <span class="comment">// 5. 销毁 streamController</span></span><br><span class="line">      streamController.close();</span><br><span class="line">      <span class="keyword">super</span>.dispose();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Widget getTabItem(<span class="built_in">int</span> tabIndex) &#123;</span><br><span class="line">    <span class="keyword">return</span> Container(</span><br><span class="line">      height: ScreenUtil().setHeight(<span class="number">58</span>),</span><br><span class="line">      child: <span class="keyword">new</span> Tab(</span><br><span class="line">        child: Text(<span class="string">'tab'</span> + tabIndex.toString()),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">      <span class="keyword">return</span>  <span class="keyword">new</span> Scaffold(</span><br><span class="line">        body: <span class="keyword">new</span> TabBarView(</span><br><span class="line">          children: &lt;Widget&gt;[</span><br><span class="line">            WalletTab(streamController: streamController),</span><br><span class="line">            FinancialTab(),</span><br><span class="line">            UserTab()</span><br><span class="line">          ],</span><br><span class="line">          controller: controller,</span><br><span class="line">        ),</span><br><span class="line">        bottomNavigationBar: <span class="keyword">new</span> Material(</span><br><span class="line">          child: <span class="keyword">new</span> TabBar(</span><br><span class="line">            tabs: [</span><br><span class="line">              getTabItem(<span class="number">0</span>),</span><br><span class="line">              getTabItem(<span class="number">1</span>),</span><br><span class="line">              getTabItem(<span class="number">2</span>),</span><br><span class="line">            ],</span><br><span class="line">            controller: controller,</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p><code>walletTab.dart</code>（ <code>home</code> 下的第一个 <code>tab</code> ） :<br></p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WalletTab</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  StreamController streamController;</span><br><span class="line">  WalletTab(&#123;<span class="keyword">this</span>.streamController&#125;);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  WalletTabState createState() =&gt; <span class="keyword">new</span> WalletTabState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WalletTabState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">WalletTab</span>&gt; <span class="title">with</span> <span class="title">AutomaticKeepAliveClientMixin</span></span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="built_in">bool</span> <span class="keyword">get</span> wantKeepAlive =&gt; <span class="keyword">true</span>;</span><br><span class="line">  StreamSubscription streamSubscription;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  initState() &#123;</span><br><span class="line">    <span class="keyword">super</span>.initState();</span><br><span class="line">    <span class="comment">// 3. 订阅广播，并判断标识符是否为 'refresh_wallet'</span></span><br><span class="line">    streamSubscription = widget.streamController.stream.listen((value) &#123;</span><br><span class="line">      <span class="keyword">if</span> (value == <span class="string">'refresh_wallet'</span>) &#123;</span><br><span class="line">        <span class="comment">// do something...</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  dispose() &#123;</span><br><span class="line">    <span class="comment">// 4. 销毁广播订阅</span></span><br><span class="line">    streamSubscription.cancel();</span><br><span class="line">    <span class="keyword">super</span>.dispose();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Container(</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h3 id="flutter-状态管理"><a href="#flutter-状态管理" class="headerlink" title="flutter 状态管理"></a>flutter 状态管理</h3><p>下面这些暂时没用到，但经常看到，功能非常强大，先做了解记录一下。</p><h4 id="InheritedWidget"><a href="#InheritedWidget" class="headerlink" title="InheritedWidget"></a>InheritedWidget</h4><p>统一状态管理，类似 <code>Redux</code> （ <code>flutter</code> 中可以使用 <code>Redux</code> ）、 <code>Vuex</code> ，子组件可以通过 <code>of()</code> 获取祖先的 <code>state</code></p><h4 id="ScopedModel"><a href="#ScopedModel" class="headerlink" title="ScopedModel"></a>ScopedModel</h4><p>用于给子组件传递 <code>data</code> ，不用层层传递</p><h4 id="BLOC"><a href="#BLOC" class="headerlink" title="BLOC"></a>BLOC</h4><p><code>Stream</code> 在 <code>Flutter</code> 中的最佳实践</p>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[机器学习算法 — 奇异值分解]]></title>
      <url>https://jintang.github.io/2019/03/26/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95%20%E2%80%94%20%E5%A5%87%E5%BC%82%E5%80%BC%E5%88%86%E8%A7%A3/</url>
      <content type="html"><![CDATA[<blockquote><p>机器学习算法可以分为三大类：监督学习、无监督学习和强化学习。</p><ul><li>监督学习可用于一个特定的数据集（训练集）具有某一属性（标签），但是其他数据没有标签或者需要预测标签的情况。</li><li>无监督学习可用于给定的没有标签的数据集（数据不是预分配好的），目的就是要找出数据间的潜在关系。</li><li>强化学习位于这两者之间，每次预测都有一定形式的反馈，但是没有精确的标签或者错误信息。</li></ul></blockquote><p>有几种常见的关于监督学习和无监督学习的算法。比如决策树、朴素贝叶斯分类、最小二乘法（是一种计算线性回归的方法）。在这儿，主要介绍一种无监督学习的算法：奇异值分解（SVD）, 在线性代数中，SVD 是复杂矩阵的因式分解。</p><h3 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h3><h4 id="矩阵的特征值和特征向量"><a href="#矩阵的特征值和特征向量" class="headerlink" title="矩阵的特征值和特征向量"></a>矩阵的特征值和特征向量</h4><p>设 A 是 n 阶矩阵，若存在数 $\lambda$ 及非零的 n 维列向量 $\nu$ ,使得<br>$$A\nu=\lambda\nu$$<br>成立，则称$\lambda$是矩阵 A 的<strong>特征值</strong>，称非零向量 $\nu$ 是矩阵 A 属于特征值 $\lambda$ 的<strong>特征向量</strong><br><br><a id="more"></a><br><strong>计算步骤：</strong></p><ol><li>计算 A 的特征多项式 $|\lambda I- A|$</li><li>判断特征方程 $|\lambda I- A| = 0$ 有没有根。由行列式计算可知，行列式$|\lambda I- A|$的值是n次多项式。如果没有根，则 A 没有特征值，从而也没有特征向量。如果 $|\lambda I- A|$ 有根，共有 n 个根（其中可能有复根，也可能有重根），这些根就是 A 的全部特征值。进行下一步</li><li>对于 A 的每一个特征值 $\lambda_j$ ，求解齐次线性方程组 $|\lambda_j I - A|X = 0$，则方程组的每一个非零解都是A的属于特征值$\lambda_j$的特征向量（说明有无穷多个）</li></ol><p><strong>举个例子：</strong><br>设 $A=\left[ \begin{array}{cc} 1 &amp; 2 \\ 2 &amp; 4 \\ \end{array} \right]$<br>A的特征多项式为 $|\lambda I- A| = \left[ \begin{array}{cc} \lambda - 1 &amp; -2 \\ -2 &amp; \lambda - 4 \\ \end{array} \right] = \lambda(\lambda - 5)$<br>得到特征值 $\lambda_1 = 0, \lambda_2 = 5$<br>将 $\lambda_1$ 带入 $|\lambda_j I - A|X = 0$ :<br>$$|\lambda_j I - A| = \left[ \begin{array}{cc} -1 &amp; -2 \\ -2 &amp; -4 \\ \end{array} \right] = \left[ \begin{array}{cc} 1 &amp; 2 \\ 0 &amp; 0 \\ \end{array} \right]$$<br>故 $\lambda_1$ 的特征向量的基础解系为 $\left[ \begin{array}{cc} -2 &amp; 1 \end{array} \right]$</p><p>将 $\lambda_2$ 带入 $|\lambda_j I - A|X = 0$ :<br>$$|\lambda_j I - A| = \left[ \begin{array}{cc} 4 &amp; -2 \\ -2 &amp; 1 \\ \end{array} \right] = \left[ \begin{array}{cc} -2 &amp; 1 \\ 0 &amp; 0 \\ \end{array} \right]$$<br>故 $\lambda_1$ 的特征向量的基础解系为 $\left[ \begin{array}{cc} 1 &amp; 2 \end{array} \right]$</p><h4 id="对角化分解"><a href="#对角化分解" class="headerlink" title="对角化分解"></a>对角化分解</h4><p>给定一个大小为$m\times m$的矩阵A（方阵），其对角化分解可以写成<br>$$A=U\Lambda U^{-1}$$<br>其中，U的每一列都是特征向量，$\Lambda$对角线上的元素是从大到小排列的特征值，若将U记作$U=\left( \vec{u}_1,\vec{u}_2,…,\vec{u}_m \right)$ ，则:<br>$$AU=A\left(\vec{u}_1,\vec{u}_2,…,\vec{u}_m\right)=\left(\lambda_1 \vec{u}_1,\lambda_2 \vec{u}_2,…,\lambda_m \vec{u}_m\right)$$<br>$$=\left(\vec{u}_1,\vec{u}_2,…,\vec{u}_m\right) \left[ \begin{array}{ccc} \lambda_1 &amp; \cdots &amp; 0 \\ \vdots &amp; \ddots &amp; \vdots \\ 0 &amp; \cdots &amp; \lambda_m \\ \end{array} \right]$$<br>$$\Rightarrow AU=U\Lambda \Rightarrow A=U\Lambda U^{-1}$$</p><p>更为特殊的是，当矩阵A是一个对称矩阵时，则存在一个对称对角化分解，即</p><p>$$A=Q\Lambda Q^T$$</p><p>其中，Q的每一列都是相互正交的特征向量，且是单位向量，$\Lambda$对角线上的元素是从大到小排列的特征值。</p><p>当然，将矩阵Q记作$Q=\left(\vec{q}_1,\vec{q}_2,…,\vec{q}_m\right)$，则矩阵A也可以写成如下形式：</p><p>$$A=\lambda_1 \vec{q}_1\vec{q}_1^T+\lambda_2 \vec{q}_2\vec{q}_2^T+…+\lambda_m \vec{q}_m\vec{q}_m^T$$</p><p><strong>举个例子：</strong><br>如给定一个大小为$2\times 2$的矩阵$A=\left[ \begin{array}{cc} 2 &amp; 1 \\ 1 &amp; 2 \\ \end{array} \right]$，根据</p><p>$\left|\lambda I-A\right|=\left| \begin{array}{cc} \lambda-2 &amp; -1 \\ -1 &amp; \lambda-2 \\ \end{array} \right|=0$求得特征值为$\lambda_1=3，\lambda_2=1$，相应地，</p><p>$\vec{q}_1=\left[ \begin{array}{cc} \frac{\sqrt{2}}{2} \\ \frac{\sqrt{2}}{2} \\ \end{array} \right], \vec{q}_2=\left[ \begin{array}{cc} - \frac{\sqrt{2}}{2} \\ \frac{\sqrt{2}}{2} \\ \end{array} \right]$，则</p><p>$$A=\lambda_1 \vec{q}_1\vec{q}_1^T+\lambda_2 \vec{q}_2\vec{q}_2^T =\left[ \begin{array}{cc} 2 &amp; 1 \\ 1 &amp; 2 \\ \end{array} \right].$$</p><p>这样，我们就很容易地得到了矩阵A的对称对角化分解。</p><p><strong>与奇异值分解的关系：</strong>对于正定对称矩阵而言，奇异值分解和对称对角化分解结果相同。</p><h3 id="SVD的定义"><a href="#SVD的定义" class="headerlink" title="SVD的定义"></a>SVD的定义</h3><p>设我们的矩阵A是一个m×n的矩阵，那么我们定义矩阵A的SVD为：<br>$$A=UΣV^T$$</p><p>其中U是一个m×m的矩阵，Σ是一个m×n的矩阵，除了主对角线上的元素以外全为0，主对角线上的每个元素都称为奇异值，V是一个n×n的矩阵。U和V都是酉矩阵，即满足$U^T U=I,V^T V=I$</p><p><strong>如何求取：</strong></p><ul><li>如果我们将A和A的转置做矩阵乘法，那么会得到m×m的一个方阵$AA^T$。既然$AA^T$是方阵，那么我们就可以进行特征分解，得到的特征值和特征向量满足下式：<br>$$(AA^T)\nu_i=λ_i \nu_i$$<br>这样我们就可以得到矩阵$AA^T$的m个特征值和对应的m个特征向量u了。将$AA^T$的所有特征向量张成一个m×m的矩阵U，就是我们SVD公式里面的U矩阵了。一般我们将U中的每个特征向量叫做A的左奇异向量。</li><li>将A的转置和A做矩阵乘法，那么会得到n×n的一个方阵$A^T A$。既然$A^T A$是方阵，那么我们就可以进行特征分解，得到的特征值和特征向量满足下式：<br>$$(A^T A)\nu_i=\lambda_i \nu_i$$<br>这样我们就可以得到矩阵 $A^T A$ 的n个特征值和对应的n个特征向量$\nu$了。将$A^T A$的所有特征向量张成一个n×n的矩阵V，就是我们SVD公式里面的V矩阵了。一般我们将V中的每个特征向量叫做A的右奇异向量。</li><li>由于Σ除了对角线上是奇异值其他位置都是0，那我们只需要求出每个奇异值σ就可以了。<br>$$A=UΣV^T ⇒ AV=UΣV^T V ⇒ AV=UΣ⇒ A\nu_i=σ_i u_i ⇒ σi=A\nu_i /u_i$$<br>特征值和奇异值满足此关系：$σ_i=\sqrtλ_i$ ,可以通过计算$A^T A$的特征值取平方根来求奇异值（<strong>注意，$AA^T$ 和 $A^T A$ 的特征值相同，<a href="https://link.zhihu.com/?target=https%3A//math.stackexchange.com/questions/1249497/largest-eigenvalues-of-aa-equals-to-aa" target="_blank" rel="noopener">证明链接</a> </strong>）</li></ul><p><strong>求取步骤：</strong></p><ol><li>计算 $AA^T$ 和 $A^T A$；</li><li>分别计算 $AA^T$ 和 $A^T A$ 的特征向量及其特征值；</li><li>$AA^T$ 的特征向量组成 U；而 $A^T A$ 的特征向量组成 V；</li><li>对 $AA^T$ 和 $A^T A$ 的非零特征值求平方根，对应上述特征向量的位置，填入 Σ 的对角元。</li></ol><p><strong>举个例子：</strong><br>设 $A=\left[ \begin{array}{cc} 2 &amp; 4 \\ 1 &amp; 3 \\ 0 &amp; 0 \\ 0 &amp; 0 \\ \end{array} \right]$</p><p><em>首先</em>，计算 $AA^T$:<br>$$AA^T = \left[ \begin{array}{cc} 2 &amp; 4 \\ 1 &amp; 3 \\ 0 &amp; 0 \\ 0 &amp; 0 \\ \end{array} \right] \left[ \begin{array}{cc} 2 &amp; 1 &amp; 0 &amp; 0 \\ 4 &amp; 3 &amp; 0 &amp; 0 \\ \end{array} \right] = \left[ \begin{array}{cc} 20 &amp; 14 &amp; 0 &amp; 0 \\ 14 &amp; 10 &amp; 0 &amp; 0 \\ 0 &amp; 0 &amp; 0 &amp; 0 \\ 0 &amp; 0 &amp; 0 &amp; 0 \\ \end{array} \right]$$<br>根据特征向量方程$|\lambda I- A| = 0$:<br>$$\left| \begin{array}{cc} \lambda - 20 &amp; -14 &amp; 0 &amp; 0 \\ -14 &amp; \lambda - 10 &amp; 0 &amp; 0 \\ 0 &amp; 0 &amp; \lambda &amp; 0 \\ 0 &amp; 0 &amp; 0 &amp; \lambda \\ \end{array} \right| = \left| \begin{array}{cc} \lambda - 20 &amp; - 14 \\ - 14 &amp; \lambda - 10 \\ \end{array} \right| \left| \begin{array}{cc} \lambda &amp; 0 \\ 0 &amp; \lambda \\ \end{array} \right| = 0$$</p><p>即: $ ((λ-20)(λ-10)−196)λ^2 = 0$， 得到特征值：$ λ_1=λ_2=0, λ_3=15+\sqrt 221≈29.866, λ_4=15− \sqrt 221≈0.134$</p><p>根据特征值代入原方程，可解得对应的特征向量。这些特征向量即作为列向量，形成矩阵:<br>$$U=\left[ \begin{array}{cc} 0.82 &amp; -0.58 &amp; 0 &amp; 0 \\ 0.58 &amp; 0.82 &amp; 0 &amp; 0 \\ 0 &amp; 0 &amp; 1 &amp; 0 \\ 0 &amp; 0 &amp; 0 &amp; 1 \\ \end{array} \right]$$</p><p><em>同理可得</em>：</p><p>$$V=\left[ \begin{array}{cc} 0.40 &amp; -0.91 \\ 0.91 &amp; 0.40 \\ \end{array} \right] $$</p><p><em>然后</em>， Σ 上的对角线元素由 $AA^T$ 的特征值的算术平方根组成</p><p>$$Σ=\left[ \begin{array}{cc} 5.46 &amp; 0 \\ 0 &amp; 0.37 \\ 0 &amp; 0 \\ 0 &amp; 0 \\ \end{array} \right] $$</p><p><em>最后</em>, 得到 A 的 SVD 分解：<br>$$\left[ \begin{array}{cc} 2 &amp; 4 \\ 1 &amp; 3 \\ 0 &amp; 0 \\ 0 &amp; 0 \\ \end{array} \right] ≈ \left[ \begin{array}{cc} 0.82 &amp; -0.58 &amp; 0 &amp; 0 \\ 0.58 &amp; 0.82 &amp; 0 &amp; 0 \\ 0 &amp; 0 &amp; 1 &amp; 0 \\ 0 &amp; 0 &amp; 0 &amp; 1 \\ \end{array} \right] \left[ \begin{array}{cc} 5.46 &amp; 0 \\ 0 &amp; 0.37 \\ 0 &amp; 0 \\ 0 &amp; 0 \\ \end{array} \right] \left[ \begin{array}{cc} 0.40 &amp; -0.91 \\ 0.91 &amp; 0.40 \\ \end{array} \right] $$</p><p><strong>结果分析：</strong></p><ul><li>上述分解中会构建出一个矩阵∑，该矩阵只有对角元素，其他元素均为0(近似于0)。另一个惯例就是，∑的对角元素是从大到小排列的。这些对角元素称为奇异值。</li><li>奇异值与特征值(PCA 数据中重要特征)是有关系的。这里的奇异值就是矩阵 $AA^T$ 特征值的平方根。</li><li>普遍的事实：在某个奇异值的数目(r 个=&gt;奇异值的平方和累加到总值的90%以上)之后，其他的奇异值都置为0(近似于0)。这意味着数据集中仅有 r 个重要特征，而其余特征则都是噪声或冗余特征。</li></ul><h3 id="SVD的性质"><a href="#SVD的性质" class="headerlink" title="SVD的性质"></a>SVD的性质</h3><p>对于奇异值,它跟我们特征分解中的特征值类似，在奇异值矩阵中也是按照从大到小排列，而且奇异值的减少特别的快，在很多情况下，前10%甚至1%的奇异值的和就占了全部的奇异值之和的99%以上的比例。</p><p>也就是说，我们也可以用最大的k个的奇异值和对应的左右奇异向量来近似描述矩阵。也就是说：</p><p>其中k要比n小很多，也就是一个大的矩阵A可以用三个小的矩阵表示</p><ul><li>$U_{m×k}$,</li><li>$Σ_{k×k}$</li><li>$V^T_{k\times n}$<br>如下图所示，现在我们的矩阵A只需要灰色的部分的三个小矩阵就可以近似描述了。<br><img src="https://tang-blog-1257996120.cos.ap-chengdu.myqcloud.com/svd.png" alt="k"></li></ul><p>由于这个重要的性质，SVD可以用于PCA降维，来做数据压缩和去噪。也可以用于推荐算法，将用户和喜好对应的矩阵做特征分解，进而得到隐含的用户需求来做推荐。同时也可以用于NLP中的算法，比如潜在语义索引（LSI）。</p><h3 id="奇异值分解的应用"><a href="#奇异值分解的应用" class="headerlink" title="奇异值分解的应用"></a>奇异值分解的应用</h3><ol><li>隐性语义检索<br>隐性语义索引：矩阵 = 文档 + 词语<br><img src="https://i.imgur.com/EPoEEET.png" alt="yuyisuoyin"></li><li>推荐系统<ul><li>利用 SVD 从数据中构建一个主题空间。</li><li>再在该空间下计算其相似度。(从高维-低维空间的转化，在低维空间来计算相似度，SVD 提升了推荐系统的效率。)</li></ul></li><li>图像压缩<br>例如：32<em>32=1024 =&gt; 32</em>2+2<em>1+32</em>2=130(2*1表示去掉了除对角线的0), 几乎获得了10倍的压缩比。</li></ol><h3 id="补充知识"><a href="#补充知识" class="headerlink" title="补充知识"></a>补充知识</h3><ol><li>逆矩阵（inverse matrix）：<br>又称反矩阵。在线性代数中，给定一个n阶方阵 A，若存在一n阶方阵 B ，使得 $AB=BA=I_n$，其中 $I_n$ 为n阶单位矩阵，则称 A 是可逆的，且 B 是 A的逆矩阵，记作 $A^{-1}$。</li></ol><p>只有方阵（n×n的矩阵）才可能有逆矩阵。若方阵 A 的逆矩阵存在，则称 A 为非奇异方阵或可逆方阵。</p><ol><li><p>向量正交：指它们的内积等于零.治元前面已经讲过了。</p></li><li><p>单位矩阵：<br>n阶单位矩阵，是一个 $n * n$ 的方形矩阵，其主对角线元素为1，其余元素为0。单位矩阵以 $I<em>n$ 表示, 如果阶数可忽略，也可简记为 I（或者E）。 如:<br>$$<br>I</em>{2}={\begin{bmatrix}1&amp;0\\0&amp;1\end{bmatrix}}<br>$$</p></li><li>行列式值得计算（必须是方阵）：<br>2 X 2 矩阵：<br>$$A = \left[ \begin{array}{cc} 2 &amp; 1 \\ 1 &amp; 2 \\ \end{array} \right]$$</li></ol>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[线性代数学习]]></title>
      <url>https://jintang.github.io/2019/03/19/%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0%E5%AD%A6%E4%B9%A0/</url>
      <content type="html"><![CDATA[<h3 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h3><p>理解n阶行列式的概念，正确的计算三阶、四阶行列式，还有简单的n阶行列式的值</p><h3 id="基本方法"><a href="#基本方法" class="headerlink" title="基本方法"></a>基本方法</h3><p>按行（列）展开公式，通过降阶来实现。但是在展开之前往往先通过对行列式的恒等变形，以在新的行列式中能构造出叫多的0或有公因式，从而简化计算。</p><p>常用技巧有：三角化法、递推法、数学归纳法、公式法等</p><h3 id="常用属性"><a href="#常用属性" class="headerlink" title="常用属性"></a>常用属性</h3><ol><li>把某行的k倍加到另一行，行列式的值不变</li></ol>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[js发布订阅者模式简单实现]]></title>
      <url>https://jintang.github.io/2019/02/11/js%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85%E8%80%85%E6%A8%A1%E5%BC%8F%E7%AE%80%E5%8D%95%E5%AE%9E%E7%8E%B0/</url>
      <content type="html"><![CDATA[<blockquote><p>之前在对比 <code>react</code> 和 <code>vue</code> 的时候，发现 <code>vue</code> 有 <code>EventBus</code> 处理非父子组件通信， 而 <code>react</code> 推荐使用 <a href="https://github.com/mroderick/PubSubJS" target="_blank" rel="noopener">PubSub.js</a> 实现。这种发布订阅者模式应用广泛，<code>vue</code> 根据 <code>Object.defineProperty</code> 实现双向绑定也是一种发布订阅者模式。下面是根据 <a href="https://github.com/mroderick/PubSubJS" target="_blank" rel="noopener">PubSub.js</a> 简化后的版本。</p></blockquote><p><a href="https://gist.github.com/jintangWang/35d96dc2491a45a9a5a674305dc374cf" target="_blank" rel="noopener">简化PubSub</a></p><p><a href="https://jsfiddle.net/jintang/xuk9Lemj/" target="_blank" rel="noopener">测试demo</a>, 查看 log 即可看到效果</p>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[学习vue源码得到的知识]]></title>
      <url>https://jintang.github.io/2018/12/10/%E5%AD%A6%E4%B9%A0vue%E6%BA%90%E5%BE%97%E5%88%B0%E7%9A%84%E5%B0%8F%E7%9F%A5%E8%AF%86/</url>
      <content type="html"><![CDATA[<h3 id="Vue-extend-创建-“Vue”-的-子类"><a href="#Vue-extend-创建-“Vue”-的-子类" class="headerlink" title="Vue.extend(): 创建 “Vue” 的 子类"></a>Vue.extend(): 创建 “Vue” 的 子类</h3><h3 id="window-performance-监控代码性能"><a href="#window-performance-监控代码性能" class="headerlink" title="window.performance: 监控代码性能"></a>window.performance: 监控代码性能</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> perf = inBrowser &amp;&amp; <span class="built_in">window</span>.performance;</span><br><span class="line">mark(<span class="string">'start'</span>)</span><br><span class="line"><span class="comment">// do something</span></span><br><span class="line">mark(<span class="string">'end'</span>)</span><br></pre></td></tr></table></figure><h3 id="小技巧"><a href="#小技巧" class="headerlink" title="小技巧"></a>小技巧</h3><ol><li><p>遍历数组：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> i = props.length</span><br><span class="line"><span class="keyword">while</span> (i--) &#123;   、</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>js 中一个值与自身都不相等: NaN 。通过下面的方式判断</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (newVal === value || (newVal !== newVal &amp;&amp; value !== value)) &#123;</span><br><span class="line">  <span class="comment">// newVal 是 NaN</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>IE11 才开始支持 <code>__proto__</code> , 之前的不支持<br>如何拦截 读取和写入 纯对象/数组</p></li><li><p>缓存一个纯函数: cached 实现？</p></li></ol>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[react-native 之 webview]]></title>
      <url>https://jintang.github.io/2018/12/04/react-native-%E4%B9%8B-webview/</url>
      <content type="html"><![CDATA[<blockquote><p>前段时间公司要求写个游戏嵌入到 App 中，我们通过 <code>webview</code> 链接到 App 中，中间遇到了很多坑，在此记录一下。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sourceAndroid = &#123; <span class="attr">uri</span>: <span class="string">'file:///android_asset/trivia-game/index.html'</span> &#125;;</span><br><span class="line"><span class="keyword">const</span> sourceIOS = &#123; <span class="attr">uri</span>: <span class="string">'./trivia-game/index.html'</span> &#125;;</span><br><span class="line">source = Platform.OS === <span class="string">'ios'</span> ? sourceIOS : sourceAndroid;</span><br><span class="line">&lt;WebView</span><br><span class="line">    ref=&#123;( webView ) =&gt; <span class="keyword">this</span>.webView = webView&#125;</span><br><span class="line">    source=&#123; source &#125;</span><br><span class="line">    originWhitelist=&#123;[<span class="string">"file://"</span>, <span class="string">'*'</span>]&#125;</span><br><span class="line">    style=&#123;&#123;<span class="attr">height</span>: <span class="keyword">this</span>.state.webViewHeight&#125;&#125;</span><br><span class="line">    javaScriptEnabled = &#123; <span class="literal">true</span> &#125;</span><br><span class="line">    scrollEnabled = &#123; <span class="literal">false</span> &#125;</span><br><span class="line">    domStorageEnabled = &#123; <span class="literal">true</span> &#125;</span><br><span class="line">    scalesPageToFit = &#123; <span class="literal">true</span> &#125;</span><br><span class="line">    startInLoadingState = &#123; <span class="literal">true</span> &#125;</span><br><span class="line">    renderLoading = &#123; () =&gt; <span class="xml"><span class="tag">&lt;<span class="name">ActivityIndicator</span> /&gt;</span>&#125;</span></span><br><span class="line"><span class="xml">    onLoadEnd=&#123; this._onLoadEnd &#125;</span></span><br><span class="line"><span class="xml">    onMessage=&#123; this._onMessage &#125;</span></span><br><span class="line"><span class="xml">    onNavigationStateChange=&#123; this._onNavigationStateChange &#125;</span></span><br><span class="line"><span class="xml">    allowUniversalAccessFromFileURLs=&#123; true &#125;</span></span><br><span class="line"><span class="xml">    mediaPlaybackRequiresUserAction=&#123; false &#125;</span></span><br><span class="line"><span class="xml">/&gt;</span></span><br></pre></td></tr></table></figure><p>官方介绍： <a href="https://reactnative.cn/docs/webview/" target="_blank" rel="noopener">webview</a>，其中像 <code>javaScriptEnabled</code> 这些属性是我们常用的，还有一些不常用但很能填坑的属性下面介绍下</p><h3 id="webview-与-react-native-通信"><a href="#webview-与-react-native-通信" class="headerlink" title="webview 与 react-native 通信"></a>webview 与 react-native 通信</h3><p>目前只能传递字符串</p><h4 id="webview-给-react-native-发消息："><a href="#webview-给-react-native-发消息：" class="headerlink" title="webview 给 react-native 发消息："></a><code>webview</code> 给 <code>react-native</code> 发消息：</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.postMessage(<span class="string">'str'</span>)</span><br></pre></td></tr></table></figure><p><code>react-native</code> 通过 <code>onMessage</code> 接受消息：<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">_onMessage = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log( <span class="string">"On Message"</span>, e.nativeEvent.data );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p></p><h4 id="react-native-给-webview-发消息："><a href="#react-native-给-webview-发消息：" class="headerlink" title="react-native 给 webview 发消息："></a><code>react-native</code> 给 <code>webview</code> 发消息：</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.webView.postMessage(<span class="string">'str'</span>);</span><br></pre></td></tr></table></figure><p><code>webview</code> 接受消息：<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.addEventListener( <span class="string">'message'</span>, event =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(event.data)</span><br><span class="line">&#125;, <span class="literal">false</span>)</span><br></pre></td></tr></table></figure><p></p><a id="more"></a><h3 id="自动计算-webview-高度"><a href="#自动计算-webview-高度" class="headerlink" title="自动计算 webview 高度"></a>自动计算 webview 高度</h3><blockquote><p>刚开始我使用的是 <code>onLoadEnd</code> 计算网页高度。当图片加载成功时 <strong>Android</strong> 和 <strong>Ios</strong> 都 OK 。如果有图片加载失败， <strong>Ios</strong> Ok ， <strong>Android</strong> 的高度会计算失败，内容显示不全。<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">_onLoadEnd = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> script = <span class="string">`window.postMessage(document.body.scrollHeight)`</span>;</span><br><span class="line">    <span class="keyword">this</span>.webView.injectJavaScript(script);</span><br><span class="line">&#125;;</span><br><span class="line">_onMessage = <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> height = <span class="built_in">parseInt</span>(event.nativeEvent.data) || <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (height &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.setState(&#123; <span class="attr">webViewHeight</span>: height &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br></pre></td></tr></table></figure><p></p></blockquote><p>下面的方案可以修复上面的问题：<br>在 <code>index.html</code> 中添加：<br></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="css">        <span class="selector-id">#height-wrapper</span> &#123;</span></span><br><span class="line"><span class="undefined">            position: absolute;</span></span><br><span class="line"><span class="undefined">            top: 0;</span></span><br><span class="line"><span class="undefined">            left: 0;</span></span><br><span class="line"><span class="undefined">            right: 0;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="actionscript">        ;(<span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> wrapper = <span class="built_in">document</span>.createElement(<span class="string">"div"</span>);</span></span><br><span class="line"><span class="actionscript">            wrapper.id = <span class="string">"height-wrapper"</span>;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">while</span> (<span class="built_in">document</span>.body.firstChild) &#123;</span></span><br><span class="line"><span class="javascript">                wrapper.appendChild(<span class="built_in">document</span>.body.firstChild);</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">document</span>.body.appendChild(wrapper);</span></span><br><span class="line"><span class="actionscript">            <span class="keyword">var</span> i = <span class="number">0</span>;</span></span><br><span class="line"><span class="actionscript">            <span class="function"><span class="keyword">function</span> <span class="title">updateHeight</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">document</span>.title = wrapper.clientHeight;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">window</span>.location.hash = ++i;</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">window</span>.addEventListener(<span class="string">"load"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="undefined">                updateHeight();</span></span><br><span class="line"><span class="undefined">            &#125;);</span></span><br><span class="line"><span class="undefined">        &#125;());</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><p>在 <code>react-native</code> 监听 <code>onNavigationStateChange</code> ：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">_onNavigationStateChange = <span class="function">(<span class="params">navState</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (navState.title &amp;&amp; (navState.title - <span class="keyword">this</span>.state.webViewHeight &gt; <span class="number">0</span>)) &#123;</span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">            webViewHeight: <span class="built_in">parseInt</span>(navState.title)</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="打包后-react-native-找不到资源"><a href="#打包后-react-native-找不到资源" class="headerlink" title="打包后 react-native 找不到资源"></a>打包后 react-native 找不到资源</h3><p>我们的 <code>index.html</code> 引用了其他的 js ， 而 js 中引用了很多图片、音乐、字体 …<br><strong>Android</strong> 和 <strong>Ios</strong> 中需要放在各自的资源目录下，具体是：</p><ul><li><strong>Android</strong> ：<br><code>android/app/src/main/assets/</code> 下，将游戏打包后的文件夹 <code>trivia-game</code> 放到前面的目录下。<br><code>webview</code> 中 <code>source</code> 对应的地址为 <code>file:///android_asset/trivia-game/index.html</code>。<br><code>webview</code> 必须添加 <code>allowUniversalAccessFromFileURLs={ true }</code> ，不然只能读到 js ，而不能读取到 js 引用的其他资源。<br>这是这个属性的介绍： Boolean that sets whether JavaScript running in the context of a file scheme URL should be allowed to access content from any origin. Including accessing content from other file scheme URLs</li><li><strong>Ios</strong> :<br><code>ios/external/</code> 下，若没有 external 目录则先新建一个， 将游戏打包后的文件夹 <code>trivia-game</code> 放到前面的目录下。<br><code>webview</code> 中 <code>source</code> 对应的地址为 <code>./trivia-game/index.html</code>。</li></ul><p>另外，<strong>Android</strong> 下的 <code>Webview</code> 不识别 <code>svg</code> 文件 ，我目前的做法是将文件转为了 <code>base64</code> 格式，不知道有大佬有更好的方案吗？</p><h3 id="ios-下-音乐不自动播放"><a href="#ios-下-音乐不自动播放" class="headerlink" title="ios 下 音乐不自动播放"></a>ios 下 音乐不自动播放</h3><p>添加属性： <code>mediaPlaybackRequiresUserAction={ false }</code> , 原因是 <strong>Ios</strong> 默认需要用户操作才可以播放音乐和视频</p><h3 id="调试工具"><a href="#调试工具" class="headerlink" title="调试工具"></a>调试工具</h3><ul><li><strong>Android</strong> :<br><a href="chrome://inspect/#devices" target="_blank" rel="noopener">chrome://inspect/#devices</a> 是很好用的工具，之前调试 <code>webview</code> 、手机网页 都很好用。但在 <strong>genymotion</strong> 模拟器中，整个调试器的样式都是乱的。查询到这个 <a href="https://stackoverflow.com/questions/47980279/google-chrome-devtools-broken-when-inspecting-android-webview" target="_blank" rel="noopener">答案</a>, 原因是 <strong>Chrome</strong> 去掉了一个 <code>api</code> ，所以我下了旧版的 <strong>Chromium</strong>。前面答案的超链接里有下载地址。</li><li><strong>Ios</strong> : 使用 <strong>Safari</strong> ,具体参考 <a href="https://stackoverflow.com/questions/47991959/how-to-debug-a-webview-in-react-native" target="_blank" rel="noopener">这儿</a></li></ul>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[算法与数据结构]]></title>
      <url>https://jintang.github.io/2018/11/11/%E7%AE%97%E6%B3%95%E5%92%8C%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%AD%A6%E4%B9%A0/</url>
      <content type="html"><![CDATA[<h2 id="算法"><a href="#算法" class="headerlink" title="算法"></a>算法</h2><h2 id="排序算法"><a href="#排序算法" class="headerlink" title="排序算法"></a>排序算法</h2><h3 id="选择排序"><a href="#选择排序" class="headerlink" title="选择排序"></a>选择排序</h3><ul><li>双层循环(i 从 0 到 length - 1, j 从 i + 1 到 length - 1)</li><li>比较 list[i] 与 list[j] 大小，如果 list[j] &lt; list[i] ，则交换位置</li></ul><p>时间复杂度： $O(N^2)$</p><h3 id="归并排序"><a href="#归并排序" class="headerlink" title="归并排序"></a>归并排序</h3><ul><li>等分目标，直到等分的结果长度为1（时间复杂度 $O(log_2 N)$）</li><li>开始循环，每次 + 2 ，单词循环中对比相邻的两项进行排列，合并之后得到长度为2的单元</li><li>同上次循环，合并得到长度为4的单元</li><li>…</li><li>直到最后，完成合并，得到正确排序数组</li></ul><p>时间复杂度： $O(N log_2 N)$</p><h3 id="图搜索算法：地图常用，比如获取从一个地方到另外一个地方最近的路线"><a href="#图搜索算法：地图常用，比如获取从一个地方到另外一个地方最近的路线" class="headerlink" title="图搜索算法：地图常用，比如获取从一个地方到另外一个地方最近的路线"></a>图搜索算法：地图常用，比如获取从一个地方到另外一个地方最近的路线</h3><p>最普通的 Dijkstra 算法： O(N^2)<br>优化后： O(N * logN)</p><h2 id="数据结构"><a href="#数据结构" class="headerlink" title="数据结构"></a>数据结构</h2><p>数组，在内存上顺序存储。字符串是一种在内存上尾部指针指向 “null” 的数组（即在内存上最后一位是二进制0）。因为是顺序存储，所以很难插入修改。数组中的节点可以一个结构体，这样便可以方便修改。下面是几种常见的结构体数组：</p><h3 id="链表"><a href="#链表" class="headerlink" title="链表"></a>链表</h3><p>每个元素叫做 Node， 存储了一个变量和一个指针（在内存上占用了两个位置），这个指针指向了下一个节点。通过新增一个节点，修改指针的指向可以方便的插入。</p><p>链表有两个比较出名的个例：队列、栈。他们的区别是先进先出与后进先出，专有名词有：出队、进队、出栈、进栈</p><h3 id="树"><a href="#树" class="headerlink" title="树"></a>树</h3><p>它的节点存储了一个变量和两个指针（在内存上占用了三个位置），分别是左指针和右指针。</p><p>专有名词有： 根节点、母节点、子节点、叶节点（没有子节点的节点）</p><h3 id="图"><a href="#图" class="headerlink" title="图"></a>图</h3><p>它的节点存储了一个变量和多个指针</p>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[开发部署以太坊DAPP]]></title>
      <url>https://jintang.github.io/2018/10/26/%E5%BC%80%E5%8F%91%E9%83%A8%E7%BD%B2%E4%BB%A5%E5%A4%AA%E5%9D%8ADAPP/</url>
      <content type="html"><![CDATA[<blockquote><p>参考链接： <a href="https://learnblockchain.cn/2018/04/15/web3-html/" target="_blank" rel="noopener">Web3与智能合约交互实战</a></p></blockquote><p><strong>DApp</strong> 是 <strong>Decentralized Application</strong> 的简称，及去中心化应用。DAPP 由客户端和合约端配合实现。<br>我们使用 <a href="https://solidity-cn.readthedocs.io/zh/develop/solidity-in-depth.html" target="_blank" rel="noopener">Solidity</a> 语言编写完合约后，之前我们使用了 <code>geth</code> 与之交互， 而这种命令行的方式太过繁琐，所以我们这儿用到了 <code>Web3.js</code>。</p><p><strong>Web3.js</strong> 是以太坊官方的Javascript API，可以帮助智能合约开发者使用HTTP或者IPC与本地的或者远程的以太坊节点交互。实际上就是一个库的集合，主要包括下面几个库：</p><ul><li>web3-eth 用来与以太坊区块链和智能合约交互</li><li>web3-shh 用来控制whisper协议与p2p通信以及广播</li><li>web3-bzz 用来与swarm协议交互</li><li>web3-utils 包含了一些Dapp开发有用的功能</li></ul><p>这儿我们主要用到了 <code>web3-eth</code>。下面开始</p><h2 id="使用-ganache-生成一条私有链"><a href="#使用-ganache-生成一条私有链" class="headerlink" title="使用 ganache 生成一条私有链"></a>使用 ganache 生成一条私有链</h2><p>ganache 是一个可以一键搭建以太坊区块链测试环境的工具。 启动之后默认会生成 10 个账号， 我们的私有链默认运行在 <a href="http://127.0.0.1:7545" target="_blank" rel="noopener">http://127.0.0.1:7545</a>上。<br><a id="more"></a></p><h2 id="编写合约"><a href="#编写合约" class="headerlink" title="编写合约"></a>编写合约</h2><p>我们使用在线的 <a href="http://remix.ethereum.org/#optimize=true&amp;version=soljson-v0.4.25+commit.59dbf8f1.js" target="_blank" rel="noopener">Remix IDE</a> 来编写代码。</p><p><em>InfoContract.sol</em>:<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.21</span>;</span><br><span class="line"></span><br><span class="line">contract InfoContract &#123;</span><br><span class="line">    </span><br><span class="line">  string fName;</span><br><span class="line">  uint age;</span><br><span class="line">   </span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">setInfo</span>(<span class="params">string _fName, uint _age</span>) <span class="title">public</span> </span>&#123;</span><br><span class="line">    fName = _fName;</span><br><span class="line">    age = _age;</span><br><span class="line">    emit Instructor(_fName, _age);</span><br><span class="line">  &#125;</span><br><span class="line">   </span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getInfo</span>(<span class="params"></span>) <span class="title">public</span> <span class="title">constant</span> <span class="title">returns</span> (<span class="params">string, uint</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (fName, age);</span><br><span class="line">  &#125;   </span><br><span class="line">   </span><br><span class="line">  event Instructor(</span><br><span class="line">    string name,</span><br><span class="line">    uint age</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>代码很简单，就是简单的给name和age变量赋值与读取。 并在赋值的时候触发了一个 Instructor 事件。</p><p><a href="https://solidity-cn.readthedocs.io/zh/develop/solidity-in-depth.html" target="_blank" rel="noopener">Solidity</a> 里有很多高级的用法，你还可以给事件添加过滤器…这儿只用了最简单的。</p><h2 id="编译与部署合约"><a href="#编译与部署合约" class="headerlink" title="编译与部署合约"></a>编译与部署合约</h2><h3 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h3><p>选择 <code>Start to compile</code>， 编译成功会出现绿色的合约名称，失败则提示相应的错误信息。</p><h3 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h3><p>切换到 run 的 tab 下，将 Environment 切换成 <code>Web3 Provider</code>，并输入我们的测试链的地址 <a href="http://127.0.0.1:7545" target="_blank" rel="noopener">http://127.0.0.1:7545</a>, Environment 选项的含义为：</p><ul><li><strong>Javascript VM</strong> ：简单的Javascript虚拟机环境，纯粹练习智能合约编写的时候可以选择</li><li><strong>Injected Web3</strong> ：连接到嵌入到页面的Web3，比如连接到MetaMask</li><li><strong>Web3 Provider</strong> ：连接到自定义的节点，如私有的测试网络。</li></ul><p>然后选择 <code>Deploy</code> ,成功后会在 <code>Deployed Contracts</code> 下显示部署成功的合约。并且在 <strong>Remix IDE</strong> 终端下显示合约创建的交易信息。同时，在 ganache 中也生成了对应的区块和交易信息。</p><h2 id="编写客户端"><a href="#编写客户端" class="headerlink" title="编写客户端"></a>编写客户端</h2><p>为了与合约交互，我们使用 <code>web3.js</code> 。</p><h3 id="新建项目并安装-web3-js"><a href="#新建项目并安装-web3-js" class="headerlink" title="新建项目并安装 web3.js"></a>新建项目并安装 web3.js</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir simple-DAPP &amp;&amp; <span class="built_in">cd</span> simple-DAPP</span><br><span class="line">npm init</span><br><span class="line">npm install web3 -D</span><br></pre></td></tr></table></figure><h3 id="构建页面与交互逻辑"><a href="#构建页面与交互逻辑" class="headerlink" title="构建页面与交互逻辑"></a>构建页面与交互逻辑</h3><p>页面、样式省略，下面说下 js 中需要注意的部分。</p><ol><li>创建 web3 :<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> web3 !== <span class="string">'undefined'</span>) &#123;</span><br><span class="line">    web3 = <span class="keyword">new</span> Web3(web3.currentProvider);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// set the provider you want from Web3.providers</span></span><br><span class="line">    web3 = <span class="keyword">new</span> Web3(<span class="keyword">new</span> Web3.providers.HttpProvider(<span class="string">"http://localhost:7545"</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><p>上面是 web3 官方的创建方法，本例中的 web3 是通过 <a href="http://localhost:7545" target="_blank" rel="noopener">http://localhost:7545</a> 创建的。而如果你使用类似 <code>MetaMask</code> （一个 Chrome 上的插件，迷你型以太坊钱包）这样的软件，provider 就会被自动植入。</p><ol><li><p>绑定账号：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">web3.eth.defaultAccount = web3.eth.accounts[<span class="number">0</span>]; <span class="comment">// ganache生成的10个账号中随便取一个作为默认账号</span></span><br></pre></td></tr></table></figure></li><li><p>通过 ABI 创建一个Solidity的合约对象，用来在某个地址上初始化合约<br><code>Application Binary Interface(ABI)</code> 是从区块链外部与合约进行交互以及合约与合约间进行交互的一种标准方式。事实上， <code>Solidity</code> 里的合约的含义就是它的 函数 和 数据（它的 状态 ），它们位于以太坊区块链的一个特定地址上。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// abi 通过 Remix IDE 的 compile 面板下 ABI 按钮复制</span></span><br><span class="line"><span class="keyword">let</span> infoContract = web3.eth.contract(abi);</span><br></pre></td></tr></table></figure></li></ol><p>这是此合约生成的 ABI :<br></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="attr">"constant"</span>: <span class="literal">false</span>,</span><br><span class="line">		<span class="attr">"inputs"</span>: [</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="attr">"name"</span>: <span class="string">"_fName"</span>,</span><br><span class="line">				<span class="attr">"type"</span>: <span class="string">"string"</span></span><br><span class="line">			&#125;,</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="attr">"name"</span>: <span class="string">"_age"</span>,</span><br><span class="line">				<span class="attr">"type"</span>: <span class="string">"uint256"</span></span><br><span class="line">			&#125;</span><br><span class="line">		],</span><br><span class="line">		<span class="attr">"name"</span>: <span class="string">"setInfo"</span>,</span><br><span class="line">		<span class="attr">"outputs"</span>: [],</span><br><span class="line">		<span class="attr">"payable"</span>: <span class="literal">false</span>,</span><br><span class="line">		<span class="attr">"stateMutability"</span>: <span class="string">"nonpayable"</span>,</span><br><span class="line">		<span class="attr">"type"</span>: <span class="string">"function"</span></span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="attr">"anonymous"</span>: <span class="literal">false</span>,</span><br><span class="line">		<span class="attr">"inputs"</span>: [</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="attr">"indexed"</span>: <span class="literal">false</span>,</span><br><span class="line">				<span class="attr">"name"</span>: <span class="string">"name"</span>,</span><br><span class="line">				<span class="attr">"type"</span>: <span class="string">"string"</span></span><br><span class="line">			&#125;,</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="attr">"indexed"</span>: <span class="literal">false</span>,</span><br><span class="line">				<span class="attr">"name"</span>: <span class="string">"age"</span>,</span><br><span class="line">				<span class="attr">"type"</span>: <span class="string">"uint256"</span></span><br><span class="line">			&#125;</span><br><span class="line">		],</span><br><span class="line">		<span class="attr">"name"</span>: <span class="string">"Instructor"</span>,</span><br><span class="line">		<span class="attr">"type"</span>: <span class="string">"event"</span></span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="attr">"constant"</span>: <span class="literal">true</span>,</span><br><span class="line">		<span class="attr">"inputs"</span>: [],</span><br><span class="line">		<span class="attr">"name"</span>: <span class="string">"getInfo"</span>,</span><br><span class="line">		<span class="attr">"outputs"</span>: [</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="attr">"name"</span>: <span class="string">""</span>,</span><br><span class="line">				<span class="attr">"type"</span>: <span class="string">"string"</span></span><br><span class="line">			&#125;,</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="attr">"name"</span>: <span class="string">""</span>,</span><br><span class="line">				<span class="attr">"type"</span>: <span class="string">"uint256"</span></span><br><span class="line">			&#125;</span><br><span class="line">		],</span><br><span class="line">		<span class="attr">"payable"</span>: <span class="literal">false</span>,</span><br><span class="line">		<span class="attr">"stateMutability"</span>: <span class="string">"view"</span>,</span><br><span class="line">		<span class="attr">"type"</span>: <span class="string">"function"</span></span><br><span class="line">	&#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p></p><p>可以看到这是对合约里函数的描述。此合约里没有状态，</p><ol><li>通过合约地址获取合约实例<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 合约地址 在 Remix IDE 的 run 面板 —— Deployed Contracts 下</span></span><br><span class="line"><span class="keyword">let</span> info = infoContract.at(<span class="string">'合约地址'</span>);</span><br></pre></td></tr></table></figure></li></ol><p>然后就可以使用合约里的函数和事件了，详细查看 <a href="https://github.com/jintangWang/simple-DAPP/blob/master/main.js" target="_blank" rel="noopener">demo</a></p><p><strong>至此：</strong> <code>DAPP</code> 的 客户端 编写完成。</p><h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>我通过 webpack 启动了客户端，每次点击 <code>Update Info</code> 按钮都会生成一条交易。<br><img src="https://tang-blog-1257996120.cos-website.ap-chengdu.myqcloud.com/dapp_transcation.png" alt="dapp_transcation"><br>交易可以看作是从一个帐户发送到另一个帐户的消息。它能包含一个二进制数据（合约负载）和以太币。如果目标账户含有代码，此代码会被执行，并以 payload 作为入参。如果目标账户是零账户（账户地址为 0 )，此交易将创建一个 新合约 。 如前文所述，合约的地址不是零地址，而是通过合约创建者的地址和从该地址发出过的交易数量计算得到的（所谓的“nonce”）</p><p><em>说明：</em> 一经创建，每笔交易都收取一定数量的 gas 。无论执行到什么位置，一旦 gas 被耗尽（比如降为负值），将会触发一个 <code>out-of-gas</code> 异常。当前调用帧（call frame）所做的所有状态修改都将被回滚。</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>可以用下图来描述 <code>DAPP</code> 的原理。<br><img src="https://tang-blog-1257996120.cos-website.ap-chengdu.myqcloud.com/DAPP_theory.png" alt="DAPP_theory"><br>我们的 demo 完成了 客户端 和 合约端。</p>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[用truffle框架开发部署以太坊DAPP]]></title>
      <url>https://jintang.github.io/2018/10/11/%E7%94%A8truffle%E6%A1%86%E6%9E%B6%E5%BC%80%E5%8F%91%E9%83%A8%E7%BD%B2%E4%BB%A5%E5%A4%AA%E5%9D%8ADAPP/</url>
      <content type="html"><![CDATA[<blockquote><p>参考链接：<a href="https://truffleframework.com/tutorials/pet-shop" target="_blank" rel="noopener">ETHEREUM PET SHOP – YOUR FIRST DAPP</a></p></blockquote><h2 id="开发环境"><a href="#开发环境" class="headerlink" title="开发环境"></a>开发环境</h2><ul><li><p><a href="https://truffleframework.com" target="_blank" rel="noopener">Truffle</a>: 以太坊Solidity编程语言开发框架。安装：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> npm install -g truffle</span></span><br></pre></td></tr></table></figure></li><li><p><a href="https://truffleframework.com/ganache" target="_blank" rel="noopener">Ganache</a>: 前身testRPC，可以启动一个个人的以太坊私有链用作测试、执行命令、检测区块执行状态。点击前面的连接下载客户端即可。</p></li></ul><h2 id="初始化项目"><a href="#初始化项目" class="headerlink" title="初始化项目"></a>初始化项目</h2><ol><li><p>建立项目目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir pet-shop &amp;&amp; <span class="built_in">cd</span> pet-shop</span><br></pre></td></tr></table></figure></li><li><p>使用 <code>truffle unbox</code> 创建项目</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">truffle unbox pet-shop</span><br><span class="line"><span class="comment"># Downloading...</span></span><br><span class="line"><span class="comment"># Unpacking...</span></span><br><span class="line"><span class="comment"># Setting up...</span></span><br><span class="line"><span class="comment"># Unbox successful. Sweet!</span></span><br></pre></td></tr></table></figure></li></ol><p><em>注:</em> 我们可以使用 <code>truffle unbox &lt;box-name&gt;</code> 下载任意的 Truffle Boxes。 在 <a href="https://truffleframework.com/boxes" target="_blank" rel="noopener">truffle box 仓库</a> 可以看到很多 Box , 上面我们下载的是 <a href="https://truffleframework.com/boxes/pet-shop" target="_blank" rel="noopener">pet-shop box</a></p><p>下载完成后,可以看到下面这些重要的目录和文件：</p><ul><li>contracts/ 智能合约的文件夹，所有的智能合约文件都放置在这里，里面包含一个重要的合约Migrations.sol</li><li>migrations/ 用来处理部署（迁移）智能合约 ，迁移是一个额外特别的合约用来保存合约的变化。</li><li>test/ 智能合约测试用例文件夹</li><li>truffle.js 配置文件</li></ul><a id="more"></a><h2 id="编写智能合约"><a href="#编写智能合约" class="headerlink" title="编写智能合约"></a>编写智能合约</h2><p>在contracts目录下，添加合约文件Adoption.sol</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.17</span>;</span><br><span class="line"></span><br><span class="line">contract Adoption &#123;</span><br><span class="line"></span><br><span class="line">  address[<span class="number">16</span>] public adopters;  <span class="comment">// 保存领养者的地址</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 领养宠物</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">adopt</span>(<span class="params">uint petId</span>) <span class="title">public</span> <span class="title">returns</span> (<span class="params">uint</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">require</span>(petId &gt;= <span class="number">0</span> &amp;&amp; petId &lt;= <span class="number">15</span>);  <span class="comment">// 确保id在数组长度内</span></span><br><span class="line"></span><br><span class="line">    adopters[petId] = msg.sender;        <span class="comment">// msg.sender 表示调用此方法的人或者智能合约</span></span><br><span class="line">    <span class="keyword">return</span> petId;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 返回领养者</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getAdopters</span>(<span class="params"></span>) <span class="title">public</span> <span class="title">view</span> <span class="title">returns</span> (<span class="params">address[<span class="number">16</span>]</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> adopters;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="编译部署智能合约"><a href="#编译部署智能合约" class="headerlink" title="编译部署智能合约"></a>编译部署智能合约</h2><p>在项目根目录下：</p><p><strong>编译：</strong><br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">truffle compile</span><br><span class="line"><span class="comment"># Compiling ./contracts/Adoption.sol...</span></span><br><span class="line"><span class="comment"># Writing artifacts to ./build/contracts</span></span><br></pre></td></tr></table></figure><p></p><p><strong>部署</strong>:</p><p>在 migrations 文件夹下已经有一个 <code>1_initial_migration.js</code> 部署脚本，用来部署 <code>Migrations.sol</code> 合约。</p><p><code>Migrations.sol</code> 用来确保不会部署相同的合约。</p><p>我们来创建一个自己的部署脚本 <code>2_deploy_contracts.js</code><br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Adoption = artifacts.require(<span class="string">"Adoption"</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params">deployer</span>) </span>&#123;</span><br><span class="line">  deployer.deploy(Adoption);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p></p><p>在执行部署之前，需要确保有一个区块链运行, 可以使用 Ganache 来开启一个私链。 Ganache 启动之后默认会在 7545 端口上运行一个开发链，然后执行下面的命令将合约部署到链上：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">truffle  migrate</span><br><span class="line"><span class="comment"># Using network 'development'.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Running migration: 1_initial_migration.js</span></span><br><span class="line"><span class="comment">#  Deploying Migrations...</span></span><br><span class="line"><span class="comment">#  ... 0xcc1a5aea7c0a8257ba3ae366b83af2d257d73a5772e84393b0576065bf24aedf</span></span><br><span class="line"><span class="comment">#  Migrations: 0x8cdaf0cd259887258bc13a92c0a6da92698644c0</span></span><br><span class="line"><span class="comment"># Saving successful migration to network...</span></span><br><span class="line"><span class="comment">#  ... 0xd7bc86d31bee32fa3988f1c1eabce403a1b5d570340a3a9cdba53a472ee8c956</span></span><br><span class="line"><span class="comment"># Saving artifacts...</span></span><br><span class="line"><span class="comment"># Running migration: 2_deploy_contracts.js</span></span><br><span class="line"><span class="comment">#  Deploying Adoption...</span></span><br><span class="line"><span class="comment">#  ... 0x43b6a6888c90c38568d4f9ea494b9e2a22f55e506a8197938fb1bb6e5eaa5d34</span></span><br><span class="line"><span class="comment">#  Adoption: 0x345ca3e014aaf5dca488057592ee47305d9b3e10</span></span><br><span class="line"><span class="comment"># Saving successful migration to network...</span></span><br><span class="line"><span class="comment">#  ... 0xf36163615f41ef7ed8f4a8f192149a0bf633fe1a2398ce001bf44c43dc7bdda0</span></span><br><span class="line"><span class="comment"># Saving artifacts...</span></span><br></pre></td></tr></table></figure><p>在打开的Ganache里可以看到区块链状态的变化，现在产生了4个区块。并且发现账号下刚开始的 100 个 <code>eth</code> 少了 零点几 个</p><p>这时说明已经智能合约已经部署好了。</p><h2 id="创建用户接口和智能合约交互"><a href="#创建用户接口和智能合约交互" class="headerlink" title="创建用户接口和智能合约交互"></a>创建用户接口和智能合约交互</h2><p>我们已经编写和部署及测试好了我们的合约，接下我们为合约编写UI，让合约真正可以用起来。</p><p>在Truffle Box <code>pet-shop</code>里，已经包含了应用的前端代码，代码在 <code>src/</code> 文件夹下。</p><p>修改 <code>src/js/app.js</code> 部分代码：</p><h3 id="初始化-web3-实例，修改-initWeb3-为："><a href="#初始化-web3-实例，修改-initWeb3-为：" class="headerlink" title="初始化 web3 实例，修改 initWeb3() 为："></a>初始化 <a href="https://github.com/ethereum/web3.js" target="_blank" rel="noopener">web3</a> 实例，修改 <code>initWeb3()</code> 为：</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">initWeb3: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Is there an injected web3 instance?</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> web3 !== <span class="string">'undefined'</span>) &#123;</span><br><span class="line">        App.web3Provider = web3.currentProvider;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// If no injected web3 instance is detected, fall back to Ganache</span></span><br><span class="line">        App.web3Provider = <span class="keyword">new</span> Web3.providers.HttpProvider(<span class="string">'http://localhost:7545'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    web3 = <span class="keyword">new</span> Web3(App.web3Provider);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> App.initContract();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="实例化合约，修改-initContract-为："><a href="#实例化合约，修改-initContract-为：" class="headerlink" title="实例化合约，修改 initContract() 为："></a>实例化合约，修改 <code>initContract()</code> 为：</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">initContract: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    $.getJSON(<span class="string">'Adoption.json'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// Get the necessary contract artifact file and instantiate it with truffle-contract</span></span><br><span class="line">        <span class="keyword">var</span> AdoptionArtifact = data;</span><br><span class="line">        <span class="comment">// 通过 truffle-contract.js 创建与我们交互的合约实例</span></span><br><span class="line">        App.contracts.Adoption = TruffleContract(AdoptionArtifact);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Set the provider for our contract</span></span><br><span class="line">        App.contracts.Adoption.setProvider(App.web3Provider);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Use our contract to retrieve and mark the adopted pets</span></span><br><span class="line">        <span class="keyword">return</span> App.markAdopted();</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> App.bindEvents();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><em>说明：</em> Artifacts 是关于合约的信息。比如部署地址和 ABI(Application Binary Interface)。ABI 是一个 js 对象，定义了如何与智能合约交互</p><h3 id="处理领养"><a href="#处理领养" class="headerlink" title="处理领养"></a>处理领养</h3><p>修改 <code>markAdopted()</code> 为：<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">markAdopted: <span class="function"><span class="keyword">function</span>(<span class="params">adopters, account</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> adoptionInstance;</span><br><span class="line"></span><br><span class="line">    App.contracts.Adoption.deployed().then(<span class="function"><span class="keyword">function</span>(<span class="params">instance</span>) </span>&#123;</span><br><span class="line">        adoptionInstance = instance;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 调用合约的getAdopters(), 用call读取链上的信息不用消耗gas</span></span><br><span class="line">        <span class="keyword">return</span> adoptionInstance.getAdopters.call();</span><br><span class="line">    &#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">adopters</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; adopters.length; i++) &#123;</span><br><span class="line">            <span class="comment">// 如果宠物已经被收养了，不允许重复收养</span></span><br><span class="line">            <span class="keyword">if</span> (adopters[i] !== <span class="string">'0x0000000000000000000000000000000000000000'</span>) &#123;</span><br><span class="line">                $(<span class="string">'.panel-pet'</span>).eq(i).find(<span class="string">'button'</span>).text(<span class="string">'Success'</span>).attr(<span class="string">'disabled'</span>, <span class="literal">true</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;).catch(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(err.message);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>修改 <code>handleAdopt()</code> 为：<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">handleAdopt: <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">    event.preventDefault();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> petId = <span class="built_in">parseInt</span>($(event.target).data(<span class="string">'id'</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> adoptionInstance;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取用户账号</span></span><br><span class="line">    web3.eth.getAccounts(<span class="function"><span class="keyword">function</span>(<span class="params">error, accounts</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (error) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(error);</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">var</span> account = accounts[<span class="number">0</span>];</span><br><span class="line">    </span><br><span class="line">        App.contracts.Adoption.deployed().then(<span class="function"><span class="keyword">function</span>(<span class="params">instance</span>) </span>&#123;</span><br><span class="line">            adoptionInstance = instance;</span><br><span class="line">        </span><br><span class="line">            <span class="comment">// 调用 Adoption.sol 里的 adopt 方法发起领养宠物交易</span></span><br><span class="line">            <span class="keyword">return</span> adoptionInstance.adopt(petId, &#123;<span class="attr">from</span>: account&#125;);</span><br><span class="line">        &#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">result</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> App.markAdopted();</span><br><span class="line">        &#125;).catch(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(err.message);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p><em>注：</em> 收养宠物是一个交易而不是 call ,交易需要支付 <code>gas</code> 。 <code>gas</code> 是智能合约计算和存储数据需要付出的费用，和 <code>eth</code> 之间有一个换算方法。</p><h2 id="在浏览器中运行"><a href="#在浏览器中运行" class="headerlink" title="在浏览器中运行"></a>在浏览器中运行</h2><h3 id="安装-MetaMask"><a href="#安装-MetaMask" class="headerlink" title="安装 MetaMask"></a>安装 MetaMask</h3><p>MetaMask 是一款浏览器插件形式的以太坊轻客户端，允许你不下载整个以太坊节点而在浏览器中运行以太坊的 DAPP</p><h3 id="配置钱包"><a href="#配置钱包" class="headerlink" title="配置钱包"></a>配置钱包</h3><p>我们通过还原一个Ganache为我们创建好的钱包，作为我们的开发测试钱包。<br>打开 MetaMask ，选择 <strong>Import using account seed phrase</strong>, 输入Ganache显示的助记词。<br>我的是：<br></p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">heavy</span> <span class="keyword">best </span>inner hobby chef <span class="keyword">bread </span><span class="meta">entry</span> oyster dose float napkin media</span><br></pre></td></tr></table></figure><p></p><p>配置密码之后即可看到账号，里面有 100 个初始 <code>eth</code></p><h3 id="连接开发区块链网络"><a href="#连接开发区块链网络" class="headerlink" title="连接开发区块链网络"></a>连接开发区块链网络</h3><p>在 MetaMask 的 Networks 里选择 <strong>Custom RPC</strong> , 添加一个网络：<a href="http://127.0.0.1:7545" target="_blank" rel="noopener">http://127.0.0.1:7545</a> 即可。</p><h3 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h3><p>Truffle Box <code>pet-shop</code> 里人家提供了一个服务: lite-server。</p><p><code>bs-config.json</code> 指示了lite-server的工作目录。<br></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"server"</span>: &#123;</span><br><span class="line">    <span class="attr">"baseDir"</span>: [<span class="string">"./src"</span>, <span class="string">"./build/contracts"</span>]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>./src 是网站文件目录</p><p>./build/contracts 是合约输出目录</p><p>在 <code>package.json</code> 中已配置了：<br></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">"scripts": &#123;</span><br><span class="line">  "dev": "lite-server",</span><br><span class="line">  "test": "echo \"Error: no test specified\" &amp;&amp; exit 1"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>我们只需要运行：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run dev</span><br></pre></td></tr></table></figure><p></p><p>然后就可以在 <a href="http://localhost:3000/" target="_blank" rel="noopener">http://localhost:3000/</a> 访问到此 DAPP 了。如果你收养了宠物，也会在 MetaMask 与 Ganache 中显示你账号的交易信息</p><p><strong>Over</strong></p>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[react vs vue]]></title>
      <url>https://jintang.github.io/2018/09/05/react-vs-vue/</url>
      <content type="html"><![CDATA[<blockquote><p>先接触了 <code>vue</code> ，感觉 <code>vue</code> 特别方便，优雅的想让你上瘾。后面接触了 <code>react native</code> 开发 App， 过来过去都感觉不适应，再慢慢用过一段日子之后，感觉 <code>react</code> 也有自己鲜明的特点，在使用 <code>react</code> 的时候，总想着和 <code>vue</code> 对比一下。由于自己使用 <code>react</code> 主要是在用 <code>react native</code>， 所以有些东西可能了解不深，望海涵。通过对比借此加深下理解的。</p></blockquote><table><thead><tr><th>Vue</th><th style="text-align:center">React</th><th style="text-align:center">补充说明</th></tr></thead><tbody><tr><td>Computed、watch</td><td style="text-align:center">React 不监听数据变化</td><td style="text-align:center">React可以使用 <code>mobx</code> 库来实现这些功能，在 vue 官方描述的 <a href="https://cn.vuejs.org/v2/guide/comparison.html#MobX" target="_blank" rel="noopener">对比其他框架</a> 里面有这样一句话： 在有限程度上，React + Mobx 也可以被认为是更繁琐的 Vue</td></tr><tr><td>v-model, 这只是通过语法糖定义了一个自定义指令，本质跟 React 一样. 修饰符<code>.async</code> 也是一样</td><td style="text-align:center">React是单向数据流，只能通过事件触发，然后再setState，React没有自定义指令</td><td style="text-align:center">/</td></tr><tr><td>传统 HTML标签渲染 / jsx render渲染</td><td style="text-align:center">jsx</td><td style="text-align:center">/</td></tr><tr><td>Vuex</td><td style="text-align:center">Redux</td><td style="text-align:center">react 有一个中间件react-redux 可以让我们方便的使用 Redux</td></tr><tr><td>EventBus 非父子组件通信</td><td style="text-align:center"><a href="https://github.com/mroderick/PubSubJS" target="_blank" rel="noopener">PubSubJS</a> 或 <a href="http://millermedeiros.github.io/js-signals/" target="_blank" rel="noopener">js-signals</a></td><td style="text-align:center">react-native 中还没用过，没遇到需要的场景</td></tr><tr><td>混入：mixins</td><td style="text-align:center">class组件不可用，在使用 <code>createReactClass</code> 创建 <code>React</code> 组件的时候可用 mixins</td><td style="text-align:center">我们可以要把 mixin 的东西写到单独的 js 文件里，通过 import 实现 mixin，这个本来就是锦上添花，不甚重要</td></tr><tr><td>slot</td><td style="text-align:center">props.chldren</td><td style="text-align:center">自定义组件获取使用时传入的子元素</td></tr><tr><td>自定义指令</td><td style="text-align:center">自己通过事件触发实现类似效果</td><td style="text-align:center">自定义指令可以实现类似于 限制 input 输入格式 等效果</td></tr></tbody></table><p>还有一些是两者非常类似的，只要会了一个，另一个也就会了：</p><ul><li>生命周期方法： 虽然名称不同，但使用一样</li><li>ref ： react 有多种使用 ref 的方法， 具体请看 <a href="https://jintang.github.io/2018/05/11/react-native%E6%88%91%E4%BB%AC%E5%BA%94%E8%AF%A5%E7%9F%A5%E9%81%93%E7%9A%84/">另外一篇文章</a></li></ul><a id="more"></a><h2 id="React-补充"><a href="#React-补充" class="headerlink" title="React 补充"></a>React 补充</h2><h3 id="JSX"><a href="#JSX" class="headerlink" title="JSX"></a>JSX</h3><p>本质上来讲， <code>JSX</code> 只是为 <code>React.createElement(component, props, ...children)</code> 方法提供的语法糖， 所以文件中必须引入 <code>React</code> —— <code>import &#39;React&#39; from &#39;react&#39;</code></p><ul><li><code>JSX</code> 中使用的标签，小写代表内置组件，大写代表自定义组件。如 <code>&lt;div&gt;&lt;/div&gt;</code> 与 <code>&lt;Hello&gt;</code> 分别是内置组件和自定义组件</li><li><code>JSX</code> 可以直接使用的判断运算符： <code>&amp;&amp;</code> 、 <code>? :</code> ；可以直接使用的循环遍历方法： <code>map</code> ，因为 <code>map</code> 会返回一个新数组</li></ul><p><em>注意：</em> 循环渲染时，数组元素中使用的 <code>key</code> 在其兄弟之间应该是独一无二的。然而，它们不需要是全局唯一的。当我们生成两个不同的数组时，我们可以使用相同的键。 另外 <code>key</code> 尽量不要使用 index 或其他随机数，如果数组重排的话 React 的差异比较算法会认为全部需要重新渲染。</p><h3 id="props-children"><a href="#props-children" class="headerlink" title="props.children"></a>props.children</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        &lt;FancyBorder color=<span class="string">"blue"</span>&gt;</span><br><span class="line">            &lt;h1 className=<span class="string">"Dialog-title"</span>&gt;</span><br><span class="line">                Welcome</span><br><span class="line">            &lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>FancyBorder&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如上我们定义了一个 <code>FancyBorder</code> 自定义组件， 那么它内部的 <code>props.children</code> 就是它的子元素，即 <code>&lt;h1&gt;</code> 包裹的那一段。</p><h3 id="构造函数是唯一能够初始化-this-state-的地方。而其他地方更新-state-只能用-setState-updater-callback"><a href="#构造函数是唯一能够初始化-this-state-的地方。而其他地方更新-state-只能用-setState-updater-callback" class="headerlink" title="构造函数是唯一能够初始化 this.state 的地方。而其他地方更新 state 只能用 setState(updater, [callback])"></a>构造函数是唯一能够初始化 this.state 的地方。而其他地方更新 <code>state</code> 只能用 <code>setState(updater, [callback])</code></h3><p><em>注意：</em> <code>setState()</code> 认为是一次请求而不是一次立即执行更新组件的命令。为了更为可观的性能， <code>React</code> 可能会推迟它，稍后会一次性更新这些组件。 <code>React</code> 不会保证在 <code>setState</code> 之后，能够立刻拿到改变的结果。</p><p>第一个参数 updater 如下:</p><ul><li>普通对象，最常见，如： <code>this.setState({name: &#39;小明&#39;})</code></li><li>updater函数，因为 this.state 可能是异步更新的，如果之后的状态依赖于之前的状态，此时就需要这种方式实现。<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Wrong */</span></span><br><span class="line"><span class="keyword">this</span>.setState(&#123;</span><br><span class="line">    counter: <span class="keyword">this</span>.state.counter + <span class="keyword">this</span>.props.increment,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">/* Correct */</span></span><br><span class="line"><span class="keyword">this</span>.setState(<span class="function">(<span class="params">prevState, props</span>) =&gt;</span> (&#123;</span><br><span class="line">    counter: prevState.counter + props.increment</span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure></li></ul><p>第二个参数在 <code>setState</code> 执行完成同时组件被重渲之后执行。通常，对于这类逻辑，我们推荐使用 <code>componentDidUpdate</code></p><h3 id="事件绑定-this-JSX-回调函数中的-this，类的方法默认是不会绑定-this-的"><a href="#事件绑定-this-JSX-回调函数中的-this，类的方法默认是不会绑定-this-的" class="headerlink" title="事件绑定 this : JSX 回调函数中的 this，类的方法默认是不会绑定 this 的"></a>事件绑定 this : <code>JSX</code> 回调函数中的 this，类的方法默认是不会绑定 this 的</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">funciton handleClick1(param, e) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">handleClick2 = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            <span class="comment">/* 1. 利用 bind, 此时 e 会是参数中的最后一个 */</span></span><br><span class="line">            &lt;button onClick=&#123;<span class="keyword">this</span>.handleClick1.bind(<span class="keyword">this</span>， param)&#125;&gt;方法<span class="number">1</span>&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">            /</span>* <span class="number">2.</span> 利用 箭头函数，需将 handleClick 定义为箭头函数格式 *<span class="regexp">/</span></span><br><span class="line"><span class="regexp">            &lt;button onClick=&#123;this.handleClick2&#125;&gt;方法2&lt;/</span>button&gt;</span><br><span class="line">        &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p><em>注意：</em> 事件回调事件不能通过 <code>reture false</code> 来阻止默认行为，必须得通过 <code>e.preventDefault()</code></p>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[区块链学习]]></title>
      <url>https://jintang.github.io/2018/08/13/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AD%A6%E4%B9%A0/</url>
      <content type="html"><![CDATA[<h3 id="Hash-函数"><a href="#Hash-函数" class="headerlink" title="Hash 函数"></a>Hash 函数</h3><p>区块链中区块相连是依靠：后一个区块持有前一个区块的 hash ，这个 hash 一般放在区块头中。 Hash 函数一般有两类：</p><ol><li>MD 系列： 如 MD5 ，已被证实不是特别安全</li><li>SH 系列： 是美国国家安全局 (NSA) 设计。经历了SHA-0，SHA-1，SHA-2，SHA-3系列发展，比特币采用SHA256算法，该算法属于SHA-2系列，在中本聪发明比特币时（2008）被公认为最安全最先进的算法之一</li></ol>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[hello 智能合约]]></title>
      <url>https://jintang.github.io/2018/08/03/hello-%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/</url>
      <content type="html"><![CDATA[<blockquote><p>欢迎查看 跟着大佬一起动手系列，点击<a href="https://learnblockchain.cn/2017/11/24/init-env/" target="_blank" rel="noopener">这儿</a>查看大佬的博文</p></blockquote><h2 id="什么是智能合约"><a href="#什么是智能合约" class="headerlink" title="什么是智能合约"></a>什么是智能合约</h2><p><strong>以太坊上的程序称之为智能合约，它是代码和数据(状态)的集合。</strong></p><p>如果做比喻的话智能合约更像是JAVA程序，JAVA程序通过JAVA虚拟机（JVM）将代码解释字节进行执行，以太坊的智能合约通过以太坊虚拟机（EVM）解释成字节码进行执行。</p><p>智能合约可以理解为在区块链上可以自动执行的（由消息驱动的）、以代码形式编写的合同（特殊的交易）。</p><p>比特币的交易是可以编程的，但是比特币脚本有很多的限制，能够编写的程序也有限，而以太坊具有 <a href="https://zh.wikipedia.org/wiki/%E5%9C%96%E9%9D%88%E5%AE%8C%E5%82%99%E6%80%A7" target="_blank" rel="noopener">图灵完备</a>，通俗来说可以完全模拟一台计算机所能做的所有事情。比特币可以执行一些简单脚本，但是他就不是图灵完备，比如循环指令比特币就无法执行。</p><h2 id="编程语言"><a href="#编程语言" class="headerlink" title="编程语言"></a>编程语言</h2><p>用户不可能直接编写以太坊虚拟机（EVM）字节码，所以以太坊提供了几种编写智能合约的高级语言。</p><p>Solidity：类似JavaScript，这是以太坊推荐的旗舰语言，也是最流行的智能合约语言。具体用法参加Solidity文档，地址：<a href="https://solidity.readthedocs.io/en/latest/" target="_blank" rel="noopener">https://solidity.readthedocs.io/en/latest/</a></p><blockquote><p>还有Viper，Serpent，LLL及Bamboo，建议大家还是使用Solidity。Serpent官方已经不再推荐，建议Serpent的用户转换到Viper，他们都是类Python语言。</p></blockquote><p>可以根据不同的习惯选择不同的高级语言，目前最流行的是Solidity。</p><p>我们下面使用 <a href="https://ethereum.github.io/browser-solidity/" target="_blank" rel="noopener">Browser-Solidity</a> IDE （也就是 Remix ）进行合约的编写和编译</p><a id="more"></a><h2 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h2><h3 id="以太坊客户端：-geth-安装"><a href="#以太坊客户端：-geth-安装" class="headerlink" title="以太坊客户端： geth 安装"></a>以太坊客户端： geth 安装</h3><p>在这儿我们使用 Geth ，全称是 go-ethereum，是以太坊的 go 语言命令行客户端，也是最流行的客户端 —— <a href="https://github.com/ethereum/go-ethereum/wiki/Building-Ethereum" target="_blank" rel="noopener">geth官方安装指引</a> 。</p><p>Geth提供了一个交互式命令控制台，通过命令控制台中包含了以太坊的各种功能（API）。拥有账户管理、挖矿、转账、智能合约的部署和执行等等功能。其中，EVM就是由以太坊客户端提供的。</p><blockquote><p>相对于Geth，Mist则是图形化操作界面的以太坊客户端。</p></blockquote><h3 id="使用geth启动环境"><a href="#使用geth启动环境" class="headerlink" title="使用geth启动环境"></a>使用geth启动环境</h3><blockquote><p>智能合约的开发需要使用以太坊的资源，所以是需要付费的，这个费用表现为 以太币。下面我们用 geth 启动开发者网络（模式）,会自动分配一个有大量余额的开发者账户给我们使用。</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">geth --datadir testNet --dev console 2&gt;&gt; test.log</span><br></pre></td></tr></table></figure><p>参数解析，更多请查看<a href="https://github.com/ethereum/go-ethereum/wiki/Command-Line-Options" target="_blank" rel="noopener">这儿</a>:</p><ul><li><code>–dev</code> 启用开发者网络（模式），开发者网络会使用POA共识，默认预分配一个开发者账户并且会自动开启挖矿。</li><li><code>–datadir</code> 后面的参数是区块数据及秘钥存放目录。<br>第一次输入命令后，它会放在当前目录下新建一个testNet目录来存放数据。</li><li><code>console</code> 进入控制台</li><li><code>2&gt;&gt; test.log</code> 表示把控制台日志输出到test.log文件</li></ul><p>为了更好的理解，建议新开一个命令行终端，实时显示日志：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tail -f test.log</span><br></pre></td></tr></table></figure><h3 id="准备账户"><a href="#准备账户" class="headerlink" title="准备账户"></a>准备账户</h3><p>智能合约的部署是指把合约字节码发布到区块链上，并使用一个特定的地址来标示这个合约，这个地址称为合约账户。</p><blockquote><p>以太坊中有两类账户：</p><ul><li>外部账户：该类账户被私钥控制（由人控制），没有关联任何代码。</li><li>合约账户: 该类账户被它们的合约代码控制且有代码与之关联。</li></ul><p><strong>外部账户与合约账户的区别和关系：</strong></p><p>一个外部账户可以通过创建和用自己的私钥来对交易进行签名，来发送消息给另一个外部账户或合约账户。在两个外部账户之间传送消息是价值转移的过程。</p><p>但从外部账户到合约账户的消息会激活合约账户的代码，允许它执行各种动作（比如转移代币，写入内部存储，挖出一个新代币，执行一些运算，创建一个新的合约等等）。</p><p>只有当外部账户发出指令时，合同账户才会执行相应的操作。</p></blockquote><p>智能合约的部署是指把合约字节码发布到区块链上，并使用一个特定的地址来标示这个合约，这个地址称为合约账户。</p><p>部署智能合约需要一个外部账户，我们先来看看分配的开发者账户，这个开发者账户里有充足的以太币。</p><p><em>查看账户:</em><br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; eth.accounts</span><br><span class="line"><span class="comment"># ["0x231b0a1ce4258e708cec69831f89d752822e25aa"] 返回了分配的开发者账户</span></span><br></pre></td></tr></table></figure><p></p><p><em>查看账户余额：</em><br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; eth.getBalance(eth.accounts[0])</span><br><span class="line"><span class="comment"># 1.15792089237316195423570985008687907853269984665640564039457584007913129639927e+77 数字非常大</span></span><br></pre></td></tr></table></figure><p></p><p>开发者账户因余额太多，如果用这个账户来部署合约时会无法看到余额变化，为了更好的体验完整的过程，这里选择创建一个新的账户。</p><p><em>创建账户:</em><br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; personal.newAccount(<span class="string">"tang"</span>)</span><br><span class="line"><span class="comment"># 返回了新的账号 "0x44e805ccb02b8c14e41d1e166e46d7b615c911ca"， tang 是账号密码</span></span><br><span class="line">&gt; eth.accounts</span><br><span class="line"><span class="comment"># ["0x231b0a1ce4258e708cec69831f89d752822e25aa", "0x44e805ccb02b8c14e41d1e166e46d7b615c911ca"] 多了一个</span></span><br><span class="line">&gt; eth.getBalance(eth.accounts[1])</span><br><span class="line"><span class="comment"># 0 查看的是第二个账号的余额</span></span><br></pre></td></tr></table></figure><p></p><p><em>给新账号转账:</em> 转 1 ether 以太币, ether 是 以太币 的单位，以太币的最小单位是 wei ，详情查看 <a href="https://github.com/ethereum/wiki/wiki/JavaScript-API#web3towei" target="_blank" rel="noopener">这儿</a><br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; eth.sendTransaction(&#123;from: <span class="string">'0x231b0a1ce4258e708cec69831f89d752822e25aa'</span>, to: <span class="string">'0x44e805ccb02b8c14e41d1e166e46d7b615c911ca'</span>, value: web3.toWei(1, <span class="string">"ether"</span>)&#125;)</span><br><span class="line"><span class="comment"># "0xf7953104df919ca3d44f262ed291c1a19a82ad34469af6bd4e2a1b7357d93a4f"</span></span><br><span class="line">&gt; eth.getBalance(eth.accounts[1])</span><br><span class="line"><span class="comment"># 1000000000000000000</span></span><br></pre></td></tr></table></figure><p></p><p><em>解锁账户:</em> 在部署合约前需要先解锁账户（就像银行转账要输入密码一样）<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; personal.unlockAccount(eth.accounts[1],<span class="string">"tang"</span>, 0);</span><br><span class="line"><span class="comment"># true  第二个参数是对应账号的密码</span></span><br></pre></td></tr></table></figure><p></p><h2 id="编写、编译、部署-合约代码"><a href="#编写、编译、部署-合约代码" class="headerlink" title="编写、编译、部署 合约代码"></a>编写、编译、部署 合约代码</h2><p><em>solidity代码如下:</em><br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.18</span>;</span><br><span class="line">contract hello &#123;</span><br><span class="line">    string greeting;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">hello</span>(<span class="params">string _greeting</span>) <span class="title">public</span> </span>&#123;</span><br><span class="line">        greeting = _greeting;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">say</span>(<span class="params"></span>) <span class="title">constant</span> <span class="title">public</span> <span class="title">returns</span> (<span class="params">string</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> greeting;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>我们定义了一个名为hello的合约，在合约初始化时保存了一个字符串（我们会传入hello world），每次调用say返回字符串。</p><p>把这段代码写(拷贝)到 <a href="https://ethereum.github.io/browser-solidity/" target="_blank" rel="noopener">Browser-Solidity</a>，Browser-Solidity 要选中 <code>Auto Compile</code> 。如果没有错误，说明编译成功。点击Details获取部署代码（警告可以不理）。</p><p>在弹出的对话框中找到WEB3DEPLOY部分，点拷贝，粘贴到随便的一个编辑器后，修改初始化字符串为hello world。最后结果为：<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> _greeting = <span class="string">"hello world"</span> ;</span><br><span class="line"><span class="comment">// Creates a contract object</span></span><br><span class="line"><span class="keyword">var</span> helloContract = web3.eth.contract([&#123;<span class="string">"constant"</span>:<span class="literal">true</span>,<span class="string">"inputs"</span>:[],<span class="string">"name"</span>:<span class="string">"say"</span>,<span class="string">"outputs"</span>:[&#123;<span class="string">"name"</span>:<span class="string">""</span>,<span class="string">"type"</span>:<span class="string">"string"</span>&#125;],<span class="string">"payable"</span>:<span class="literal">false</span>,<span class="string">"stateMutability"</span>:<span class="string">"view"</span>,<span class="string">"type"</span>:<span class="string">"function"</span>&#125;,&#123;<span class="string">"inputs"</span>:[&#123;<span class="string">"name"</span>:<span class="string">"_greeting"</span>,<span class="string">"type"</span>:<span class="string">"string"</span>&#125;],<span class="string">"payable"</span>:<span class="literal">false</span>,<span class="string">"stateMutability"</span>:<span class="string">"nonpayable"</span>,<span class="string">"type"</span>:<span class="string">"constructor"</span>&#125;]);</span><br><span class="line"><span class="comment">// deploy new contract</span></span><br><span class="line"><span class="keyword">var</span> hello = helloContract.new(</span><br><span class="line">   _greeting, <span class="comment">// constructorParam, 可存在多个</span></span><br><span class="line">   &#123;</span><br><span class="line">     <span class="keyword">from</span>: web3.eth.accounts[<span class="number">1</span>],  <span class="comment">// 部署账号</span></span><br><span class="line">     data: <span class="string">'0x608060405234801561001057600080fd5b5060405161027c38038061027c83398101604052805101805161003a906000906020840190610041565b50506100dc565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061008257805160ff19168380011785556100af565b828001600101855582156100af579182015b828111156100af578251825591602001919060010190610094565b506100bb9291506100bf565b5090565b6100d991905b808211156100bb57600081556001016100c5565b90565b610191806100eb6000396000f3006080604052600436106100405763ffffffff7c0100000000000000000000000000000000000000000000000000000000600035041663954ab4b28114610045575b600080fd5b34801561005157600080fd5b5061005a6100cf565b6040805160208082528351818301528351919283929083019185019080838360005b8381101561009457818101518382015260200161007c565b50505050905090810190601f1680156100c15780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b60008054604080516020601f600260001961010060018816150201909516949094049384018190048102820181019092528281526060939092909183018282801561015b5780601f106101305761010080835404028352916020019161015b565b820191906000526020600020905b81548152906001019060200180831161013e57829003601f168201915b50505050509050905600a165627a7a7230582095d42238dd45ab5b9cf241235d3dbba2dae94a09053bc96b0935ed98ac9a4ec10029'</span>,  <span class="comment">// 合约编译后的字节码</span></span><br><span class="line">     gas: <span class="string">'4700000'</span> <span class="comment">// 以太坊用 gas 计算要智能合约需要的以太币</span></span><br><span class="line">   &#125;, <span class="function"><span class="keyword">function</span> (<span class="params">e, contract</span>)</span>&#123; <span class="comment">// 部署后的回调函数</span></span><br><span class="line">    <span class="comment">// <span class="doctag">NOTE:</span> The callback will fire twice!</span></span><br><span class="line">    <span class="comment">// Once the contract has the transactionHash property set and once its deployed on an address.</span></span><br><span class="line">    <span class="built_in">console</span>.log(e, contract);</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> contract.address !== <span class="string">'undefined'</span>) &#123;</span><br><span class="line">         <span class="built_in">console</span>.log(<span class="string">'Contract mined! address: '</span> + contract.address + <span class="string">' transactionHash: '</span> + contract.transactionHash);</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;)</span><br></pre></td></tr></table></figure><p></p><p><code>eth.contract</code> ：<a href="https://solidity.readthedocs.io/en/develop/abi-spec.html" target="_blank" rel="noopener">api说明</a></p><blockquote><p>需要修改的地方：</p><ul><li>第1行：修改字符串为 hello world</li><li>第6行：修改部署账户为新账户索引，即使用新账户来部署合约。</li></ul></blockquote><p>然后一行一行拷贝到 geth 中执行。出现以下类似 log 说明 <strong>部署成功</strong>。<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Contract mined! address: 0x8500c68000dbbebea6d5673d28927b28b9470854 transactionHash: 0x16c8aa6129693edaf22b43fd043748857d05511251f65b5e9f9faf8355b95656</span><br><span class="line">&gt; eth.getBalance(eth.accounts[1])</span><br><span class="line"><span class="comment"># 查看账号余额，发现变少了</span></span><br></pre></td></tr></table></figure><p></p><p>同时也可以在日志中看到挖矿记录等<br><img src="https://tang-blog-1257996120.cos-website.ap-chengdu.myqcloud.com/mine-log.png" alt="mine-log"></p><h2 id="运行合约"><a href="#运行合约" class="headerlink" title="运行合约"></a>运行合约</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; hello.say()</span><br><span class="line"><span class="comment"># hello world</span></span><br></pre></td></tr></table></figure><p>不知道为什么公司的电脑运行成功了，而家里的电脑却报错了 <code>TypeError: &#39;say&#39; is not a function</code>，明明合约创建成功了。</p><p>跟上面截图的最底部的 error: <code>waiting for transactions</code> 没关系，公司的电脑上也有这行日志。</p>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[node常用]]></title>
      <url>https://jintang.github.io/2018/07/16/node%E5%B8%B8%E7%94%A8/</url>
      <content type="html"><![CDATA[<h2 id="node常用命令"><a href="#node常用命令" class="headerlink" title="node常用命令"></a>node常用命令</h2><h3 id="进入、退出命令行"><a href="#进入、退出命令行" class="headerlink" title="进入、退出命令行"></a>进入、退出命令行</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 进入命令行</span></span><br><span class="line">node</span><br><span class="line"><span class="comment"># 正常退出退出命令行</span></span><br><span class="line">.<span class="built_in">exit</span></span><br><span class="line"><span class="comment"># 强制退出</span></span><br><span class="line">ctrl + c <span class="comment"># 两次</span></span><br></pre></td></tr></table></figure><h3 id="调试模式"><a href="#调试模式" class="headerlink" title="调试模式"></a>调试模式</h3><p>谷歌浏览器内置了 <code>node</code> 的调试器，可以很方便的打断点，看 log , 我们需要以调试模式运行 <code>node</code> 程序<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">node --inspect index</span><br><span class="line"><span class="comment"># 也是以node --inspect的方式启动，只不过加了supervisor的保存即时生效</span></span><br><span class="line">supervisor --inspect index</span><br></pre></td></tr></table></figure><p></p><h3 id="软连接全局-node-包"><a href="#软连接全局-node-包" class="headerlink" title="软连接全局 node 包"></a>软连接全局 node 包</h3><p>我们可以通过 <code>npm install -g 包名</code> 的方式全局安装第远程包，但对于没有在 <code>node</code> 仓库的包无能为力。这儿有另一种方法全局添加自己写的包<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> 文件夹</span><br><span class="line">npm link</span><br></pre></td></tr></table></figure><p></p><p>在全局的包仓库下引用了此仓库，原理类似于快捷方式。然后就可以全局使用自己的包命令了，不想用了的话删除软连接<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm unlink</span><br></pre></td></tr></table></figure><p></p><a id="more"></a>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[网页适配问题]]></title>
      <url>https://jintang.github.io/2018/07/12/%E7%BD%91%E9%A1%B5%E9%80%82%E9%85%8D%E9%97%AE%E9%A2%98/</url>
      <content type="html"><![CDATA[<blockquote><p>自己对网页自适应有些不足，补充一下。另外区分一下 自适应 与 响应式 的区别。</p><ul><li>自适应是为了解决如何才能在不同大小的设备上呈现同样的网页</li><li>响应式是自动识别屏幕宽度、并做出相应调整的网页设计，布局和展示的内容可能会有所变动</li></ul></blockquote><h3 id="技术选择"><a href="#技术选择" class="headerlink" title="技术选择"></a>技术选择</h3><p>可知需要设置大小的样式： <code>width</code> 、 <code>height</code> 、 <code>margin</code> 、 <code>padding</code> 、<code>font-size</code> ，列出来方便思考。<br>可知技术方案： 百分比布局、媒体查询 、 <code>rem</code> 、 <code>vw系列</code> 、 <code>flex</code> 。每一项都有自己的优缺点，我们需要结合起来使用。以实验过程来说明一些问题：</p><ol><li>只用百分比布局</li></ol><ul><li>优点： 浏览器大小改变时布局不变。实现了 自适应网页</li><li>缺点：<ul><li>如果屏幕过小，某个 <code>div</code> 内的内容可能过于拥挤，现在 <strong>PC</strong> 的屏幕不会太小，一般不会影响，但如果想要手机端或者平板访问此网页，效果可想而知。</li><li>如果屏幕过大，某个 <code>div</code> 内的内容可能过于稀少，那么我们需要字体同步放大，需要图片或其他媒体资源同步放大</li></ul></li></ul><ol><li><p>加上媒体查询</p><p>百分比布局加上这个就可以实现 <a href="https://alistapart.com/article/responsive-web-design" target="_blank" rel="noopener">响应式布局</a>，<a href="https://mediaqueri.es/" target="_blank" rel="noopener">这儿</a> 有很多案例</p></li></ol><ul><li>优点： 可以根据 <code>@media</code> 查询设置不同的样式，甚至布局。这样移动端通过修改布局也可以得到好的体验。</li><li>缺点： 要多写好几倍的 <code>css</code></li></ul><ol><li><p>锦上添花</p><p>理论上上面的两个已经可以解决布局问题，但现实中你可能没有时间写那么多的 <code>css</code>。那我们需要其他好东西。</p></li></ol><ul><li><p><code>rem</code> ：根据网页的根元素来设置字体大小。现代浏览器默认的根元素字体大小是 <code>font-size: 16px</code>。<br>设置这个可以让不同屏幕下的字体大小同步缩放，也可以设置给 <code>width</code>、 <code>padding</code> 、 <code>margin</code>。但不同的屏幕下需要给 <code>html</code> 节点 设定不同的 <code>font-size</code> 基准值。下面是几种方式：</p><ol><li><p>配合 <code>@media</code>,例如： <a href="http://3g.163.com/touch/news?version=v_standard" target="_blank" rel="noopener">网易新闻</a></p><p>手机的屏幕宽度： iphone5 是 320px ， iphone6/7/8/X 是 375px ， iphone6/7/8 plus 是 414px ，下面是部分代码</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">media</span> screen and (max-width: <span class="number">320px</span>) &#123;</span><br><span class="line">    <span class="selector-tag">html</span> &#123;</span><br><span class="line">        <span class="attribute">font-size</span>:<span class="number">42.667px</span>;</span><br><span class="line">        <span class="attribute">font-size</span>: <span class="number">13.33333vw</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="keyword">media</span> screen and (min-width: <span class="number">361px</span>) and (max-width:<span class="number">375px</span>) &#123;</span><br><span class="line">    <span class="selector-tag">html</span> &#123;</span><br><span class="line">        <span class="attribute">font-size</span>:<span class="number">50px</span>;</span><br><span class="line">        <span class="attribute">font-size</span>: <span class="number">13.33333vw</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="keyword">media</span> screen and (min-width: <span class="number">413px</span>) and (max-width:<span class="number">414px</span>) &#123;</span><br><span class="line">    <span class="selector-tag">html</span> &#123;</span><br><span class="line">        <span class="attribute">font-size</span>:<span class="number">55.2px</span>;</span><br><span class="line">        <span class="attribute">font-size</span>: <span class="number">13.33333vw</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><a id="more"></a><p>上面的 <code>font-size</code> 是由 屏幕宽度/7.5 得到的，网易新闻 的设计图应该是 750px 的，除以 7.5之后 <code>font-size</code> 就是 100px ，方便其他元素的计算。子元素都是通过 <code>rem</code> 设的宽高等，因为 <code>414:375:320 = 55.2:50:42.667</code> ， 所以在 320px、375px、414px下显示的效果是一样的，上面还用了 <code>vw</code> ，如果浏览器支持的话，可以不使用 <code>@media</code> ，直接设置 <code>html: {font-size: 13.33333}vw</code>， 13.33333 是通过 100/7.5 得到的。然后根据设计图将 <code>px</code> 换算为 <code>rem</code> 就行了，你也可以修改 7.5 为其他值，比如说 10 。</p></li><li><p><code>js</code> 动态计算</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 在 window.resize 方法里也要添加下面这条命令 */</span></span><br><span class="line"><span class="built_in">document</span>.documentElement.style.fontSize = <span class="built_in">window</span>.innerWidth / <span class="number">10</span> + <span class="string">'px'</span>;</span><br></pre></td></tr></table></figure></li><li><p>利用<code>calc</code> 自动计算</p><p>可以直接设置 <code>html: {font-size: 13.33333}vw</code> ，好粗暴。 <a href="https://www.zhangxinxu.com/wordpress/2016/08/vw-viewport-responsive-layout-typography/" target="_blank" rel="noopener">张鑫旭大神</a> 有实践大型项目后的样式：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">html</span> &#123;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">16px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="keyword">media</span> screen and (min-width: <span class="number">375px</span>) &#123;</span><br><span class="line">    <span class="selector-tag">html</span> &#123;</span><br><span class="line">        <span class="comment">/* iPhone6的375px尺寸作为16px基准，414px正好18px大小, 600 20px */</span></span><br><span class="line">        <span class="attribute">font-size</span>: <span class="built_in">calc</span>(100% + 2 * (100vw - 375px) / <span class="number">39</span>);</span><br><span class="line">        <span class="attribute">font-size</span>: <span class="built_in">calc</span>(16px + 2 * (100vw - 375px) / <span class="number">39</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">@<span class="keyword">media</span> screen and (min-width: <span class="number">414px</span>) &#123;</span><br><span class="line">    <span class="selector-tag">html</span> &#123;</span><br><span class="line">        <span class="comment">/* 414px-1000px每100像素宽字体增加1px(18px-22px) */</span></span><br><span class="line">        <span class="attribute">font-size</span>: <span class="built_in">calc</span>(112.5% + 4 * (100vw - 414px) / <span class="number">586</span>);</span><br><span class="line">        <span class="attribute">font-size</span>: <span class="built_in">calc</span>(18px + 4 * (100vw - 414px) / <span class="number">586</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">@<span class="keyword">media</span> screen and (min-width: <span class="number">600px</span>) &#123;</span><br><span class="line">    <span class="selector-tag">html</span> &#123;</span><br><span class="line">        <span class="comment">/* 600px-1000px每100像素宽字体增加1px(20px-24px) */</span></span><br><span class="line">        <span class="attribute">font-size</span>: <span class="built_in">calc</span>(125% + 4 * (100vw - 600px) / <span class="number">400</span>);</span><br><span class="line">        <span class="attribute">font-size</span>: <span class="built_in">calc</span>(20px + 4 * (100vw - 600px) / <span class="number">400</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">@<span class="keyword">media</span> screen and (min-width: <span class="number">1000px</span>) &#123;</span><br><span class="line">    <span class="selector-tag">html</span> &#123;</span><br><span class="line">        <span class="comment">/* 1000px往后是每100像素0.5px增加 */</span></span><br><span class="line">        <span class="attribute">font-size</span>: <span class="built_in">calc</span>(137.5% + 6 * (100vw - 1000px) / <span class="number">1000</span>);</span><br><span class="line">        <span class="attribute">font-size</span>: <span class="built_in">calc</span>(22px + 6 * (100vw - 1000px) / <span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol></li><li><p><code>vw系列</code> : <code>vw</code> 代表屏幕的可见宽度，类似的还有 <code>vh</code> 、 <code>vmin</code> 、 <code>vmax</code> 。百分比宽度是根据父节点的宽度设定的，当嵌套多层之后，用 <code>vw</code> 比较方便。如果浏览器都支持 <code>vw</code> 的话，完全可以用 <code>vw</code> 取代 <code>rem</code> ，上面 网易新闻 的 demo 还用 <code>vw</code> 来设定 <code>html</code> 的 <code>font-size</code></p></li><li><code>flex</code>: 让子元素成比例，垂直居中…等等，不要太方便</li></ul><h3 id="图片等媒体资源处理"><a href="#图片等媒体资源处理" class="headerlink" title="图片等媒体资源处理"></a>图片等媒体资源处理</h3><p>jpg 等图片如果大小设置不合理会发生失真或者截取一部分的情况。所以我们通常这样处理：<br></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">img</span>, <span class="selector-tag">video</span> &#123;</span><br><span class="line">    <span class="attribute">max-width</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>这样，图片最大的时候会保持其原始大小和比例，不会放大失真。而图片变小时也会保持比例。</p>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[移动端调试网页需知]]></title>
      <url>https://jintang.github.io/2018/07/10/%E7%A7%BB%E5%8A%A8%E7%AB%AF%E8%B0%83%E8%AF%95%E7%BD%91%E9%A1%B5%E9%9C%80%E7%9F%A5/</url>
      <content type="html"><![CDATA[<blockquote><p>注意是网页，而不是 App</p></blockquote><h2 id="常见国内移动端浏览器"><a href="#常见国内移动端浏览器" class="headerlink" title="常见国内移动端浏览器"></a>常见国内移动端浏览器</h2><p>手机浏览器内核基本都是 <code>webkit</code>，只不过国内的重新封装了一层，所以谷歌浏览器自带的 <code>Inspect Device</code> 检测不出国内浏览器。</p><ol><li>微信内置、qq浏览器： <code>X5内核</code> ，由腾讯开发的。</li></ol><ul><li>一加自带浏览器： X5内核 037322GPU-M，目前我的是这个版本，问题好多， <code>vue</code> 已经用 <code>babel</code> 转了，但还是不支持，不知道为什么</li><li>QQ浏览器： X5内核 038615GPU-UU，目前我的是这个版本</li><li>UC浏览器： U4内核，由 UC 自主开发</li></ul><p>由于移动端浏览器的五花八门，经常会遇到莫名其妙的 bug ， 我们需要好用的调试工具，看下文。</p><h2 id="调试工具"><a href="#调试工具" class="headerlink" title="调试工具"></a>调试工具</h2><ul><li><a href="http://www.browsersync.cn/" target="_blank" rel="noopener">BrowerSync</a>： 可以同时在PC、平板、手机等设备下进项调试，需要电脑和手机在同一 <code>wifi</code> 下</li><li><code>Weinre</code> : 功能与 Chrome DevTools 相似，需要在页面中插入一段 JS 脚本来实时调试页面 DOM 结构、样式、JS 等，另外它使用的是代理的方式，所以兼容性很好，无论是新老设备系统通吃。如果你的手机安装了 Chrome 浏览器，那么可以通过 USB 用 Chrome DevTools 调试，但是国内的手机用的浏览器在 Chrome DevTools 上无法识别，所以可以用过 <code>Weinre</code> 调试。详细可参考 <a href="https://aotu.io/notes/2017/02/24/Mobile-debug/" target="_blank" rel="noopener">这儿</a>，利用此工具可以调试这些：<ul><li>dom 元素</li><li>network 监听</li><li>source 打断点</li><li>console 查看日志</li></ul></li><li><code>fiddle</code> 等代理工具，通过 <code>usb</code> 连接。我没成功…<a id="more"></a></li></ul><h2 id="响应式问题"><a href="#响应式问题" class="headerlink" title="响应式问题"></a>响应式问题</h2><p>现代浏览器我们直接使用了 <code>vw</code> ，创建了一个 <code>px</code> 转 <code>vw</code> 的函数，然后在 <code>scss</code> 中使用对应的像素值。<br></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">function</span> px2vw($number) &#123;</span><br><span class="line">    <span class="comment">/* 因为我们的设计稿是320 */</span></span><br><span class="line">    @<span class="keyword">return</span> $number/<span class="number">320</span>*<span class="number">100</span>+vw;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p><em>使用：</em><br></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="built_in">px2vw</span>(30);</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="built_in">px2vw</span>(12);</span><br><span class="line">    <span class="comment">/* 其他属性如margin、padding、line-height这些都可以用vw */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>以下情况需要酌情使用 <code>@media</code>:</p><ul><li>如果需要适配 <code>ipad</code> ，因为这个屏幕比手机大很多，所以最好用 <code>@media</code> 修改下页面布局。不用 <code>@media</code> 直接让等比缩放也勉强可以接受。</li><li>用 <code>css</code> 写了特殊样式，比如说写一个 三个横杠的菜单图标，我们要为每个横杠设置高度，这个值一般比较小，直接上面的 <code>px2vw</code> 函数最后可能生成的是带小数的 <code>px</code>，在手机端你会发现三个横杠不一样高。这时候我们需要用 <code>@media</code> 设置整数的高度</li></ul><h2 id="1px-border-问题"><a href="#1px-border-问题" class="headerlink" title="1px border 问题"></a>1px border 问题</h2><p>利用伪类 和 <code>transform</code> 的 <code>scale</code><br><em>scss mixin:</em><br></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">mixin</span> border1px ($color)&#123;</span><br><span class="line">    <span class="selector-tag">position</span>: <span class="selector-tag">relative</span>;</span><br><span class="line">    border: 1px solid $color;</span><br><span class="line"></span><br><span class="line">    <span class="selector-tag">html</span><span class="selector-class">.pixel-ratio-2</span> &amp; &#123;</span><br><span class="line">        <span class="attribute">border</span>: none;</span><br><span class="line">        &amp;:before &#123;</span><br><span class="line">            <span class="selector-tag">content</span>: "";</span><br><span class="line">            <span class="selector-tag">position</span>: <span class="selector-tag">absolute</span>;</span><br><span class="line">            <span class="selector-tag">top</span>: 0;</span><br><span class="line">            <span class="selector-tag">left</span>: 0;</span><br><span class="line">            <span class="selector-tag">width</span>: 200%;</span><br><span class="line">            <span class="selector-tag">height</span>: 200%;</span><br><span class="line">            <span class="selector-tag">transform</span>: <span class="selector-tag">scale</span>(0<span class="selector-class">.5</span>);</span><br><span class="line">            <span class="selector-tag">box-sizing</span>: <span class="selector-tag">border-box</span>;</span><br><span class="line">            border: 1px solid $color;</span><br><span class="line">            <span class="selector-tag">transform-origin</span>: 0 0;</span><br><span class="line">            <span class="selector-tag">pointer-events</span>: <span class="selector-tag">none</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="selector-tag">html</span><span class="selector-class">.pixel-ratio-3</span> &amp; &#123;</span><br><span class="line">        <span class="attribute">border</span>: none;</span><br><span class="line">        &amp;:before &#123;</span><br><span class="line">            <span class="selector-tag">content</span>: "";</span><br><span class="line">            <span class="selector-tag">position</span>: <span class="selector-tag">absolute</span>;</span><br><span class="line">            <span class="selector-tag">top</span>: 0;</span><br><span class="line">            <span class="selector-tag">left</span>: 0;</span><br><span class="line">            <span class="selector-tag">width</span>: 300%;</span><br><span class="line">            <span class="selector-tag">height</span>: 300%;</span><br><span class="line">            <span class="selector-tag">transform</span>: <span class="selector-tag">scale</span>(0<span class="selector-class">.33</span>);</span><br><span class="line">            <span class="selector-tag">box-sizing</span>: <span class="selector-tag">border-box</span>;</span><br><span class="line">            border: 1px solid $color;</span><br><span class="line">            <span class="selector-tag">transform-origin</span>: 0 0;</span><br><span class="line">            <span class="selector-tag">pointer-events</span>: <span class="selector-tag">none</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p><em>js :</em><br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> dpr = <span class="built_in">Math</span>.floor(<span class="built_in">window</span>.devicePixelRatio || <span class="number">1</span>);</span><br><span class="line"><span class="keyword">if</span> (dpr &gt; <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="built_in">document</span>.documentElement.className = <span class="string">'pixel-ratio-'</span> + dpr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>上面的例子是四个方向都有 <code>border</code> ，若只有一个方向的，比如 <code>border-top</code> ，<em>js</em> 部分不变， <em>scss</em> 部分为 :<br></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">mixin</span> border1px-top ($color)&#123;</span><br><span class="line">    <span class="selector-tag">position</span>: <span class="selector-tag">relative</span>;</span><br><span class="line"></span><br><span class="line">    &amp;<span class="selector-pseudo">:before</span>&#123;</span><br><span class="line">        <span class="attribute">content</span>: <span class="string">''</span>;</span><br><span class="line">        <span class="attribute">position</span>: absolute;</span><br><span class="line">        <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">        <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">        <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">        <span class="attribute">height</span>: <span class="number">1px</span>;</span><br><span class="line">        <span class="attribute">display</span>: block;</span><br><span class="line">        <span class="attribute">background-color</span>: $color;</span><br><span class="line">        <span class="attribute">z-index</span>: <span class="number">1</span>;</span><br><span class="line">        html.pixel-ratio-2 &amp; &#123;</span><br><span class="line">            <span class="selector-tag">transform</span>: <span class="selector-tag">scaleY</span>(0<span class="selector-class">.5</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="selector-tag">html</span><span class="selector-class">.pixel-ratio-3</span> &amp; &#123;</span><br><span class="line">            <span class="attribute">transform</span>: <span class="built_in">scaleY</span>(0.33);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h2 id="最小字体限制"><a href="#最小字体限制" class="headerlink" title="最小字体限制"></a>最小字体限制</h2><p>移动端浏览器没有 pc 浏览器最小字体 <code>12px</code> 的限制，可以直接指定小于 <code>12px</code> 的字体</p><h2 id="图片问题"><a href="#图片问题" class="headerlink" title="图片问题"></a>图片问题</h2><ol><li><p>图片模糊问题：</p><p>有些手机屏幕是高清屏，比如说 <code>iphone</code> 系列，现在它的主流 <code>dpr</code> 是 2 和 3 ，所以如果我们要用图片的话需要使用 2倍图 和 3倍图，不然高清屏下图片会模糊。</p><p>当然用 <code>svg</code> 也是可以的， <code>svg</code> 号称不会失真 , 但我在用 <code>iphoneX</code> 下有个小图标竟然有些模糊，原因不明…很纳闷</p></li><li><p>大图问题：</p><p>设计mm截的图有些 <code>svg</code> 有些大。对于这些 <code>svg</code> ， 设计mm就帮我改成了 <code>jpg</code> 或 <code>png</code>， 图片变小了一些，但还有部分大小还是有些大。</p><p>然后我用了 <a href="https://tinypng.com/" target="_blank" rel="noopener">压缩图片工具</a>，这个工具压缩后的图片不会修改图片的分辨率，所以不会影响图片的清晰度。它的原理是减少了原本图片里使用的颜色数量，肉眼是看不出来区别的。</p></li><li><p><code>Svg</code> 大小问题：</p><p><code>svg</code> 文件中不要设置固定px的 <code>width</code> 与 <code>height</code>（如果设置了， <code>svg</code> 就不会根据 <code>img</code> 标签设置的宽高变化了），可以设值为 100% 。用 <code>viewBox</code> 来描述 <code>svg</code> 的宽高比就行了。</p><p>然后在引用 <code>svg</code> 的 <code>img</code> 标签上设置宽高，或者只设置其中的一个。本来设计mm给我的 <code>svg</code> 有固定的宽高，我手动改成了 100% ，其他手机浏览器下可以自动缩放适应，但在 <code>IOS</code> 下这些改过的没有缩放，最后通过添加下面样式解决：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 父容器</span><br><span class="line"><span class="selector-class">.parent</span> &#123;<span class="attribute">display</span>: flex;&#125;</span><br><span class="line">// svg</span><br><span class="line"><span class="selector-class">.icon</span> &#123;<span class="attribute">flex-shrink</span>: <span class="number">0</span>;&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="个别机型问题"><a href="#个别机型问题" class="headerlink" title="个别机型问题"></a>个别机型问题</h2><ol><li><code>UC</code> 、 <code>QQ</code> 、 <code>360</code> 、 <code>Chrome</code> … 浏览器首屏工具栏问题：</li></ol><p>若需要做首屏占满屏幕：</p><ul><li><p>我用 <code>vh</code> 来实现占满屏幕，底部的工具栏会盖住一部分内容，但如果滚动到最底部，工具栏却不会盖住内容，应该是浏览器对 <code>vh</code> 的支持不太友好。针对首屏被盖住内容的部分，按下面处理：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> browser = navigator.userAgent;</span><br><span class="line"><span class="keyword">if</span> (browser.indexOf(<span class="string">'MQQBrowser'</span>) !== <span class="number">-1</span> || browser.indexOf(<span class="string">'UCBrowser'</span>) !== <span class="number">-1</span> || browser.indexOf(<span class="string">'Chrome'</span>) !== <span class="number">-1</span>) &#123;</span><br><span class="line">    <span class="comment">// 不知道工具栏具体的高度，所以是大概的给需要改变位置的元素加了 50px</span></span><br><span class="line">    <span class="keyword">let</span> downSignEle = <span class="built_in">document</span>.querySelector(<span class="string">'.down-sign'</span>);</span><br><span class="line">    downSignEle.style.bottom = <span class="built_in">parseInt</span>(getComputedStyle(downSignEle)[<span class="string">'bottom'</span>]) + <span class="number">50</span> + <span class="string">'px'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>用 <code>js</code> 计算屏幕可见高度，建议这种方式，各种浏览器下都会统一</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> screenH = <span class="built_in">document</span>.documentElement.clientHeight;</span><br><span class="line"><span class="keyword">let</span> firstPageEle = <span class="built_in">document</span>.querySelector(<span class="string">'.first-page'</span>);</span><br><span class="line">firstPageEle.style.height = screenH + <span class="string">'px'</span>;</span><br></pre></td></tr></table></figure></li></ul><ol><li><p><code>IOS</code> 系统下滚动不流畅，添加下面的样式：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">height</span>: 100%;</span><br><span class="line"><span class="selector-tag">overflow</span>: <span class="selector-tag">scroll</span>;</span><br><span class="line"><span class="selector-tag">-webkit-overflow-scrolling</span>: <span class="selector-tag">touch</span>;</span><br></pre></td></tr></table></figure></li><li><p><code>IOS</code> 点击去除灰色选中效果，添加样式：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">-webkit-tap-highlight-color</span>: <span class="selector-tag">rgba</span>(0,0,0,0);</span><br></pre></td></tr></table></figure></li><li><p><code>UC</code> 下 <code>text-align:center</code> 无效<br>使用的 <code>UIkit</code> 的 <code>banner</code> 中 <code>text-align:center</code> 生效，但自己写的却不生效，对比样式发现没啥区别，没找到原因，最后用了下面的方案实现 <code>center</code> 效果，有哪位大佬知道请留言。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">display</span>: <span class="selector-tag">flex</span>;</span><br><span class="line"><span class="selector-tag">justify-content</span>: <span class="selector-tag">center</span>;</span><br></pre></td></tr></table></figure></li></ol>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[洛阳纸贵]]></title>
      <url>https://jintang.github.io/2018/06/26/%E6%B4%9B%E9%98%B3%E7%BA%B8%E8%B4%B5/</url>
      <content type="html"><![CDATA[<blockquote><p>离开意味着新的开始，感叹下自己这离奇的9天</p></blockquote><h2 id="干货"><a href="#干货" class="headerlink" title="干货"></a>干货</h2><ol><li><p>程序员最好有一台自己的笔记本，这样环境只需要配一次，不用换个公司又重新配一遍环境。我没用过 <code>Mac</code>， 但我感觉 <code>windows</code> 和 <code>linux</code> 双系统也挺棒的</p></li><li><p>我也经历过好几家公司了，每家公司的网都不咋地。除了用本地局域网联调外，我决定其他的连手机热点，网速比这快多了。</p></li><li><p>作为一个中国程序员，每次装环境之后还需要额外设置一些东西：</p><ul><li><code>node</code>、<code>yarn</code>： 装完之后受限于国内的网络，设置镜像。有几个包还需要额外设置镜像仓库，比如大名鼎鼎的 <code>node-sass</code>，参考 <a href="https://gist.github.com/52cik/c1de8926e20971f415dd" target="_blank" rel="noopener">这儿</a>，设置一次 <code>npm</code> 和 <code>yarn</code> 同时生效，设置完之后可以通过 <code>npm config list</code> 和 <code>yarn config list</code> 查看。</li><li><code>git</code>：基本配置查看 <a href="https://jintang.github.io/2016/06/24/git%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/">这儿</a></li><li><p><code>dokcer</code> ： 同样设置镜像</p><ul><li><p><code>linux</code> 中在 <code>/etc/docker/daemon.json</code> 中写入如下内容（如果文件不存在请新建该文件）</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"registry-mirrors"</span>: [</span><br><span class="line">        <span class="string">"https://registry.docker-cn.com"</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>之后重新启动服务。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo systemctl daemon-reload</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo systemctl restart docke</span></span><br></pre></td></tr></table></figure></li><li><p><code>Windows10</code> 在系统右下角托盘 <code>Docker</code> 图标内右键菜单选择 <code>Settings</code> ，打开配置窗口后左侧导航菜单选择 <code>Daemon</code> 。在 <code>Registry mirrors</code> 一栏中填写加速器地址 <code>https://registry.docker-cn.com</code> ，之后点击 <code>Apply</code> 保存后 <code>Docker</code> 就会重启并应用配置的镜像地址了</p></li></ul></li><li><code>vue</code> :<ul><li>安装：<code>npm install -g @vue/cli</code> ， <code>vue-cli</code> 到 3 了，加了可视化配置，更新的好快</li><li>初始化项目模板： <code>vue create 项目名</code></li></ul></li><li><code>react-native</code> :<ul><li>安装： <code>npm install -g react-native-cli</code></li><li>初始化项目模板： <code>react-native init AwesomeProject</code></li></ul></li><li><code>android</code>： 既然要用 <code>react-native</code>， 肯定要配置 <code>android</code> 与 <code>ios</code> 的环境，可惜我没 <code>mac</code><ul><li><code>jdk1.8</code>： <code>Android Studio</code> 必须。 需手动配置环境变量 <code>JAVA_HOME</code> 与 <code>Path</code></li><li><code>Android Studio</code> 、 <code>SDK</code> 、 <code>ANDROID_HOME</code>: 可以帮助我们编译 <code>Android</code> 原生相关，用里面的 <code>SDK Manager</code>安装相关 <code>sdk</code>，配置环境变量 <code>ANDROID_HOME</code></li><li>手机模拟器： <code>windows</code> 下如果你装了 <code>docker</code> 就不能用 <code>genymotion</code> 了，原因看后面。 选择 <code>Visual Studio Emulator for Android</code></li></ul></li><li>自动化工具： 这只是个工具，不应该将很多精力放在这上面<ul><li><code>grunt</code>: 已经很少用了，需全局安装： <code>npm install -g grunt-cli</code></li><li><code>gulp</code>: 有些还在用，也需全局安装： <code>npm install gulp-cli -g</code></li><li><code>webpack</code>: 很流行。 可以全局安装，也可以只在项目中安装</li></ul></li></ul></li><li>常用 <code>IDE</code> 的设置存到云盘：我常用的 <code>vscode</code> 、 <code>webstorm</code> （jetbrain 家 IDE 的配置可以通用）<a id="more"></a></li></ol><h2 id="经历"><a href="#经历" class="headerlink" title="经历"></a>经历</h2><p>记录经历主要是为了吐槽， 但还有一个方面非常重要。每次配环境都是匆匆的配，想起一点配一点，很糟。</p><ol><li><p>拿到新的电脑，查看代码规范文档，看着同事的 <code>mac</code> 们羡慕不已，对有规范文档暗暗点头，是家有范的公司。</p></li><li><p>后端是 <code>php</code> ，关系不大。为毛我也要装 <code>php</code> 跟 <code>php</code> 框架 <code>laravel</code>，什么，前后端没分离…我擦。本地装完 <code>laravel</code> 后才发现大家都用的 <code>docker</code> 保持环境的一致，我记得之前学这个的时候记得 <code>windows</code> 下只有 <code>win10</code> 可以安装 <code>docker</code>，在建议下装 <code>ubuntu</code></p></li><li><p>装双系统需要给 <code>linux</code> 系统压缩出一块硬盘，怕不够特意比网上的多分配了差不多一倍。 <code>ubuntu18.04</code> 装好了，我的台式机用的无线网卡，苦逼的发现连不上网，好不容易下了网卡驱动，又没有 <code>gcc</code> 的编译环境，无法 <code>make</code> ， 好蛋疼，最后找了根网线，醉了醉了。 装了一大堆的其他环境：<code>git</code> 、 <code>node</code> 、 <code>yarn</code> 、<code>php</code> … <code>docker</code> 怎么也下不到最新版的，在 <code>docker</code> 官方仓库 <a href="https://download.docker.com/linux/ubuntu" target="_blank" rel="noopener">https://download.docker.com/linux/ubuntu</a> 里也找不到，怪不得安装不上最新的。然后我在 6.24 日（过了一个礼拜）的时候重新打开看了下，神奇的有了 <img src="https://tang-blog-1257996120.cos-website.ap-chengdu.myqcloud.com/docker-address.png" alt="docker-address">。我很无语…</p></li><li><p>项目里的 <code>docker</code> ，我们的项目里配置了很多容器，需要搭配好，项目我不熟，最后是后台的同事帮助搞定了 <code>docker</code> 环境，自己一脸懵逼。</p></li><li><p>又是一个项目， <code>docker</code> 的配置还是后台同事帮忙配的，这次大概明白了点，主要修改 <code>haproxy</code> 配置、 <code>nginx</code> 配置、<code>docker-compose.yml</code>, 进入 <code>nginx-php-fpm</code> 容器安装 <code>php</code> 依赖—— <code>composer install</code>，本地项目安装前端依赖—— <code>yarn install</code>，因为项目用了 <code>laravel</code> 框架， 所以还要配 <code>.env</code> 文件， 用 <code>php atisan keg:generate</code> 生成 <strong>APP-key</strong> ，其他配置按需求。修改 <code>host</code> ， 因为 <code>nginx</code> 中配的是自定义域名，自定义域名指向 127.0.0.1 ，用的是 <code>SwitchHosts</code> 这个工具，这个是跨平台的，比较好用。 还要给 <code>Storage</code> 文件夹下赋权限 777，不太懂…开始修改 bug</p></li><li><p>其他的 bug 修改完了，还有 360 浏览器的兼容性 bug 。一脸苦笑，我一个 <code>ubuntu</code> 哪来的 360 。好吧，装虚拟机吧，装个 win10 的虚拟机，幸好有之前使用这台电脑的哥们留着的 iso 镜像，我不用等很久很久，网速好慢。装好了，网络设为 <strong>桥接</strong> ，可以访问宿主机调试了。在装一些方便的软件： 谷歌浏览器、 <code>shadows-qt5</code> 搭配谷歌插件 <code>SwitchyOmega</code> 来浏览器翻墙（终端翻墙需要另外的配置）、 <code>webStorm</code> 、 <code>vscode</code> 、搜狐输入法、 <code>wine-qq</code> 、 <code>wine-钉钉</code> 、微信、 <code>gnome-tweak-tool</code> （优化主题等，优化后的系统真好看）… <code>vscode</code> 这种软件配置成自己的习惯好麻烦，所以我找了以前的同事帮我备份了下我以前的配置，然后导入，再然后保存到百度云盘里， <code>webstorm</code> 同样处理。话说回来，整个 <code>ubuntu</code> 的配置能不能云备份，下次我装的时候一键解决…</p></li><li><p>360 兼容模式下使用的是 <strong>IE</strong> 内核，绝大多数的兼容性 bug 都是因为在 <code>blade.php</code> 文件里用了 <code>es6</code> 的语法。 为啥用不了呢，下面是回答的原文, 再附上 <a href="https://laracasts.com/discuss/channels/elixir/babel-es6-in-blade-template" target="_blank" rel="noopener">链接</a>，我还是不太明白深层的含义</p><blockquote><p>The only reason you should have javascript in a blade template is because you’re passing variables from PHP.There’s no way that can be compiled anywhere other than at run time.</p></blockquote></li><li><p>得知消息说要开始做 app 了，选用 <code>react-native</code> ， 嗯…那我先装环境， <code>java</code> 环境没装完就报我 <code>/home</code> 卷满了，用磁盘分析工具发现那个虚拟机就占了 18G ，我整个 <code>/home</code> 卷才配了 20G …好吧，找篇教程开始扩容。马有失蹄啊，扩容后重启，整个系统崩了…我好崩溃，我装 <code>ubuntu</code> 的 U盘带回家了，不然我就重装 <code>ubuntu了</code>。也许是天意，接了一圈借到了 <code>win10</code> 的安装盘，好吧，听同事说他用的 <code>win10</code>， 可以装 <code>docker</code> ，我也不想再折腾了。那就 <code>win10</code> 吧，借到的这个是 <strong>家庭版</strong> ， 装不了 <code>docker</code> ， 虽然明天是周六，看来得自己来加班了…这几天装环境装的人身心俱疲，查到的资料一大堆乱乱的充斥在脑子里，所以我做了一件好事，把 <strong>魂斗罗</strong> 手游给戒了，垃圾游戏，天天各种任务，毁我视力，浪费时间，浪费生命。</p></li><li><p>带着家里网速杠杠制作的 <code>win10企业版</code> 安装盘来装系统，以防万一我还带了 <code>ubuntu18.04</code> 的安装盘 。为毛这么热啊，空调是摆设吗，根本就调不了那个温度嘛，感觉一直在被蒸着，后面才知道周末大楼为了节约是关了中央空调的。一上午就装好了，开始装 <code>docker</code>。通过 <code>bios</code> 设置 <code>Intel Virtual technology: enable</code>， 这样系统就开启了 <code>Hyper-V</code> ，这是个 <code>win10</code> 自带的虚拟机， <code>docker</code> 需要这个才可以安装。发现还是装不了，需要升级 <code>windows</code> 版本， 至少要到 <code>14393</code> 版本。通过 <strong>运行</strong> —— <code>winver</code> 查看自己的版本号，果然不够。好吧，来个在线升级吧，真的不想再装系统了。下载 <strong>易升</strong> 开始在线升级，这时刚到中午，速度好像不给力啊，如果速度稳定的话，这 100% 得到下午 4 点了。 在等待的过程中在 <code>windows</code> 上用 <code>Hyper-V</code> 装了 <code>ubuntu</code> 的虚拟机，再选择版本的时候想起来上次没找到 <code>ubuntu18.04</code> 对应的 <code>docker</code> 新版本，这次在 <code>docker</code> 仓库上重新查看，发现 <code>17.10</code> 有，鬼使神差的又去看了 <code>18.04</code>，竟然也有，这就是我之前写到为啥会重新查看的原因，使用感觉很不好…主要是反应慢一拍。被蒸了一下午，到了 5 点，终于 100% 了，竟然又来了个进度条… 这个速度稍微快点，我想今天怎么着也得弄完吧，一直到了 7 点，才到 80% ，中间我意识到可能是因为我没有全局代理翻墙，但是不敢切，怕整个连接都断了。天啊，晚上还有人约饭呢，算了，我明天再来吧…草。 值得安慰的是朋友做了一大堆好吃的，喝果啤看球赛，在他的怂恿下压了 100元 的德国，如果这把德国输了德国就小组淘汰了，很有道理。</p></li><li><p>昨天蒸了一天，早上醒来感觉自己感冒了，发现德国赢了，来公司发现升级好了，鉴于公司这么垃圾的网速，我决定跟宽带办一个绑定的无线流量卡，以后开热点，自力更生。整个人软软的，接着装好了 <code>docker</code> ，好像没问题，具体得，明天周一配置项目了验证下，自己对整个配置过程还不是很明白。</p></li><li><p>经过同事的帮助，项目成功跑起来了，看来我以后还是用 <code>windows</code> 吧， <code>qq</code> 这些东西起码方便。再重新装 <code>git</code> 、 <code>node</code> 、 <code>yarn</code> 、<code>php</code> … <code>php</code> 环境好麻烦，最后用了 <code>phpStudy</code> 的集成环境，再从 <code>composer</code> 官网下载 <code>composer</code> 安装包，会自动配置好环境变量。</p></li><li><p>因为要运行 <code>react-native</code> ，所以需要手机模拟器，之前一直用的 <code>genymotion</code> 启动不起来…原来是 <code>virtual box</code> 跟 <code>Hyper-V</code> 冲突了。最后安装了 <code>Visual Studio Emulator for Android</code>，不需要装 <code>VS</code>这个模拟器也是用的 <code>Hyper-V</code> 虚拟机。但是无法同时启动 <code>Android模拟器</code> 和 <code>docker</code> ， 原因是我的内存不够…</p></li></ol><p>我的折腾环境总算告一段落了，感冒让我欲仙欲死…这样的过程我再也不想来第二遍了，如果还要我重装的话，我选择自己买台电脑，以后在公司用自己的电脑。最后在上面列一下自己苦逼的经验。</p>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[面试遇到的]]></title>
      <url>https://jintang.github.io/2018/05/29/%E9%9D%A2%E8%AF%95%E9%81%87%E5%88%B0%E7%9A%84/</url>
      <content type="html"><![CDATA[<blockquote><p>一有离意便按耐不住自己，面试了一周半便确定了自己即将去的地方，不知道是不是太快了点…前后林林总总面了10家过一点，有5家给了我offer，有些问题没回答上来但还是通过了，还有些就没通过，再次根据回忆主要记录下, 问的太多了，所以下面的问题都是印象比较深刻的，印象深刻嘛，要嘛是不会的，要嘛是问了次数比较多的。对了，我是一个前端，主要的问题也都是针对前端，因为一直在做 <code>vue</code> 项目，所以很多问题也都跟 <code>vue</code> 相关</p><p>一位腾讯大佬有这样的面试技巧（或者说招聘技巧）：看候选人 <code>github</code> 有个技巧，看他 <strong>activity</strong> 里 <strong>issue</strong> 区讨论、给知名开源项目的 <strong>PR、merged PR</strong> 数量和质量</p></blockquote><h3 id="被问到两次以上的"><a href="#被问到两次以上的" class="headerlink" title="被问到两次以上的"></a>被问到两次以上的</h3><h4 id="前端优化方案"><a href="#前端优化方案" class="headerlink" title="前端优化方案"></a>前端优化方案</h4><p>涉及太多请自行谷歌</p><h4 id="webpack相关"><a href="#webpack相关" class="headerlink" title="webpack相关"></a>webpack相关</h4><p>当你讲述你的项目经验的时候，当面试官听到你在用 <code>vue</code> 全家桶的时候，所有相关的问题都会问题， 其他的我都能说个123来，但 <code>webpack</code> 却没咋用，项目中都是别人构建的…也为后面的 <code>thoughtwork</code> 一道开放性作品题失败埋下了伏笔。面试官听到我不会也就没再问了，现在开始补 <code>webpack</code> 的知识</p><h4 id="es6相关"><a href="#es6相关" class="headerlink" title="es6相关"></a>es6相关</h4><p>你用了哪些 <code>es6</code> 的东西，都是啥，其中 <strong>箭头函数</strong> 与普通函数的区别最常被问</p><h4 id="原型链相关：如何实现原型链继承，原型与构造函数的关系，new-对象的时候发生的过程"><a href="#原型链相关：如何实现原型链继承，原型与构造函数的关系，new-对象的时候发生的过程" class="headerlink" title="原型链相关：如何实现原型链继承，原型与构造函数的关系，new 对象的时候发生的过程"></a>原型链相关：如何实现原型链继承，原型与构造函数的关系，<code>new</code> 对象的时候发生的过程</h4><p>下面这张图可以清晰明白的帮助我们理解，如果还想深入理解，参考 <a href="https://github.com/mqyqingfeng/Blog/issues/2" target="_blank" rel="noopener">这儿1</a> 和 <a href="https://www.digitalocean.com/community/tutorials/understanding-classes-in-javascript" target="_blank" rel="noopener">这儿2</a><br><img src="https://tang-blog-1257996120.cos-website.ap-chengdu.myqcloud.com/prototype-series.png" alt="原型链"><br><a id="more"></a><br>下面附上 <code>es5</code> 和 <code>es6</code> 实现继承的方式：<br><code>es5</code>:<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Hero</span>(<span class="params">name, level</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">    <span class="keyword">this</span>.level = level;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Adding a method to the constructor</span></span><br><span class="line">Hero.prototype.greet = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;<span class="keyword">this</span>.name&#125;</span> says hello.`</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Creating a new constructor from the parent</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Mage</span>(<span class="params">name, level, spell</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Chain constructor with call</span></span><br><span class="line">    Hero.call(<span class="keyword">this</span>, name, level);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.spell = spell;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> hero1 = <span class="keyword">new</span> Mage(<span class="string">'Lejon'</span>, <span class="number">2</span>, <span class="string">'Magic Missile'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(hero1)</span><br></pre></td></tr></table></figure><p></p><p><code>es6</code>:<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Initializing a class</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Hero</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(name, level) &#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.level = level;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Adding a method to the constructor</span></span><br><span class="line">    greet() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;<span class="keyword">this</span>.name&#125;</span> says hello.`</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Creating a new class from the parent</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mage</span> <span class="keyword">extends</span> <span class="title">Hero</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(name, level, spell) &#123;</span><br><span class="line">        <span class="comment">// Chain constructor with super</span></span><br><span class="line">        <span class="keyword">super</span>(name, level);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Add a new property</span></span><br><span class="line">        <span class="keyword">this</span>.spell = spell;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> hero2 = <span class="keyword">new</span> Mage(<span class="string">'Lejon'</span>, <span class="number">2</span>, <span class="string">'Magic Missile'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(hero2)</span><br></pre></td></tr></table></figure><p></p><p><em>结果</em>：<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// hero1</span></span><br><span class="line">Mage &#123;<span class="attr">name</span>: <span class="string">"Lejon"</span>, <span class="attr">level</span>: <span class="number">2</span>, <span class="attr">spell</span>: <span class="string">"Magic Missile"</span>&#125;</span><br><span class="line">__proto__:</span><br><span class="line">    ▶ <span class="keyword">constructor</span>: ƒ Mage(name, level, spell)</span><br></pre></td></tr></table></figure><p></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// hero2</span></span><br><span class="line">Mage &#123;<span class="attr">name</span>: <span class="string">"Lejon"</span>, <span class="attr">level</span>: <span class="number">2</span>, <span class="attr">spell</span>: <span class="string">"Magic Missile"</span>&#125;</span><br><span class="line">__proto__: Hero</span><br><span class="line">    ▶ <span class="keyword">constructor</span>: class Mage</span><br></pre></td></tr></table></figure><h4 id="apply-与-call-的区别"><a href="#apply-与-call-的区别" class="headerlink" title="apply 与 call 的区别"></a>apply 与 call 的区别</h4><p>都是为了改变调用函数的上下文，唯一的区别就是传参格式的区别，<code>call</code> 接受多个参数， <code>apply</code> 接受数组参数，如下：<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fun().call(thisObj, arg1, arg2 ...)</span><br><span class="line">fun().apply(thisObj, [arg1, arg2 ...])</span><br></pre></td></tr></table></figure><p></p><h4 id="vue-的生命周期"><a href="#vue-的生命周期" class="headerlink" title="vue 的生命周期"></a>vue 的生命周期</h4><p>请参照 <a href="https://cn.vuejs.org/v2/guide/instance.html#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%9B%BE%E7%A4%BA" target="_blank" rel="noopener">vue官网</a></p><h4 id="vue-父子、兄弟组件间传递消息"><a href="#vue-父子、兄弟组件间传递消息" class="headerlink" title="vue 父子、兄弟组件间传递消息"></a>vue 父子、兄弟组件间传递消息</h4><p>父子： <code>$emit</code>, <code>props</code><br>兄弟： <code>eventBus</code>, <code>vuex</code></p><h4 id="cookie、localStorage、sessionStorage的区别"><a href="#cookie、localStorage、sessionStorage的区别" class="headerlink" title="cookie、localStorage、sessionStorage的区别"></a>cookie、localStorage、sessionStorage的区别</h4><p>可以参考我的这篇 <a href="http://jintang.github.io/2016/10/08/H5%E4%B8%ADlocalStorage%E4%B8%8EsessionStorage%E7%9A%84%E5%8C%BA%E5%88%AB/">文章</a></p><h4 id="登陆超时如何处理"><a href="#登陆超时如何处理" class="headerlink" title="登陆超时如何处理"></a>登陆超时如何处理</h4><p>客户端 <code>cookie</code> 存 <code>sessionId</code>，<code>ajax</code> 请求携带 <code>cookie</code>，后端判断对应 <code>sessionId</code> 对应的客户，后端存的 <code>session</code> 如果超时了就给接口返回超时的标志位，前端根据该标志跳转到登录页并清空 <code>cookie</code>。<br>其他的方法还有使用 <code>token</code> ,具体可以参照 <a href="http://www.cnblogs.com/xiekeli/p/5607107.html" target="_blank" rel="noopener">这儿</a></p><h4 id="如何适配不同大小的显示屏"><a href="#如何适配不同大小的显示屏" class="headerlink" title="如何适配不同大小的显示屏"></a>如何适配不同大小的显示屏</h4><p>我回答了 响应式布局、 rem 、 flex，自己对这个并不深入</p><h3 id="只被问了一次的"><a href="#只被问了一次的" class="headerlink" title="只被问了一次的"></a>只被问了一次的</h3><h4 id="vuex-一般什么时候使用"><a href="#vuex-一般什么时候使用" class="headerlink" title="vuex 一般什么时候使用"></a>vuex 一般什么时候使用</h4><p>为了存储一些公用的数据，比如有一个功能需要好几步，你还可以返回上一步，这时候就要用了。</p><h4 id="项目中使用了-keep-alive，如何让返回列表页的时候重新刷新数据"><a href="#项目中使用了-keep-alive，如何让返回列表页的时候重新刷新数据" class="headerlink" title="项目中使用了 keep-alive，如何让返回列表页的时候重新刷新数据"></a>项目中使用了 keep-alive，如何让返回列表页的时候重新刷新数据</h4><p>我们的项目中并没有使用 <code>keep-alive</code> ，但我知道使用了之后组件的 <strong>生命周期方法</strong> 是不触发的，于是询问面试官（这个面试官非常和善） <code>route</code> 的钩子触发吗？<br>面试官给了肯定的答复后作了下面的回答：</p><blockquote><p>可以利用 <code>route</code> 的导航钩子： <code>beforeRouteEnter</code>，在这里处理刷新事项</p></blockquote><p>面试官点了点头。后面经过查证，这个钩子确实是触发的，同时还有我从没注意到的 <strong>生命周期方法</strong> 也会被触发: <code>activated</code> 与 <code>deactivated</code>，这是 <code>vue</code> 专门为了 <code>keep-alive</code> 创建的钩子</p><h4 id="跨域如何处理"><a href="#跨域如何处理" class="headerlink" title="跨域如何处理"></a>跨域如何处理</h4><p>有 <code>jsonp</code>、<code>cors</code>、<code>nginx</code>反向代理等方法，项目上线肯定不能用 <code>nginx</code>反向代理，<code>jsonp</code>我还从没用过，我知道局限性很大， <code>cors</code> 设置的 <code>allow-origin:　*</code> 又不安全。而在 <code>vue</code> 项目的开发中，使用的是 <code>webpack</code> 的 <code>proxy</code></p><h4 id="什么是重绘和回流"><a href="#什么是重绘和回流" class="headerlink" title="什么是重绘和回流"></a>什么是重绘和回流</h4><p>请参考 <a href="http://www.css88.com/archives/4996" target="_blank" rel="noopener">这儿</a></p><h4 id="深拷贝一个function"><a href="#深拷贝一个function" class="headerlink" title="深拷贝一个function"></a>深拷贝一个function</h4><p>请参考 <a href="http://jintang.github.io/2017/05/17/vue%E4%B8%AD%E9%81%87%E5%88%B0%E7%9A%84%E5%9D%91/">这篇文章</a> 里关于 <code>深拷贝</code> 的描述</p><h4 id="浏览器渲染html的详细过程"><a href="#浏览器渲染html的详细过程" class="headerlink" title="浏览器渲染html的详细过程"></a>浏览器渲染html的详细过程</h4><p>回头翻答案，发现自己也了解过这个…但是被问到的时候，一点印象都没，只记得是先渲染 <code>dom</code> 树 ，再渲染具体的。具体的渲染过程请参照 <a href="https://juejin.im/entry/59e1d31f51882578c3411c77" target="_blank" rel="noopener">这儿</a></p><h4 id="数组相关"><a href="#数组相关" class="headerlink" title="数组相关"></a>数组相关</h4><p><strong>排序算法：</strong> 可能是我记性太差，我总感觉不常用的东西很容易忘。排序算法我也模拟实现了插值排序，其他算法也都看过好几遍，结果…写纸上，也没法验证，根据面试官的表情好像写错了。<br><strong>数组去重：</strong> 人家要求说出两种，第一种可以用 <code>[...new Set(arr)]</code>， 第二种自己实现…唉，问我的时候我比较慌，说了个双层遍历的方法，下面提供一个单层遍历的：<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">distinct</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> obj = &#123;&#125;;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(arr) &amp;&amp; arr.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, len = arr.length; i &lt; len; i += <span class="number">1</span>) &#123;</span><br><span class="line">            obj[arr[i]] = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Object</span>.keys(obj);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> [];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h4 id="require导入和import导入有啥区别"><a href="#require导入和import导入有啥区别" class="headerlink" title="require导入和import导入有啥区别"></a>require导入和import导入有啥区别</h4><p>刚开始接触 <code>es6</code> 的时候还看过这个，时间久了又忘记了…<br><code>CommonJS</code> 是 <code>node</code> 的规范，它是用 <code>require</code>。而 <code>es6</code> 是用 <code>import</code>,下面是他们的区别：</p><ul><li><code>CommonJS</code> 模块输出的是一个值的拷贝，<code>ES6</code> 模块输出的是值的引用。</li><li><code>CommonJS</code> 模块是运行时加载，<code>ES6</code> 模块是编译时输出接口。</li></ul><p>第二个差异是因为 <code>CommonJS</code> 加载的是一个对象（即 <code>module.exports</code> 属性），该对象只有在脚本运行完才会生成。而 <code>ES6</code> 模块不是对象，它的对外接口只是一种静态定义，在代码静态解析阶段就会生成。显然 编译期 早于 运行期。</p><p>更多了解请查看阮大神的 <a href="http://es6.ruanyifeng.com/#docs/module-loader#ES6-%E6%A8%A1%E5%9D%97%E4%B8%8E-CommonJS-%E6%A8%A1%E5%9D%97%E7%9A%84%E5%B7%AE%E5%BC%82" target="_blank" rel="noopener">ECMAScript 6 入门</a></p><p><em>注意：</em> 你可以在同一个文件中同时使用 <code>require</code> 和 <code>export</code>. 但不能同时使用 <code>import</code> 和 <code>module.exports</code>. 不然会报错——<code>Cannot assign to read only property &#39;exports&#39; of object &#39;#&lt;Object&gt;&#39;</code></p><h4 id="请列举下js的数据类型"><a href="#请列举下js的数据类型" class="headerlink" title="请列举下js的数据类型"></a>请列举下js的数据类型</h4><p>一共7种，<code>es6</code>中新增加了一个数据类型 <code>Symbol</code>。其中 <strong>引用类型</strong> 只有一种，就是 <code>Object</code>，<code>Array</code> 与 <code>Function</code> 都不算，具体请看 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Grammar_and_types" target="_blank" rel="noopener">这儿</a></p><h4 id="移动端点击事件-300ms-延迟处理"><a href="#移动端点击事件-300ms-延迟处理" class="headerlink" title="移动端点击事件 300ms 延迟处理"></a>移动端点击事件 300ms 延迟处理</h4><p>我回答的是可以用 <code>tap</code> 代替 <code>click</code>，我只记得 <code>angular</code> 还是 <code>ionic</code> 里有这么个方法，官方推荐使用这个…这明显不是面试官想要的答案<br>后面查了一下：<br><em>原因：</em> 等待 <code>300ms</code> 看用户是点击还是双击缩放<br><em>解决办法：</em></p><ul><li>禁止缩放 <code>&lt;meta name=&quot;viewport&quot; content=&quot;user-scalable=no&quot;&gt;</code> ，这样的话双指缩放也被禁了，不推荐</li><li>设置默认视口宽度为设备宽度: <code>&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;&gt;</code> ，加了这个之后浏览器认为该网站已经对移动端做过了适配和优化，就无需双击缩放操作了</li><li>设置 <code>css</code> : <code>touch-action:none;</code> 或 <code>touch-action:manipulation;</code> ，属性说明看 <a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/touch-action" target="_blank" rel="noopener">这儿</a></li><li><a href="https://github.com/ftlabs/fastclick" target="_blank" rel="noopener">fastclick.js</a></li></ul><h4 id="移动端-1px-边框问题"><a href="#移动端-1px-边框问题" class="headerlink" title="移动端 1px 边框问题"></a>移动端 1px 边框问题</h4><p>多种方案：<a href="http://www.programmersought.com/article/2597819400/" target="_blank" rel="noopener">1px border 的6种方法</a></p><p>最佳方案： 利用伪类</p><p><strong>1. 定义border时使用下面的类：</strong><br></p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.bd</span> &#123;</span><br><span class="line">    <span class="attribute">border-style</span>: solid;</span><br><span class="line">    <span class="attribute">border-color</span>: <span class="number">#ccc</span>;</span><br><span class="line">    &amp;<span class="selector-class">.bd-l</span> &#123;</span><br><span class="line">        <span class="attribute">border-left-width</span>: <span class="number">1px</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    &amp;<span class="selector-class">.bd-r</span> &#123;</span><br><span class="line">        <span class="attribute">border-right-width</span>: <span class="number">1px</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    &amp;<span class="selector-class">.bd-t</span> &#123;</span><br><span class="line">        <span class="attribute">border-top-width</span>: <span class="number">1px</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    &amp;<span class="selector-class">.bd-b</span> &#123;</span><br><span class="line">        <span class="attribute">border-bottom-width</span>: <span class="number">1px</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    &amp;<span class="selector-class">.bd-all</span> &#123;</span><br><span class="line">        <span class="attribute">border-width</span>: <span class="number">1px</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p><strong>2. 利用js添加缩放类 scale-bd</strong><br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="built_in">window</span>.devicePixelRatio &amp;&amp; devicePixelRatio &gt;= <span class="number">2</span>)&#123;</span><br><span class="line">  <span class="built_in">document</span>.documentElement.className = <span class="string">`scale-bd scale-<span class="subst">$&#123;<span class="built_in">window</span>.devicePixelRatio&#125;</span>`</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p><strong>3. 定义高清屏下的border：</strong><br></p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.scale-bd</span> &#123;</span><br><span class="line">    <span class="selector-class">.bd</span> &#123;</span><br><span class="line">        <span class="attribute">position</span>: relative;</span><br><span class="line">        <span class="attribute">border</span>: none <span class="meta">!important</span>;</span><br><span class="line">        &amp;::before &#123;</span><br><span class="line">            <span class="attribute">content</span>: <span class="string">''</span>;</span><br><span class="line">            <span class="attribute">position</span>: absolute;</span><br><span class="line">            <span class="attribute">border-color</span>: <span class="number">#ccc</span>;</span><br><span class="line">            <span class="attribute">border-style</span>: solid;</span><br><span class="line">            <span class="attribute">transform-origin</span>: <span class="number">0</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        &amp;<span class="selector-class">.bd-l</span>::before &#123;</span><br><span class="line">            <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">            <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">            <span class="attribute">border-left-width</span>: <span class="number">1px</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        &amp;<span class="selector-class">.bd-r</span>::before &#123;</span><br><span class="line">            <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">            <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">            <span class="attribute">border-right-width</span>: <span class="number">1px</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        &amp;<span class="selector-class">.bd-t</span>::before &#123;</span><br><span class="line">            <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">            <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">            <span class="attribute">border-top-width</span>: <span class="number">1px</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        &amp;<span class="selector-class">.bd-b</span>::before &#123;</span><br><span class="line">            <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">            <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">            <span class="attribute">border-bottom-width</span>: <span class="number">1px</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        &amp;<span class="selector-class">.bd-all</span>::before &#123;</span><br><span class="line">            <span class="attribute">border-width</span>: <span class="number">1px</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 对于 devicePixelRatio 为 2 的屏幕</span></span><br><span class="line"><span class="selector-class">.scale-2</span> &#123;</span><br><span class="line">    <span class="selector-class">.bd</span> &#123;</span><br><span class="line">        &amp;::before &#123;</span><br><span class="line">            <span class="attribute">width</span>: <span class="number">200%</span>;</span><br><span class="line">            <span class="attribute">height</span>: <span class="number">200%</span>;</span><br><span class="line">            <span class="attribute">transform</span>: scale(<span class="number">0.5</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 对于 devicePixelRatio 为 2 的屏幕</span></span><br><span class="line"><span class="selector-class">.scale-3</span> &#123;</span><br><span class="line">    <span class="selector-class">.bd</span> &#123;</span><br><span class="line">        &amp;::before &#123;</span><br><span class="line">            <span class="attribute">width</span>: <span class="number">300%</span>;</span><br><span class="line">            <span class="attribute">height</span>: <span class="number">300%</span>;</span><br><span class="line">            <span class="attribute">transform</span>: scale(<span class="number">0.33</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h4 id="sql相关"><a href="#sql相关" class="headerlink" title="sql相关"></a>sql相关</h4><p>有面试官问了些简单的 <code>sql</code> ，因为我说我不熟，所以问的都很简单，而且我面的是前端岗…涉及太多请自行谷歌</p><h4 id="vuex原理"><a href="#vuex原理" class="headerlink" title="vuex原理"></a>vuex原理</h4><p>很抱歉我没了解这个，源码也没看过…请自行谷歌</p><h3 id="机试题和开放性题目"><a href="#机试题和开放性题目" class="headerlink" title="机试题和开放性题目"></a>机试题和开放性题目</h3><p>我们常碰到的是笔试然后面试，偶尔也会碰到机试题，我这次就碰到了。还碰到了两家比较牛的公司，是让我先做开放性的题目，然后将东西发给人家，人家审核通过了再给你发面试邀请。</p><ul><li>机试的公司要求是用框架搭建一个小页面，挺简单的。</li><li>一家公司的题库里我选做的是 <strong>杨辉三角</strong>， 虽然结果正确，但人家邮件回复说没通过，不知道为什么，问原因也没回我。</li><li>另一家就是 <code>thoughtwork</code> ，大概的题目是要 自己搭建脚手架工具，我选择了 <code>webpack</code>，再用原生 <code>js</code> 实现一个小的管理系统，不涉及数据库，附带的功能有 响应式布局、单元测试… 很繁杂，虽然花了很久，但没做出来…这就是经常用框架的坏处吧，发现自己短板还挺多的…得补充下了</li></ul><h3 id="非技术性问题"><a href="#非技术性问题" class="headerlink" title="非技术性问题"></a>非技术性问题</h3><h4 id="为什么离职"><a href="#为什么离职" class="headerlink" title="为什么离职"></a>为什么离职</h4><p>我说的是为了多见识多学习，^_^</p><h4 id="最近解决的最难的问题是什么"><a href="#最近解决的最难的问题是什么" class="headerlink" title="最近解决的最难的问题是什么"></a>最近解决的最难的问题是什么</h4><p>…因人而异</p><h4 id="你做的哪件事表现出你有出色的学习能力"><a href="#你做的哪件事表现出你有出色的学习能力" class="headerlink" title="你做的哪件事表现出你有出色的学习能力"></a>你做的哪件事表现出你有出色的学习能力</h4><p>…同上</p><h4 id="以后的发展规划"><a href="#以后的发展规划" class="headerlink" title="以后的发展规划"></a>以后的发展规划</h4><p>这个我也比较迷茫，我觉得前端有些浅，希望能接触到其他的技术。再就是走一步看一步了</p><h3 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h3><p>还有很多问题都忘记了，想到了会再加上去。想要抱怨的是一些大公司审核太慢了…等你们的时间我已经找到了。上面的题有些是不是很难，哈哈，其中难得题目大多数都是由3个人问出来的： 一个架构师、 一个大公司的大佬、一家使用 <code>jquery</code>的技术leader（他们还没有拥抱 <code>es6</code> ，所以对 <code>es5</code> 里的一些比较麻烦的问题问的比较多），一般的问题都是比较简单的。和行业内的大佬交流挺有意思的，大多数面试官都感觉人很好。</p>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[vue我们应该知道的]]></title>
      <url>https://jintang.github.io/2018/05/11/vue%E6%88%91%E4%BB%AC%E5%BA%94%E8%AF%A5%E7%9F%A5%E9%81%93%E7%9A%84/</url>
      <content type="html"><![CDATA[<h3 id="route开启h5模式"><a href="#route开启h5模式" class="headerlink" title="route开启h5模式"></a>route开启h5模式</h3><p>路由里面加一个 <code>mode: &#39;history&#39;</code><br><strong>作用:</strong> 实现页面后退时，还原滚动位置</p><h3 id="vuex模块话"><a href="#vuex模块话" class="headerlink" title="vuex模块话"></a>vuex模块话</h3><p><em>默认：</em> 内部的 <code>action</code> 、 <code>mutation</code> 和 <code>getter</code> 是注册在全局命名空间的。不包括 <code>state</code></p><p>所以，当 <code>commit</code> 一个子模块的 <code>mutation</code> 时，若还有其他子模块有相同的 <code>mutation</code> 时,<br>这两者都会触发。<strong>bug:</strong> 再次发现中，下一步的扫描时间初始化不是0，而是先变成了上一步的扫描时间，然后才变成0。因为点击下一步的时候触发了上一步的同名 <code>mutation</code></p><p><strong>解决方案：</strong> 给子模块添加 <code>namespaced: true</code> 让子模块成为命名空间模块，这样可以封装单独作用域</p><p>此时要 <code>commit</code> 一个子模块的 <code>mutation</code> 时，就需要<code>this.$store.commit(&#39;子模块名/事件名&#39;)</code></p><p><strong>tip:</strong> 不论是不是命名空间模块， <code>state</code> 的获取都是这样的： <code>this.$store.state.子模块名.变量名</code><br>或者利用 <code>mapState</code> :<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">...mapState(<span class="string">'子模块名'</span>, [</span><br><span class="line">    <span class="string">'变量名'</span></span><br><span class="line">])</span><br></pre></td></tr></table></figure><p></p><a id="more"></a><h3 id="引用类型的复制可以用-lodash"><a href="#引用类型的复制可以用-lodash" class="headerlink" title="引用类型的复制可以用 lodash"></a>引用类型的复制可以用 lodash</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">_.clone(obj)</span><br><span class="line">_.cloneDeep(obj)</span><br></pre></td></tr></table></figure><h3 id="unicode字符串-如-u0000-页面显示乱码"><a href="#unicode字符串-如-u0000-页面显示乱码" class="headerlink" title="unicode字符串(如\u0000)页面显示乱码"></a>unicode字符串(如\u0000)页面显示乱码</h3><p>使用 <code>v-html</code> 代替 <code>{{}}</code> 、<code>v-text</code> ,这样才可以显示不转义的字符串</p><h3 id="使用debounce节流函数"><a href="#使用debounce节流函数" class="headerlink" title="使用debounce节流函数"></a>使用debounce节流函数</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;debounce&#125; <span class="keyword">from</span> <span class="string">'lodash'</span>;</span><br><span class="line"></span><br><span class="line">methods: &#123;</span><br><span class="line">    checkChange: debounce(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// do something</span></span><br><span class="line">    &#125;, <span class="number">500</span>),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="vue-cli分析工具"><a href="#vue-cli分析工具" class="headerlink" title="vue-cli分析工具"></a>vue-cli分析工具</h3><p><code>npm run build --report</code></p><h3 id="vue的循环v-for如何一次循环2条项目？"><a href="#vue的循环v-for如何一次循环2条项目？" class="headerlink" title="vue的循环v-for如何一次循环2条项目？"></a>vue的循环v-for如何一次循环2条项目？</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">v-for</span>=<span class="string">"i in (items.length / 2)"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;&#123;items[(i - 1) * 2].name&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;&#123;items[(i - 1) * 2 + 1].name&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure><p>需要处理奇数问题</p>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[react-native我们应该知道的]]></title>
      <url>https://jintang.github.io/2018/05/11/react-native%E6%88%91%E4%BB%AC%E5%BA%94%E8%AF%A5%E7%9F%A5%E9%81%93%E7%9A%84/</url>
      <content type="html"><![CDATA[<blockquote><p>记录下自己遇到的…</p></blockquote><h3 id="react-native-须知"><a href="#react-native-须知" class="headerlink" title="react-native 须知"></a>react-native 须知</h3><h4 id="React的每个组件里，必须import-React"><a href="#React的每个组件里，必须import-React" class="headerlink" title="React的每个组件里，必须import React"></a><code>React</code>的每个组件里，必须<code>import React</code></h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br></pre></td></tr></table></figure><p>因为组件内部隐式的使用了<code>React</code>，比如<code>jsx</code>语法等</p><h4 id="自定义组件"><a href="#自定义组件" class="headerlink" title="自定义组件"></a>自定义组件</h4><p>分为函数式组件和 class 组件，我们一般使用 class 组件。</p><ul><li><p>函数式组件：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 接受的参数是 props */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Welcome</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello, &#123;props.name&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>class 组件：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Welcome</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello, &#123;this.props.name&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p><strong>注意：</strong> 组件名称必须以大写字母开头。</p><h4 id="组件触发事件"><a href="#组件触发事件" class="headerlink" title="组件触发事件"></a>组件触发事件</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Toggle</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="comment">// 方法1. 在Render中使用bind绑定，此时方法的定义用es5的这种语法</span></span><br><span class="line">        &lt;Text onPress=&#123;<span class="keyword">this</span>.handleClick1.bind(<span class="keyword">this</span>)&#125;&gt;点击&lt;<span class="regexp">/Text&gt;</span></span><br><span class="line"><span class="regexp">        /</span><span class="regexp">/ 方法2. 定义类属性，使用es6的语法定义方法</span></span><br><span class="line"><span class="regexp">        &lt;Text onPress=&#123;this.handleClick2&#125;&gt;点击&lt;/</span>Text&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">  handleClick1() &#123;</span><br><span class="line">    <span class="comment">// do something1</span></span><br><span class="line">  &#125;</span><br><span class="line">  handleClick2 = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// do something2...  </span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>推荐使用方式2，简单明了，且没有副作用。详解请参看 <a href="https://react.docschina.org/docs/faq-functions.html" target="_blank" rel="noopener">官方文档</a><br><a id="more"></a></p><h4 id="遍历渲染组件："><a href="#遍历渲染组件：" class="headerlink" title="遍历渲染组件："></a>遍历渲染组件：</h4><p><code>jsx</code> 中只能写表达式，不能写多行语句,所以不能写 <code>if else</code> 、 <code>for</code> … 最佳循环写法是使用 <code>map</code> 函数<br></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">View</span>&gt;</span></span><br><span class="line">&#123;</span><br><span class="line">    arr.map((item, index) =&gt; <span class="tag">&lt;<span class="name">View</span> <span class="attr">key</span>=<span class="string">&#123;item.id</span> || <span class="attr">index</span>&#125; /&gt;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">View</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--  或----------------------------------  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">View</span>&gt;</span></span><br><span class="line">&#123;</span><br><span class="line">    arr.map((index, index) =&gt; &#123;</span><br><span class="line">        return (<span class="tag">&lt;<span class="name">View</span> <span class="attr">key</span>=<span class="string">&#123;index.id</span> || <span class="attr">index</span>&#125; /&gt;</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">View</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><p><em>注意：</em></p><ul><li><code>key</code> 必须在其兄弟节点中是唯一的，而非全局唯一</li><li>并不建议使用元素在数组中的索引作为 <code>key</code> 。若数组没有重排，该方法效果不错，但若重排了（比如数组内重新排序、数组头部插入新元素），那样，内容相同的元素他们的 <code>key</code> 并不相同， <code>React</code> 就会都重新渲染，而且相同 <code>key</code> 元素也有可能以意想不到的方式混淆和更新。详情参考 <a href="https://react.docschina.org/docs/reconciliation.html" target="_blank" rel="noopener">这儿</a></li></ul><h4 id="Ref"><a href="#Ref" class="headerlink" title="Ref :"></a><a href="https://react.docschina.org/docs/refs-and-the-dom.html" target="_blank" rel="noopener">Ref</a> :</h4><p>分为 String 类型 和 回调函数类型，推荐使用回调函数类型，<code>React</code> 官方称 String 类型已过时并在未来版本可能被删除。还有一种是传递 <code>createRef()</code> 创建的 <code>ref</code> 属性 ，个人感觉不太方便，具体请看标题的超链接。</p><ul><li>当 <code>ref</code> 属性被用于一个普通的 <code>HTML</code> 元素时，回调函数将接收底层 <code>DOM</code> 元素作为它的参数</li><li>当 <code>ref</code> 属性被用于一个自定义类组件时，回调函数将接收 该组件已挂载的实例 作为它的参数<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AutoFocusTextInput</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    componentDidMount() &#123;</span><br><span class="line">        <span class="keyword">this</span>.textInput.focusTextInput();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;CustomTextInput</span><br><span class="line">            <span class="comment">// input是CustomTextInput的实例</span></span><br><span class="line">            ref=&#123;(input) =&gt; &#123; <span class="keyword">this</span>.textInput = input; &#125;&#125; /&gt;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p><em>注意:</em> <code>ref</code> 只能用于 class 组件 ，不能用于 函数式组件， 因为函数式组件没有实例。</p><h4 id="PureComponent-与-shouldComponentUpdate-nextProps-nextState"><a href="#PureComponent-与-shouldComponentUpdate-nextProps-nextState" class="headerlink" title="PureComponent 与 shouldComponentUpdate(nextProps, nextState)"></a>PureComponent 与 shouldComponentUpdate(nextProps, nextState)</h4><p><code>shouldComponentUpdate(nextProps, nextState)</code>：</p><ul><li>不在初始化渲染或当使用 <code>forceUpdate()</code> 时被调用。当接收到新属性或状态时，<code>shouldComponentUpdate()</code> 在 <code>render()</code> 前被调用。</li><li>默认返回 <code>true</code> ，表示重新渲染。若我们想要在 <code>props</code>、 <code>state</code> 中的某些值变化时不重新渲染，通过与 <code>nextProps</code> 、 <code>nextState</code> 比较实现逻辑，在你想要的地方返回 <code>false</code></li></ul><p><code>PureComponent</code> ：<br>在某些场景下你可以使用 <code>React.PureComponent</code> 来提升性能。与 <code>React.Component</code> 几乎完全相同，但 <code>React.PureComponent</code> 通过 <code>prop</code> 和 <code>state</code> 的浅对比来实现 <code>shouldComponentUpate()</code></p><p>更多查看 <a href="https://react.docschina.org/docs/react-api.html" target="_blank" rel="noopener">这儿</a></p><h3 id="react-native-调试"><a href="#react-native-调试" class="headerlink" title="react-native 调试"></a>react-native 调试</h3><p>在调试网页的时候我们使用<code>Chrome Devtool</code> ，它上面有些面板非常好用，我最常用的有： <code>Source</code>、<code>Console</code> 、<code>Elements</code>、<code>NetWork</code>，现在我们调试 <code>React Native</code> 的 app 。我们分别使用以下工具来操作上面各项的调试：</p><ul><li><code>Source</code>、<code>Console</code> : 模拟器上打开 <code>Debug JS Remotely</code>， 就会在 <a href="http://localhost:8081/debugger-ui" target="_blank" rel="noopener">http://localhost:8081/debugger-ui</a> 上打开调试页面，将这个页面在 <code>Chrome</code> 中打开，然后就可以跟调试网页一样，可惜只能调试这两个面板，无法监控 <code>Network</code></li><li><code>Elements</code>； 安装 <code>react-devtools</code>， 并在模拟器上打开 <code>Toggle Inspector</code> 配合使用。具体参考 <a href="https://reactnative.cn/docs/debugging/" target="_blank" rel="noopener">官方文档</a></li><li><p><code>NetWork</code>: 前面说到 <code>Debug JS Remotely</code> 没法监控 <code>Network</code> , 这个问题官方还没解决，可以查看这个 <a href="https://github.com/facebook/react-native/issues/934" target="_blank" rel="noopener">issue</a>。当然聪明人很多，有大佬开发了 <a href="https://github.com/infinitered/reactotron" target="_blank" rel="noopener">reactotron</a> ,使用的话：</p><ul><li>需要安装这个软件、项目中安装依赖 <code>yarn add reactotron-react-native -D</code></li><li><p>添加配置文件<code>ReactotronConfig.js</code> 并引入到入门文件——<code>index.js</code>/<code>App.js</code> 首行即可</p><p>具体的请参考 <a href="https://github.com/infinitered/reactotron/blob/master/docs/quick-start-react-native.md" target="_blank" rel="noopener">官方链接</a> 或 <a href="https://juejin.im/post/5a61641751882573443cc202" target="_blank" rel="noopener">掘金的这篇文章</a>。<br><em>注意：</em> 如果要监听 <code>Android</code> 模拟器的请求，需要运行 <code>adb reverse tcp:9090 tcp:9090</code> （<strong>9090</strong>是 <code>Reactotron</code> 的默认端口） , 并且在 <code>ReactotronConfig.js</code> 中配置</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Reactotron.configure(&#123; <span class="attr">host</span>: <span class="string">'宿主机ip'</span> &#125;).connect()</span><br></pre></td></tr></table></figure><p>详情参考<a href="https://github.com/infinitered/reactotron/issues/174" target="_blank" rel="noopener">此issue</a></p></li></ul></li></ul><h4 id="开启自动刷新：真机或者模拟器中Enable-Live-Reload-和Enable-Hot-Reloading同时打开，下面的情况需要重新编译"><a href="#开启自动刷新：真机或者模拟器中Enable-Live-Reload-和Enable-Hot-Reloading同时打开，下面的情况需要重新编译" class="headerlink" title="开启自动刷新：真机或者模拟器中Enable Live Reload 和Enable Hot Reloading同时打开，下面的情况需要重新编译:"></a>开启自动刷新：真机或者模拟器中<code>Enable Live Reload</code> 和<code>Enable Hot Reloading</code>同时打开，下面的情况需要重新编译:</h4><ul><li>增加了新的资源(比如给 <code>iOS</code> 的Images.xcassets或是 <code>Andorid</code> 的res/drawable文件夹添加了图片)</li><li>更改了任何的原生代码（objective-c/swift/java）</li></ul><h4 id="同时启动两个项目-需要同时启动两个packger与模拟器"><a href="#同时启动两个项目-需要同时启动两个packger与模拟器" class="headerlink" title="同时启动两个项目:需要同时启动两个packger与模拟器"></a>同时启动两个项目:需要同时启动两个packger与模拟器</h4><ol><li><p>同时启动两个<code>packger</code>:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">react-native start --port 端口号</span><br></pre></td></tr></table></figure></li><li><p>启动两个模拟器之后</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">react-native run-android --deviceId [device_id]</span><br><span class="line"><span class="meta">#</span><span class="bash"> device_id可以通过下面的命令进行查看：</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> adb devices</span></span><br></pre></td></tr></table></figure></li></ol><p><em>tip: 其他常用 <code>adb</code> 命令</em><br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 进入模拟器shell命令</span></span><br><span class="line"><span class="built_in">cd</span> ...sdk/platform-tools/</span><br><span class="line">adb -s 设备名称 shell </span><br><span class="line"><span class="comment"># 获取模拟器配置(进入模拟器shell之后)</span></span><br><span class="line">getprop</span><br></pre></td></tr></table></figure><p></p><ol><li>如果是两个模拟器，和电脑在同一个wifi下，那分别在 <strong>dev-setting</strong> =&gt; <strong>Debug server host &amp; port for device</strong> 下添加：<strong>电脑ip:port</strong> 。设置之后按两次R重新加载 <code>bundle</code> 即可。<br><strong>注意：两个模拟器都必须指定端口,即使一个<code>packger</code>是默认端口。</strong><br><strong>疑问： 同时启动 ios 和 android 模拟器经常有一个会没反应，原因未知</strong></li></ol><h3 id="react-native-打包"><a href="#react-native-打包" class="headerlink" title="react-native 打包"></a>react-native 打包</h3><p><a href="https://reactnative.cn/docs/signed-apk-android/" target="_blank" rel="noopener">官方文档</a>介绍的很详细，下面只是些临时用作测试的打包</p><h4 id="android"><a href="#android" class="headerlink" title="android"></a>android</h4><p>不使用签名的简单打包：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> android</span><br><span class="line">./gradlew assembleRelease</span><br></pre></td></tr></table></figure><p></p><h3 id="react-native-常见错误"><a href="#react-native-常见错误" class="headerlink" title="react-native 常见错误"></a>react-native 常见错误</h3><h4 id="Native-module-模块名-tried-to-override-模块名-for-module-name-xxx-If-this-was-your-intention-set-canOverrideExistingModule-true"><a href="#Native-module-模块名-tried-to-override-模块名-for-module-name-xxx-If-this-was-your-intention-set-canOverrideExistingModule-true" class="headerlink" title="Native module 模块名 tried to override 模块名 for module name xxx. If this was your intention, set canOverrideExistingModule=true"></a>Native module 模块名 tried to override 模块名 for module name xxx. If this was your intention, set canOverrideExistingModule=true</h4><p><strong>原因：</strong> 通常重复执行 <code>react-link</code> 引起的，会在 <code>MainApplication.java</code> 、 <code>build.gradle</code> 、 <code>settings.gradle</code> 里重复导入包。这是 facebook 的官方bug，详情可以看 <a href="https://stackoverflow.com/questions/43032841/react-native-link-causes-duplicate-imports-in-android-settings-gradle" target="_blank" rel="noopener">stackoverflow</a></p><p><strong>解决方法:</strong> 检查 <code>MainApplication.java</code>，删除重复出现的包 。一般是在两个地方重复，一是 <code>import</code> ，二是 <code>protected List&lt;ReactPackage&gt; getPackages()</code> 里面。 <code>build.gradle</code> 、 <code>settings.gradle</code> 里虽然也重复了，但不会报错，项目也可以正常跑起来。</p><p><strong>注意：</strong> 有些包虽然你执行了 <code>react-native link</code>， 但并不会正确引入到原生代码里。比如说：<a href="https://github.com/yonahforst/react-native-permissions" target="_blank" rel="noopener">react-native-permissions</a>，需要单独执行 <code>react-native link react-native-permissions</code> 。具体情况还是多看看人家的 <code>README</code></p><h4 id="react-native-scrollable-tab-view-有时候不显示内容，升级到-0-7-4即可"><a href="#react-native-scrollable-tab-view-有时候不显示内容，升级到-0-7-4即可" class="headerlink" title="react-native-scrollable-tab-view 有时候不显示内容，升级到^0.7.4即可"></a>react-native-scrollable-tab-view 有时候不显示内容，升级到^0.7.4即可</h4><h4 id="genymotion-模拟器滑动时老切换到搜索页面，并出现00003。关闭有道词典的划词翻译即可。"><a href="#genymotion-模拟器滑动时老切换到搜索页面，并出现00003。关闭有道词典的划词翻译即可。" class="headerlink" title="genymotion 模拟器滑动时老切换到搜索页面，并出现00003。关闭有道词典的划词翻译即可。"></a>genymotion 模拟器滑动时老切换到搜索页面，并出现00003。关闭有道词典的划词翻译即可。</h4><h4 id="android打包错误"><a href="#android打包错误" class="headerlink" title="android打包错误"></a>android打包错误</h4><p>本来好好地项目打包出错，比如这样的错误:<code>:app:packageDebug</code>,或者说什么解压不了文件什么的，可以尝试用下面的语句：<br></p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">cd</span> <span class="keyword">android</span></span><br><span class="line"><span class="keyword">gradlew </span>clean</span><br></pre></td></tr></table></figure><p></p><p>清理缓存后重新打包</p><h4 id="权限问题"><a href="#权限问题" class="headerlink" title="权限问题"></a>权限问题</h4><ol><li><p>官方对 <code>android</code> 出了 <a href="https://reactnative.cn/docs/permissionsandroid/" target="_blank" rel="noopener">PermissionsAndroid</a> API，刚开始检测 相机权限 ，无论我在 app 中给没给相机权限，这个 API 给我返回的结果都是有权限。</p><p><strong>原因：</strong> <code>Android 6.0</code> 之前的版本只要是在 <code>AndroidManifest.xml</code> 申明的权限这个 API 都会返回有权限。</p><p><strong>解决方法：</strong> 需要修改 <code>build.gradle</code> 里的 <code>targetSdkVersion</code> 为 23 才可以。<em>注意： 需要卸载原来的 app 重新装。</em></p></li><li><p><code>Ios</code> 的权限判断使用 <a href="https://github.com/yonahforst/react-native-permissions" target="_blank" rel="noopener">react-native-permissions</a> , 其实 <code>android</code> 也可以使用这个，很方便。下面有个 demo：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">_requestCameraIosPermission = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> permitStr = <span class="string">'camera'</span>;</span><br><span class="line">    <span class="keyword">let</span> response = <span class="keyword">await</span> Permissions.check(permitStr);</span><br><span class="line">    <span class="keyword">if</span> (response === <span class="string">'undetermined'</span>) &#123; <span class="comment">/* 之前没有弹出来过权限申请 */</span></span><br><span class="line">        <span class="keyword">let</span> requestResult = <span class="keyword">await</span> Permissions.request(permitStr);</span><br><span class="line">        <span class="keyword">return</span> requestResult === <span class="string">'authorized'</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (response !== <span class="string">'authorized'</span>) &#123;</span><br><span class="line">        Alert.alert(</span><br><span class="line">            <span class="string">'权限提醒'</span>,</span><br><span class="line">            <span class="string">'请到设置中开启INKubator Pay的相机权限'</span>,</span><br><span class="line">            [</span><br><span class="line">                &#123; <span class="attr">text</span>: <span class="string">'Ok'</span>, <span class="attr">onPress</span>: Permissions.openSettings &#125;, <span class="comment">/* 跳转到IOS系统的权限设置 */</span></span><br><span class="line">                &#123; <span class="attr">text</span>: <span class="string">'Cancel'</span>, <span class="attr">style</span>: <span class="string">'cancel'</span>&#125;</span><br><span class="line">            ]</span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li></ol><h3 id="react-native-杂谈"><a href="#react-native-杂谈" class="headerlink" title="react-native 杂谈"></a>react-native 杂谈</h3><h4 id="Android-api与版本号对应关系"><a href="#Android-api与版本号对应关系" class="headerlink" title="Android api与版本号对应关系"></a><code>Android</code> api与版本号对应关系</h4><p><code>react native</code> 要求我们安装的 <code>sdk</code> 都是 api 23 的对应版本，这个对应的版本号是 <code>Andrid 6.0</code> ，其他的对应关系请参考 <a href="https://source.android.com/source/build-numbers" target="_blank" rel="noopener">这儿</a></p><h4 id="require只能使用静态字符串，因为它是在编译期执行，而不是运行期。js执行过程"><a href="#require只能使用静态字符串，因为它是在编译期执行，而不是运行期。js执行过程" class="headerlink" title="require只能使用静态字符串，因为它是在编译期执行，而不是运行期。js执行过程:"></a><code>require</code>只能使用静态字符串，因为它是在编译期执行，而不是运行期。js执行过程:</h4><p><img src="https://tang-blog-1257996120.cos-website.ap-chengdu.myqcloud.com/react-native-run.png" alt="react-native-run"><br><code>React Native</code>从0.5.0版本开始已经内置<code>Babel</code>转换器</p><h4 id="Android-Studios-常用快捷键"><a href="#Android-Studios-常用快捷键" class="headerlink" title="Android Studios 常用快捷键"></a>Android Studios 常用快捷键</h4><p>打开 <code>andorid studio</code> ，会默认根据 <code>gradle</code> 同步项目。同步完成后才可以 Build 与 Run，一般可以直接 Run</p><ul><li>快速打开某一个文件: <strong>command + shift + O</strong></li><li>根据 <code>gradle</code> 同步项目： <code>File -&gt; Sync Project with Gradle Files</code></li><li>Run: <strong>control + R</strong></li></ul><h4 id="XCode-常用快捷键"><a href="#XCode-常用快捷键" class="headerlink" title="XCode 常用快捷键"></a>XCode 常用快捷键</h4><ul><li>快速打开某一个文件: <strong>command + shift + O</strong></li><li>返回至上一次光标位置： <strong>control + command + ← , control + command + →</strong></li><li>快速查看当前class的方法： <strong>control + 6</strong></li></ul>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[nginx开启https]]></title>
      <url>https://jintang.github.io/2018/04/27/nginx%E5%BC%80%E5%90%AFhttps/</url>
      <content type="html"><![CDATA[<p>前段时间微信小程序很火，得闲时来写写小程序。本来想用豆瓣的 api ，但已经有人写了，好吧…那我就自己写个简单的 api 用用。程序已经写好了，但小程序要求后台必须是 <code>https</code>,好吧，那就给谷歌云搞个 <code>https</code>, 下面讲讲过程。万万没想到， 最后的结局是悲伤的，这个 api 最后还是用不成，因为小程序要求的接口域名必须是要经过备案的，而谷歌云无法备案，苦涩的哈哈哈… 。仅以此纪念学习这个的过程。</p><h3 id="下载证书"><a href="#下载证书" class="headerlink" title="下载证书"></a>下载证书</h3><p>首先在本地先试验下，用 <code>openssl</code> 生成了自签名证书，参考 <a href="http://www.xymiao.com/archives/769" target="_blank" rel="noopener">这儿</a>, 再修改下 <code>nginx.conf</code> 的配置，就可以访问 <a href="https://localhost" target="_blank" rel="noopener">https://localhost</a> 了，但放在谷歌云上却无法正确运行，不知道为什么…</p><p>那么，我们去买一个 <code>https</code> 证书来配置，==…发现有免费的，那自然用免费的，申请下载请参考 <a href="http://www.zslin.com/web/article/detail/72" target="_blank" rel="noopener">这儿</a>，文章中阿里云的免费证书已经不可以申请了，所以我申请了腾讯云的免费证书，不枉我玩了那么多腾讯游戏…手动笑哭</p><h3 id="修改nginx配置"><a href="#修改nginx配置" class="headerlink" title="修改nginx配置"></a>修改nginx配置</h3><p>免费的证书有 1 年的使用时间，下载下来的证书长这样：<img src="https://tang-blog-1257996120.cos-website.ap-chengdu.myqcloud.com/ca-dir.png" alt="https腾讯云证书"><br><a id="more"></a><br>在 <code>/etc/nginx</code> 下创建个 <code>ssl</code> 文件夹，此路径下的文件如图：<img src="https://tang-blog-1257996120.cos-website.ap-chengdu.myqcloud.com/nginx-dir.png" alt="nginx目录"><br>将下载下来 <code>nginx</code> 下的证书上传到 <code>ssl</code> 文件夹下。然后修改 <code>nginx.conf</code> 文件，只需要添加一个 <code>server</code> 配置，其他的都不变：<br></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">http</span> <span class="string">&#123;</span></span><br><span class="line">    <span class="comment"># http 的 server 配置，不变</span></span><br><span class="line">    <span class="string">server</span> <span class="string">&#123;</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">    <span class="string">&#125;</span></span><br><span class="line">    <span class="comment"># https 的 server 配置 </span></span><br><span class="line">    <span class="string">server</span> <span class="string">&#123;</span></span><br><span class="line">        <span class="string">listen</span>       <span class="number">443</span> <span class="string">ssl</span> <span class="string">http2</span> <span class="string">default_server;</span></span><br><span class="line">        <span class="string">listen</span>       <span class="string">[::]:443</span> <span class="string">ssl</span> <span class="string">http2</span> <span class="string">default_server;</span></span><br><span class="line">        <span class="string">server_name</span>  <span class="string">_;</span></span><br><span class="line">        <span class="string">root</span>         <span class="string">/usr/share/nginx/html;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 添加的证书信息, 主要修改下证书的路径</span></span><br><span class="line">        <span class="string">ssl_certificate</span> <span class="string">"/etc/nginx/ssl/1_cloud-tv.top_bundle.crt"</span><span class="string">;</span></span><br><span class="line">        <span class="string">ssl_certificate_key</span> <span class="string">"/etc/nginx/ssl/2_cloud-tv.top.key"</span><span class="string">;</span></span><br><span class="line">        <span class="string">ssl_session_cache</span> <span class="attr">shared:SSL:1m;</span></span><br><span class="line">        <span class="string">ssl_session_timeout</span>  <span class="number">10</span><span class="string">m;</span></span><br><span class="line">        <span class="string">ssl_ciphers</span> <span class="attr">HIGH:!aNULL:!MD5;</span></span><br><span class="line">        <span class="string">ssl_prefer_server_ciphers</span> <span class="string">on;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Load configuration files for the default server block.</span></span><br><span class="line">        <span class="string">include</span> <span class="string">/etc/nginx/default.d/*.conf;</span></span><br><span class="line"></span><br><span class="line">        <span class="string">location</span> <span class="string">/</span> <span class="string">&#123;</span></span><br><span class="line">            <span class="string">proxy_pass</span> <span class="attr">http://localhost:3000;</span></span><br><span class="line">            <span class="string">proxy_set_header</span> <span class="string">Host</span> <span class="string">$host;</span></span><br><span class="line">        <span class="string">&#125;</span></span><br><span class="line"></span><br><span class="line">        <span class="string">error_page</span> <span class="number">404</span> <span class="string">/404.html;</span></span><br><span class="line">            <span class="string">location</span> <span class="string">=</span> <span class="string">/40x.html</span> <span class="string">&#123;</span></span><br><span class="line">        <span class="string">&#125;</span></span><br><span class="line"></span><br><span class="line">        <span class="string">error_page</span> <span class="number">500</span> <span class="number">502</span> <span class="number">503</span> <span class="number">504</span> <span class="string">/50x.html;</span></span><br><span class="line">            <span class="string">location</span> <span class="string">=</span> <span class="string">/50x.html</span> <span class="string">&#123;</span></span><br><span class="line">        <span class="string">&#125;</span></span><br><span class="line">    <span class="string">&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure><p></p><p>最后重启 <code>nginx</code> 服务就可以访问了。我是这样重启的<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ systemctl stop nginx</span><br><span class="line">$ systemctl start nginx</span><br></pre></td></tr></table></figure><p></p><p>感觉自己好傻逼…</p>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[docker初识]]></title>
      <url>https://jintang.github.io/2018/04/24/docker%E5%88%9D%E8%AF%86/</url>
      <content type="html"><![CDATA[<blockquote><p>参考链接：</p><ul><li><a href="http://www.ruanyifeng.com/blog/2018/02/docker-tutorial.html" target="_blank" rel="noopener">阮大神</a>，有些介绍直接 copy 了阮大神的，因为阮大神写得很通俗易懂，嘿嘿</li></ul></blockquote><p>软件开发最大的麻烦事之一，就是环境配置。用户计算机的环境都不相同，你怎么知道自家的软件，能在那些机器跑起来？</p><p>用户必须保证两件事：操作系统的设置，各种库和组件的安装。只有它们都正确，软件才能运行。举例来说，安装一个 <code>Python</code> 应用，计算机必须有 <code>Python</code> 引擎，还必须有各种依赖，可能还要配置环境变量。</p><p>如果某些老旧的模块与当前环境不兼容，那就麻烦了。开发者常常会说：”它在我的机器可以跑了”（It works on my machine），言下之意就是，其他机器很可能跑不了。</p><p>环境配置如此麻烦，换一台机器，就要重来一次，旷日费时。很多人想到，能不能从根本上解决问题，软件可以带环境安装？也就是说，安装的时候，把原始环境一模一样地复制过来。</p><p><strong>解决方案：</strong></p><ol><li><p>虚拟机（virtual machine）就是带环境安装的一种解决方案。它可以在一种操作系统里面运行另一种操作系统，比如在 Windows 系统里面运行 Linux 系统。应用程序对此毫无感知，因为虚拟机看上去跟真实系统一模一样，而对于底层系统来说，虚拟机就是一个普通文件，不需要了就删掉，对其他部分毫无影响。</p><p>虽然用户可以通过虚拟机还原软件的原始环境。但是，这个方案有几个缺点。</p><ul><li><strong>资源占用多</strong>:<br>虚拟机会独占一部分内存和硬盘空间。它运行的时候，其他程序就不能使用这些资源了。哪怕虚拟机里面的应用程序，真正使用的内存只有 1MB，虚拟机依然需要几百 MB 的内存才能运行。</li><li><strong>冗余步骤多</strong>：<br>虚拟机是完整的操作系统，一些系统级别的操作步骤，往往无法跳过，比如用户登录。</li><li><strong>启动慢</strong>：<br>启动操作系统需要多久，启动虚拟机就需要多久。可能要等几分钟，应用程序才能真正运行。</li></ul></li><li><p>Linux 容器不是模拟一个完整的操作系统，而是对进程进行隔离。或者说，在正常进程的外面套了一个保护层。对于容器里面的进程来说，它接触到的各种资源都是虚拟的，从而实现与底层系统的隔离。</p><p>由于容器是进程级别的，相比虚拟机有很多优势。</p><ul><li><strong>启动快</strong>:<br>容器里面的应用，直接就是底层系统的一个进程，而不是虚拟机内部的进程。所以，启动容器相当于启动本机的一个进程，而不是启动一个操作系统，速度就快很多。</li><li><strong>资源占用少</strong>：<br>容器只占用需要的资源，不占用那些没有用到的资源；虚拟机由于是完整的操作系统，不可避免要占用所有资源。另外，多个容器可以共享资源，虚拟机都是独享资源。</li><li><strong>体积小</strong>：<br>容器只要包含用到的组件即可，而虚拟机是整个操作系统的打包，所以容器文件比虚拟机文件要小很多。</li></ul></li></ol><p><strong>总之</strong>，容器有点像轻量级的虚拟机，能够提供虚拟化的环境，但是成本开销小得多。</p><a id="more"></a><h3 id="什么是docker"><a href="#什么是docker" class="headerlink" title="什么是docker"></a>什么是docker</h3><p><code>Docker</code> 属于 Linux 容器的一种封装，提供简单易用的容器使用接口。它是目前最流行的 Linux 容器解决方案。</p><p><code>Docker</code> 将应用程序与该程序的依赖，打包在一个文件里面。运行这个文件，就会生成一个虚拟容器。程序在这个虚拟容器里运行，就好像在真实的物理机上运行一样。有了 <code>Docker</code>，就不用担心环境问题。</p><p>总体来说，<code>Docker</code> 的接口相当简单，用户可以方便地创建和使用容器，把自己的应用放入容器。容器还可以进行版本管理、复制、分享、修改，就像管理普通的代码一样。</p><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p><code>Docker</code> 是一个开源的商业产品，有两个版本：社区版（Community Edition，缩写为 CE）和企业版（Enterprise Edition，缩写为 EE）。企业版包含了一些收费服务，个人开发者一般用不到。我们使用社区版。</p><p><code>Docker</code> 可以在<code>Mac</code>、<code>Linux</code>、<code>windows</code>下安装，其中的 windows 只能是 win10，我又没有 mac, 所以我使用谷歌云来进行安装，它是 <code>CentOs7</code>。</p><p>鉴于国内网络问题，强烈建议使用国内源<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># \ 表示换行</span></span><br><span class="line">$ sudo yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https://mirrors.ustc.edu.cn/docker-ce/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure><p></p><p>如果无法识别 <code>yum-config-manager</code> 命令，使用下面命令安装并重新登录:<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo yum install -y yum-utils</span><br></pre></td></tr></table></figure><p></p><p>更新 <code>yum</code> 软件源缓存，并安装 <code>docker-ce</code>。<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo yum makecache fast</span><br><span class="line">$ sudo yum install docker-ce</span><br></pre></td></tr></table></figure><p></p><p>安装完成后，运行下面的命令，验证是否安装成功。<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker version</span><br></pre></td></tr></table></figure><p></p><p><code>Docker</code> 需要用户具有 sudo 权限，为了避免每次命令都输入sudo，可以把用户加入 <code>Docker</code> 用户组。<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo usermod -aG docker <span class="variable">$USER</span></span><br></pre></td></tr></table></figure><p></p><p><code>Docker</code> 是服务器—-客户端架构。命令行运行 <code>docker</code> 命令的时候，需要本机有 <code>Docker</code> 服务。如果这项服务没有启动，可以用下面的命令启动。<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl start docker</span><br></pre></td></tr></table></figure><p></p><p>最后，验证 <code>docker</code> 是否可以正常运行：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run hello-world</span><br></pre></td></tr></table></figure><p></p><h3 id="image文件"><a href="#image文件" class="headerlink" title="image文件"></a>image文件</h3><p><strong>Docker 把应用程序及其依赖，打包在 image 文件里面，这就是 docker 里常说的镜像。</strong> 只有通过这个文件，才能生成 <code>Docker</code> 容器。 <code>image</code> 文件可以看作是容器的模板。 <code>Docker</code> 根据 <code>image</code> 文件生成容器的实例。同一个 <code>image</code> 文件，可以生成多个同时运行的容器实例。</p><p><code>image</code> 是二进制文件。实际开发中，一个 <code>image</code> 文件往往通过继承另一个 <code>image</code> 文件，加上一些个性化设置而生成。举例来说，你可以在 Ubuntu 的 <code>image</code> 基础上，往里面加入 Apache 服务器，形成你的 <code>image</code>。</p><p><code>image</code> 常用命令：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取image</span></span><br><span class="line">$ docker pull [imageName]</span><br><span class="line"><span class="comment"># 显示本机所有的image</span></span><br><span class="line">$ docker images</span><br><span class="line"><span class="comment"># 删除 image 文件</span></span><br><span class="line">$ docker rmi [imageName]</span><br></pre></td></tr></table></figure><p></p><p><code>image</code> 文件是通用的，一台机器的 <code>image</code> 文件拷贝到另一台机器，照样可以使用。一般来说，为了节省时间，我们应该尽量使用别人制作好的 <code>image</code> 文件，而不是自己制作。即使要定制，也应该基于别人的 <code>image</code> 文件进行加工，而不是从零开始制作。</p><p>为了方便共享， <code>image</code> 文件制作完成后，可以上传到网上的仓库。 <code>Docker</code> 的官方仓库 <em>Docker Hub</em> 是最重要、最常用的 <code>image</code> 仓库。此外，出售自己制作的 <code>image</code> 文件也是可以的。</p><p>我们来使用下上面这些命令：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker pull hello-world</span><br><span class="line">$ docker images</span><br><span class="line">$ docker rmi hello-world</span><br></pre></td></tr></table></figure><p></p><h3 id="通过-Dockerfile-创建-image"><a href="#通过-Dockerfile-创建-image" class="headerlink" title="通过 Dockerfile 创建 image"></a>通过 Dockerfile 创建 image</h3><p><code>Docker</code> 根据该文件生成二进制的 <code>image</code> 文件。</p><p>常用相关命令：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建image</span></span><br><span class="line">$ docker build [optiosn] PATH</span><br></pre></td></tr></table></figure><p></p><p>下面用实例来演示：</p><p>创建一个 <code>Dockerfile</code> 文件<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir docker-demo &amp;&amp; <span class="built_in">cd</span> docker-demo</span><br><span class="line">$ touch Dockfile</span><br><span class="line">$ vim Dockerfile</span><br></pre></td></tr></table></figure><p></p><p>填入如下内容：<br></p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> alpine:latest</span><br><span class="line"><span class="keyword">MAINTAINER</span> tang</span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> <span class="built_in">echo</span> <span class="string">'hello docker'</span></span></span><br></pre></td></tr></table></figure><p></p><p>保存退出。继续下面的命令:<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker build -t hello-docker . </span><br><span class="line">$ docker images <span class="comment"># 可以看到生成的hello-docker</span></span><br><span class="line">$ docker run hello-docker <span class="comment"># 输出：hello docker</span></span><br></pre></td></tr></table></figure><p></p><p>上面 <code>docker build</code> 语句中：-t 指定 <code>image</code> 的名称，后面跟冒号可以指定标签，若没有指定，则默认为 <code>latest</code></p><p><code>Dockerfile</code> 文件常用命令：</p><ul><li><strong>FROM:</strong> 基础镜像</li><li><strong>MAINTAINER:</strong> 维护者</li><li><strong>WORKDIR:</strong> 指定工作目录</li><li><strong>ADD:</strong> 添加文件,可以添加远程文件</li><li><strong>COPY:</strong> 拷贝文件，但不允许远程文件</li><li><strong>RUN:</strong> 执行命令，允许出现多条</li><li><strong>CMD:</strong> 执行命令，只允许一条生效，若有多条，最后一条生效，若 <code>docker run</code> 命令后面有命令，会覆盖CMD命令</li><li><strong>EXPOSE:</strong> 暴露端口</li><li><strong>ENV:</strong> 设定环境变量</li><li><strong>ENTRYPOINT:</strong> 容器入口</li><li><strong>USER:</strong> 指定用户</li><li><strong>VOLUME:</strong> 挂载卷。如：<code>VOLUME /data</code> ， /data 目录就会在运行时自动挂载为匿名卷,任何向 /data 中写入的信息都不会记录进容器存储层，从而保证了容器存储层的无状态化。运行时可以覆盖这个挂载设置,如： <code>docker run -d -v mydata:/data imageName</code>, 使用了 mydata 这个命名卷挂载到了 /data 这个位置，替代了 <code>Dockerfile</code> 中定义的匿名卷的挂载配置</li></ul><p>下面我们来个稍微复杂点的实例，还是在上面那个目录，先做些准备工作：</p><p>初始化一个 <code>node</code> 项目:<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ npm init</span><br><span class="line">$ npm install koa -S</span><br></pre></td></tr></table></figure><p></p><p>创建 <code>.dockerignore</code> 文件，并写入：</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">node_modules</span><br><span class="line"><span class="keyword">node</span><span class="title">-debug</span>.log</span><br></pre></td></tr></table></figure><p>创建 <code>server.js</code> 并填写：<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">'koa'</span>)</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa()</span><br><span class="line"></span><br><span class="line">app.use( <span class="keyword">async</span> ( ctx ) =&gt; &#123;</span><br><span class="line">  ctx.body = <span class="string">'hello koa2'</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3006</span>)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'[demo] start-quick is starting at port 3006'</span>)</span><br></pre></td></tr></table></figure><p></p><p>准备工作完成，修改 <code>Dockerfile</code> , 参考 <a href="https://nodejs.org/en/docs/guides/nodejs-docker-webapp/" target="_blank" rel="noopener">node官方demo</a>, 最终如下：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">FROM node:carbon</span><br><span class="line">MAINTAINER tang</span><br><span class="line"><span class="comment"># Dockerfile 中每一个指令都会建立一层，使用 WORKDIR 后各层的当前目录就被改为指定的目录</span></span><br><span class="line">WORKDIR /usr/src/app</span><br><span class="line">COPY package*.json ./</span><br><span class="line"></span><br><span class="line">RUN \</span><br><span class="line">npm install -g nrm &amp;&amp; \</span><br><span class="line">nrm use taobao &amp;&amp; \</span><br><span class="line">npm install</span><br><span class="line"></span><br><span class="line">COPY . .</span><br><span class="line">EXPOSE 3006</span><br><span class="line">CMD [<span class="string">"npm"</span>, <span class="string">"start"</span>]</span><br></pre></td></tr></table></figure><p></p><p>继续下面命令：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建image</span></span><br><span class="line">$ docker build -t hello-koa2 .</span><br><span class="line"><span class="comment"># 查看创建的image</span></span><br><span class="line">$ docker images</span><br><span class="line"><span class="comment"># run the image</span></span><br><span class="line">$ docker run -p 9000:3006 -d hello-koa2 <span class="comment"># 返回containerId</span></span><br><span class="line"><span class="comment"># 查看生成的container</span></span><br><span class="line">$ docker ps</span><br><span class="line"><span class="comment"># Print app output</span></span><br><span class="line">$ docker logs containerId</span><br></pre></td></tr></table></figure><p></p><p>最后访问 <a href="localhost:9000" target="_blank" rel="noopener">localhost:9000</a>，可以看到结果： hello koa2</p><h3 id="container文件"><a href="#container文件" class="headerlink" title="container文件"></a>container文件</h3><p><strong>image 运行时的实例，本身也是一个文件，称为容器文件。</strong></p><p>container 常用命令:<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 根据image生成container并启动</span></span><br><span class="line">$ docker run [OPTIONS] imageName [<span class="built_in">command</span>]</span><br><span class="line"><span class="comment"># 启动已经停止的container</span></span><br><span class="line">$ docker start [containerId, ...]</span><br><span class="line"><span class="comment"># 查看正在运行的container，加 -a 显示所有的container</span></span><br><span class="line">$ docker ps</span><br><span class="line"><span class="comment"># 停止container</span></span><br><span class="line">$ docker stop [containerId]</span><br><span class="line"><span class="comment"># 删除container</span></span><br><span class="line">$ docker rm [containerId]</span><br></pre></td></tr></table></figure><p></p><p><code>docker run</code> 常用的 options:</p><ul><li><strong>-d:</strong> 后台运行容器，并返回容器ID；</li><li><strong>-i:</strong> 以交互模式运行容器，通常与 -t 同时使用；</li><li><strong>-t:</strong> 为容器重新分配一个伪输入终端，通常与 -i 同时使用；-it一起使用表示，容器的 Shell 映射到当前的 Shell，然后你在本机窗口输入的命令，就会传入容器</li><li><strong>-p:</strong> 端口映射，将 <code>docker</code> 内部端口映射到本机端口,如 -p 8080:3000，8080表示本机端口</li></ul><p>我们来使用下上面这些命令：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ docker run hello-world <span class="comment"># 本地找不到会自动在仓库下载</span></span><br><span class="line">$ docker ps</span><br><span class="line">$ docker stop [containerId]</span><br><span class="line">$ docker ps <span class="comment"># 只能看到正在运行的container</span></span><br><span class="line">$ docker ps -a</span><br><span class="line">$ docker rm [containerId]</span><br><span class="line">$ docker ps -a</span><br></pre></td></tr></table></figure><p></p><h3 id="发布-image-文件"><a href="#发布-image-文件" class="headerlink" title="发布 image 文件"></a>发布 image 文件</h3><p>容器运行成功后，就确认了 <code>image</code> 文件的有效性。这时，我们就可以考虑把 <code>image</code> 文件分享到网上，让其他人使用。假设我们要发布上面用到的 <code>hello-koa2 image</code> ，进行如下步骤：</p><p>首先，去 <a href="https://hub.docker.com" target="_blank" rel="noopener">hub.docker.com</a> 或 <a href="https://cloud.docker.com" target="_blank" rel="noopener">cloud.docker.com</a> 注册一个账户。然后，使用下面的命令：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ docker login <span class="comment"># 输入注册的用户名和密码</span></span><br><span class="line"><span class="comment"># 为本地的 image 标注用户名和版本。</span></span><br><span class="line">$ docker tag hello-koa2 [username]/[respository]:[tag]</span><br><span class="line"><span class="comment"># 我的是： docker tag hello-koa2 jintang/hello-koa2</span></span><br><span class="line">$ docker push jintang/hello-koa2</span><br></pre></td></tr></table></figure><p></p><p>现在就可以在 <a href="https://hub.docker.com" target="_blank" rel="noopener">hub.docker.com</a> 上登录自己的账号看到刚发布的 <code>image</code> 了</p><h3 id="Docker-Compose"><a href="#Docker-Compose" class="headerlink" title="Docker Compose"></a>Docker Compose</h3><p><code>Compose</code> 是 <code>Docker</code> 公司推出的一个工具软件，可以管理多个 <code>Docker</code> 容器组成一个应用。你需要定义一个 <em>YAML</em> 格式的配置文件 <code>docker-compose.yml</code> ，写好多个容器之间的调用关系。然后，只要一个命令，就能同时启动/关闭这些容器。</p><h4 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo curl -L https://github.com/docker/compose/releases/download/1.21.0/docker-compose-$(uname -s)-$(uname -m) -o /usr/<span class="built_in">local</span>/bin/docker-compose</span><br><span class="line">$ sudo chmod +x /usr/<span class="built_in">local</span>/bin/docker-compose</span><br></pre></td></tr></table></figure><p>检测是否安装成功：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker-compose --version</span><br><span class="line"><span class="comment"># docker-compose version 1.21.0, build 5920eb0</span></span><br></pre></td></tr></table></figure><p></p><h4 id="编写-docker-compose-yml"><a href="#编写-docker-compose-yml" class="headerlink" title="编写 docker-compose.yml"></a>编写 docker-compose.yml</h4><p>现在我们要搭建一个 <code>wordpress</code> 站点，它需要 <code>wordpress</code> 容器和 <code>mysql</code> 容器。</p><p><strong>先看看不使用 compose 的实现方法:</strong></p><p>首先，基于官方的 <code>mysql image</code>， 新建并启动 <code>MySQL</code> 容器。<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ docker run \</span><br><span class="line">  -d \</span><br><span class="line">  --rm \</span><br><span class="line">  --name wordpressdb \</span><br><span class="line">  --env MYSQL_ROOT_PASSWORD=123456 \</span><br><span class="line">  --env MYSQL_DATABASE=wordpress \</span><br><span class="line">  mysql:5.7</span><br></pre></td></tr></table></figure><p></p><p>然后，基于官方的 <code>WordPress image</code> ，新建并启动 <code>WordPress</code> 容器。<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ docker run \</span><br><span class="line">  -d \</span><br><span class="line">  -p 9001:80 \</span><br><span class="line">  --rm \</span><br><span class="line">  --name wordpress \</span><br><span class="line">  --env WORDPRESS_DB_PASSWORD=123456 \</span><br><span class="line">  --link wordpressdb:mysql \</span><br><span class="line">  --volume <span class="string">"<span class="variable">$PWD</span>/wordpress"</span>:/var/www/html \</span><br><span class="line">  wordpress</span><br></pre></td></tr></table></figure><p></p><p>解析：</p><ul><li><strong>–rm：</strong> 停止运行后，自动删除容器文件。</li><li><strong>–name wordpress：</strong> 容器的名字叫做wordpress。</li><li><strong>–env MYSQL_ROOT_PASSWORD=123456：</strong> 向容器进程传入一个环境变量 MYSQL_ROOT_PASSWORD ，该变量会被用作 MySQL 的根密码。</li><li><strong>–env MYSQL_DATABASE=wordpress：</strong> 向容器进程传入一个环境变量 MYSQL_DATABASE ，容器里面的 <code>MySQL</code> 会根据该变量创建一个同名数据库。</li><li><strong>–link wordpressdb:mysql</strong> ，表示 <code>WordPress</code> 容器要连到 <code>wordpressdb</code> 容器，冒号表示该容器的别名是 mysql</li><li><strong>–volume “$PWD/“:/var/www/html：</strong> 将当前目录（$PWD）映射到容器的 <code>/var/www/html</code> （Apache 对外访问的默认目录）。因此，当前目录的任何修改，都会反映到容器里面，进而被外部访问到。</li></ul><p>现在访问 <a href="localhost:9001" target="_blank" rel="noopener">localhost:9001</a> 即可以看到安装页面，停止两个 container 后因为 <code>--rm</code> 就自动删除了。</p><p><strong>下面是使用 compose 的实现方法:</strong></p><p><code>docker-compose.yml</code> 写入如下内容：<br></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mysql:</span></span><br><span class="line"><span class="attr">    image:</span> <span class="attr">mysql:5.7</span></span><br><span class="line"><span class="attr">    environment:</span></span><br><span class="line"><span class="bullet">     -</span> <span class="string">MYSQL_ROOT_PASSWORD=123456</span></span><br><span class="line"><span class="bullet">     -</span> <span class="string">MYSQL_DATABASE=wordpress</span></span><br><span class="line"><span class="attr">web:</span></span><br><span class="line"><span class="attr">    image:</span> <span class="string">wordpress</span></span><br><span class="line"><span class="attr">    links:</span></span><br><span class="line"><span class="bullet">     -</span> <span class="string">mysql</span></span><br><span class="line"><span class="attr">    environment:</span></span><br><span class="line"><span class="bullet">     -</span> <span class="string">WORDPRESS_DB_PASSWORD=123456</span></span><br><span class="line"><span class="attr">    ports:</span></span><br><span class="line"><span class="bullet">     -</span> <span class="string">"9001:80"</span></span><br><span class="line"><span class="attr">    working_dir:</span> <span class="string">/var/www/html</span></span><br><span class="line"><span class="attr">    volumes:</span></span><br><span class="line"><span class="attr">     - wordpress:</span><span class="string">/var/www/html</span></span><br></pre></td></tr></table></figure><p></p><h4 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker-compose up</span><br></pre></td></tr></table></figure><p>访问 <a href="localhost:9001" target="_blank" rel="noopener">localhost:9001</a> 就可以看到 <code>wordpress</code> 的安装界面了</p><p>现在关闭两个容器。<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker-compose stop</span><br></pre></td></tr></table></figure><p></p><p>关闭以后，这两个容器文件还是存在的，写在里面的数据不会丢失。下次启动的时候，还可以复用。下面的命令可以把这两个容器文件删除（容器必须已经停止运行）。<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker-compose rm</span><br></pre></td></tr></table></figure><p></p><p>比起上面单独创建 container 的方式方便多了。</p><h3 id="docker-常用命令"><a href="#docker-常用命令" class="headerlink" title="docker 常用命令"></a>docker 常用命令</h3><p><code>image</code> 相关命令简介：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 仓库地址：地址的格式一般是 &lt;域名/IP&gt;[:端口号]。默认地址是 Docker Hub。</span></span><br><span class="line"><span class="comment"># 仓库名：两段式名称，即 &lt;用户名&gt;/&lt;软件名&gt;。对于 Docker Hub，如果不给出用户名，则默认为 library，也就是官方镜像。</span></span><br><span class="line"><span class="comment"># 标签： 若没有写标签，默认是 latest</span></span><br><span class="line">$ docker pull [选项] [Docker Registry 地址[:端口号]/]仓库名[:标签]</span><br><span class="line"><span class="comment"># 删除 虚悬镜像 , 虚悬镜像是指仓库名、标签都为 &lt;none&gt; 的镜像。</span></span><br><span class="line">$ docker image prune</span><br><span class="line"><span class="comment"># 删除镜像， 可同时删除多个</span></span><br><span class="line">$ docker rmi imageID/image名称</span><br><span class="line"><span class="comment"># 通过 dockerfile 创建 image ， .表示当前路径</span></span><br><span class="line"><span class="comment"># options一般加上 -t 名称:tag，会给打包好的镜像加上名称和tag </span></span><br><span class="line">$ docker build [options] .</span><br></pre></td></tr></table></figure><p></p><p><code>container</code> 相关命令简介：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动容器，-i -t -d -p 的作用在 上面 container文件 的介绍部分</span></span><br><span class="line">$ docker run -dit -p 80:80 image名</span><br><span class="line"><span class="comment"># 进入容器， -i -t 一起使用时，则可以看到我们熟悉的 Linux 命令提示符。</span></span><br><span class="line">$ docker <span class="built_in">exec</span> -it containerID bash</span><br><span class="line"><span class="comment"># 删除容器，添加 -f 可以删除运行中的容器，可同时删除多个。注意container名不是镜像名</span></span><br><span class="line">$ docker rm containerId/container名</span><br><span class="line"><span class="comment"># 清理所有处于终止状态的容器</span></span><br><span class="line">$ docker container prune</span><br><span class="line"><span class="comment"># 导出本地容器，导出为 xxx.tar</span></span><br><span class="line">$ docker <span class="built_in">export</span> containerId &gt; xxx.tar</span><br><span class="line"><span class="comment"># 导入容器快照为本地镜像</span></span><br><span class="line">$ cat xxx.tar | docker import - image名[:tag]</span><br><span class="line">$ docker load -i xxx.tar</span><br></pre></td></tr></table></figure><p></p><blockquote><p>补充说明</p><ul><li><strong>虚悬镜像</strong> ：假如你原来有一个 mongo:3.2 的镜像，官方发布新版本后，重新 <code>docker pull mongo:3.2</code> , mongo:3.2 的名称就会被转移到新下载的镜像上，而旧的镜像就会成为 <code>&lt;none&gt;</code> 。另外， <code>docker build</code> 也会导致这种现象，产生 虚悬镜像</li></ul></blockquote><p><strong>ok, 本文结束。</strong></p>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[vue动态添加组件]]></title>
      <url>https://jintang.github.io/2018/03/27/vue%E5%8A%A8%E6%80%81%E6%B7%BB%E5%8A%A0%E7%BB%84%E4%BB%B6/</url>
      <content type="html"><![CDATA[<blockquote><p>大多数时候，我们都用单文件.vue文件来实现功能。比如添加一个dialog，代码如下：</p></blockquote><p><code>hello.vue</code><br></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">"showDialog"</span>&gt;</span>显示一个弹框<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dialog</span> <span class="attr">v-if</span>=<span class="string">"dialogFlag"</span>&gt;</span><span class="tag">&lt;/<span class="name">dialog</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">import</span> Dialog <span class="keyword">from</span> <span class="string">'./Dialog.vue'</span>;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="undefined">        data() &#123;</span></span><br><span class="line"><span class="actionscript">            <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="actionscript">                dialogFlag: <span class="literal">false</span></span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">        &#125;,</span></span><br><span class="line"><span class="undefined">        methods: &#123;</span></span><br><span class="line"><span class="undefined">            showDialog() &#123;</span></span><br><span class="line"><span class="actionscript">                <span class="keyword">this</span>.dialogFlag = <span class="literal">true</span></span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">        &#125;,</span></span><br><span class="line"><span class="undefined">        components: &#123; Dialog &#125;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><p>点击按钮即可显示弹框。很简单明了，功能划分也清晰，表示很开心。下面列出动态创建弹框的代码，可以跟上面的比较一下有啥优缺点，在不同的情景下选用不同的方案：<br><a id="more"></a><br><code>hello.vue</code><br></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">"showDialog"</span>&gt;</span>显示一个弹框<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">import</span> Dialog <span class="keyword">from</span> <span class="string">'./Dialog.vue'</span>;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="undefined">        data() &#123;</span></span><br><span class="line"><span class="actionscript">            <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="actionscript">                dialogComp: <span class="literal">null</span></span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">        &#125;,</span></span><br><span class="line"><span class="undefined">        methods: &#123;</span></span><br><span class="line"><span class="undefined">            showDialog() &#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">let</span> dialogClass = Vue.extend(Dialog);</span></span><br><span class="line"><span class="actionscript">                <span class="keyword">this</span>.dialogComp = <span class="keyword">new</span> dialogClass().$mount()</span></span><br><span class="line"><span class="javascript">                <span class="built_in">document</span>.body.appendChild(<span class="keyword">this</span>.vm.$el)</span></span><br><span class="line"><span class="actionscript">                <span class="keyword">this</span>.vm.dialogFlag = <span class="literal">true</span></span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">        &#125;,</span></span><br><span class="line"><span class="undefined">        components: &#123; Dialog &#125;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><p>下面做一些解析：</p><ul><li><p><code>extend()</code>:</p><ul><li><p>参数是一个包含组件选项的对象，此处 <code>Dialog</code> 是 <code>import</code> 的一个单文件组件，其值为：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    data() &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;...&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;...&#125;,</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>引申一下，我们的单文件组件通过<code>import</code>后解析为一个<code>js</code>对象，在添加到<code>components</code>里后才可以按组件使用，内部机制请原谅我没深究…</p></li><li>返回值： 返回一个”子类”，通过<code>console</code>看到结构如下：<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">VueComponent(options) &#123;</span><br><span class="line">    <span class="keyword">this</span>._init(options);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p><code>$mount([elementOrSelector])</code>: 通过<code>new</code>一个”子类”创建了一个<strong>未挂载</strong>的 <code>vue</code> 组件，<code>$mount()</code>用来挂载组件到页面，如果没有提供 elementOrSelector 参数，模板将被渲染为文档之外的的元素，并且你必须使用原生 <code>DOM API</code> 把它插入文档中。如上面的 <code>appendChild()</code> 。返回值是挂载后的 <code>vue</code>组件。</p></li></ul><p><strong>总结：</strong> 各有妙用,嘿嘿</p>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[经常遇到的小算法]]></title>
      <url>https://jintang.github.io/2018/03/21/%E7%BB%8F%E5%B8%B8%E9%81%87%E5%88%B0%E7%9A%84%E5%B0%8F%E7%AE%97%E6%B3%95/</url>
      <content type="html"><![CDATA[<blockquote><p>以此记录经常见到的小算法</p></blockquote><h2 id="求素数"><a href="#求素数" class="headerlink" title="求素数"></a>求素数</h2><p><strong>算法：</strong><a href="https://baike.baidu.com/item/%E5%9F%83%E6%8B%89%E6%89%98%E8%89%B2%E5%B0%BC%E7%AD%9B%E9%80%89%E6%B3%95" target="_blank" rel="noopener">埃氏筛法</a>，简单解释如下：<br>首先，列出从2开始的所有自然数，构造一个序列：</p><blockquote><p>2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, …</p></blockquote><p>取序列的第一个数2，它一定是素数，然后用2把序列的2的倍数筛掉：</p><blockquote><p>3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, …</p></blockquote><p>取新序列的第一个数3，它一定是素数，然后用3把序列的3的倍数筛掉：</p><blockquote><p>5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, …</p></blockquote><p>不断筛下去，这些第一个数的集合就是所有的素数。</p><p>以<code>python</code>代码为例：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">arr = range(<span class="number">2</span>, <span class="number">100</span>) <span class="comment"># 生成2-100的序列</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getPrimeNum</span><span class="params">(arr)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">fil</span><span class="params">(item)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> item % arr[<span class="number">0</span>] != <span class="number">0</span></span><br><span class="line">    result = []    </span><br><span class="line">    <span class="keyword">while</span> len(arr) != <span class="number">0</span>:</span><br><span class="line">        result.append(arr[<span class="number">0</span>])</span><br><span class="line">        arr = list(filter(fil, arr))</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">result = getPrimeNum(arr)</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure><p></p><a id="more"></a>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[nginx反向代理豆瓣接口]]></title>
      <url>https://jintang.github.io/2018/03/05/nginx%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E8%B1%86%E7%93%A3%E6%8E%A5%E5%8F%A3/</url>
      <content type="html"><![CDATA[<blockquote><p><code>nginx</code>是一个<code>web</code>服务器，类似<code>apache</code>。又不仅仅是个服务器，还可以<code>反向代理</code>、<code>负载均衡</code>…很多牛逼的网站都是用了<code>nginx</code>二次开发，比如说大名鼎鼎的 <strong>草榴</strong>。我们普通人可以通过<code>反向代理</code>来转发接口，实现 <strong>跨域</strong>。</p></blockquote><p>不论你是<code>windows</code>还是<code>linux</code>，都可以用下面三个步骤来概括：</p><ol><li>下载安装，<code>windows</code>下不需安装，解压即可</li><li>修改配置：<code>conf/nginx.conf</code></li><li>重启：第一次启动：<code>start nginx</code>；修改配置后重启：<code>nginx -s realod</code><br>然后访问就可以看到结果。</li></ol><p>那么，下面放上其中的重点——<strong>修改配置</strong>：<br></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">server</span> <span class="string">&#123;</span></span><br><span class="line">    <span class="string">listen</span>       <span class="number">80</span><span class="string">;</span></span><br><span class="line">    <span class="string">server_name</span>  <span class="string">localhost;</span></span><br><span class="line"></span><br><span class="line">    <span class="string">location</span> <span class="string">/</span> <span class="string">&#123;</span></span><br><span class="line">        <span class="string">root</span>   <span class="string">html;</span></span><br><span class="line">        <span class="string">index</span>  <span class="string">index.html</span> <span class="string">index.htm;</span></span><br><span class="line">    <span class="string">&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="string">location</span> <span class="string">~</span> <span class="string">/v2/</span> <span class="string">&#123;</span></span><br><span class="line">        <span class="comment"># 反向代理https://api.douban.com</span></span><br><span class="line">        <span class="string">proxy_pass</span> <span class="attr">https://api.douban.com;</span></span><br><span class="line">    <span class="string">&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure><p></p><p>所谓<strong>反向代理</strong>，就是当你访问你的<code>nginx</code>服务器时，会转发到你设置的服务器上。比如上面当你访问<code>localhost</code>时，就转发到 <a href="https://api.douban.com" target="_blank" rel="noopener">https://api.douban.com</a> 上。即你访问<code>localhost</code>相当于访问 <a href="https://api.douban.com" target="_blank" rel="noopener">https://api.douban.com</a> 。</p><p>重启后就可以访问下豆瓣的接口了，比如：<a href="https://api.douban.com/v2/book/1220562" target="_blank" rel="noopener">https://api.douban.com/v2/book/1220562</a> 可以用 <a href="/v2/book/1220562">localhost/v2/book/1220562</a> 访问。<br><a id="more"></a><br><strong>Tip:</strong> <code>nginx</code>默认不支持<code>https</code>，如果要访问 <a href="https://localhost" target="_blank" rel="noopener">https://localhost</a> 来转发接口。需要 <code>https</code>证书，这种证书可以用两种方法获得：</p><ul><li>用<a href="http://slproweb.com/products/Win32OpenSSL.html" target="_blank" rel="noopener">openSSL</a>自己生成一个，这样转发的接口访问时谷歌浏览器会提示<strong>您的连接不是私密连接</strong>，你需要点击：高级——继续前往…就可以了，其他的浏览器类似。具体的做法可以参考<a href="http://www.xymiao.com/archives/769" target="_blank" rel="noopener">这里</a></li><li>买一个认证的证书，可以去阿里云等地方买一个，然后配置和上面差不多。</li></ul>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[谷歌云部署个人网站]]></title>
      <url>https://jintang.github.io/2018/01/24/%E8%B0%B7%E6%AD%8C%E4%BA%91%E9%83%A8%E7%BD%B2%E4%B8%AA%E4%BA%BA%E7%BD%91%E7%AB%99/</url>
      <content type="html"><![CDATA[<blockquote><p>得知谷歌云免费的消息，喜出望外，毕竟阿里云腾讯云这些一年价格也不菲。赶紧申请了一个，想申请的抓紧了。废话不说了，跟我一起在谷歌云上部署一个个人网站吧。</p></blockquote><p>假设你已经拥有了一个谷歌云账号。没有的话赶紧注册一个，需要一个<strong>VISA</strong>的信用卡，其他的都是基本信息填写。</p><h2 id="谷歌云上创建-Compute-Engine-实例"><a href="#谷歌云上创建-Compute-Engine-实例" class="headerlink" title="谷歌云上创建 Compute Engine 实例"></a>谷歌云上创建 Compute Engine 实例</h2><ol><li>点击<a href="https://console.cloud.google.com/compute/instances" target="_blank" rel="noopener">这里</a>进入 <strong>Compute Engine</strong> 页面</li><li>选择 <strong>创建实例</strong><ul><li>地区选<code>asia-east1-c</code>，据说对大陆玩家友好。</li><li>机器类型：我选了 小型(一个共享vCPU) ，我部署的网站很小，所以这个就可以了</li><li>启动磁盘——更改：选择 <code>CentOS7</code>，其他不用变。因为我要用到<code>mongodb</code>，如果选择<code>debian9</code>，<code>mongodb</code>的官网目前还不支持，为了在<code>debian9</code>上安装<code>mongodb</code>，我也是被折磨得很心累。然后果断在同事的建议下果断新建了个<code>CentOS7</code>的<strong>实例</strong>。当然你也可以选择其他的…</li><li>管理、磁盘、网络、SSH密钥：需要改网络部分，如果你之前已经创建了<strong>静态IP</strong>，<strong>外部IP</strong>这一栏就选<code>临时</code>，如果没有创建的话，请选择<code>创建IP地址</code>。</li></ul></li><li>点击创建，结果如下：<br><img src="https://tang-blog-1257996120.cos-website.ap-chengdu.myqcloud.com/google-cloud-vm.png" alt="vm实例"></li></ol><a id="more"></a><h2 id="创建部署的项目"><a href="#创建部署的项目" class="headerlink" title="创建部署的项目"></a>创建部署的项目</h2><p>要在云服务器上部署一个网站，那首先肯定要从本地新建一个了。我选择了一个使用<code>node</code>和<code>mongodb</code>的博客系统，跟着<strong>nswbmw</strong>大神的<a href="https://github.com/nswbmw/N-blog" target="_blank" rel="noopener">N-blog</a>敲一遍，写完之后本地运行成功。感叹一下，大神的这个项目带了多少人走进了<code>node</code>。</p><p>如果不想关注创建项目，这儿就不用花费功夫，在下一步的时候可以直接使用大神的项目部署。</p><h2 id="进入云服务器部署"><a href="#进入云服务器部署" class="headerlink" title="进入云服务器部署"></a>进入云服务器部署</h2><p><strong>vm实例</strong>右侧有个<code>ssh</code>按钮，点击就可以进入到后台。当然我们可以使用其他<code>ssh</code>工具登陆，那个<code>ssh</code>按钮右边有个小三角，点开之后选择<strong>使用其他SSH客户端</strong>，就可以进入教程。</p><p>关于<code>ssh</code>工具的选择，最具代表性的是<strong>putty</strong>，我选择使用<strong>xshell</strong>，因为它是中文版的，我英语不好…而且功能比<strong>putty</strong>强大很多。更多<code>ssh</code>工具的选择，请参考<a href="https://llinmeng.github.io/2015/08/05/windows-ssh-tools-diff/" target="_blank" rel="noopener">这儿</a>。</p><p>废话不多说，<code>ssh</code>登陆后开始下面的步骤：</p><p><em>Tip:</em> 我的系统是<code>centOS7</code>，所以其他的系统会有稍微的区别，主要是包管理器的区别。如果是<code>debian</code>和<code>ubuntu</code>使用<code>apt-get</code>安装。</p><h3 id="安装-Node-js"><a href="#安装-Node-js" class="headerlink" title="安装 Node.js"></a>安装 Node.js</h3><p><strong>方法1： </strong>使用源码安装包安装，你也可以选择其他方式，目前的最新稳定版是<code>8.9.4</code>，以下安装<code>node</code>的版本是<code>8.9.4</code><br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install wget</span><br><span class="line"><span class="comment"># 在官方网站（https://nodejs.org/zh-cn/download/）查看链接并下载源码</span></span><br><span class="line">wget https://nodejs.org/dist/v8.9.4/node-v8.9.4.tar.gz</span><br><span class="line"><span class="comment"># 解压</span></span><br><span class="line">tar xzvf node-v8.9.4.tar.gz</span><br><span class="line"><span class="built_in">cd</span> node-v8.9.4</span><br><span class="line"><span class="comment"># 安装编译环境并编译</span></span><br><span class="line">sudo yum install gcc gcc-c++</span><br><span class="line">./configure</span><br><span class="line">make <span class="comment"># 这一步时间比较长</span></span><br><span class="line"><span class="comment"># 安装node</span></span><br><span class="line">sudo make install</span><br><span class="line"><span class="comment"># 检测安装是否成功，出现版本号就成功了</span></span><br><span class="line">node --version</span><br></pre></td></tr></table></figure><p></p><p><strong>方法2：</strong>官方编译过的二进制数据包安装，更快速和方便<br>在<a href="https://nodejs.org/download/release/" target="_blank" rel="noopener">下载地址</a>选择要下载的版本，还是选择<code>8.9.4</code><br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wget https://nodejs.org/download/release/v8.9.4/node-v8.9.4-linux-x64.tar.gz</span><br><span class="line">sudo tar --strip-components 1 -xzvf node-v8.9.4-linux-x64.tar.gz -C /usr/<span class="built_in">local</span></span><br><span class="line"><span class="comment"># 检测安装是否成功，出现版本号就成功了</span></span><br><span class="line">node --version</span><br></pre></td></tr></table></figure><p></p><h3 id="安装mongodb"><a href="#安装mongodb" class="headerlink" title="安装mongodb"></a>安装mongodb</h3><p>我们安装的<strong>mongodb社区版</strong>，根据<a href="https://docs.mongodb.com/manual/tutorial/install-mongodb-on-red-hat/" target="_blank" rel="noopener">官方链接</a>安装并启动。</p><h3 id="添加项目"><a href="#添加项目" class="headerlink" title="添加项目"></a>添加项目</h3><p>之前我们不是在本地跟着大神写了一个项目，我们可以通过<strong>ftp</strong>将刚刚那个项目上传上来，也可以安装个<code>git</code>直接克隆大神的项目进行部署。我们直接克隆好了，更方便…<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo yum update</span><br><span class="line">sudo yum install git</span><br><span class="line">git <span class="built_in">clone</span> https://github.com/nswbmw/N-blog.git</span><br></pre></td></tr></table></figure><p></p><h3 id="启动项目"><a href="#启动项目" class="headerlink" title="启动项目"></a>启动项目</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> N-blog</span><br><span class="line">npm i</span><br><span class="line">vim config/default.js <span class="comment">#修改端口 3000-&gt;80</span></span><br><span class="line">sudo node index</span><br><span class="line"><span class="comment"># 成功的提示: myblog listening on port 80</span></span><br></pre></td></tr></table></figure><p>如果成功了，那么访问你的<strong>静态ip</strong>这时候已经可以看到项目了。<br>我在最后运行的时候出现了这个问题:<br></p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">node</span> <span class="title">command</span> is undefined</span><br></pre></td></tr></table></figure><p></p><p>因为<code>centOS</code>的安全策略，要运行 <strong>80</strong>端口必须以管理员身份运行，但在管理员身份下却获取不到<code>node</code>命令，解决办法是添加<strong>环境变量</strong>。<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 切换为管理员</span></span><br><span class="line">sudo -i </span><br><span class="line"><span class="comment"># 获取node的位置</span></span><br><span class="line"><span class="built_in">which</span> node <span class="comment"># 我的是在/usr/local/bin/node</span></span><br><span class="line"><span class="comment"># 编辑环境变量</span></span><br><span class="line">vi /etc/profile</span><br><span class="line">    <span class="comment"># 在结尾处添加:</span></span><br><span class="line">    PATH=<span class="variable">$PATH</span>:/usr/<span class="built_in">local</span>/bin/ <span class="comment"># 结尾到bin/就可以了，不是bin/node</span></span><br><span class="line">    <span class="built_in">export</span> PATH</span><br><span class="line">    <span class="comment"># 使环境变量生效</span></span><br><span class="line">    <span class="built_in">source</span> /etc/profile</span><br><span class="line"><span class="comment"># 检测是否生效，包含刚刚添加的表示生效了</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$PATH</span>   </span><br><span class="line">node --version <span class="comment"># 可以正确显示版本号</span></span><br></pre></td></tr></table></figure><p></p><p>经过上面的步骤，项目已经成功的跑了起来，访问<strong>静态ip</strong>已经可以看到项目。但如果关闭终端，我们的项目就又停止了，我们需要<code>pm2</code>作为守护进程启动博客</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm <span class="selector-tag">i</span> pm2 -g</span><br><span class="line">pm2 start index<span class="selector-class">.js</span> --name=<span class="string">"myblog"</span></span><br></pre></td></tr></table></figure><p>关闭终端，访问<strong>静态ip</strong>，我们的项目依旧在运行。</p><h2 id="绑定域名"><a href="#绑定域名" class="headerlink" title="绑定域名"></a>绑定域名</h2><p>我们随便访问一个网站，地址栏里都输入的是域名，而非<code>IP</code>，所以我们也来个域名吧。</p><h3 id="购买域名"><a href="#购买域名" class="headerlink" title="购买域名"></a>购买域名</h3><p>购买域名可以去 <a href="https://wanwang.aliyun.com/" target="_blank" rel="noopener">万网</a>…因为我只是为了玩，所以在<a href="https://www.zzidc.com/main/huodong/doMainActivity/spreadid_138149_hdName_doMainActivity.html" target="_blank" rel="noopener">景安网络</a>买个1年便宜的<code>.top</code>域名。</p><h3 id="域名解析"><a href="#域名解析" class="headerlink" title="域名解析"></a>域名解析</h3><p>进入<strong>域名控制面板</strong>——选择<strong>DNS解析管理</strong>——<strong>添加记录：</strong><br><img src="https://tang-blog-1257996120.cos-website.ap-chengdu.myqcloud.com/google-cloud-host.png" alt="host"><br>我的域名是<code>cloud-tv.top</code>，为了让<code>www.cloud-tv.top</code>也可用，我添加的记录如上图所示，下面解释一下：</p><blockquote><p>主机名这一列表示域名前缀，以<code>cloud-tv.top</code>为例，当值为：</p><ul><li>www：表示 <code>www.cloud-tv.top</code></li><li>留空：表示主域名 <code>cloud-tv.top</code></li><li>*：泛解析，表示匹配其他所有域名 <code>*.cloud-tv.top</code></li></ul></blockquote><ul><li>第一行：A记录，将域名指向ip。所以主机名我<strong>留空</strong>表示主域名，记录值填写ip</li><li>第二行：CNAME记录，增加子域名，指向到已有空间。所以主机名我填写<strong>www</strong>表示<code>www.cloud-tv.top</code>，记录值填写主域名</li></ul><p>当我访问<code>www.cloud-tv.top</code>时，先根据<strong>CNAME记录</strong>指向主域名<code>cloud-tv.top</code>。再根据<code>A记录</code>指向<strong>ip</strong>，这样完成了整个解析过程。</p><h3 id="检测解析完成"><a href="#检测解析完成" class="headerlink" title="检测解析完成"></a>检测解析完成</h3><p>等几分钟一般就解析完了。检测方法：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ping cloud-tv.top</span><br></pre></td></tr></table></figure><p></p><p>当域名后面出现你绑定的<code>ip</code>时说明解析成功。<br>更多域名解析的相关知识请自行百度。</p><p><strong>最后</strong>：访问 <a href="http://cloud-tv.top" target="_blank" rel="noopener">http://cloud-tv.top</a> 或 <a href="http://www.cloud-tv.top" target="_blank" rel="noopener">http://www.cloud-tv.top</a> 就可以看到之前部署的项目了。</p><h2 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h2><p><img src="https://tang-blog-1257996120.cos-website.ap-chengdu.myqcloud.com/google-cloud-cost.png" alt="google-cost"><br>刚心血来潮查看了一下谷歌云的花费，然后算一笔账。第一行是我开的一个微型主机（可供选择里面最小的），用来翻墙，算下来一年的费用是<strong>$78.87</strong>。第二行就是我开的一个比上面一个高一级的主机（也就是可选择主机里排倒数第二），用来部署个人网站，算下来一年的费用是<strong>$481.65</strong>。而且这只是主机运行的费用，不包含流量费。so…谷歌云送的<strong>$300</strong>不够啊…看来我得把两个主机合成一个，用最小型号的那个主机。果然…没钱是多么苦…</p>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[linux学习]]></title>
      <url>https://jintang.github.io/2018/01/23/linux%E5%AD%A6%E4%B9%A0/</url>
      <content type="html"><![CDATA[<blockquote><p>谷歌云有一个免费1年的服务，那就申请一个学习学习啦。对于<code>linux</code>之前只用过<code>ubuntu</code>，装啥环境感觉非常方便。用这篇文章来记录下自己的理解。</p></blockquote><p><code>linux</code>有很多发行的版本，想要了解请看<a href="http://blog.sciencenet.cn/blog-3373182-1089895.html" target="_blank" rel="noopener">这里</a>。我这次使用了其中的<code>centos7</code>和<code>debian9</code>。之前我使用的<code>ubuntu</code>是基于<code>Debian</code>的<code>unstable</code>版本加强而来。</p><h2 id="通用的命令"><a href="#通用的命令" class="headerlink" title="通用的命令"></a>通用的命令</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ lsb_release -a <span class="comment"># 查看 linux 系统版本</span></span><br><span class="line">$ id <span class="comment"># 查看当前用户与其所在的组</span></span><br><span class="line">$ <span class="built_in">which</span> node <span class="comment"># 查看node命令所在地址</span></span><br><span class="line">$ man ps <span class="comment"># 查看ps命令的用法</span></span><br></pre></td></tr></table></figure><p><strong>systemctl</strong>命令：系统管理与服务管理<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl start mysqld <span class="comment"># 启动mysql服务</span></span><br><span class="line">$ sudo systemctl status mysqld <span class="comment"># 查看mysql服务的状态</span></span><br><span class="line"></span><br><span class="line">$ sudo systemctl <span class="built_in">enable</span> mysqld <span class="comment"># mysql单元开机启动</span></span><br><span class="line"><span class="comment"># 查看开启启动项：</span></span><br><span class="line"><span class="comment"># 只显示sysV services，上面的mysqld是不展示的</span></span><br><span class="line">$ chkconfig --list</span><br><span class="line"><span class="comment"># 查看系统服务，其中开机启动的服务状态是enabled，可以看到mysqld</span></span><br><span class="line">$ systemctl list-unit-files</span><br></pre></td></tr></table></figure><p></p><a id="more"></a><h2 id="进程管理"><a href="#进程管理" class="headerlink" title="进程管理"></a>进程管理</h2><p>进程状态：</p><ul><li>R： running or in run queue（在运行队列中等待）</li><li>S： sleeping，可中断的睡眠状态</li><li>D： uninterruptible sleep (usually IO)，不可中断的睡眠状态</li><li>T： traced or stopped，此刻进程是不可中断的</li><li>Z： zombie（僵尸），退出状态，进程成为僵尸进程</li></ul><h3 id="ps"><a href="#ps" class="headerlink" title="ps"></a>ps</h3><p>显示progress status的静态结果。详细参数请点击<a href="http://man.linuxde.net/ps" target="_blank" rel="noopener">这儿</a>。<br><strong>常见用法：</strong><br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 默认只显示运行在当前控制台下的属于当前用户的进程</span></span><br><span class="line">$ ps</span><br><span class="line"><span class="comment"># -a表示所有，加上x会显示所有进程，包括没有控制终端的进程</span></span><br><span class="line">$ ps -ax</span><br><span class="line"><span class="comment"># 查看tang用户下的进程，没有指定用户名时默认为当前用户</span></span><br><span class="line">$ ps -u tang</span><br><span class="line"><span class="comment"># 查看系统中所有用户下所有进程，显示全面信息，常用！</span></span><br><span class="line">$ ps -aux</span><br></pre></td></tr></table></figure><p></p><p><strong>引申用法：</strong><br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 根据 CPU 使用来升序排序</span></span><br><span class="line">$ ps -aux --sort -pcpu</span><br><span class="line"><span class="comment"># 根据 内存使用 来升序排序</span></span><br><span class="line">$ ps -aux --sort -pmem</span><br><span class="line"><span class="comment"># 将上面两个合并到一个命令，并通过管道显示前10个结果</span></span><br><span class="line">$ ps -aux --sort -pcpu,-pmem | head -n 10</span><br><span class="line"><span class="comment"># 根据进程名过滤，如下查找mongod进程</span></span><br><span class="line">$ ps -C mongod</span><br><span class="line"><span class="comment"># 根据PID过滤</span></span><br><span class="line">$ ps -L 1213</span><br><span class="line"><span class="comment"># 显示更多信息加-f</span></span><br><span class="line">$ ps -C mongod -f</span><br></pre></td></tr></table></figure><p></p><p><code>ps -aux</code>显示的结果：<br><img src="https://tang-blog-1257996120.cos-website.ap-chengdu.myqcloud.com/linux_ps_result.png" alt="ps_result"><br><strong>列的含义：</strong></p><ul><li>USER： 账号</li><li>PID： progress id</li><li>%CPU： 占用cpu百分比</li><li>%MEM：占用物理内存百分比</li><li>VSZ：占用虚拟内存(kb)</li><li>RSS：占用固定内存(kb)</li><li>TTY：该 process 是在哪个终端机上面运作，若与终端机无关，则显示 ?，另外， tty1-tty6 是本机上面的登入者程序，若为 pts/0 等等的，则表示为由网络连接进主机的程序。</li><li>STAT：进程状态，参照本节刚开始的说明</li><li>START： 启动时间</li><li>TIME： 运行时间</li><li>COMMAND： 实际指令</li></ul><blockquote><p><strong>Tip：</strong>不可中断，指的并不是CPU不响应外部硬件的中断，而是指进程不响应异步信号：进程收到SIGSTOP, SIGSTP, SIGTIN, SIGTOU信号后停止运行</p></blockquote><h3 id="top"><a href="#top" class="headerlink" title="top"></a>top</h3><p>实时（动态的）显示系统中各个进程的资源占用状况，类似于Windows的任务管理器。<br><strong>使用：</strong><br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ top [参数]</span><br></pre></td></tr></table></figure><p></p><p><strong>参数说明：</strong></p><ul><li>d 指定每两次屏幕信息刷新之间的时间间隔。当然用户可以使用s交互命令来改变之。</li><li>p 通过指定监控进程ID来仅仅监控某个进程的状态。</li><li>q 该选项将使top没有任何延迟的进行刷新。</li><li>c 显示整个命令行而不只是显示命令名</li><li>S 指定累计模式</li><li>s 使top命令在安全模式中运行。这将去除交互命令所带来的潜在危险。</li><li>i 使top不显示任何闲置或者僵死进程。</li></ul><p><strong>结果：</strong><br><img src="https://tang-blog-1257996120.cos-website.ap-chengdu.myqcloud.com/linux-top-result.png" alt="top-result"><br><strong>含义：</strong></p><ol><li>top：<ul><li>08:01:27 当前时间</li><li>up 1 day, 23:14 系统运行时间，格式为时:分</li><li>1 user 当前登录用户数</li><li>load average: 0.00, 0.02, 0.05 系统负载，即任务队列的平均长度。三个数值分别为 1分钟、5分钟、15分钟前到现在的平均值。</li></ul></li><li>Tasks：进程状态，状态说明参考<code>ps</code>指令，不再详述</li><li>%Cpu(s)：cpu 百分比<ul><li>2.0 us 用户空间占用CPU百分比</li><li>4.0 sy 内核空间占用CPU百分比</li><li>0.0 ni 用户进程空间内改变过优先级的进程占用CPU百分比</li><li>94.0 id 空闲CPU百分比</li><li>0.0 wa 等待输入输出的CPU时间百分比</li><li>0.0 hi：硬件CPU中断占用百分比</li><li>0.0 si：软中断占用百分比</li><li>0.0 st：虚拟机占用百分比</li></ul></li><li>KiB Mem：物理内存使用情况，只解释下面一个，其他看单词就可以明白<ul><li>157056 buff/cache 用作内核缓存的内存量</li></ul></li><li>KiB Swap：交换区使用情况</li><li>统计区列的含义：下面没列出来的请参考<code>ps</code>指令。<ul><li>PR：priority。优先级</li><li>NI：nice。负值表示高优先级，正值表示低优先级</li><li>VIRT：进程使用的虚拟内存总量，单位kb。</li><li>RES：进程使用的、未被换出的物理内存大小，单位kb。</li><li>SHR：共享内存大小，单k位b</li><li>S：进程状态，参照本节刚开始的说明</li><li>TIME+：进程使用的CPU时间总计，单位1/100秒</li></ul></li></ol><h2 id="包管理器"><a href="#包管理器" class="headerlink" title="包管理器"></a>包管理器</h2><p><code>centos</code>与<code>debian</code>虽然使用的是不同的软件包管理器，但大体的命令都差不多</p><ul><li><p><code>centos</code>（<code>Redhat</code>系列一样）的包管理方式采用的是基于<code>RPM</code>包的<code>YUM</code>包管理方式，包分发方式是编译好的二进制文件。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">yum</span> <span class="selector-attr">[options]</span> <span class="selector-attr">[command]</span> <span class="selector-attr">[package ...]</span></span><br></pre></td></tr></table></figure><p><strong>options:</strong><code>-h</code>（帮助），<code>-y</code>（安装过程中的提示选择全部为”yes”），<code>-q</code>（不显示安装的过程）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum -y install [package]              下载并安装一个rpm包</span></span><br><span class="line"><span class="comment"># yum localinstall [package.rpm]    安装一个rpm包，使用你自己的软件仓库解决所有依赖关系</span></span><br><span class="line"><span class="comment"># yum -y update                              更新当前系统中安装的所有rpm包</span></span><br><span class="line"><span class="comment"># yum update [package]                 更新一个rpm包</span></span><br><span class="line"><span class="comment"># yum remove [package]                删除一个rpm包</span></span><br><span class="line"><span class="comment"># yum list                            列出当前系统中安装的所有包</span></span><br><span class="line"><span class="comment"># yum search [package]                 在rpm仓库中搜寻软件包</span></span><br><span class="line"><span class="comment"># yum clean [package]                   清除缓存目录（/var/cache/yum）下的软件包</span></span><br><span class="line"><span class="comment"># yum clean headers                      删除所有头文件</span></span><br><span class="line"><span class="comment"># yum clean all                                删除所有缓存的包和头文件</span></span><br></pre></td></tr></table></figure></li><li><p><code>Debian</code>最具特色的是<code>apt-get / dpkg</code>包管理方式，包分发方式是编译好的二进制文件。其实<code>Redhat</code>的<code>YUM</code>也是在模仿<code>Debian</code>的<code>APT</code>方式，但是<code>YUM</code>可供选择的包比较少。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">用法：</span><br><span class="line"> apt-get [选项] 命令  </span><br><span class="line"> apt-get [选项] install pkg1 [pkg2 ...]  </span><br><span class="line">命令：  </span><br><span class="line"> update - 重新获取软件包列表  </span><br><span class="line"> upgrade - 进行更新  </span><br><span class="line"> install - 安装新的软件包  </span><br><span class="line"> remove - 移除软件包  </span><br><span class="line"> autoremove - 自动移除全部不使用的软件包  </span><br><span class="line"> purge - 移除软件包和配置文件  </span><br><span class="line"> <span class="built_in">source</span> - 下载源码档案  </span><br><span class="line"> build-dep - 为源码包配置编译依赖  </span><br><span class="line"> dist-upgrade - 发行版升级, 参见 apt-get(8)  </span><br><span class="line"> dselect-upgrade - 依照 dselect 的选择更新  </span><br><span class="line"> clean - 清除下载的归档文件  </span><br><span class="line"> autoclean - 清除旧的的已下载的归档文件  </span><br><span class="line"> check - 检验是否有损坏的依赖  </span><br><span class="line">  </span><br><span class="line">选项：  </span><br><span class="line"> -h 本帮助文件。  </span><br><span class="line"> -q 输出到日志 - 无进展指示  </span><br><span class="line"> -qq 不输出信息，错误除外  </span><br><span class="line"> -d 仅下载 - 不安装或解压归档文件  </span><br><span class="line"> -s 不实际安装。模拟执行命令  </span><br><span class="line"> -y 假定对所有的询问选是，不提示  </span><br><span class="line"> -f 尝试修正系统依赖损坏处  </span><br><span class="line"> -m 如果归档无法定位，尝试继续  </span><br><span class="line"> -u 同时显示更新软件包的列表  </span><br><span class="line"> -b 获取源码包后编译  </span><br><span class="line"> -V 显示详细的版本号  </span><br><span class="line"> -c=? 阅读此配置文件  </span><br><span class="line"> -o=? 设置自定的配置选项，如 -o dir::cache=/tmp</span><br></pre></td></tr></table></figure></li></ul>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[debounce与throttle]]></title>
      <url>https://jintang.github.io/2017/12/23/debounce%E4%B8%8Ethrottle/</url>
      <content type="html"><![CDATA[<ul><li><a href="https://css-tricks.com/debouncing-throttling-explained-examples/" target="_blank" rel="noopener">David Corbacho’s article</a></li><li><a href="https://lodash.com/docs/4.17.4#debounce" target="_blank" rel="noopener">官方文档</a></li></ul><blockquote><p>在<code>lodash</code>的方法里，有两个比较有趣的方法：<code>debounce</code>与<code>throttle</code>，这两个方法是用来限制连续事件的触发频率的。具体的使用请查看<a href="https://lodash.com/docs/4.17.4#debounce" target="_blank" rel="noopener">官方文档</a>。</p></blockquote><h2 id="debounce-防抖"><a href="#debounce-防抖" class="headerlink" title="debounce: 防抖"></a>debounce: 防抖</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">_.debounce(func, [wait=<span class="number">0</span>], [options=&#123;</span><br><span class="line">    leading: <span class="literal">false</span>,</span><br><span class="line">    maxWait: <span class="built_in">Number</span>,</span><br><span class="line">    trailing: <span class="literal">true</span></span><br><span class="line">&#125;])</span><br></pre></td></tr></table></figure><p><strong>作用：</strong>连续触发的事件，如果一直在触发，没有中途暂停且暂停时间超过<code>wait</code>,那么这些事件会合并为一次，直到暂停时间超过<code>wait</code>时执行。然后判断下一轮…直到事件最后一次触发。<br><strong>使用：</strong><br><code>debounce()</code>接受一些配置参数，返回一个 <em>new debounced function</em>，这个对象拥有<code>cancel</code>、<code>flush</code>方法，这两个方法都不咋用，就看看配置参数就行了。<br>默认的效果图：<br><img src="https://tang-blog-1257996120.cos-website.ap-chengdu.myqcloud.com/debounce.webp" alt="debounce默认效果图"><br>使用<code>leading</code>属性的效果图：<br><img src="https://tang-blog-1257996120.cos-website.ap-chengdu.myqcloud.com/debounce-leading.webp" alt="debounce使用leading属性的效果图"><br>所以，当设置<code>leading:true, trailing: false</code>时会在<code>wait</code>时间段的开始触发合并后的事件。</p><a id="more"></a><p><em>注意：</em><code>leading: true,trailing: true</code>时同默认情况<br>自己尝试一下,鼠标在<em>trigger area</em>上不停的动:</p><div style="min-width:900px;transform:translateX(-50%);margin-left:50%;margin-bottom:-85px"><br><p data-height="360" data-theme-id="0" data-slug-hash="GZWqNV" data-default-tab="result" data-user="dcorb" data-embed-version="2" data-pen-title="Debounce. Leading" class="codepen">See the Pen <a href="https://codepen.io/dcorb/pen/GZWqNV/" target="_blank" rel="noopener">Debounce. Leading</a> by Corbacho (<a href="https://codepen.io/dcorb" target="_blank" rel="noopener">@dcorb</a>) on <a href="https://codepen.io" target="_blank" rel="noopener">CodePen</a>.</p><br><script async src="https://production-assets.codepen.io/assets/embed/ei.js"></script><br></div><p>还有一个<code>maxWait</code>属性，请查看<strong>区别</strong>这一部分。<br><em>注意：</em><br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// WRONG</span></span><br><span class="line">$(<span class="built_in">window</span>).on(<span class="string">'scroll'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">   _.debounce(doSomething, <span class="number">300</span>); </span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// RIGHT</span></span><br><span class="line">$(<span class="built_in">window</span>).on(<span class="string">'scroll'</span>, _.debounce(doSomething, <span class="number">200</span>));</span><br></pre></td></tr></table></figure><p></p><p><strong>使用场景：</strong></p><ul><li><code>scroll</code>、<code>resize</code>、<code>输入验证</code>这种连续触发的事件，触发时运行某些代码，大多数时候你可能不需要每次事件都要运行这些代码。比如<code>input</code>输入时验证</li><li>有个新增弹框，为了防止快速点击两次确定按钮提交两次接口，可以使用<code>debounce</code></li></ul><h2 id="throttle：节流"><a href="#throttle：节流" class="headerlink" title="throttle：节流"></a>throttle：节流</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">_.throttle(func, [wait=<span class="number">0</span>], [options=&#123;</span><br><span class="line">    leading: <span class="literal">true</span>,</span><br><span class="line">    trailing: <span class="literal">true</span></span><br><span class="line">&#125;])</span><br></pre></td></tr></table></figure><p><strong>作用：</strong>连续触发的事件，如果一直在触发，不论有没有中途暂停,<code>wait</code>时间段里的事件会被合并为一次。<br><strong>使用：</strong><br>参数少了个<code>maxWait</code>，其他的不论是参数还是返回值和<code>debounce</code>都一样。<br>自己尝试一下，无限滚动：</p><div style="min-width:900px;transform:translateX(-50%);margin-left:50%;margin-bottom:-85px"><br><p data-height="500" data-theme-id="0" data-slug-hash="eJLMxa" data-default-tab="result" data-user="dcorb" data-embed-version="2" data-pen-title="Infinite scrolling throttled" class="codepen">See the Pen <a href="https://codepen.io/dcorb/pen/eJLMxa/" target="_blank" rel="noopener">Infinite scrolling throttled</a> by Corbacho (<a href="https://codepen.io/dcorb" target="_blank" rel="noopener">@dcorb</a>) on <a href="https://codepen.io" target="_blank" rel="noopener">CodePen</a>.</p><br><script async src="https://production-assets.codepen.io/assets/embed/ei.js"></script><br></div><p><strong>使用场景：</strong></p><ul><li><code>scroll</code>无限滚动翻页，此时不能用<code>debounce</code>，因为一直连续触发，只要你没有中间暂停时间超过<code>wait</code>，那你滚动的那么多事件都会合并为一次。此时用<code>throttle</code>,连续触发的事件在每<code>wait</code>事件内触发的多次会合并为一次，还是可以连续触发，只不过频率降低了</li></ul><h2 id="区别"><a href="#区别" class="headerlink" title="区别"></a>区别</h2><p>这两个方法非常相似，都降低了触发频率，只有一点细微的差别：<br><code>throttle</code>方法其实是加了<code>maxWait</code>选项的<code>debounce</code>方法，<code>lodash</code>的源码中就可以看到。<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">throttle</span>(<span class="params">func, wait, options</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> leading = <span class="literal">true</span>,</span><br><span class="line">      trailing = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> func != <span class="string">'function'</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(FUNC_ERROR_TEXT);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (isObject(options)) &#123;</span><br><span class="line">    leading = <span class="string">'leading'</span> <span class="keyword">in</span> options ? !!options.leading : leading;</span><br><span class="line">    trailing = <span class="string">'trailing'</span> <span class="keyword">in</span> options ? !!options.trailing : trailing;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> debounce(func, wait, &#123;</span><br><span class="line">    <span class="string">'leading'</span>: leading,</span><br><span class="line">    <span class="string">'maxWait'</span>: wait,</span><br><span class="line">    <span class="string">'trailing'</span>: trailing</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p><strong>结语：</strong><br>大神David Corbacho说建议直接使用<code>lodash</code>或<code>underscore</code>的这两个方法。这里放下源码的地址：<a href="https://github.com/lodash/lodash/blob/master/debounce.js" target="_blank" rel="noopener">debounce</a>,利用的是<code>setTimeout</code>方法实现这种效果。</p>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[vue静态资源放在src/assets与static目录下的区别]]></title>
      <url>https://jintang.github.io/2017/11/03/vue%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E6%94%BE%E5%9C%A8src-assets%E4%B8%8Estatic%E7%9B%AE%E5%BD%95%E4%B8%8B%E7%9A%84%E5%8C%BA%E5%88%AB/</url>
      <content type="html"><![CDATA[<blockquote><ul><li><a href="http://vuejs-templates.github.io/webpack/static.html" target="_blank" rel="noopener">官方链接</a></li><li><a href="https://segmentfault.com/q/1010000009842688" target="_blank" rel="noopener">翻译链接</a></li></ul></blockquote><h2 id="官方解释"><a href="#官方解释" class="headerlink" title="官方解释"></a>官方解释</h2><h3 id="Assets"><a href="#Assets" class="headerlink" title="Assets"></a>Assets</h3><p>为了回答这个问题，我们首先需要了解Webpack如何处理静态资产。在 <code>*.vue</code>组件中，所有模板和CSS都会被 <code>vue-html-loader</code> 及 <code>css-loader</code> 解析，并查找资源URL。例如，在 <code>&lt;img src=&quot;./logo.png&quot;&gt; 和 background: url(./logo.png)</code> 中，<code>&quot;./logo.png&quot;</code>是相对的资源路径，将由<strong>Webpack</strong>解析为模块依赖。</p><p>因为 <code>logo.png</code> 不是 JavaScript，当被视为模块依赖时，需要使用 <code>url-loader</code> 和 <code>file-loader</code>处理它。vue-cli 的 webpack 脚手架已经配置了这些 loader，因此可以使用相对/模块路径。</p><p>由于这些资源可能在构建过程中被内联/复制/重命名，所以它们基本上是源代码的一部分。这就是为什么建议将Webpack 处理的静态资源放在 <code>/src</code> 目录中和其它源文件放一起的原因。事实上，甚至不必把它们全部放在 <code>/src/assets</code>：可以用<code>模块/组件</code>的组织方式来使用它们。例如，可以在每个放置组件的目录中存放静态资源。<br><a id="more"></a></p><h3 id="Static"><a href="#Static" class="headerlink" title="Static"></a>Static</h3><p>相比之下，<code>static/</code> 目录下的文件并不会被 Webpack 处理：它们会直接被复制到最终目录（默认是<code>dist/static</code>）下。必须使用绝对路径引用这些文件，这是通过在 <code>config.js</code> 文件中的 <code>build.assetsPublicPath</code> 和 <code>build.assetsSubDirectory</code> 连接来确定的。</p><p>任何放在 <code>static/</code> 中文件需要以绝对路径的形式引用：<code>/static/[filename]</code>。如果更改 <code>assetSubDirectory</code> 的值为 <code>assets</code>，那么路径需改为 <code>/assets/[filename]</code>。</p><h2 id="使用区别"><a href="#使用区别" class="headerlink" title="使用区别"></a>使用区别</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">img</span> <span class="attr">:src</span>=<span class="string">"filterIcon(item.pollingState)"</span> <span class="attr">alt</span>=<span class="string">""</span> <span class="attr">class</span>=<span class="string">"pollingIcon"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="undefined">        methods: &#123;</span></span><br><span class="line"><span class="undefined">            filterIcon(val) &#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">let</span> commonUrl = <span class="string">'../../../../static/images/assetpolling/'</span>;</span></span><br><span class="line"><span class="actionscript">                <span class="keyword">if</span> (val === <span class="number">1</span>) &#123;</span></span><br><span class="line"><span class="actionscript">                  <span class="keyword">return</span> commonUrl + <span class="string">'pollingSuccess.png'</span>;</span></span><br><span class="line"><span class="actionscript">                &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="actionscript">                  <span class="keyword">return</span> commonUrl + <span class="string">'pollingLoading.gif'</span>;</span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="undefined">              &#125;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>如果<code>src</code>的值是一个变量，放在<code>staic</code>下能访问到图片，放在<code>assets</code>下访问不到。如果是一个字符串常量，<code>static</code>和<code>assets</code>下都可以访问到。</p><p><strong>分析：</strong>官方说，在 <code>*.vue</code>组件中，所有模板和CSS都会被 <code>vue-html-loader</code> 及 <code>css-loader</code> 解析，并查找资源URL。所以对应的资源如果是个字符串常量，在<strong>编译期</strong>就已经被解析为<code>Base64</code>与代码融合为一体。而如果<code>src</code>对应的是个变量，只有在<strong>运行期</strong>才会被解析，这时候就访问不到<code>assets</code>目录下的资源了。</p><p><strong>结论:</strong>当资源对应的是变量时，资源放在<code>static</code>下。第三方的类库的资源也放在<code>static</code>下。其他时候个人感觉相同。</p><p><em>tip: 如果有不对的地方请留言</em></p>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[各种环境下使用es6]]></title>
      <url>https://jintang.github.io/2017/09/28/%E5%90%84%E7%A7%8D%E7%8E%AF%E5%A2%83%E4%B8%8B%E4%BD%BF%E7%94%A8es6/</url>
      <content type="html"><![CDATA[<blockquote><p>不讲为什么使用es6，只讲es6如何在各种环境下使用。目前浏览器…环境都不支持es6，所以我们需要<a href="http://babeljs.cn/" target="_blank" rel="noopener">babel</a></p></blockquote><h2 id="浏览器中使用"><a href="#浏览器中使用" class="headerlink" title="浏览器中使用"></a>浏览器中使用</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"node_modules/babel-core/browser.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/babel"</span>&gt;</span><span class="actionscript"> <span class="comment">// 注意type</span></span></span><br><span class="line"><span class="actionscript"><span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span></span><br><span class="line"><span class="undefined">  test() &#123;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="string">"test"</span>);</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="actionscript"><span class="keyword">var</span> test = <span class="keyword">new</span> Test;</span></span><br><span class="line"><span class="actionscript">test.test(); <span class="comment">// "test"</span></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>Note:</strong><code>Babel</code>可以用于浏览器环境,但是从<code>Babel 6.0</code>开始，不再直接提供浏览器版本，而是要用构建工具构建出来。所以，我们只是做简单的<code>html</code>时，又不想使用构建工具，可以通过<code>安装5.x版本的babel-core模块获取</code>。<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install babel-core@5</span><br></pre></td></tr></table></figure><p></p><a id="more"></a><h2 id="命令行转换使用"><a href="#命令行转换使用" class="headerlink" title="命令行转换使用"></a>命令行转换使用</h2><p>我们创建了一个用<code>es6</code>写的js文件，想要运行，但是不想使用构建工具,可以使用<code>babel</code>提供的命令行工具。</p><ol><li><p>安装命令行工具:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install babel-cli -g // 全局安装</span><br></pre></td></tr></table></figure></li><li><p>配置编译规则</p><ul><li><p>添加<code>babel</code>用来转换的依赖包</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ES2015转码规则</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> npm install --save-dev babel-preset-es2015</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ES7不同阶段语法提案的转码规则（共有4个阶段），选装一个</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> npm install --save-dev babel-preset-stage-0</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> npm install --save-dev babel-preset-stage-1</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> npm install --save-dev babel-preset-stage-2</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> npm install --save-dev babel-preset-stage-3</span></span><br></pre></td></tr></table></figure></li><li><p>在根目录下创建<code>.babelrc</code>文件并添加配置:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 只是为了演示添加的简单配置</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"presets"</span>: [</span><br><span class="line">    <span class="string">"es2015"</span>,</span><br><span class="line">    <span class="string">"stage-2"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="string">"plugins"</span>: []</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>使用：<br>放个<a href="http://babeljs.cn/docs/usage/cli/" target="_blank" rel="noopener">官方链接</a>，懒得写了。<br>因为我不想让<code>babel</code>编译了之后重新生成个文件，所以我一般用<code>babel-node</code>命令测试：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">babel-node 文件名</span><br></pre></td></tr></table></figure><p>即可在命令行看到结果。</p></li></ol><h2 id="构建工具中使用"><a href="#构建工具中使用" class="headerlink" title="构建工具中使用"></a>构建工具中使用</h2><p>…未完待续</p>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[vue中遇到的坑]]></title>
      <url>https://jintang.github.io/2017/05/17/vue%E4%B8%AD%E9%81%87%E5%88%B0%E7%9A%84%E5%9D%91/</url>
      <content type="html"><![CDATA[<blockquote><p>仅以此记录 vue 中遇到的坑</p></blockquote><h3 id="组件的复用问题"><a href="#组件的复用问题" class="headerlink" title="组件的复用问题"></a>组件的复用问题</h3><blockquote><p><code>Vue</code>的虚拟DOM中，<code>Vue</code>会使用一种最大限度减少动态元素并且尽可能的尝试修复/再利用相同类型元素的算法。</p></blockquote><p><em>然后我遇到了这样的bug：</em>同事做了一个<code>scrollbar</code>的组件,我用在了<code>steps</code>组件中，用了多个。在点击<strong>下一步</strong>的时候当前<code>step</code>下的组件会销毁，我特意加了<code>v-if</code>，下一个<code>step</code>下的组件会创建，问题来了…上一步的<code>scrollbar</code>组件影响到了当前创建下的<code>scrollbar</code>组件。</p><p><em>原因：</em><code>Vue</code>的算法会尝试复用组件</p><p><strong>解决方案：</strong>使用<code>key</code>，它会基于<code>key</code>的变化重新排列元素顺序，并且会移除<code>key</code>不存在的元素。加了<code>key</code>之后，就会重新渲染，而不是复用了。<br>代码：<br></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"stepContent"</span> <span class="attr">key</span>=<span class="string">"1"</span> <span class="attr">v-else-if</span>=<span class="string">"currentStep == 1"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">s-scrollbar</span> <span class="attr">wrap-class</span>=<span class="string">"scrollheight"</span>&gt;</span></span><br><span class="line">      ...</span><br><span class="line">    <span class="tag">&lt;/<span class="name">s-scrollbar</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"stepContent"</span> <span class="attr">key</span>=<span class="string">"2"</span> <span class="attr">v-else-if</span>=<span class="string">"currentStep == 2"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">s-scrollbar</span> <span class="attr">wrap-class</span>=<span class="string">"scrollheight"</span>&gt;</span></span><br><span class="line">      ...</span><br><span class="line">    <span class="tag">&lt;/<span class="name">s-scrollbar</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><p><em>结语：</em>我想大多数玩家和我一样，都是在<code>v-for</code>里用到了<code>key</code>，我虽然用到了，但是没有真正理解它，所以才会碰到这个bug不知道原因，还傻乎乎的去看组件的源码，浪费了很长时间。理解最值得重视…</p><p>最后附上：<a href="https://cn.vuejs.org/v2/api/#key" target="_blank" rel="noopener">key的官方介绍</a><br><a id="more"></a></p><h3 id="数据的拷贝和动态组件产生的bug"><a href="#数据的拷贝和动态组件产生的bug" class="headerlink" title="数据的拷贝和动态组件产生的bug"></a>数据的拷贝和动态组件产生的bug</h3><blockquote><p>自己用<code>element</code>的<code>input</code>和<code>tree</code>合成了一个<code>inputTree</code>组件</p></blockquote><p>想使用动态组件来生成不同的表单，代码如下：<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&lt;component :is=&quot;getDynamicComp(item)&quot; v-for=&quot;(item,index) in list&quot; :key=&quot;index&quot;&gt;&lt;/component&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">    data() &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">            list: [</span><br><span class="line">                &#123;</span><br><span class="line">                    htmlType: &apos;udf_char_single_line&apos;,</span><br><span class="line">                    value: &apos;&apos;</span><br><span class="line">                &#125;,&#123;</span><br><span class="line">                    htmlType: &apos;udf_char_list&apos;,</span><br><span class="line">                    value: &apos;&apos;,</span><br><span class="line">                    listvalues: [</span><br><span class="line">                        &#123;value：1&#125;,</span><br><span class="line">                        &#123;value：2&#125;</span><br><span class="line">                    ]</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">        getDynamicComp(item) &#123;</span><br><span class="line">            let dynamicComp = &#123;</span><br><span class="line">              data() &#123;</span><br><span class="line">                return &#123;</span><br><span class="line">                  item: item</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;,</span><br><span class="line">              template: &apos;&apos;</span><br><span class="line">            &#125;;</span><br><span class="line">            if (item.htmlType === &apos;udf_char_single_line&apos;) &#123;</span><br><span class="line">              dynamicComp.template = `&lt;s-input v-model=&quot;$&#123;item.value&#125;&quot;&gt;&lt;/s-input&gt;`;</span><br><span class="line">            &#125; else if (item.htmlType === &apos;udf_char_list&apos;) &#123;</span><br><span class="line">              dynamicComp.template = &apos;&lt;s-select v-model=&quot;item.value&quot;&gt;&apos; +</span><br><span class="line">                  &apos;&lt;s-option v-for=&quot;(option,index) in item.listvalues&quot; :key=&quot;index&quot; :value=&quot;option.value&quot;&gt;&lt;/s-option&gt;&apos; +</span><br><span class="line">                &apos;&lt;/s-select&gt;&apos;;</span><br><span class="line">            &#125;</span><br><span class="line">            return dynamicComp;</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p><strong>结果：</strong><code>input</code>和<code>select</code>都生成了，但是改变不了数据<br><strong>原因:</strong>改变<code>input</code>和<code>select</code>的值时，<code>list</code>数组会变化，这个<code>list</code>其实还在我另外一个组件中使用，另外一个组件监听了这个<code>list</code>的变化,由此<code>getDynamicComp()</code>重新计算，然后重新生成动态组件，动态组件里面的<code>input</code>、<code>select</code>又恢复到了初始渲染状态,所以改变数据无效</p><p><strong>最后:</strong>提供对象浅拷贝和深拷贝的方法</p><ol><li><p><strong>浅拷贝：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span>.assign(&#123;&#125;, obj)</span><br></pre></td></tr></table></figure></li><li><p><strong>深拷贝：</strong> 参考 <a href="https://smalldata.tech/blog/2018/11/01/copying-objects-in-javascript" target="_blank" rel="noopener">这儿</a></p><ul><li><p><strong>将对象序列化为字符串，然后将其反序列化</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">JSON</span>.parse(<span class="built_in">JSON</span>.stringify(obj))</span><br></pre></td></tr></table></figure><p>非常简单，但是有两个常见的错误:</p><ul><li>如果属性是不可序列化值类型，结果并不是期盼的值。比如 函数会被忽略， <code>Date</code> 类型会被 <code>JSON.parse()</code> 解释为字符串</li><li>如果有循环引用会报错</li></ul><p><code>JSON.stringify()</code>拥有三个参数(参考<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify" target="_blank" rel="noopener">官方描述</a>)，第一个错误可以用下面的代码修复：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">JSON</span>.parse(<span class="built_in">JSON</span>.stringify(json, <span class="function"><span class="keyword">function</span>(<span class="params">key,val</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">typeof</span> val==<span class="string">'function'</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> val+<span class="string">''</span><span class="comment">//手动将其字符串化</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> val;</span><br><span class="line">    &#125;</span><br><span class="line">),<span class="function"><span class="keyword">function</span>(<span class="params">key,val</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(val.indexOf&amp;&amp;val.indexOf(<span class="string">'function'</span>) !== <span class="number">-1</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">eval</span>(<span class="string">"(function()&#123;return "</span>+val+<span class="string">" &#125;)()"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> val;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>第二个错误只能望而叹之。</p></li><li><p><strong>递归拷贝：</strong><br>可以使用<code>lodash</code>的<code>_.cloneDeep(obj)</code>方法,通过学习这个库，咱们可以简单实现这样的一个方法：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">cloneDeep</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(value <span class="keyword">instanceof</span> <span class="built_in">Object</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> result;</span><br><span class="line">        <span class="keyword">if</span>(value.constructor === <span class="built_in">Object</span>) &#123; <span class="comment">// 对象</span></span><br><span class="line">            result  = &#123;&#125;;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">in</span> value) &#123;</span><br><span class="line">                result[i] = cloneDeep(value[i]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (value.constructor === <span class="built_in">Array</span>) &#123; <span class="comment">// 数组</span></span><br><span class="line">            result  = [];</span><br><span class="line">            value.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">item, index</span>) </span>&#123;</span><br><span class="line">                result[index] = cloneDeep(item);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (value.constructor === <span class="built_in">Function</span>) &#123; <span class="comment">// 函数</span></span><br><span class="line">            <span class="comment">// 方式1</span></span><br><span class="line">            result = <span class="keyword">new</span> <span class="built_in">Function</span>(<span class="string">"return "</span> + value.toString())();</span><br><span class="line">            <span class="comment">// 方式2</span></span><br><span class="line">            result = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> value.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (value <span class="keyword">instanceof</span> <span class="built_in">Date</span>) &#123; <span class="comment">// new Date() 时间对象</span></span><br><span class="line">            result = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">            result.setTime(result.getTime());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; <span class="comment">// new String...的instanceof Object也为true，这个直接赋值，</span></span><br><span class="line">            result = value;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>里面对于循环引用没做处理，因为对<code>lodash</code>的封装的<code>Stack</code>还不是很明白…</p></li></ul></li></ol>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[es6常用语法]]></title>
      <url>https://jintang.github.io/2017/04/20/es6%E5%B8%B8%E7%94%A8%E8%AF%AD%E6%B3%95/</url>
      <content type="html"><![CDATA[<h3 id="…"><a href="#…" class="headerlink" title="…"></a>…</h3><p>含义：</p><p><strong>1.</strong> 函数中的剩余参数<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">pick</span>(<span class="params">object, ...keys</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> result = <span class="built_in">Object</span>.create(<span class="literal">null</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, len = keys.length; i &lt; len; i++) &#123;</span><br><span class="line">        result[keys[i]] = object[keys[i]];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p><code>keys</code> 是一个包含所有在 <code>object</code> 之后的参数的剩余参数（这与包含所有参数的 <code>arguments</code> 不同，后者会连第一个参数都包含在内）</p><p><strong>2.</strong> 数组的扩展运算: 将一个数组分割，返回分离的各个项<br>在<code>vuex</code>中的辅助函数中常有这样的用法，如下:<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; mapGetters &#125; <span class="keyword">from</span> <span class="string">'vuex'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  computed: &#123;</span><br><span class="line">  <span class="comment">// 使用对象展开运算符将 getters 混入 computed 对象中</span></span><br><span class="line">    ...mapGetters([</span><br><span class="line">      <span class="string">'doneTodosCount'</span>,</span><br><span class="line">      <span class="string">'anotherGetter'</span>,</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">    ])</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>作用是将<code>mapGetters</code>返回的数组分割开来放到了<code>computed</code>属性里<br>还有这样一个例子：<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> values = [<span class="number">25</span>, <span class="number">50</span>, <span class="number">75</span>, <span class="number">100</span>]</span><br><span class="line"><span class="comment">// 等价于 console.log(Math.max(25, 50, 75, 100, 120));</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Math</span>.max(...values, <span class="number">120</span>)); <span class="comment">// 120</span></span><br></pre></td></tr></table></figure><p></p><p><strong>3.</strong> 对象的扩展运算：属于es7的内容<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> &#123; x, y, ...z &#125; = &#123; <span class="attr">x</span>: <span class="number">1</span>, <span class="attr">y</span>: <span class="number">2</span>, <span class="attr">a</span>: <span class="number">3</span>, <span class="attr">b</span>: <span class="number">4</span> &#125;;</span><br><span class="line">x; <span class="comment">// 1</span></span><br><span class="line">y; <span class="comment">// 2</span></span><br><span class="line">z; <span class="comment">// &#123; a: 3, b: 4 &#125;</span></span><br><span class="line"><span class="comment">// 分隔符---------------------------</span></span><br><span class="line"><span class="keyword">let</span> n = &#123; x, y, ...z &#125;;</span><br><span class="line">n; <span class="comment">// &#123; x: 1, y: 2, a: 3, b: 4 &#125;</span></span><br></pre></td></tr></table></figure><p></p><a id="more"></a><h3 id="export与import"><a href="#export与import" class="headerlink" title="export与import"></a>export与import</h3><ul><li><p>命名导出: 对导出多个值很有用。在导入期间，必须使用相应对象的相同名称</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// module "modules.js"</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">cube</span>(<span class="params">x</span>) </span>&#123;&#125;</span><br><span class="line"><span class="keyword">const</span> foo = <span class="built_in">Math</span>.PI + <span class="built_in">Math</span>.SQRT2;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">var</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">export</span> &#123; cube,foo &#125;;</span><br><span class="line"><span class="comment">// 导入时：</span></span><br><span class="line"><span class="keyword">import</span> &#123; cube, foo, a &#125; <span class="keyword">from</span> <span class="string">'modules.js'</span>;</span><br></pre></td></tr></table></figure></li><li><p>默认导出: 可以使用任何名称导入默认导出,且一个模块只能有一个默认的导出</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// module "modules.js"</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> k = <span class="number">12</span>;</span><br><span class="line"><span class="comment">// 导入时：</span></span><br><span class="line"><span class="keyword">import</span> x <span class="keyword">from</span> <span class="string">'modules.js'</span>;</span><br></pre></td></tr></table></figure></li></ul><p><strong>注意：</strong>不能直接使用<code>var</code>，<code>let</code>或<code>const</code>作为默认导出<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> a;　　<span class="comment">// 正确,可以用这种方式</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">var</span> a = <span class="number">1</span>; <span class="comment">// 错误</span></span><br></pre></td></tr></table></figure><p></p><p><strong>原因：</strong><code>export</code>后面需要跟变量声明或者大括号作为输出，而<code>export default</code>命令其实只是输出一个叫做<code>default</code>的变量，所以它后面不能跟变量声明语句。<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// modules.js</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x * y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> add;</span><br><span class="line"><span class="comment">// 等同于 export &#123;add as default&#125;;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// app.js</span></span><br><span class="line"><span class="keyword">import</span> xxx <span class="keyword">from</span> <span class="string">'modules'</span>;</span><br><span class="line"><span class="comment">// 等同于 import &#123; default as xxx &#125; from 'modules.js';</span></span><br></pre></td></tr></table></figure><p></p><p><strong>综合用法：</strong><br>一些成熟的框架都是这样导入的：<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br></pre></td></tr></table></figure><p></p><p>下面就是我们的实例：<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// modules.js</span></span><br><span class="line"><span class="keyword">export</span> add() &#123;&#125;</span><br><span class="line"><span class="keyword">export</span> reduce() &#123;&#125;</span><br><span class="line"><span class="keyword">const</span> calcObj = &#123;add, reduce&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> calcObj;</span><br><span class="line"><span class="comment">// 导入时:</span></span><br><span class="line"><span class="keyword">import</span> calcObj, &#123;add, reduce&#125; <span class="keyword">from</span> <span class="string">'modules.js'</span></span><br></pre></td></tr></table></figure><p></p><h3 id="Generator-函数"><a href="#Generator-函数" class="headerlink" title="Generator  函数"></a>Generator 函数</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">fun</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">'a'</span>;</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">'b'</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'c'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 该函数并不执行返回的值，也不是函数运行结果，</span></span><br><span class="line"><span class="comment">*  而是一个指向内部状态的指针对象：遍历器对象*/</span></span><br><span class="line"><span class="keyword">var</span> funIte = fun(); </span><br><span class="line"></span><br><span class="line"><span class="comment">/* 每次调用next方法，内部指针就从上一次停下来的地方</span></span><br><span class="line"><span class="comment">开始执行，直到遇到下一个yield语句（或return语句）为止*/</span></span><br><span class="line">funIte.next(); <span class="comment">// &#123;value: 'a', done: false&#125;</span></span><br><span class="line">funIte.next(); <span class="comment">// &#123;value: 'b', done: false&#125;</span></span><br><span class="line">funIte.next(); <span class="comment">// &#123;value: 'c', done: true&#125;</span></span><br><span class="line">funIte.next(); <span class="comment">// &#123;value: undefined, done: true&#125;</span></span><br></pre></td></tr></table></figure><p>这种函数有两个特征：</p><ul><li>function关键字后紧跟<code>*</code></li><li>函数内部用<code>yield</code>语句。yield意思是<em>产出</em></li></ul>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[vue自定义树组件s-tree]]></title>
      <url>https://jintang.github.io/2017/04/18/vue%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A0%91%E7%BB%84%E4%BB%B6s-tree/</url>
      <content type="html"><![CDATA[<blockquote><p>本组件是基于<code>Vue2</code>的自定义tree组件，参考了<a href="https://github.com/weibangtuo/vue-tree" target="_blank" rel="noopener">weibangtuo</a>的实现，实现了以下功能:</p></blockquote><ul><li>节点单击钩子函数与选中效果</li><li>树节点默认的增删改</li></ul><h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><h4 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h4><p><strong>1.</strong>基础使用：给<code>s-tree</code>组件传递<code>tree-data</code>即可,<code>treeData</code>中单个节点的数据结构:<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  name: <span class="string">'Node Name'</span>,</span><br><span class="line">  title: <span class="string">'Node Tag title attr'</span>,</span><br><span class="line">  isParent: <span class="literal">true</span>, <span class="comment">// Requested for parent node</span></span><br><span class="line">  isOpen: <span class="literal">false</span>, <span class="comment">//  Control node to fold or unfold</span></span><br><span class="line">  icon: <span class="string">'fa fa-folder'</span>, <span class="comment">// Icon class name</span></span><br><span class="line">  openedIcon: <span class="string">'fa fa-folder-open'</span>, <span class="comment">// 节点打开时的icon样式</span></span><br><span class="line">  closedIcon: <span class="string">'fa fa-folder'</span>, <span class="comment">// 节点折叠时的icon样式</span></span><br><span class="line">  children: [], </span><br><span class="line">  buttons: [ </span><br><span class="line">    &#123;</span><br><span class="line">      title: <span class="string">'icon button tag title attr'</span>, <span class="comment">//[opt]</span></span><br><span class="line">      icon: <span class="string">'fa fa-edit'</span>,</span><br><span class="line">      click: <span class="function"><span class="keyword">function</span> (<span class="params">node</span>) </span>&#123; </span><br><span class="line">          <span class="comment">// 自定义事件</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>本例所使用的<a href="https://github.com/jintangWang/hello-vue/blob/master/src/components/my/tree/tree.json" target="_blank" rel="noopener">json数据</a><br><strong>2.</strong>节点单击事件：监听<code>node-click</code>,此方法接受了<code>node</code>参数(点击的节点对象)<br><strong>3.</strong>节点后的按钮事件: <code>buttons</code>下<code>click</code>的值可以是自定义方法，也可以默认方法，默认有<code>addNode</code>、<code>delNode</code>、<code>editNode</code>字符串<br></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"tree-demo"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">s-tree</span> <span class="attr">:tree-data</span> = <span class="string">"treeData"</span> @<span class="attr">node-click</span>=<span class="string">"nodeClick"</span>&gt;</span><span class="tag">&lt;/<span class="name">s-tree</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> sTree <span class="keyword">from</span> <span class="string">"src/common/component/tree"</span>;</span></span><br><span class="line"><span class="javascript"><span class="keyword">let</span> treeData =  <span class="built_in">require</span>(<span class="string">"./tree.json"</span>);</span></span><br><span class="line"><span class="actionscript"><span class="comment">//自定义事件</span></span></span><br><span class="line"><span class="actionscript">treeData[<span class="number">0</span>].children[<span class="number">1</span>].buttons[<span class="number">0</span>].click=<span class="function"><span class="keyword">function</span><span class="params">(node)</span></span>&#123;</span></span><br><span class="line"><span class="actionscript">    alert(<span class="string">'自定义添加事件'</span>);</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="undefined">    data()&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="undefined">            treeData: treeData</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">    &#125;,</span></span><br><span class="line"><span class="undefined">    components:&#123;</span></span><br><span class="line"><span class="undefined">        sTree</span></span><br><span class="line"><span class="undefined">    &#125;,</span></span><br><span class="line"><span class="undefined">    methods:&#123;</span></span><br><span class="line"><span class="undefined">        nodeClick(node)&#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(node);</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><a id="more"></a><h4 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h4><p><img src="https://tang-blog-1257996120.cos-website.ap-chengdu.myqcloud.com/vue_tree.png" alt="s-tree"></p><h3 id="组件原理"><a href="#组件原理" class="headerlink" title="组件原理"></a>组件原理</h3><p>下面是一部分需要注意的地方讲解，其他的请查看底部的源代码链接</p><h4 id="使用递归组件"><a href="#使用递归组件" class="headerlink" title="使用递归组件"></a>使用递归组件</h4><p>因为不确定树有多少层，所以必须得使用递归组件，递归组件最重要的是什么时候跳出递归,本例使用了如下条件：<br><em>tree.vue</em><br></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"s-tree"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">s-tree-item</span> <span class="attr">v-for</span>=<span class="string">"node in innerTreeData"</span> <span class="attr">:key</span>=<span class="string">"node.name"</span> </span></span><br><span class="line"><span class="tag">            <span class="attr">:node</span>=<span class="string">"node"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">s-tree</span> <span class="attr">v-if</span>=<span class="string">"node.isOpen &amp;&amp; node.children"</span> <span class="attr">:tree-data</span>=<span class="string">"node.children"</span>&gt;</span><span class="tag">&lt;/<span class="name">s-tree</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">s-tree-item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><h4 id="node-click事件实现"><a href="#node-click事件实现" class="headerlink" title="node-click事件实现"></a>node-click事件实现</h4><p>由于组件是递归的，无法直接<code>$emit</code>事件给外部钩子函数，所以循环获取到了最外层的<code>s-tree</code>vue实例，通过此实例<code>$emit</code>事件暴漏给外部钩子函数<br><em>tree-item.vue</em>:<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    methods:&#123;</span><br><span class="line">        nodeClick()&#123;</span><br><span class="line">            <span class="keyword">let</span> _this = <span class="keyword">this</span>;</span><br><span class="line">            <span class="keyword">while</span>(isNotTree(_this.$parent))&#123;</span><br><span class="line">                _this = _this.$parent;</span><br><span class="line">            &#125;</span><br><span class="line">            _this.$emit(<span class="string">'node-click'</span>,<span class="keyword">this</span>.node);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isNotTree</span>(<span class="params">vm</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> classStr = vm.$el.className;</span><br><span class="line">    <span class="keyword">if</span>(classStr.indexOf(<span class="string">'s-tree'</span>)!==<span class="number">-1</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h4 id="单击节点选中效果实现"><a href="#单击节点选中效果实现" class="headerlink" title="单击节点选中效果实现"></a>单击节点选中效果实现</h4><p><code>s-tree-item</code>如果是单个循环的组件，不是递归的，那么直接在外层的<code>s-tree</code>创建变量储存选中的值，在<code>s-tree-item</code>内部与该值判断来实现选中效果就可以了，但是递归组件中<code>s-tree</code>也可能生成了多个，所以这个值不能储存在<code>s-tree</code>里，只能储存在一个单例里，这儿我使用了<code>事件中心</code>，代码如下:<br><em>tree-item.vue</em>:<br></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"s-tree-item"</span> @<span class="attr">click.stop</span>=<span class="string">"nodeClick"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">i</span> <span class="attr">:class</span>=<span class="string">"[statusIconClass]"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">:class</span>=<span class="string">"&#123;'is-active': activeValue === node.name&#125;"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">i</span>  <span class="attr">:class</span>=<span class="string">"[node.icon,nodeIconClass]"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">            &#123;&#123;node.name&#125;&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">i</span> <span class="attr">v-if</span>=<span class="string">"node.buttons"</span> <span class="attr">v-for</span>=<span class="string">"button in node.buttons"</span> <span class="attr">class</span>=<span class="string">"iButton"</span> </span></span><br><span class="line"><span class="tag">                <span class="attr">:class</span>=<span class="string">"[button.icon]"</span> </span></span><br><span class="line"><span class="tag">                <span class="attr">:title</span>=<span class="string">"button.title"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">import</span> Bus <span class="keyword">from</span> <span class="string">'./bus.vue'</span>;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="undefined">        computed:&#123;</span></span><br><span class="line"><span class="undefined">            activeValue()&#123;</span></span><br><span class="line"><span class="actionscript">                <span class="keyword">return</span> Bus.activeValue;</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">        &#125;,</span></span><br><span class="line"><span class="undefined">        methods:&#123;</span></span><br><span class="line"><span class="undefined">            nodeClick()&#123;</span></span><br><span class="line"><span class="actionscript">                Bus.$emit(<span class="string">'active'</span>,<span class="keyword">this</span>.node.name);</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><p><em>bus.vue</em>:<br></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">   <span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span>;</span></span><br><span class="line"><span class="javascript">   <span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="actionscript">       name: <span class="string">'bus'</span>,</span></span><br><span class="line"><span class="undefined">       data()&#123;</span></span><br><span class="line"><span class="actionscript">           <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="actionscript">               activeValue: <span class="string">''</span></span></span><br><span class="line"><span class="undefined">           &#125;</span></span><br><span class="line"><span class="undefined">       &#125;,</span></span><br><span class="line"><span class="undefined">       created()&#123;</span></span><br><span class="line"><span class="actionscript">           <span class="keyword">this</span>.$on(<span class="string">'active'</span>,<span class="keyword">this</span>.active);</span></span><br><span class="line"><span class="undefined">       &#125;,</span></span><br><span class="line"><span class="undefined">       methods:&#123;</span></span><br><span class="line"><span class="undefined">           active(value)&#123;</span></span><br><span class="line"><span class="actionscript">               <span class="keyword">this</span>.activeValue = value;</span></span><br><span class="line"><span class="undefined">           &#125;</span></span><br><span class="line"><span class="undefined">       &#125;</span></span><br><span class="line"><span class="undefined">   &#125;);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><p>对了，这儿使用<a href="https://vuex.vuejs.org/zh-cn/" target="_blank" rel="noopener">vuex</a>也是可以的。</p><h3 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h3><ul><li><a href="https://github.com/jintangWang/hello-vue/tree/master/src/common/component/tree" target="_blank" rel="noopener">源代码</a></li><li><a href="https://jintangwang.github.io/hello-vue/#/my/tree-demo" target="_blank" rel="noopener">实例</a></li></ul>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[vue中上传照片生成带图片的二维码]]></title>
      <url>https://jintang.github.io/2017/04/13/vue%E4%B8%AD%E4%B8%8A%E4%BC%A0%E7%85%A7%E7%89%87%E7%94%9F%E6%88%90%E5%B8%A6%E5%9B%BE%E7%89%87%E7%9A%84%E4%BA%8C%E7%BB%B4%E7%A0%81/</url>
      <content type="html"><![CDATA[<p>本例使用了：</p><ul><li><a href="https://github.com/kciter/qart.js" target="_blank" rel="noopener">qart.js</a>：Generate artistic QR code</li><li><a href="http://javascript.ruanyifeng.com/htmlapi/canvas.html#toc5" target="_blank" rel="noopener">canvas</a></li></ul><h3 id="上传照片"><a href="#上传照片" class="headerlink" title="上传照片"></a>上传照片</h3><p>利用<code>&lt;input type=&quot;file&quot;&gt;</code>的<code>change</code>事件<br>html部分:<br></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> @<span class="attr">change</span>=<span class="string">"fileChange"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">:src</span>=<span class="string">"originImg"</span> <span class="attr">alt</span>=<span class="string">"origin"</span> &gt;</span></span><br></pre></td></tr></table></figure><p></p><p>js部分:<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> QArt <span class="keyword">from</span> <span class="string">'qartjs'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    methods:&#123;</span><br><span class="line">        fileChange(event)&#123;</span><br><span class="line">            <span class="keyword">let</span> files = event.target.files;</span><br><span class="line">            <span class="keyword">let</span> file = files[<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">if</span>(!file.type.match(<span class="string">'image.*'</span>))&#123;</span><br><span class="line">                alert(<span class="string">'请选择照片'</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">let</span> reader = <span class="keyword">new</span> FileReader();</span><br><span class="line">            reader.readAsDataURL(file);</span><br><span class="line">            reader.onload = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">this</span>.generateQRcode(reader.result);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        generateQRcode(base64Img)&#123;</span><br><span class="line">            <span class="keyword">this</span>.originImg = base64Img;</span><br><span class="line">            <span class="keyword">new</span> QArt(&#123;</span><br><span class="line">              value: <span class="string">'www.baidu.com'</span>,</span><br><span class="line">              imagePath: base64Img,</span><br><span class="line">              filter: <span class="string">'color'</span>,</span><br><span class="line">              size: <span class="number">195</span></span><br><span class="line">            &#125;).make(<span class="keyword">this</span>.$refs.result);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><a id="more"></a><h3 id="下载二维码"><a href="#下载二维码" class="headerlink" title="下载二维码"></a>下载二维码</h3><p>利用<code>canvas</code>生成图片，让现代浏览器直接输出<code>image/octet-stream</code>实现图片自动弹出下载功能<br>html部分：<br></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"resultImg"</span> <span class="attr">ref</span>=<span class="string">"result"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">"primary"</span> @<span class="attr">click</span>=<span class="string">"download"</span>&gt;</span>下载二维码<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><p>js部分：<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    methods:&#123;</span><br><span class="line">        download()&#123;</span><br><span class="line">            <span class="keyword">let</span> resultCanvas = <span class="keyword">this</span>.$refs.result.children[<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">let</span> type = <span class="string">"image/png"</span>;</span><br><span class="line">            <span class="keyword">let</span> image = resultCanvas.toDataURL(type).replace(type, <span class="string">"image/octet-stream"</span>);</span><br><span class="line">            <span class="built_in">window</span>.location.href = image;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h5 id="最后附上demo和源代码："><a href="#最后附上demo和源代码：" class="headerlink" title="最后附上demo和源代码："></a>最后附上demo和源代码：</h5><p><strong><a href="https://jintangwang.github.io/hello-vue/#/comment" target="_blank" rel="noopener">demo</a></strong><br><strong><a href="https://github.com/jintangWang/hello-vue/blob/master/src/components/comment/comment.vue" target="_blank" rel="noopener">源代码</a></strong></p>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[vue中封装使用markdown并语法高亮]]></title>
      <url>https://jintang.github.io/2017/03/22/vue%E4%B8%AD%E5%B0%81%E8%A3%85%E4%BD%BF%E7%94%A8markdown%E5%B9%B6%E8%AF%AD%E6%B3%95%E9%AB%98%E4%BA%AE/</url>
      <content type="html"><![CDATA[<blockquote><p>最近学习Vue2.0，感觉很有意思，给大家分享一个在<code>vue</code>项目中写<code>markdown</code>的方法。国际惯例,先附上一些链接。</p></blockquote><ul><li><a href="https://github.com/chjj/marked" target="_blank" rel="noopener">marked</a>：A full-featured markdown parser and compiler, written in JavaScript.</li><li><a href="https://github.com/isagalaev/highlight.js/" target="_blank" rel="noopener">highlight.js</a>:Javascript syntax highlighter</li><li><a href="http://cn.vuejs.org/v2/guide/custom-directive.html" target="_blank" rel="noopener">vue自定义指令</a></li></ul><h3 id="安装依赖包"><a href="#安装依赖包" class="headerlink" title="安装依赖包"></a>安装依赖包</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install -S marked</span><br><span class="line">npm install -S highlight.js</span><br></pre></td></tr></table></figure><h3 id="vue中注册自定义指令"><a href="#vue中注册自定义指令" class="headerlink" title="vue中注册自定义指令"></a>vue中注册自定义指令</h3><p><code>main.js</code>:<br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> Marked <span class="keyword">from</span> <span class="string">'./common/directive/marked.js'</span></span><br><span class="line">Vue.use(Marked);</span><br></pre></td></tr></table></figure><p></p><p><strong>ps:</strong><code>Vue.use()</code>会自动调用参数文件里的<code>install()</code><br><a id="more"></a><br><code>marked.js</code>:<br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> marked <span class="keyword">from</span> <span class="string">'marked'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'highlight.js/styles/monokai-sublime.css'</span>;<span class="comment">//这个样式有多种类型可选择</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">marked.setOptions(&#123;</span><br><span class="line">  renderer: <span class="keyword">new</span> marked.Renderer(),</span><br><span class="line">  gfm: <span class="literal">true</span>,</span><br><span class="line">  tables: <span class="literal">true</span>,</span><br><span class="line">  breaks: <span class="literal">false</span>,</span><br><span class="line">  pedantic: <span class="literal">false</span>,</span><br><span class="line">  sanitize: <span class="literal">false</span>,</span><br><span class="line">  smartLists: <span class="literal">true</span>,</span><br><span class="line">  smartypants: <span class="literal">false</span>,</span><br><span class="line">  highlight: <span class="function"><span class="keyword">function</span> (<span class="params">code</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">require</span>(<span class="string">'highlight.js'</span>).highlightAuto(code).value;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> install = <span class="function"><span class="keyword">function</span>(<span class="params">Vue</span>)</span>&#123;</span><br><span class="line">    <span class="comment">/* istanbul ignore if */</span></span><br><span class="line">    <span class="keyword">if</span> (install.installed) <span class="keyword">return</span>;</span><br><span class="line">    Vue.directive(<span class="string">'marked'</span>,&#123;</span><br><span class="line">      <span class="comment">//注意，这儿得使用bind钩子函数，因为我们使用此指令主要是为了写文档，</span></span><br><span class="line">      <span class="comment">//文档里不会有变量且一次性生成,而update在自定义指令所在模板变化时就会重新执行，</span></span><br><span class="line">      <span class="comment">//会影响渲染文档的方法，所以不能使用update钩子，也不能使用函数简写</span></span><br><span class="line">      bind:<span class="function"><span class="keyword">function</span>(<span class="params">el,binding,vnode</span>)</span>&#123;</span><br><span class="line">        el.innerHTML = marked(el.innerText);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> install;</span><br></pre></td></tr></table></figure><p></p><h3 id="使用自定义指令-v-marked"><a href="#使用自定义指令-v-marked" class="headerlink" title="使用自定义指令:v-marked"></a>使用自定义指令:<code>v-marked</code></h3><p>里面的缩进和空格也是<code>markdown</code>语法的一部分<br><img src="https://tang-blog-1257996120.cos-website.ap-chengdu.myqcloud.com/vue_mark.png" alt="vue mark"><br><strong>结果：</strong><br><img src="https://tang-blog-1257996120.cos-website.ap-chengdu.myqcloud.com/vue_mark_result.png" alt="vue mark result"></p><p><strong>ps:</strong><br>代码语法高亮的样式可以有多种选择:<br><img src="https://tang-blog-1257996120.cos-website.ap-chengdu.myqcloud.com/highlight.png" alt="highlight style"></p><h3 id="vue自定义指令相关知识"><a href="#vue自定义指令相关知识" class="headerlink" title="vue自定义指令相关知识"></a><code>vue</code>自定义指令相关知识</h3><h5 id="钩子函数"><a href="#钩子函数" class="headerlink" title="钩子函数"></a>钩子函数</h5><p>指令定义函数提供了几个钩子函数（可选）：</p><ul><li><code>bind</code>: 只调用一次，指令第一次绑定到元素时调用，用这个钩子函数可以定义一个在绑定时执行一次的初始化动作。</li><li><code>inserted</code>: 被绑定元素插入父节点时调用（父节点存在即可调用，不必存在于 document 中）。</li><li><code>update</code>: 被绑定元素所在的模板更新时调用，而不论绑定值是否变化。通过比较更新前后的绑定值，可以忽略不必要的模板更新（详细的钩子函数参数见下）。</li><li><code>componentUpdated</code>: 被绑定元素所在模板完成一次更新周期时调用。</li><li><code>unbind</code>: 只调用一次， 指令与元素解绑时调用。</li></ul><h5 id="钩子函数的参数"><a href="#钩子函数的参数" class="headerlink" title="钩子函数的参数"></a>钩子函数的参数</h5><ul><li><strong>el</strong>: 指令所绑定的元素，可以用来直接操作 <code>DOM</code> 。</li><li><strong>binding</strong>: 一个对象，包含以下属性：<ul><li><strong>name</strong>: 指令名，不包括 <code>v-</code> 前缀。</li><li><strong>value</strong>: 指令的绑定值， 例如： <code>v-my-directive=&quot;1 + 1&quot;</code>, <code>value</code> 的值是 2。</li><li><strong>oldValue</strong>: 指令绑定的前一个值，仅在 <code>update</code> 和 <code>componentUpdated</code> 钩子中可用。无论值是否改变都可用。</li><li><strong>expression</strong>: 绑定值的字符串形式。 例如 <code>v-my-directive=&quot;1 + 1&quot;</code> ， expression 的值是 <code>&quot;1 + 1&quot;</code>。</li><li><strong>arg</strong>: 传给指令的参数。例如 <code>v-my-directive:foo， arg</code> 的值是 <code>&quot;foo&quot;</code>。</li><li><strong>modifiers</strong>: 一个包含修饰符的对象。 例如： <code>v-my-directive.foo.bar</code>, 修饰符对象 <code>modifiers</code> 的值是 <code>{ foo: true, bar: true }</code>。</li></ul></li><li><strong>vnode</strong>: <code>Vue</code> 编译生成的虚拟节点，查阅 <code>VNode API</code> 了解更多详情。</li><li><strong>oldVnode</strong>: 上一个虚拟节点，仅在 <code>update</code> 和 <code>componentUpdated</code> 钩子中可用。</li></ul><h5 id="函数简写"><a href="#函数简写" class="headerlink" title="函数简写"></a>函数简写</h5><p>大多数情况下，我们可能想在 <code>bind</code> 和 <code>update</code> 钩子上做重复动作，并且不想关心其它的钩子函数。可以这样写:<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//首先bind的时候执行一次，再多次执行update</span></span><br><span class="line">Vue.directive(<span class="string">'color-swatch'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">el, binding</span>) </span>&#123;</span><br><span class="line">  el.style.backgroundColor = binding.value</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p></p><blockquote><ul><li><strong><a href="https://jintangwang.github.io/hello-vue/dist/#/my" target="_blank" rel="noopener">我的demo</a></strong></li><li><strong><a href="https://github.com/jintangWang/hello-vue" target="_blank" rel="noopener">源代码</a></strong></li></ul></blockquote>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[小疑问]]></title>
      <url>https://jintang.github.io/2017/01/19/%E5%B0%8F%E7%96%91%E9%97%AE/</url>
      <content type="html"><![CDATA[<blockquote><p>记录一些闪过的疑问,有解决方法更好喽</p></blockquote><h3 id="获取数组中某一项的index"><a href="#获取数组中某一项的index" class="headerlink" title="获取数组中某一项的index?"></a>获取数组中某一项的index?</h3><ul><li><p><code>item</code>为<code>直接值</code>,如：数组、字符串等。这种很好获取index</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">myArr.indexOf(item);</span><br></pre></td></tr></table></figure></li><li><p>系列节点：获取<code>ul</code>中某一<code>li</code>的下标,这种多个变幻，不过还是很方便:<br>假如点击了当前<code>li</code>:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Array</span>.indexOf().call(<span class="keyword">this</span>.parentNode.childNodes,<span class="keyword">this</span>);</span><br></pre></td></tr></table></figure></li><li><p><code>item</code>为对象时，如何获取？有没有很方便的方法？现在我用的常规方法：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getIndexOfArray</span>(<span class="params">arr,item</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(item)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, l = arr.length; i &lt; l; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(arr[i].uuid == item.uuid)&#123;</span><br><span class="line">                <span class="keyword">return</span> i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="如何判断一个节点上是否绑定了事件"><a href="#如何判断一个节点上是否绑定了事件" class="headerlink" title="如何判断一个节点上是否绑定了事件?"></a>如何判断一个节点上是否绑定了事件?</h3><p>网上流传的<code>$(elem).data(&quot;events&quot;)[type]</code>不起作用，谁有好办法吗？</p>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[小棋童]]></title>
      <url>https://jintang.github.io/2016/12/02/%E5%B0%8F%E6%A3%8B%E7%AB%A5/</url>
      <content type="html"><![CDATA[<p><img src="https://tang-blog-1257996120.cos-website.ap-chengdu.myqcloud.com/xiaoqitong.jpg" alt="小棋童"></p><a id="more"></a><div style="width:330px;margin:0 auto"><br><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="http://music.163.com/outchain/player?type=2&id=409649814&auto=1&height=66"></iframe><br></div><blockquote class="pullquote lrc"><p>大牛且慢 咱 再来一盘 手谈<br>昨夜受风寒 不是我脚在软<br>麻雀咿呀乱 叫得人心很烦<br>东头二狗也观战 笑我一般<br>大路且漫漫 咱 先走几步看看</p><p>低头不见抬头看 拿人手短<br>李家镇的碗 春花小妹的发簪<br>有朝一日定叫你 统统归还</p><p>听说古人犯难 总爱拍遍栏杆<br>词人失恋心烦 总爱睡杨柳岸<br>我娘说 一旦我难过 我都会添很多 的饭<br>那个今晚 我已吃了十几碗<br>不知怎么办 不知怎么那个办<br>观 房梁望穿 这星河瀚翰</p><p>扳呐扳扳扳扳<br>上路扳完下路拆三 手段<br>他举棋 又不定<br>抓耳挠腮擦汗</p><p>断呐断断断断<br>黑蛟断首白龙收官 怒斩<br>斜阳里春家小妹 别起发簪<br>她眉眼弯弯</p><p>算呐算算算算<br>人活几世能打几番 算盘<br>有何贪 有何婪<br>打水偏用竹篮</p><p>换呐换换换换<br>冰糖葫芦一钱换 一串<br>送春花 能啵一下 啦啦啦啦啦<br>啦啦啦啦</p><p>春花：你是怎么赢的大牛？<br>施小夏：……嗯……看天上的星星。<br>春花：你骗人。<br>施小夏：……吃糖葫芦吗？<br>春花：不吃！<br>施小夏：你不吃……那我可就吃啦。<br>春花：你敢！<br>施小夏：发簪我都赢回来了，怎么还这么凶……</p><p>大爹且慢 咱 先缓一缓 再谈<br>京城的棋院 家要往南边搬<br>牛弟哭得惨 见我要翻座山<br>二狗兄长倒心宽 夸不简单<br>大道且漫漫 咱 一步一步走完</p><p>宛如那棋谱 总得一步步参<br>书谱竟然叹 两处有情方可断<br>小小棋童又不安 惶惶不安</p><p>听说京城恶歹 总逮棋童来贩<br>沿街黑店客栈 睡一晚要十万<br>我娘猜 就算我被卖 也会吃穷他们 的饭<br>自打今晚 我吃不下小半碗<br>不知怎么瞒 爹娘骗不过怎么办<br>望 秋水望穿 这秋水潺潺<br>翻呐翻翻翻翻</p><p>我翻篱笆再淌河滩 河湾<br>月光满 夜色晚<br>悄悄呼朋引伴</p><p>拦呐拦拦拦拦<br>远处火把爹娘在喊 定庵<br>我只能一步一望春家姑娘<br>她深情款款</p><p>关呐关关关关<br>人活几世也算不完 机关<br>况且我只是在<br>十九道里周转</p><p>拆呐拆拆拆拆<br>岁月拆开 西村南门外<br>老树槐 年轮几载 哎呀呀呀呀<br>哎呀呀呀</p></blockquote>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[戏言]]></title>
      <url>https://jintang.github.io/2016/12/01/%E6%88%8F%E8%A8%80/</url>
      <content type="html"><![CDATA[<p><img src="https://tang-blog-1257996120.cos-website.ap-chengdu.myqcloud.com/xiyan.jpg" alt="戏言"></p><a id="more"></a><p></p><div style="width:330px;margin:0 auto"><p></p><p><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="http://music.163.com/outchain/player?type=2&id=28793806&auto=1&height=66"></iframe><br></p></div><br><blockquote class="pullquote lrc"><p>作曲 : 神居谣<br>作词 : 五子<br>戏中言 莫当真<br>字传神 也不过 撇竖横<br>一纸情分</p><p>谭惜言写了一辈子的戏，真情假意，全在戏言里，<br>借着他的口，唱给自己听。<br>薄云淡月谢酒 檀板暗悄收<br>斜影栏杆处 趁醉吟 轻旋走<br>未必胭脂粉扣 素颜挑水袖<br>戏中情意切 只借作 他人口<br>此一折 伴弦歌<br>可有闻者泪渐落<br>台前戏言怎知写书人心事不可说<br>幕起 一帘隔<br>开场情字婉转可为我<br>笙琴不需多<br>开场说的是画舫初见，谭惜言用了三十二个字，<br>每个字都亲口教给他，声声入耳。<br>泼陈墨潦新愁 故人旧时候<br>浮生哪个敢说一世再无求<br>卷角戏本且留 浅字深描勾<br>依稀写过同枝比翼恋某某<br>那一折 曾为我<br>辗转青衣扮婀娜<br>嬉笑戏言也该是脱口把玩笑开过<br>身起 一世隔<br>散场仍有人在琢磨<br>尾句留白不留墨<br>戏书难如你 我又弹一曲<br>提笔弄句<br>勘几页 血字泣<br>潭勾冷月 一笔画潭勾冷月<br>堪觅我徒留心<br>梦里路陌雾深<br>此一折 伴弦歌<br>可有闻者泪渐落<br>台前戏言怎知写书人心事不可说<br>幕起 一帘隔<br>开场情字婉转可为我<br>笙琴不需多<br>那一折 曾为我<br>辗转青衣扮婀娜<br>嬉笑戏言也该是脱口把玩笑开过<br>身起 一世隔<br>散场仍有人在琢磨<br>尾句留白不留墨</p><p>谭惜言写的每一页戏词他都妥善保存着。<br>虽然他不知这些戏词是写给谁的，<br>但也按着对方的遗愿，<br>每年上坟的时候，给他烧一页，唱一段。</p></blockquote><p></p>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[优化hexo之next主题]]></title>
      <url>https://jintang.github.io/2016/12/01/%E4%BC%98%E5%8C%96hexo%E4%B9%8Bnext%E4%B8%BB%E9%A2%98/</url>
      <content type="html"><![CDATA[<blockquote><p><a href="http://theme-next.iissnan.com/" target="_blank" rel="noopener">next</a>主题是一款黑白色的主题，简单大方，时间久了难免有点厌烦。于是自己遍想做点优化和美化,让它色彩缤纷些。下面的方法也适用于其他主题</p></blockquote><h3 id="样式方面"><a href="#样式方面" class="headerlink" title="样式方面"></a>样式方面</h3><p><a href="http://notes.iissnan.com/" target="_blank" rel="noopener">官方默认样式</a>对比<a href="http://jintang.github.io/">我的主题样式</a></p><ul><li><code>next/source/css/_custom/custom.styl</code>:这里面写自定义样式，浏览器中<code>f12</code>调试，看哪儿不好看，直接写在此文件中覆盖。我的自定义样式：<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">// Custom styles.</span><br><span class="line"><span class="selector-pseudo">::selection</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#3399FF</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">a</span> &#123;</span><br><span class="line">    <span class="attribute">border-bottom</span>: none;</span><br><span class="line">&#125;</span><br><span class="line">article a, .about-page a&#123; // about页面下也用此样式</span><br><span class="line">	color: $my-link-color;</span><br><span class="line">	&amp;<span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">	    <span class="attribute">color</span>: $my-link-hover-color;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.posts-expand</span> <span class="selector-class">.post-body</span> <span class="selector-tag">ul</span> <span class="selector-tag">li</span>&#123;</span><br><span class="line">	<span class="attribute">list-style</span>: disc;</span><br><span class="line">&#125;</span><br><span class="line">//最近访客</span><br><span class="line"><span class="selector-id">#ds-recent-visitors</span> <span class="selector-class">.ds-avatar</span>&#123;</span><br><span class="line">	<span class="attribute">float</span>:left;</span><br><span class="line">&#125;</span><br><span class="line">//最新评论</span><br><span class="line"><span class="selector-class">.ds-recent-comments</span>&#123;</span><br><span class="line">	<span class="attribute">padding-left</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">//打赏样式</span><br><span class="line"><span class="selector-id">#wechat</span> <span class="selector-tag">p</span>&#123;</span><br><span class="line">	<span class="attribute">margin-top</span>:-<span class="number">16px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#alipay</span>&#123;</span><br><span class="line">	<span class="attribute">vertical-align</span>:top;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.lrc</span>&#123;</span><br><span class="line">	<span class="attribute">width</span>:<span class="number">100%</span>;</span><br><span class="line">	<span class="attribute">text-align</span>:center;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.tip</span>&#123;</span><br><span class="line">	<span class="attribute">color</span>: <span class="number">#DF0101</span>;</span><br><span class="line">	<span class="attribute">font-weight</span>:bold;</span><br><span class="line">&#125;</span><br><span class="line">// 行内代码</span><br><span class="line">$code-block &#123;</span><br><span class="line">  <span class="selector-tag">overflow</span>: <span class="selector-tag">auto</span>;</span><br><span class="line">  <span class="selector-tag">margin</span>: 20<span class="selector-tag">px</span> 0;</span><br><span class="line">  <span class="selector-tag">padding</span>: 15<span class="selector-tag">px</span>;</span><br><span class="line">  font-size : $code-font-size;</span><br><span class="line">  color: $highlight-foreground;</span><br><span class="line">  background: $my-highlight-background;</span><br><span class="line">  border:1px solid $my-highlight-border;</span><br><span class="line">  line-height: $line-height-code-block;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">code</span> &#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">2px</span> <span class="number">4px</span>;</span><br><span class="line">  <span class="attribute">word-break</span>: break-all;</span><br><span class="line">  <span class="attribute">color</span>: $my-code-foreground;</span><br><span class="line">  <span class="attribute">background</span>: $my-code-background;</span><br><span class="line">  <span class="attribute">border-radius</span>: $code-border-radius;</span><br><span class="line">  <span class="attribute">font-size </span>: $code-font-size;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">p</span> &#123;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">15px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><a id="more"></a><ul><li><code>next/source/css/_variables/custom.styl</code>:这里面可以自定义一些<a href="http://www.zhangxinxu.com/jq/stylus/" target="_blank" rel="noopener">Stylus</a>的变量，一般用作全局的东西，可以覆盖主题默认的变量。我的自定义变量：<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">//字体:</span><br><span class="line">// 标题，修改成你期望的字体族</span><br><span class="line">$font-family-headings = Georgia, sans</span><br><span class="line">// 正文, 修改成你期望的字体族</span><br><span class="line">$font-family-base = "Helvetica Neue","Helvetica","Microsoft YaHei","WenQuanYi Micro 	Hei",Arial,sans-serif</span><br><span class="line"></span><br><span class="line">//行内代码字体颜色</span><br><span class="line">$my-code-foreground = #c7254e</span><br><span class="line">//行内代码背景颜色</span><br><span class="line">$my-code-background = #f8f5ec</span><br><span class="line">//代码块背景颜色</span><br><span class="line">$my-highlight-background = #eee;</span><br><span class="line">//代码块border颜色</span><br><span class="line">$my-highlight-border = #ddd;</span><br><span class="line"></span><br><span class="line">//a标签的颜色</span><br><span class="line">$my-link-color = #0d8abf;</span><br><span class="line">$my-link-hover-color = #29B4F0;</span><br><span class="line"></span><br><span class="line">//bootstrap的颜色</span><br><span class="line">$brand-primary = #428bca;</span><br><span class="line">$brand-success = #5cb85c;</span><br><span class="line">$brand-info =    #5bc0de;</span><br><span class="line">$brand-warning = #f0ad4e;</span><br><span class="line">$brand-danger =  #d9534f;</span><br></pre></td></tr></table></figure></li></ul><h3 id="主页添加热评文章、最新访客、最新评论"><a href="#主页添加热评文章、最新访客、最新评论" class="headerlink" title="主页添加热评文章、最新访客、最新评论"></a>主页添加热评文章、最新访客、最新评论</h3><blockquote><p>这几种功能都是利用了<a href="http://dev.duoshuo.com/docs" target="_blank" rel="noopener">多说</a>，所以想要这几个功能你的博客必须得添加<code>多说</code>,如何添加请点<a href="http://theme-next.iissnan.com/third-party-services.html" target="_blank" rel="noopener">这儿</a>。</p></blockquote><p><strong>原理</strong>：在需要的页面上加上<code>多说</code>的<code>通用代码</code>，<code>多说</code>的<code>embed.js</code>会解析生成对应的模块，next主题使用的是<a href="http://yangxiaofu.com/swig/" target="_blank" rel="noopener">swig</a>模板来生成对应的<code>html</code>，所以我们在模板中添加<code>通用代码</code>。实例讲解：</p><h4 id="热评文章"><a href="#热评文章" class="headerlink" title="热评文章"></a>热评文章</h4><p>通用代码：<br></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span>  <span class="attr">class</span>=<span class="string">"ds-top-threads"</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">data-range</span>=<span class="string">"monthly"</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">data-num-items</span>=<span class="string">"5"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><p>属性说明:<br></p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//以下参数均为可选参数</span></span><br><span class="line"> <span class="keyword">data</span>-range=<span class="string">"weekly"</span>      <span class="comment">//热评统计时间范围：daily：日；weekly：周；monthly：月；默认值daily</span></span><br><span class="line"> <span class="keyword">data</span>-num-items=<span class="string">"5"</span>     <span class="comment">//显示最新文章的条数，默认值5</span></span><br></pre></td></tr></table></figure><p></p><p>我要显示在<strong>侧边栏</strong>，所以我将通用代码添加到<code>sidebar.swig</code>,此文件在<code>next/layout/_macro</code>目录下。我要放在许可协议<img src="https://tang-blog-1257996120.cos-website.ap-chengdu.myqcloud.com/blog_license.png" alt="许可协议">的下面：</p><p>首先，在文件中找到证书对应的代码：<br></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"cc-license motion-element"</span> <span class="attr">itemprop</span>=<span class="string">"license"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><p>然后，在下面加入通用代码和样式：<br></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"links-of-blogroll motion-element"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"links-of-blogroll-title"</span>&gt;</span> <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"fa fa-globe fa-fw"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span>热评文章<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ul</span>  <span class="attr">class</span>=<span class="string">"ds-top-threads"</span> <span class="attr">data-range</span>=<span class="string">"monthly"</span> <span class="attr">data-num-items</span>=<span class="string">"5"</span>&gt;</span><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><p>重新部署，就ok了</p><blockquote><p>如果没有生效，用<code>hexo clean</code>后再部署试试</p></blockquote><h4 id="最新访客"><a href="#最新访客" class="headerlink" title="最新访客"></a>最新访客</h4><p>通用代码：<br></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"ds-recent-visitors"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">data-avatar-size</span>=<span class="string">"42"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">id</span>=<span class="string">"ds-recent-visitors"</span> </span></span><br><span class="line"><span class="tag">  <span class="attr">data-num-items</span>=<span class="string">"24"</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><p>属性说明:<br></p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">data-num-items</span>=<span class="string">"10"</span>     //显示访客的数量</span><br><span class="line"><span class="attr">data-avatar-size</span>=<span class="string">"42"</span>   //访客头像大小</span><br></pre></td></tr></table></figure><p></p><p>在<strong>热评文章</strong>下添加<strong>最新访客</strong>通用代码和样式：<br></p><figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"></span><span class="comment">&#123;# Blogroll:只在主页显示 #&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml"></span><span class="template-tag">&#123;% <span class="name"><span class="name">if</span></span> !display_toc %&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml">//</span><span class="template-tag">&#123;%%&#125;</span><span class="xml">、</span><span class="comment">&#123;##&#125;</span><span class="xml">是swig模板的语法</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"links-of-blogroll motion-element clearfix"</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"links-of-blogroll-title"</span>&gt;</span> <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"fa fa-globe fa-fw"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span>最近访客<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"ds-recent-visitors"</span></span></span></span><br><span class="line"><span class="xml">      data-num-items="36"</span></span><br><span class="line"><span class="xml">      data-avatar-size="42"</span></span><br><span class="line"><span class="xml">      id="ds-recent-visitors" </span></span><br><span class="line"><span class="xml">      data-num-items="24" &gt;</span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span><span class="template-tag">&#123;% <span class="name"><span class="name">endif</span></span> %&#125;</span><span class="xml"></span></span><br></pre></td></tr></table></figure><p></p><p>重新部署，ok了。</p><h4 id="最新评论"><a href="#最新评论" class="headerlink" title="最新评论"></a>最新评论</h4><p>通用代码：<br></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"ds-recent-comments"</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">data-num-items</span>=<span class="string">"5"</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">data-show-avatars</span>=<span class="string">"1"</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">data-show-time</span>=<span class="string">"1"</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">data-show-admin</span>=<span class="string">"0"</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">data-excerpt-length</span>=<span class="string">"70"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><p>属性说明:<br></p><figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//以下参数均为可选</span></span><br><span class="line"><span class="keyword">data</span>-num-items=<span class="string">"10"</span>     <span class="comment">//显示最新评论的条数，最大支持200条</span></span><br><span class="line"><span class="keyword">data</span>-show-avatars=<span class="string">"1"</span>   <span class="comment">//是否显示头像，1：显示，0：不显示</span></span><br><span class="line"><span class="keyword">data</span>-show-<span class="built_in">time</span>=<span class="string">"1"</span>      <span class="comment">//是否显示时间，1：显示，0：不显示</span></span><br><span class="line"><span class="keyword">data</span>-show-<span class="built_in">title</span>=<span class="string">"0"</span>     <span class="comment">//是否显示标题，1：显示，0：不显示</span></span><br><span class="line"><span class="keyword">data</span>-show-admin=<span class="string">"1"</span>     <span class="comment">//是否显示管理员的评论，1：显示，0：不显示</span></span><br><span class="line"><span class="keyword">data</span>-excerpt-length=<span class="string">"70"</span><span class="comment">//最大显示评论汉字数</span></span><br></pre></td></tr></table></figure><p></p><p>在<strong>最新访客</strong>下添加<strong>最新评论</strong>通用代码和样式：<br></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"links-of-blogroll motion-element"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"links-of-blogroll-title"</span>&gt;</span> <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"fa fa-globe fa-fw"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span>最新评论<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"ds-recent-comments"</span> <span class="attr">data-num-items</span>=<span class="string">"5"</span> <span class="attr">data-show-avatars</span>=<span class="string">"1"</span> <span class="attr">data-show-time</span>=<span class="string">"1"</span> <span class="attr">data-show-admin</span>=<span class="string">"0"</span> <span class="attr">data-excerpt-length</span>=<span class="string">"70"</span>&gt;</span><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><p>重新部署，生效了。</p>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[sass VS less]]></title>
      <url>https://jintang.github.io/2016/11/17/sass%20VS%20less/</url>
      <content type="html"><![CDATA[<blockquote><p>为了重构项目的css代码，先体验了<code>less</code>，但发现less不能满足我的需求，没办法转为<code>sass</code>,在此描述一下自我感受这两者的区别。我描述的只是我直观使用的部分，大部分的不同点百度一下，第一页的全一样。。。</p></blockquote><h3 id="判断条件的区别-感觉最重要的地方"><a href="#判断条件的区别-感觉最重要的地方" class="headerlink" title="判断条件的区别(感觉最重要的地方)"></a>判断条件的区别(感觉最重要的地方)</h3><ul><li><code>less</code>写<code>mixin</code>时判断的唯一关键字就是<code>when</code>，而我需要生成复合样式中的一部分，像这样：<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">a</span>&#123;</span><br><span class="line">    <span class="attribute">border-right</span>:<span class="number">1px</span>;</span><br><span class="line">    <span class="attribute">border-bottom</span>:<span class="number">2px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>要选择性的生成部分属性，<code>less</code>很不方便，可以参考前面一篇文章<a href="http://jintang.github.io/2016/11/10/less%E4%BD%BF%E7%94%A8%E5%85%A8%E8%A7%A3-%E9%99%84%E5%BC%80%E5%8F%91%E8%A7%84%E8%8C%83%E4%B8%8E%E5%9F%BA%E6%9C%ACminix/#复合样式mixin">less实战全解之复合样式mixin</a></p><ul><li><code>sass</code>的判断关键字很符合我们的习惯<code>@if</code>、<code>@else</code>、<code>@else if</code>,还有其他的<code>@for</code>、<code>@each</code>，非常强大。额…有点跑题，继续。那么用<code>sass</code>处理符合属性可以写成这样,不会生成多余的属性：<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">mixin</span> position(<span class="variable">$position</span>,<span class="variable">$top</span>:null,<span class="variable">$right</span>:null,<span class="variable">$bottom</span>:null,<span class="variable">$left</span>:null,<span class="variable">$z-index</span>:null)&#123;</span><br><span class="line">  <span class="attribute">position</span>: <span class="variable">$position</span>;</span><br><span class="line">  @<span class="keyword">if</span> <span class="variable">$top</span>&#123;<span class="attribute">top</span>: <span class="variable">$top</span>;&#125;</span><br><span class="line">  @<span class="keyword">if</span> <span class="variable">$right</span>&#123;<span class="attribute">right</span>: <span class="variable">$right</span>;&#125;</span><br><span class="line">  @<span class="keyword">if</span> <span class="variable">$bottom</span>&#123;<span class="attribute">bottom</span>: <span class="variable">$bottom</span>;&#125;</span><br><span class="line">  @<span class="keyword">if</span> <span class="variable">$left</span>&#123;<span class="attribute">left</span>: <span class="variable">$left</span>;&#125;</span><br><span class="line">  @<span class="keyword">if</span> <span class="variable">$z-index</span>&#123;<span class="attribute">z-index</span>: <span class="variable">$z-index</span>;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>假设要编译成这样的css:<br></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">position</span>: <span class="selector-tag">absolute</span>;</span><br><span class="line"><span class="selector-tag">right</span>: 0;</span><br><span class="line"><span class="selector-tag">bottom</span>: 0;</span><br></pre></td></tr></table></figure><p></p><p>使用的方式有两种：<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//方法1,最后一个&quot;有效参数&quot;前面的参数设为null，后面的不用管，因为参数默认值就是null</span><br><span class="line">@include position(absolute,null,0,0);</span><br><span class="line">//方法2,指定参数名称</span><br><span class="line">@include position(absolute,$right:0,$bottom:0);</span><br></pre></td></tr></table></figure><p></p><a id="more"></a><p>而且像<code>sass</code>写的这种：支持多属性的0%和100%<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">@mixin frames($props,$starts,$ends)&#123;</span><br><span class="line">  $length:length($props);</span><br><span class="line">  0% &#123;</span><br><span class="line">    @for $i from 1 through $length&#123;</span><br><span class="line">      $prop:nth($props,$i);</span><br><span class="line">      #&#123;$prop&#125;:nth($starts,$i);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  100%&#123;</span><br><span class="line">    @for $j from 1 through $length&#123;</span><br><span class="line">      $prop:nth($props,$j);</span><br><span class="line">      #&#123;$prop&#125;:nth($ends,$j);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p><code>less</code>由于缺少<code>for</code>这种关键字，只能通过递归实现循环，要实现上面的效果，想想就醉了</p><h3 id="import的路径问题"><a href="#import的路径问题" class="headerlink" title="import的路径问题"></a><code>import</code>的路径问题</h3><ul><li><code>less</code>:可以使用相对路径和绝对路径，可以参考<a href="http://jintang.github.io/2016/11/07/less%E4%BD%BF%E7%94%A8mixin%E7%9A%84%E5%B0%8F%E6%8A%80%E5%B7%A7/#import导入的路径问题">前面的文章</a></li><li><code>sass</code>:可以使用相对路径，绝对路径好像不可以，我尝试了很多次，依旧不行，不知道是不是我尝试的有问题，请知道的前辈告诉我。语法没有<code>less</code>的小括号，如下：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@import &quot;../../furnace/sass/_base&quot;;</span><br></pre></td></tr></table></figure></li></ul><h3 id="使用mixin"><a href="#使用mixin" class="headerlink" title="使用mixin"></a>使用<code>mixin</code></h3><ul><li><p><code>less</code>:只能放在选择器内，不能放在外面，以至于我只能这样定义一个动画,而不能使用公共mixin定义动画</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.blink</span> &#123;</span><br><span class="line">  <span class="selector-class">.animation</span>(blink <span class="number">1.8s</span> infinite);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@-webkit-keyframes</span> blink &#123;<span class="selector-class">.keyframes-opacity</span>(<span class="number">10</span>,<span class="number">0</span>);&#125;</span><br><span class="line"><span class="keyword">@-moz-keyframes</span> blink &#123;<span class="selector-class">.keyframes-opacity</span>(<span class="number">10</span>,<span class="number">0</span>);&#125;</span><br><span class="line"><span class="keyword">@-o-keyframes</span> blink &#123;<span class="selector-class">.keyframes-opacity</span>(<span class="number">10</span>,<span class="number">0</span>);&#125;</span><br><span class="line"><span class="keyword">@keyframes</span> blink &#123;<span class="selector-class">.keyframes-opacity</span>(<span class="number">10</span>,<span class="number">0</span>);&#125;</span><br></pre></td></tr></table></figure></li><li><p><code>sass</code>:可以放在外面，然后代码就变成了这样：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.blink &#123;</span><br><span class="line">  @include animation(blink 1.8s infinite);</span><br><span class="line">&#125;</span><br><span class="line">@include keyframes-opacity(blink);</span><br></pre></td></tr></table></figure></li></ul><p>是不是简练了很多？</p><h3 id="内部函数"><a href="#内部函数" class="headerlink" title="内部函数"></a>内部函数</h3><ul><li><code>less</code>:自定义函数比较多，很方便</li><li><code>sass</code>:官方自己封装的都是基本的，比较少，如三角操作函数就没有，所以需要用sass扩展库:<a href="http://compass-style.org/" target="_blank" rel="noopener">compass</a>、<a href="http://www.w3cplus.com/sasscore/index.html" target="_blank" rel="noopener">sassCore</a></li></ul><h3 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h3><h4 id="grunt插件编译"><a href="#grunt插件编译" class="headerlink" title="grunt插件编译"></a>grunt插件编译</h4><p>很多人选择用<code>less</code>是因为用<code>sass</code>是基于<code>ruby</code>的,所以选择了<code>less</code>,我在使用的过程中用了这样两个插件，都是<code>grunt</code>的，<code>gulp</code>当然也有。下面我的两个插件：</p><ul><li><a href="https://github.com/gruntjs/grunt-contrib-less" target="_blank" rel="noopener">grunt-contrib-less</a></li><li><a href="https://github.com/sindresorhus/grunt-sass" target="_blank" rel="noopener">grunt-sass</a></li></ul><blockquote><p>此处不使用grunt官方团队的<a href="https://github.com/gruntjs/grunt-contrib-sass" target="_blank" rel="noopener">grunt-contrib-sass</a>,因为它需要ruby环境的支持</p></blockquote><p>使用<code>grunt-sass</code>,就不需要安装ruby环境了，因为它是用<a href="https://github.com/sass/node-sass" target="_blank" rel="noopener">node-sass</a>编译的,只需要用<code>npm</code>安装了<code>node-sass</code>就可以编译了。这是我的<code>Gruntfile.js</code>:<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">grunt.initConfig(&#123;</span><br><span class="line">    sass: &#123;</span><br><span class="line">        dist:&#123;</span><br><span class="line">          options: &#123;</span><br><span class="line">              sourceMap: <span class="literal">true</span>,</span><br><span class="line">              outputStyle:<span class="string">"expanded"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          dist:&#123;</span><br><span class="line">              files:&#123;</span><br><span class="line">                  <span class="string">'sass/style.css'</span>:<span class="string">'sass/style.scss'</span></span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    less:&#123;</span><br><span class="line">        dist:&#123;</span><br><span class="line">            options:&#123;</span><br><span class="line">                <span class="comment">// paths: ['WebRoot/css']//Directory of input file.</span></span><br><span class="line">            &#125;,</span><br><span class="line">            files:&#123;</span><br><span class="line">                <span class="string">'WebRoot/css/less/tvwall.css'</span>:<span class="string">'WebRoot/css/less/tvwall.less'</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    watch:&#123;</span><br><span class="line">        css:&#123;</span><br><span class="line">            files:[</span><br><span class="line">                <span class="string">'WebRoot/css/less/tvwall.less'</span>,</span><br><span class="line">                <span class="string">'WebRoot/css/sass/tvwall.scss'</span>,</span><br><span class="line">            ],</span><br><span class="line">            tasks:[<span class="string">'less'</span>,<span class="string">'sass'</span>],</span><br><span class="line">            options:&#123;</span><br><span class="line">                reload:<span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        self:&#123;</span><br><span class="line">            files:[<span class="string">'Gruntfile.js'</span>],</span><br><span class="line">            tasks:[<span class="string">'watch:css'</span>]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">grunt.loadNpmTasks(<span class="string">'grunt-sass'</span>);</span><br><span class="line">grunt.loadNpmTasks(<span class="string">'grunt-contrib-less'</span>);</span><br><span class="line">grunt.loadNpmTasks(<span class="string">'grunt-contrib-watch'</span>);</span><br><span class="line">grunt.registerTask(<span class="string">'default'</span>, [<span class="string">'less'</span>,<span class="string">'sass'</span>,<span class="string">'watch'</span>]);</span><br></pre></td></tr></table></figure><p></p><p>命令行使用：<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grunt watch</span><br></pre></td></tr></table></figure><p></p><h4 id="js编译，方便调试"><a href="#js编译，方便调试" class="headerlink" title="js编译，方便调试"></a>js编译，方便调试</h4><ul><li><code>less</code>是基于JavaScript，所以，是在客户端处理的。官方提供了<code>less.js</code>文件，放在html里直接就可以编译，很方便.</li><li><code>sass</code>是基于服务端的，但有牛人创造了<a href="https://github.com/medialize/sass.js" target="_blank" rel="noopener">sass.js</a>,主要由：<code>sass.js</code>、<code>sass.work.js</code>和<code>sass.sync.js</code>组成。如果你的浏览器支持h5的<a href="https://developer.mozilla.org/en/docs/Web/API/Worker" target="_blank" rel="noopener"> Web Worker</a>,请使用<code>sass.js</code>和<code>sass.work.js</code>，我这儿就用的这两个文件。如果不支持，就使用<code>sass.js</code>和<code>sass.sync.js</code>。使用如下：</li></ul><p><strong>(1)直接在html中使用<code>sass.js</code></strong><br></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns</span>=<span class="string">"http://www.w3.org/1999/xhtml"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"/js/sass/sass.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="actionscript">            <span class="keyword">var</span> sass = <span class="keyword">new</span> Sass(<span class="string">'/js/sass/sass.worker.js'</span>);</span></span><br><span class="line"><span class="undefined">            sass.destroy();</span></span><br><span class="line"><span class="actionscript">            <span class="keyword">var</span> sass = <span class="keyword">new</span> Sass();</span></span><br><span class="line"><span class="undefined">            sass.options(&#123;</span></span><br><span class="line"><span class="actionscript">                style: Sass.style.expanded<span class="comment">//这种格式我们比较习惯</span></span></span><br><span class="line"><span class="undefined">            &#125;);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="actionscript">            <span class="keyword">var</span> base = <span class="string">'../../furnace/'</span>;</span></span><br><span class="line"><span class="actionscript">            <span class="keyword">var</span> directory = <span class="string">''</span>;</span></span><br><span class="line"><span class="undefined">            /*因为我的'audio.scss'引入了公共的文件:</span></span><br><span class="line"><span class="actionscript">             *   @<span class="meta"><span class="meta-keyword">import</span> "../../sass/_base";</span></span></span><br><span class="line"><span class="actionscript">             * 所以<span class="string">'_base.scss'</span>文件也必须使用preloadFiles()<span class="string">"注册"</span>文件之后再编译</span></span><br><span class="line"><span class="undefined">            */</span></span><br><span class="line"><span class="actionscript">            <span class="keyword">var</span> files = [</span></span><br><span class="line"><span class="actionscript">                <span class="string">'audio/sass/audio.scss'</span>,</span></span><br><span class="line"><span class="actionscript">                <span class="string">'sass/_base.scss'</span></span></span><br><span class="line"><span class="undefined">            ];</span></span><br><span class="line"><span class="actionscript">            sass.preloadFiles(base, directory, files, <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">                sass.compileFile(<span class="string">'audio/sass/audio.scss'</span>,<span class="function"><span class="keyword">function</span><span class="params">(result)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">var</span> style=<span class="built_in">document</span>.createElement(<span class="string">'style'</span>);</span></span><br><span class="line"><span class="undefined">                    style.innerHTML=result.text;</span></span><br><span class="line"><span class="javascript">                    <span class="built_in">document</span>.head.appendChild(style);</span></span><br><span class="line"><span class="undefined">                &#125;);</span></span><br><span class="line"><span class="undefined">            &#125;);</span></span><br><span class="line"><span class="undefined">        </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><p><strong>(2)在对应的模块js中使用</strong><br>我们使用了<code>sea.js</code>来模块化，本来官方介绍是简单的<code>require</code>之后就可以使用，官方demo:<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">define(<span class="function"><span class="keyword">function</span> <span class="title">defineSassModule</span>(<span class="params">require</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// load Sass.js</span></span><br><span class="line">  <span class="keyword">var</span> Sass = <span class="built_in">require</span>(<span class="string">'path/to/sass.js'</span>);</span><br><span class="line">  <span class="comment">// tell Sass.js where it can find the worker,</span></span><br><span class="line">  <span class="comment">// url is relative to document.URL - i.e. outside of whatever</span></span><br><span class="line">  <span class="comment">// Require or Browserify et al do for you</span></span><br><span class="line">  Sass.setWorkerUrl(<span class="string">'dist/sass.worker.js'</span>);</span><br><span class="line">  <span class="comment">// initialize a Sass instance</span></span><br><span class="line">  <span class="keyword">var</span> sass = <span class="keyword">new</span> Sass();</span><br><span class="line">  <span class="keyword">var</span> scss = <span class="string">'$someVar: 123px; .some-selector &#123; width: $someVar; &#125;'</span>;</span><br><span class="line">  sass.compile(scss, <span class="function"><span class="keyword">function</span>(<span class="params">result</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(result);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p></p><p>但是在我的项目里并不成功,提示<code>require</code>返回的对象是<code>underfined</code>,注意到了<code>sass.js</code>里面的这段代码：<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">root, factory</span>) </span>&#123;</span><br><span class="line"><span class="meta">    'use strict'</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> define === <span class="string">'function'</span> &amp;&amp; define.amd) &#123;</span><br><span class="line">      define([], factory);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> exports === <span class="string">'object'</span>) &#123;</span><br><span class="line">      <span class="built_in">module</span>.exports = factory();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">/*走到了这个逻辑里，可能是因为用的是sea.js而非require.js*/</span></span><br><span class="line">      root.Sass = factory();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;(<span class="keyword">this</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;...&#125;)</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p></p><p>所以，<code>require</code>之后的对象被绑定到了window上，于是，代码修改为：<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">define(<span class="function"><span class="keyword">function</span>(<span class="params">require, exports, module</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">require</span>(<span class="string">'/js/sass/sass.js'</span>);</span><br><span class="line">    Sass.setWorkerUrl(suninfo.getRootPath()+<span class="string">'js/sass/sass.worker.js'</span>);</span><br><span class="line">    <span class="keyword">var</span> sass=<span class="keyword">new</span> Sass();</span><br><span class="line">    sass.options(&#123;</span><br><span class="line">        style: Sass.style.expanded</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> base = <span class="string">'../../furnace/'</span>;</span><br><span class="line">    <span class="keyword">var</span> directory = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">var</span> files = [</span><br><span class="line">        <span class="string">'audio/sass/audio.scss'</span>,</span><br><span class="line">        <span class="string">'sass/_base.scss'</span>,</span><br><span class="line">        <span class="string">'sass/_variables.scss'</span></span><br><span class="line">    ];</span><br><span class="line">    sass.preloadFiles(base, directory, files, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        sass.compileFile(<span class="string">'audio/sass/audio.scss'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">result</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> style=<span class="built_in">document</span>.createElement(<span class="string">'style'</span>);</span><br><span class="line">            style.innerHTML=result.text;</span><br><span class="line">            <span class="built_in">document</span>.head.appendChild(style);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p></p><p>然后在浏览器中开心的调试<code>sass</code>吧…</p><blockquote class="pullquote tip"><p>最终，我还是比较喜欢sass。最后放个我总结的<strong>sass使用规范</strong>和<strong>_base.scss</strong>:</p></blockquote><blockquote><ul><li><a href="https://gist.github.com/jintangWang/15b7175268946b9cef21d94625180ee7#file-sass-md" target="_blank" rel="noopener">sass使用规范</a></li><li><a href="https://gist.github.com/jintangWang/15b7175268946b9cef21d94625180ee7#file-_base-scss" target="_blank" rel="noopener">_base.scss</a></li></ul></blockquote>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[less实战全解]]></title>
      <url>https://jintang.github.io/2016/11/10/less%E5%AE%9E%E6%88%98%E5%85%A8%E8%A7%A3/</url>
      <content type="html"><![CDATA[<p>附上我的<strong>开发规范</strong>与<strong>公用mixin</strong>:</p><blockquote><ul><li><a href="https://gist.github.com/jintangWang/7633204455a2b992f08252f82fac1d58#file-_less-md" target="_blank" rel="noopener">less开发规范</a></li><li><a href="https://gist.github.com/jintangWang/7633204455a2b992f08252f82fac1d58#file-base-less" target="_blank" rel="noopener">less公用mixin</a></li></ul></blockquote><p>本文所有的实例都可以在<a href="https://gist.github.com/jintangWang/7633204455a2b992f08252f82fac1d58#file-base-less" target="_blank" rel="noopener">less公用mixin</a> 找到</p><h3 id="不同主题的颜色字体等变量定义规范："><a href="#不同主题的颜色字体等变量定义规范：" class="headerlink" title="不同主题的颜色字体等变量定义规范："></a>不同主题的颜色字体等变量定义规范：</h3><p>假设有一蓝色主题，且起名为”Blue”。那么：</p><ul><li>其下的所有变量都以”Blue”为开头起名</li><li>变量名应包含主要特征和用途,若用途较多用”color”声明</li><li>对于一些动作变化效果，如hover的颜色效果，最后再跟上对应的动作名</li></ul><p>实例：<br></p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@Blue-color-blue:</span><span class="number">#1D89E4</span>;<span class="comment">//用途较多,是此主题的主色</span></span><br><span class="line"><span class="variable">@Blue-border-lightgray-a:</span><span class="number">#e4e4e4</span>;<span class="comment">//常用作border</span></span><br><span class="line"><span class="variable">@Blue-border-lightgray-b:</span><span class="number">#dddddd</span>;</span><br><span class="line"><span class="variable">@Blue-bg-lightgray:</span><span class="number">#f9f9f9</span>;<span class="comment">//常作背景色</span></span><br><span class="line"><span class="variable">@Blue-font-blue-hover:</span><span class="number">#0f79d5</span>;<span class="comment">//常作字体颜色,当hover时字体为这个颜色</span></span><br></pre></td></tr></table></figure><p></p><p>这样，就定义了一套主题的颜色。下面的语句决定我们使用的主题：<br></p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@theme-color:</span><span class="variable">@Blue-color-blue</span>;</span><br><span class="line"><span class="variable">@theme-border-a:</span><span class="variable">@Blue-border-lightgray-a</span>;</span><br><span class="line"><span class="variable">@theme-border-b:</span><span class="variable">@Blue-border-lightgray-b</span>;</span><br><span class="line"><span class="variable">@theme-bg:</span><span class="variable">@Blue-bg-lightgray</span>;</span><br><span class="line"><span class="variable">@theme-font-hover:</span><span class="variable">@Blue-font-blue-hover</span>;</span><br></pre></td></tr></table></figure><p></p><p>这里定义的变量才是实际在项目中用的，这些名称只包含了主要作用，而不包含特征。要切换不同的主题，只需要该这些变量对应的值就可以了。</p><h3 id="跟主题无关的颜色字体等变量定义规范："><a href="#跟主题无关的颜色字体等变量定义规范：" class="headerlink" title="跟主题无关的颜色字体等变量定义规范："></a>跟主题无关的颜色字体等变量定义规范：</h3><p>和跟主题相关的颜色名称定义类似，只不过开头不用加主题名，使用的时候可以明显区分主题相关的颜色和不相关的颜色。</p><ul><li>用途较多的颜色：不用声明作用，只需用单词表明特征即可</li><li>一些有常规用途的颜色：声明主要作用和特征</li></ul><p>这个比较灵活，具体视情况而定。<br>实例：<br></p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@white:</span><span class="number">#fff</span>;</span><br><span class="line"><span class="variable">@font-red:</span><span class="number">#f00</span>;</span><br></pre></td></tr></table></figure><p></p><h3 id="兼容不同浏览器的样式mixin"><a href="#兼容不同浏览器的样式mixin" class="headerlink" title="兼容不同浏览器的样式mixin"></a>兼容不同浏览器的样式mixin</h3><p>以<code>.</code>开头，其名称与样式的名称一致：<br>实例1：<br></p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.border-radius</span>(...)&#123;</span><br><span class="line">  <span class="attribute">-webkit-border-radius</span>: <span class="variable">@arguments</span>;</span><br><span class="line">  <span class="attribute">-moz-border-radius</span>: <span class="variable">@arguments</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="variable">@arguments</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><a id="more"></a><p>实例2：<code>linear-gradient</code>的兼容处理<br>这儿就能感觉到<code>less</code>的缺陷，判断关键词只有个<code>when</code>，为后面sass的用法埋个伏笔<br></p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//gradient开始</span></span><br><span class="line"><span class="comment">//相反方向</span></span><br><span class="line"><span class="variable">@top_opposite:</span>bottom;</span><br><span class="line"><span class="variable">@bottom_opposite:</span>top;</span><br><span class="line"><span class="variable">@left_opposite:</span>right;</span><br><span class="line"><span class="variable">@right_opposite:</span>left;</span><br><span class="line"><span class="selector-class">.opposite</span>(<span class="variable">@origin</span>) <span class="keyword">when</span> (length(<span class="variable">@origin</span>)=<span class="number">1</span>) <span class="keyword">and</span> (isstring(<span class="variable">@origin</span>))&#123;</span><br><span class="line">  <span class="variable">@opposite:</span><span class="string">~"@&#123;@&#123;origin&#125;_opposite&#125;"</span>;</span><br><span class="line">  <span class="variable">@to_opposite:</span><span class="string">~"to @&#123;opposite&#125;"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.opposite</span>(<span class="variable">@origin</span>) <span class="keyword">when</span> (length(<span class="variable">@origin</span>)=<span class="number">1</span>) <span class="keyword">and</span> (isnumber(<span class="variable">@origin</span>)) <span class="keyword">and</span>(<span class="variable">@origin</span>&lt;<span class="number">180</span>)&#123;</span><br><span class="line">  <span class="variable">@opposite:</span><span class="variable">@origin</span>+<span class="number">180</span>;</span><br><span class="line">  <span class="variable">@to_opposite:</span><span class="variable">@origin</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.opposite</span>(<span class="variable">@origin</span>) <span class="keyword">when</span> (length(<span class="variable">@origin</span>)=<span class="number">1</span>) <span class="keyword">and</span> (isnumber(<span class="variable">@origin</span>)) <span class="keyword">and</span>(<span class="variable">@origin</span>&gt;=<span class="number">180</span>)&#123;</span><br><span class="line">  <span class="variable">@opposite:</span><span class="variable">@origin</span>+(-<span class="number">180</span>);</span><br><span class="line">  <span class="variable">@to_opposite:</span><span class="variable">@origin</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.opposite</span>(<span class="variable">@origin</span>) <span class="keyword">when</span> (length(<span class="variable">@origin</span>)=<span class="number">2</span>) <span class="keyword">and</span> (<span class="string">"@&#123;origin&#125;"</span>=<span class="string">"left top"</span>)&#123;</span><br><span class="line">  <span class="variable">@opposite:</span><span class="string">~"right bottom"</span>;</span><br><span class="line">  <span class="variable">@to_opposite:</span><span class="string">~"to @&#123;opposite&#125;"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.opposite</span>(<span class="variable">@origin</span>) <span class="keyword">when</span> (length(<span class="variable">@origin</span>)=<span class="number">2</span>) <span class="keyword">and</span> (<span class="string">"@&#123;origin&#125;"</span>=<span class="string">"left bottom"</span>)&#123;</span><br><span class="line">  <span class="variable">@opposite:</span><span class="string">~"right top"</span>;</span><br><span class="line">  <span class="variable">@to_opposite:</span><span class="string">~"to @&#123;opposite&#125;"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.opposite</span>(<span class="variable">@origin</span>) <span class="keyword">when</span> (length(<span class="variable">@origin</span>)=<span class="number">2</span>) <span class="keyword">and</span> (<span class="string">"@&#123;origin&#125;"</span>=<span class="string">"right top"</span>)&#123;</span><br><span class="line">  <span class="variable">@opposite:</span><span class="string">~"left bottom"</span>;</span><br><span class="line">  <span class="variable">@to_opposite:</span><span class="string">~"to @&#123;opposite&#125;"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.opposite</span>(<span class="variable">@origin</span>) <span class="keyword">when</span> (length(<span class="variable">@origin</span>)=<span class="number">2</span>) <span class="keyword">and</span> (<span class="string">"@&#123;origin&#125;"</span>=<span class="string">"right bottom"</span>)&#123;</span><br><span class="line">  <span class="variable">@opposite:</span><span class="string">~"left top"</span>;</span><br><span class="line">  <span class="variable">@to_opposite:</span><span class="string">~"to @&#123;opposite&#125;"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.gradient</span> (<span class="variable">@origin</span>:top, <span class="variable">@start</span>, <span class="variable">@stop</span>) &#123;</span><br><span class="line">  <span class="selector-class">.opposite</span>(<span class="variable">@origin</span>);</span><br><span class="line">  <span class="attribute">background-color</span>: mix(<span class="variable">@start</span>,<span class="variable">@stop</span>);</span><br><span class="line">  <span class="attribute">background-image</span>: -webkit-linear-gradient(<span class="variable">@origin</span>, <span class="variable">@start</span>, <span class="variable">@stop</span>);</span><br><span class="line">  <span class="attribute">background-image</span>: -webkit-gradient(linear, <span class="variable">@origin</span>, <span class="variable">@opposite</span>, from(<span class="variable">@start</span>), to(<span class="variable">@stop</span>));</span><br><span class="line">  <span class="attribute">background-image</span>: -moz-linear-gradient(<span class="variable">@origin</span>, <span class="variable">@start</span>, <span class="variable">@stop</span>);</span><br><span class="line">  <span class="attribute">background-image</span>: -o-linear-gradient(<span class="variable">@origin</span>, <span class="variable">@start</span>, <span class="variable">@stop</span>);</span><br><span class="line">  <span class="attribute">background-image</span>: -ms-linear-gradient(<span class="variable">@origin</span>, <span class="variable">@start</span>, <span class="variable">@stop</span>);</span><br><span class="line">  <span class="attribute">background-image</span>: linear-gradient(<span class="variable">@to_opposite</span>, <span class="variable">@start</span>, <span class="variable">@stop</span>);</span><br><span class="line">  <span class="attribute">filter</span>: <span class="attribute">progid</span>:DXImageTransform.Microsoft.gradient(startColorstr=<span class="variable">@start</span>, endColorstr=<span class="variable">@stop</span>, GradientType=<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//gradient结束</span></span><br></pre></td></tr></table></figure><p></p><h3 id="特殊的mixin"><a href="#特殊的mixin" class="headerlink" title="特殊的mixin"></a>特殊的mixin</h3><h4 id="一些常用的"><a href="#一些常用的" class="headerlink" title="一些常用的"></a>一些常用的</h4><p>实例：<br></p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.clearfix</span>&#123;</span><br><span class="line">  <span class="selector-tag">&amp;</span><span class="selector-pseudo">:before</span>,<span class="selector-tag">&amp;</span><span class="selector-pseudo">:after</span>,&#123;</span><br><span class="line">    <span class="attribute">display</span>: table;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">''</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-tag">&amp;</span><span class="selector-pseudo">:after</span>&#123;</span><br><span class="line">    <span class="attribute">clear</span>: both;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h4 id="特殊的keyframes-只能生成单属性的动画定义"><a href="#特殊的keyframes-只能生成单属性的动画定义" class="headerlink" title="特殊的keyframes(只能生成单属性的动画定义)"></a>特殊的keyframes(只能生成单属性的动画定义)</h4><p>实例：<br></p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.keyframs</span>(<span class="number">2</span>,<span class="variable">@prop</span>,<span class="variable">@start</span>,<span class="variable">@end</span>)&#123;</span><br><span class="line">      <span class="selector-tag">0%</span>&#123;</span><br><span class="line">        <span class="attribute">@&#123;prop&#125;</span>:<span class="variable">@start</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="selector-tag">100%</span>&#123;</span><br><span class="line">        <span class="attribute">@&#123;prop&#125;</span>:<span class="variable">@end</span>;</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br><span class="line"> <span class="comment">//只是支持单属性opacity的动画定义</span></span><br><span class="line"><span class="selector-class">.keyframes-opacity</span>(<span class="number">10</span>,<span class="variable">@value</span>) <span class="keyword">when</span> (<span class="variable">@value</span>&lt;=<span class="number">1</span>)&#123;</span><br><span class="line">    <span class="variable">@indicate:</span>percentage(<span class="variable">@value</span>);</span><br><span class="line">      <span class="variable">@&#123;indicate&#125;</span> &#123;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="variable">@value</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.keyframes-opacity</span>(<span class="number">10</span>,<span class="variable">@value</span>+<span class="number">0.1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h3 id="复合样式mixin"><a href="#复合样式mixin" class="headerlink" title="复合样式mixin:"></a>复合样式mixin:</h3><p><del>注意：此部分废弃，因为项目中大多数是设了部分属性，如<code>margin-top</code>和<code>margin-right</code>,但如果用了此<code>mixin</code>，会造成多了<code>margin-bottom</code>和<code>margin-left</code>属性，即使他们设的是默认属性。这样很不好，如果要修改这个<code>mixin</code>，由于<code>less</code>中的判断只有<code>when</code>关键字，类似于上面的<code>line-gradient</code>,所以要写11条(怎么算出来的：$C_4^2+C_4^3+1$)的判断，很麻烦，所以废弃。后面会有<code>sass</code>的方法，完美解决这个问题</del><br>实例：<br></p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//根据不同的参数只设置部分属性,其他的还是默认值0</span></span><br><span class="line"><span class="selector-class">.margin</span>(<span class="variable">@top</span>:<span class="number">0</span>;<span class="variable">@right</span>:<span class="number">0</span>;<span class="variable">@bottom</span>:<span class="number">0</span>;<span class="variable">@left</span>:<span class="number">0</span>)&#123;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="variable">@top</span>;</span><br><span class="line">  <span class="attribute">margin-right</span>: <span class="variable">@right</span>;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="variable">@bottom</span>;</span><br><span class="line">  <span class="attribute">margin-left</span>: <span class="variable">@left</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>为了区分兼容不同浏览器的mixin，这个采用”驼峰命名法”.</p>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[less使用mixin的小技巧]]></title>
      <url>https://jintang.github.io/2016/11/07/less%E4%BD%BF%E7%94%A8mixin%E7%9A%84%E5%B0%8F%E6%8A%80%E5%B7%A7/</url>
      <content type="html"><![CDATA[<blockquote><p>less是一种css的扩展，可以编译成css。将它定位为”工具”即可，最终 浏览器/app 识别的还是css</p></blockquote><p>参考网站：</p><blockquote><ul><li><a href="http://less.bootcss.com/" target="_blank" rel="noopener">less中文官网</a>，是bootstrap帮忙翻译的，但容我吐槽一句：翻译翻一半，惆怅也疼蛋。</li><li><a href="http://www.css88.com/doc/less/features/" target="_blank" rel="noopener">css88的less中文文档</a>，这个翻译完了，不喜欢英文的可以看这个</li></ul></blockquote><h3 id="css3中calc在less编译时被计算的解决办法"><a href="#css3中calc在less编译时被计算的解决办法" class="headerlink" title="css3中calc在less编译时被计算的解决办法"></a>css3中calc在less编译时被计算的解决办法</h3><p>目标：<br></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">width</span>: <span class="selector-tag">-moz-calc</span>(100% <span class="selector-tag">-</span> 10<span class="selector-tag">px</span>);</span><br><span class="line"><span class="selector-tag">width</span>: <span class="selector-tag">-webkit-calc</span>(100% <span class="selector-tag">-</span> 10<span class="selector-tag">px</span>);</span><br><span class="line"><span class="selector-tag">width</span>: <span class="selector-tag">calc</span>(100% <span class="selector-tag">-</span> 10<span class="selector-tag">px</span>);</span><br></pre></td></tr></table></figure><p></p><p>错误<code>less</code>:<br></p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//less的mixin</span></span><br><span class="line"><span class="selector-class">.calcWidth</span>(<span class="variable">@width</span>)&#123;</span><br><span class="line">    <span class="attribute">width</span>:-moz-calc(<span class="variable">@width</span>);</span><br><span class="line">    <span class="attribute">width</span>:-webkit-calc(<span class="variable">@width</span>);</span><br><span class="line">    <span class="attribute">width</span>:calc(<span class="variable">@width</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//使用</span></span><br><span class="line"><span class="selector-tag">div</span>&#123;</span><br><span class="line">    <span class="selector-class">.calcWidth</span>(<span class="number">100%</span> - <span class="number">10px</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>错误结果:<br></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">width</span>: <span class="selector-tag">-moz-calc</span>(90%);</span><br><span class="line"><span class="selector-tag">width</span>: <span class="selector-tag">-webkit-calc</span>(90%);</span><br><span class="line"><span class="selector-tag">width</span>: <span class="selector-tag">calc</span>(90%);</span><br></pre></td></tr></table></figure><p></p><p>原因：<code>less</code>把这个当成运算式去执行了<br><strong>正确<code>less</code></strong>:<br></p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//less的mixin</span></span><br><span class="line"><span class="selector-class">.calcWidth</span>(<span class="variable">@width</span>)&#123;</span><br><span class="line">    <span class="attribute">width</span>:-moz-calc(<span class="variable">@width</span>);</span><br><span class="line">    <span class="attribute">width</span>:-webkit-calc(<span class="variable">@width</span>);</span><br><span class="line">    <span class="attribute">width</span>:calc(<span class="variable">@width</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//使用</span></span><br><span class="line"><span class="selector-tag">div</span>&#123;</span><br><span class="line">    <span class="selector-class">.calcWidth</span>(<span class="string">~"100% - 10px"</span>);</span><br><span class="line">    <span class="comment">//~是less内置的转义函数，就是以前的e函数，语法：~"value"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>结果就是目标，验证通过<br><a id="more"></a></p><h3 id="less写一个可复用的帧动画类型的-函数"><a href="#less写一个可复用的帧动画类型的-函数" class="headerlink" title="less写一个可复用的帧动画类型的 函数"></a>less写一个可复用的帧动画类型的 函数</h3><p>目标：<br></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">div</span> &#123;</span><br><span class="line">  <span class="attribute">animation</span>: blink <span class="number">1.8s</span> infinite;</span><br><span class="line">  <span class="attribute">-webkit-animation</span>: blink <span class="number">1.8s</span> infinite;</span><br><span class="line">  <span class="attribute">-moz-animation</span>: blink <span class="number">1.8s</span> infinite;</span><br><span class="line">  <span class="attribute">-o-animation</span>: blink <span class="number">1.8s</span> infinite;</span><br><span class="line">&#125;</span><br><span class="line">//定义的动画还有-webkit-、-moz-、-o-、-ms-，此处为了省篇幅没有加</span><br><span class="line">@<span class="keyword">keyframes</span> blink &#123;</span><br><span class="line">  0% &#123;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  10% &#123;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0.1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  20% &#123;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0.2</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  30% &#123;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0.3</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  40% &#123;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0.4</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  50% &#123;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0.5</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  60% &#123;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0.6</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  70% &#123;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0.7</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  80% &#123;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0.8</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  90% &#123;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0.9</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  100% &#123;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>方法：<br></p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//mixin开始</span></span><br><span class="line"><span class="selector-class">.animation</span>(...)&#123;</span><br><span class="line">  <span class="attribute">animation</span>: <span class="variable">@arguments</span>;</span><br><span class="line">  <span class="attribute">-webkit-animation</span>: <span class="variable">@arguments</span>;</span><br><span class="line">  <span class="attribute">-moz-animation</span>: <span class="variable">@arguments</span>;</span><br><span class="line">  <span class="attribute">-o-animation</span>: <span class="variable">@arguments</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.opacityLoop</span>(<span class="variable">@count</span>) <span class="keyword">when</span> (<span class="variable">@count</span>&lt;=<span class="number">1</span>)&#123;</span><br><span class="line">  <span class="comment">//percentage是less的内置函数，作用：将浮点数转换为百分比字符串</span></span><br><span class="line">  <span class="variable">@keysname:</span>percentage(<span class="variable">@count</span>);</span><br><span class="line">  <span class="comment">/*注意：less不能直接在属性名上调用内置函数*/</span></span><br><span class="line">  <span class="variable">@&#123;keysname&#125;</span> &#123;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="variable">@count</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.opacityLoop</span>((<span class="variable">@count</span>+<span class="number">0.1</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//mixin结束</span></span><br><span class="line"><span class="selector-tag">div</span> &#123;</span><br><span class="line">  <span class="selector-class">.animation</span>(blink <span class="number">1.8s</span> infinite);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@-webkit-keyframes</span> blink &#123;<span class="selector-class">.opacityLoop</span>(<span class="number">0</span>);&#125;</span><br><span class="line"><span class="keyword">@-moz-keyframes</span> blink &#123;<span class="selector-class">.opacityLoop</span>(<span class="number">0</span>);&#125;</span><br><span class="line"><span class="keyword">@-o-keyframes</span> blink &#123;<span class="selector-class">.opacityLoop</span>(<span class="number">0</span>);&#125;</span><br><span class="line"><span class="keyword">@keyframes</span> blink &#123;<span class="selector-class">.opacityLoop</span>(<span class="number">0</span>);&#125;</span><br></pre></td></tr></table></figure><p></p><p>经过验证,结果正确。<br>其实，上述的代码是否看起来还有点累赘，<code>@keyframes</code>的定义没有用<code>mixin</code>，但是<code>less</code>没办法做到，而<code>sass</code>可以像下面这样写：<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">//支持多属性的0%和100%</span><br><span class="line">@mixin keyframes($name,$props,$starts,$ends)&#123;</span><br><span class="line">  @-webkit-keyframes #&#123;$name&#125; &#123;@include frames($props,$starts,$ends);&#125;</span><br><span class="line">  @-moz-keyframes #&#123;$name&#125; &#123;@include frames($props,$starts,$ends);&#125;</span><br><span class="line">  @-o-keyframes #&#123;$name&#125; &#123;@include frames($props,$starts,$ends);&#125;</span><br><span class="line">  @keyframes #&#123;$name&#125; &#123;@include frames($props,$starts,$ends);&#125;</span><br><span class="line">&#125;</span><br><span class="line">@mixin frames($props,$starts,$ends)&#123;</span><br><span class="line">  $length:length($props);</span><br><span class="line">  0% &#123;</span><br><span class="line">    @for $i from 1 through $length&#123;</span><br><span class="line">      $prop:nth($props,$i);</span><br><span class="line">      #&#123;$prop&#125;:nth($starts,$i);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  100%&#123;</span><br><span class="line">    @for $j from 1 through $length&#123;</span><br><span class="line">      $prop:nth($props,$j);</span><br><span class="line">      #&#123;$prop&#125;:nth($ends,$j);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">//外部直接调用</span><br><span class="line">@include keyframes(blink,background-color border-width,#f00 1px,#0f0 5px);</span><br></pre></td></tr></table></figure><p></p><h3 id="import导入的路径问题"><a href="#import导入的路径问题" class="headerlink" title="import导入的路径问题"></a>import导入的路径问题</h3><p>我们通常会将公共的颜色和mixin提取出来，放在一个文件里。那么如何引入此文件呢？<br>默认:当前路径<br></p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@import</span> (keyword) <span class="string">"filename"</span>;</span><br></pre></td></tr></table></figure><p></p><p>现在，我有一个<code>demo1.less</code>需要引用<code>base.less</code>，他们的路径如图:<br><img src="https://tang-blog-1257996120.cos-website.ap-chengdu.myqcloud.com/less%E4%B9%8Bimport.png" alt="引用base.less"><br>使用相对路径：<br></p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@import</span> (keyword) <span class="string">"../../../furnace/less/base.less"</span>;</span><br></pre></td></tr></table></figure><p></p><p>使用绝对路径:<br></p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@import</span> (keyword) <span class="string">"WebRoot\furnace\less\base.less"</span>;</span><br></pre></td></tr></table></figure><p></p><p><strong>ps</strong>:还可以直接从你的 node_modules 文件夹中加载 LESS 文件。</p><p><strong>结语：</strong>不论是<code>less</code>还是<code>sass</code>，都只是个工具，不应该在这上面花费大量的精力来玩花它。附一张百度找的<code>less</code>的思维导图,如下：<br><img src="https://tang-blog-1257996120.cos-website.ap-chengdu.myqcloud.com/less%E6%80%9D%E7%BB%B4%E5%AF%BC%E5%9B%BE.png" alt="less思维导图"><br>话说这思维导图不全，以后有时间自己做个。所谓的有时间，大概又是了了无期…</p>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[正则RegExp中的九曲十八弯]]></title>
      <url>https://jintang.github.io/2016/10/25/%E6%AD%A3%E5%88%99RegExp%E4%B8%AD%E7%9A%84%E4%B9%9D%E6%9B%B2%E5%8D%81%E5%85%AB%E5%BC%AF/</url>
      <content type="html"><![CDATA[<blockquote><p>很多知识都是有许多不被注意的细节，一不小心就会拐错了弯，翻了车。今天说几个正则需要注意的地方。</p></blockquote><h3 id="正则和string常用的方法"><a href="#正则和string常用的方法" class="headerlink" title="正则和string常用的方法"></a>正则和string常用的方法</h3><h4 id="正则表达式验证字符串的方法"><a href="#正则表达式验证字符串的方法" class="headerlink" title="正则表达式验证字符串的方法"></a>正则表达式验证字符串的方法</h4><ol><li><code>reg.exec(string)</code>:<ul><li>如果执行exec方法的正则表达式没有分组（没有括号括起来的内容），那么如果有匹配，他将返回一个只有一个元素的数组(不论正则是否有标志g)，这个数组唯一的元素就是该正则表达式匹配的第一个串;如果没有匹配则返回null</li><li>exec如果找到了匹配，而且包含分组的话，返回的数组将包含多个元素，第一个元素是找到的匹配，之后的元素依次为该匹配中的第一、第二…个分组</li></ul></li><li><code>reg.test(string)</code>: 返回的是true和false。</li></ol><h4 id="字符串验证正则的方法"><a href="#字符串验证正则的方法" class="headerlink" title="字符串验证正则的方法"></a>字符串验证正则的方法</h4><ol><li><code>string.match(reg/str)</code>:<ul><li>参数为reg时返回符合正则的子串，但是被封装在数组里;不同于<code>reg.exec()</code>，如果正则带有标志g,且有多个匹配的子串，会返回有多个元素的数组。</li><li>参数为str时若包含返回该str，不包含时返回<code>null</code><br><strong>tip:特殊情况</strong><code>&#39;1 2 ()&#39;.match(&#39;1 2 ()&#39;)</code>，当字符串里面有<code>()</code>时<code>match</code>直接返回<code>null</code>，因为括号是正则中特殊的存在，可以匹配<code>$N</code>。此时用<code>indexOf()</code>。</li></ul></li><li><code>string.replace(reg/str,replacement)</code>:将字符串 满足reg的子串/指定的str 替换为replacement，返回值为替换后的结果，原变量不变</li><li><code>string.search(reg)</code>:作用类似于<code>string.indexOf()</code>,返回符合正则的起始下标，如果没找到也为-1</li></ol><h3 id="RegExp静态属性"><a href="#RegExp静态属性" class="headerlink" title="RegExp静态属性"></a>RegExp静态属性</h3><p><code>$1...$9</code>:每当产生一个带括号的成功匹配时，$1…$9 属性的值就被修改。可以在一个正则表达式模式中指定任意多个带括号的子匹配，但只能存储最新的九个。<br><strong>Note:</strong></p><ul><li>这些属性是RegExp的静态属性，而非RegExp实例的属性。</li><li>这些属性是全局的，只要对正则有影响，就会改变这几个属性的值</li></ul><a id="more"></a><h3 id="RegExp-对象中需要注意的属性：lastIndex"><a href="#RegExp-对象中需要注意的属性：lastIndex" class="headerlink" title="RegExp 对象中需要注意的属性：lastIndex"></a>RegExp 对象中需要注意的属性：<code>lastIndex</code></h3><p>这是一个例子：<br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> reg=<span class="regexp">/^(\d+)\.(\d+)\.(\d+)\.(\d+)$/g</span>;</span><br><span class="line"><span class="comment">//$1...$9对应的是带括号的正则匹配的值中最近的第1-9个</span></span><br><span class="line"><span class="keyword">var</span> Arr=[<span class="string">'192.168.1.1'</span>,<span class="string">'192.168.1.2'</span>];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> j=<span class="number">0</span>;j&lt;Arr.length;j++)&#123;</span><br><span class="line">    <span class="comment">//每次匹配时lastIndex会更新为匹配子串结束时的index+1，此处为11</span></span><br><span class="line">    reg.lastIndex=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(!reg.test(Arr[j]))&#123;</span><br><span class="line">        <span class="comment">//若不将lastIndex重新设为0，明明符合正则的字串却会进入此步骤，就会出错</span></span><br><span class="line">        result=<span class="literal">false</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>( <span class="built_in">RegExp</span>.$<span class="number">1</span> &gt;=<span class="number">256</span> || <span class="built_in">RegExp</span>.$<span class="number">2</span>&gt;=<span class="number">256</span> || <span class="built_in">RegExp</span>.$<span class="number">3</span>&gt;=<span class="number">256</span> || <span class="built_in">RegExp</span>.$<span class="number">4</span>&gt;=<span class="number">256</span>)&#123;</span><br><span class="line">            result = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>这是<code>RegExp</code>对象<code>$1...$9</code>值的变化：<br><img src="https://tang-blog-1257996120.cos-website.ap-chengdu.myqcloud.com/regExp1.png" alt="$1...$9的值"><img src="https://tang-blog-1257996120.cos-website.ap-chengdu.myqcloud.com/regExp2.png" alt="$1...$9的值"><br>可以看到，每次循环<code>$1...$4</code>是新匹配的4个<br>附上<a href="https://segmentfault.com/u/trigkit4" target="_blank" rel="noopener">trigkit4</a>的正则表达式思维导图一张：<br><img src="https://tang-blog-1257996120.cos-website.ap-chengdu.myqcloud.com/repExp%E6%80%9D%E7%BB%B4%E5%AF%BC%E5%9B%BE.gif" alt="正则思维导图"></p>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[使用handsontable插件修改bug心得]]></title>
      <url>https://jintang.github.io/2016/10/18/%E4%BF%AE%E6%94%B9handsontable%E6%8F%92%E4%BB%B6%E5%BF%83%E5%BE%97/</url>
      <content type="html"><![CDATA[<blockquote><p>这段日子有个坑爹的项目——南网，这篇文章就来纪念它。里面有用到一个jq插件：<a href="https://handsontable.com/" target="_blank" rel="noopener">handsontable</a>,作用是生成一个类似excel的表格，不得不说功能十分强大，实现了类似excel的各种功能，使用的api也比较简单，然而…后面有些莫名其妙的bug，奈何于水平有限，其源码也太长(30000+)，各种嵌套，无法从正确的逻辑中找到出问题的地方，只能在关键的地方强制使用自己的逻辑，下面就说说怎么找这个bug关键的地方</p></blockquote><h3 id="平时修改bug"><a href="#平时修改bug" class="headerlink" title="平时修改bug"></a>平时修改bug</h3><ol><li>js的bug：我总是想一遍过程，整个流程构思的跑一遍，然后哪儿的逻辑出了问题或者疏忽了，自然就知道了对应的地方。</li><li>页面的bug:google浏览器，你懂得。我对页面渲染理解着实不深，所以经常”不求甚解”。</li></ol><h3 id="这次修改handsontable插件bug的经验"><a href="#这次修改handsontable插件bug的经验" class="headerlink" title="这次修改handsontable插件bug的经验"></a>这次修改handsontable插件bug的经验</h3><h4 id="bug1-要渲染的数据很多，但是只显示了一部分"><a href="#bug1-要渲染的数据很多，但是只显示了一部分" class="headerlink" title="bug1:要渲染的数据很多，但是只显示了一部分:"></a>bug1:要渲染的数据很多，但是只显示了一部分:</h4><svg height="597" version="1.1" width="417.171875" xmlns="http://www.w3.org/2000/svg" style="overflow:hidden;position:relative" viewbox="0 0 417.171875 597" preserveaspectratio="xMidYMid meet"><desc style="-webkit-tap-highlight-color:transparent">Created with Raphaël 2.1.2</desc><defs style="-webkit-tap-highlight-color:transparent"><path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block-obj27" style="-webkit-tap-highlight-color:transparent"/><marker id="raphael-marker-endblock33-obj28" markerheight="3" markerwidth="3" orient="auto" refx="1.5" refy="1.5" style="-webkit-tap-highlight-color:transparent"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block-obj27" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color:transparent"/></marker></defs><rect x="0" y="0" width="383" height="55" r="20" rx="20" ry="20" fill="#ffffff" stroke="#000000" style="-webkit-tap-highlight-color:transparent" stroke-width="2" class="flowchart" id="st" transform="matrix(1,0,0,1,18.0859,4)"/><text x="10" y="27.5" text-anchor="start" font="10px &quot;Arial&quot;" stroke="none" fill="#000000" style="-webkit-tap-highlight-color:transparent;text-anchor:start;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;font-size:15px;line-height:normal;font-family:Arial" id="stt" class="flowchartt" font-size="15px" transform="matrix(1,0,0,1,18.0859,4)" stroke-width="1"><tspan style="-webkit-tap-highlight-color:transparent" dy="-3.5">根据官方demo发现handsontable是先渲染一部分数据，</tspan><tspan dy="18" x="10" style="-webkit-tap-highlight-color:transparent">然后滚动的时候渲染新数据</tspan></text><rect x="0" y="0" width="392" height="55" r="0" rx="0" ry="0" fill="#ffffff" stroke="#000000" style="-webkit-tap-highlight-color:transparent" stroke-width="2" class="flowchart" id="op1" transform="matrix(1,0,0,1,13.5859,113)"/><text x="10" y="27.5" text-anchor="start" font="10px &quot;Arial&quot;" stroke="none" fill="#000000" style="-webkit-tap-highlight-color:transparent;text-anchor:start;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;font-size:15px;line-height:normal;font-family:Arial" id="op1t" class="flowchartt" font-size="15px" transform="matrix(1,0,0,1,13.5859,113)" stroke-width="1"><tspan style="-webkit-tap-highlight-color:transparent" dy="-3.5">在页面上使用开发者工具查看handsontable的绑定事件，</tspan><tspan dy="18" x="10" style="-webkit-tap-highlight-color:transparent">发现事件:wheel</tspan></text><rect x="0" y="0" width="350" height="55" r="0" rx="0" ry="0" fill="#ffffff" stroke="#000000" style="-webkit-tap-highlight-color:transparent" stroke-width="2" class="flowchart" id="op2" transform="matrix(1,0,0,1,34.5859,222)"/><text x="10" y="27.5" text-anchor="start" font="10px &quot;Arial&quot;" stroke="none" fill="#000000" style="-webkit-tap-highlight-color:transparent;text-anchor:start;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;font-size:15px;line-height:normal;font-family:Arial" id="op2t" class="flowchartt" font-size="15px" transform="matrix(1,0,0,1,34.5859,222)" stroke-width="1"><tspan style="-webkit-tap-highlight-color:transparent" dy="-3.5">查看绑定事件的地方，发现嵌套多层，理不清楚，</tspan><tspan dy="18" x="10" style="-webkit-tap-highlight-color:transparent">转而在源码中搜索关键字:wheel</tspan></text><rect x="0" y="0" width="320.328125" height="37" r="0" rx="0" ry="0" fill="#ffffff" stroke="#000000" style="-webkit-tap-highlight-color:transparent" stroke-width="2" class="flowchart" id="op3" transform="matrix(1,0,0,1,49.4219,340)"/><text x="10" y="18.5" text-anchor="start" font="10px &quot;Arial&quot;" stroke="none" fill="#000000" style="-webkit-tap-highlight-color:transparent;text-anchor:start;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;font-size:15px;line-height:normal;font-family:Arial" id="op3t" class="flowchartt" font-size="15px" transform="matrix(1,0,0,1,49.4219,340)" stroke-width="1"><tspan style="-webkit-tap-highlight-color:transparent" dy="5.5">搜索发现wheel都与方法：onTableScroll()有关</tspan></text><rect x="0" y="0" width="357.328125" height="55" r="0" rx="0" ry="0" fill="#ffffff" stroke="#000000" style="-webkit-tap-highlight-color:transparent" stroke-width="2" class="flowchart" id="op4" transform="matrix(1,0,0,1,30.9219,431)"/><text x="10" y="27.5" text-anchor="start" font="10px &quot;Arial&quot;" stroke="none" fill="#000000" style="-webkit-tap-highlight-color:transparent;text-anchor:start;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;font-size:15px;line-height:normal;font-family:Arial" id="op4t" class="flowchartt" font-size="15px" transform="matrix(1,0,0,1,30.9219,431)" stroke-width="1"><tspan style="-webkit-tap-highlight-color:transparent" dy="-3.5">在onTableScroll()内打断点，查看代码执行的步骤，</tspan><tspan dy="18" x="10" style="-webkit-tap-highlight-color:transparent">通过对比官方demo发现步骤中不同的地方</tspan></text><rect x="0" y="0" width="411.171875" height="55" r="20" rx="20" ry="20" fill="#ffffff" stroke="#000000" style="-webkit-tap-highlight-color:transparent" stroke-width="2" class="flowchart" id="end" transform="matrix(1,0,0,1,4,540)"/><text x="10" y="27.5" text-anchor="start" font="10px &quot;Arial&quot;" stroke="none" fill="#000000" style="-webkit-tap-highlight-color:transparent;text-anchor:start;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;font-size:15px;line-height:normal;font-family:Arial" id="endt" class="flowchartt" font-size="15px" transform="matrix(1,0,0,1,4,540)" stroke-width="1"><tspan style="-webkit-tap-highlight-color:transparent" dy="-3.5">在自己使用handsontable的地方加一个全局变量:window.flag</tspan><tspan dy="18" x="10" style="-webkit-tap-highlight-color:transparent">，在onTableScroll()中使用此变量来强制执行正确的步骤</tspan><tspan dy="18" x="10" style="-webkit-tap-highlight-color:transparent"/></text><path fill="none" stroke="#000000" d="M209.5859375,59C209.5859375,59,209.5859375,98.65409994125366,209.5859375,110.00043908460066" stroke-width="2" marker-end="url(#raphael-marker-endblock33-obj28)" style="-webkit-tap-highlight-color:transparent"/><path fill="none" stroke="#000000" d="M209.5859375,168C209.5859375,168,209.5859375,207.65409994125366,209.5859375,219.00043908460066" stroke-width="2" marker-end="url(#raphael-marker-endblock33-obj28)" style="-webkit-tap-highlight-color:transparent"/><path fill="none" stroke="#000000" d="M209.5859375,277C209.5859375,277,209.5859375,324.48365688323975,209.5859375,337.0037617255002" stroke-width="2" marker-end="url(#raphael-marker-endblock33-obj28)" style="-webkit-tap-highlight-color:transparent"/><path fill="none" stroke="#000000" d="M209.5859375,377C209.5859375,377,209.5859375,416.65409994125366,209.5859375,428.00043908460066" stroke-width="2" marker-end="url(#raphael-marker-endblock33-obj28)" style="-webkit-tap-highlight-color:transparent"/><path fill="none" stroke="#000000" d="M209.5859375,486C209.5859375,486,209.5859375,525.6540999412537,209.5859375,537.0004390846007" stroke-width="2" marker-end="url(#raphael-marker-endblock33-obj28)" style="-webkit-tap-highlight-color:transparent"/></svg><blockquote><p>注：使用全局变量window.flag是为了在其他地方不影响</p></blockquote><a id="more"></a><h4 id="bug2-n-双击编辑时弹框位置不对、点击某些单元格时却滚动到表格顶部、下拉列表的显示位置不对…"><a href="#bug2-n-双击编辑时弹框位置不对、点击某些单元格时却滚动到表格顶部、下拉列表的显示位置不对…" class="headerlink" title="bug2-n:双击编辑时弹框位置不对、点击某些单元格时却滚动到表格顶部、下拉列表的显示位置不对…"></a>bug2-n:双击编辑时弹框位置不对、点击某些单元格时却滚动到表格顶部、下拉列表的显示位置不对…</h4><p><svg height="752.75" version="1.1" width="792.625" xmlns="http://www.w3.org/2000/svg" style="overflow:hidden;position:relative" viewbox="0 0 792.625 752.75" preserveaspectratio="xMidYMid meet"><desc style="-webkit-tap-highlight-color:transparent">Created with Raphaël 2.1.2</desc><defs style="-webkit-tap-highlight-color:transparent"><path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block-obj65" style="-webkit-tap-highlight-color:transparent"/><marker id="raphael-marker-endblock33-obj66" markerheight="3" markerwidth="3" orient="auto" refx="1.5" refy="1.5" style="-webkit-tap-highlight-color:transparent"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block-obj65" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color:transparent"/></marker></defs><rect x="0" y="0" width="379.171875" height="55" r="20" rx="20" ry="20" fill="#ffffff" stroke="#000000" style="-webkit-tap-highlight-color:transparent" stroke-width="2" class="flowchart" id="st" transform="matrix(1,0,0,1,8.9141,49.625)"/><text x="10" y="27.5" text-anchor="start" font="10px &quot;Arial&quot;" stroke="none" fill="#000000" style="-webkit-tap-highlight-color:transparent;text-anchor:start;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;font-size:15px;line-height:normal;font-family:Arial" id="stt" class="flowchartt" font-size="15px" transform="matrix(1,0,0,1,8.9141,49.625)" stroke-width="1"><tspan style="-webkit-tap-highlight-color:transparent" dy="-3.5">开发者工具查看绑定事件，找到可以搜索的关键字：</tspan><tspan dy="18" x="10" style="-webkit-tap-highlight-color:transparent">click、mousedown、mouseup、edit、select、render…</tspan></text><rect x="0" y="0" width="365" height="55" r="0" rx="0" ry="0" fill="#ffffff" stroke="#000000" style="-webkit-tap-highlight-color:transparent" stroke-width="2" class="flowchart" id="op1" transform="matrix(1,0,0,1,16,204.25)"/><text x="10" y="27.5" text-anchor="start" font="10px &quot;Arial&quot;" stroke="none" fill="#000000" style="-webkit-tap-highlight-color:transparent;text-anchor:start;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;font-size:15px;line-height:normal;font-family:Arial" id="op1t" class="flowchartt" font-size="15px" transform="matrix(1,0,0,1,16,204.25)" stroke-width="1"><tspan style="-webkit-tap-highlight-color:transparent" dy="-3.5">搜索关键字，在觉得有可能影响的地方都打上断点，</tspan><tspan dy="18" x="10" style="-webkit-tap-highlight-color:transparent">如果关键字是方法，那调用它的地方都有可能影响</tspan></text><rect x="0" y="0" width="389" height="37" r="0" rx="0" ry="0" fill="#ffffff" stroke="#000000" style="-webkit-tap-highlight-color:transparent" stroke-width="2" class="flowchart" id="op2" transform="matrix(1,0,0,1,4,367.875)"/><text x="10" y="18.5" text-anchor="start" font="10px &quot;Arial&quot;" stroke="none" fill="#000000" style="-webkit-tap-highlight-color:transparent;text-anchor:start;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;font-size:15px;line-height:normal;font-family:Arial" id="op2t" class="flowchartt" font-size="15px" transform="matrix(1,0,0,1,4,367.875)" stroke-width="1"><tspan style="-webkit-tap-highlight-color:transparent" dy="5.5">开始苦逼的调试，在触发哪个断点的时候导致了bug发生</tspan></text><path fill="#ffffff" stroke="#000000" d="M73.125,36.5625L0,73.125L146.25,146.25L292.5,73.125L146.25,0L0,73.125" stroke-width="2" id="cond" class="flowchart" style="-webkit-tap-highlight-color:transparent" transform="matrix(1,0,0,1,52.25,458.875)"/><text x="78.125" y="73.125" text-anchor="start" font="10px &quot;Arial&quot;" stroke="none" fill="#000000" style="-webkit-tap-highlight-color:transparent;text-anchor:start;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;font-size:15px;line-height:normal;font-family:Arial" id="condt" class="flowchartt" font-size="15px" transform="matrix(1,0,0,1,52.25,458.875)" stroke-width="1"><tspan style="-webkit-tap-highlight-color:transparent" dy="-12.5">是否由包含该断点</tspan><tspan dy="18" x="78.125" style="-webkit-tap-highlight-color:transparent">的方法里的步骤导致的，</tspan><tspan dy="18" x="78.125" style="-webkit-tap-highlight-color:transparent">是或否？</tspan></text><rect x="0" y="0" width="270" height="37" r="20" rx="20" ry="20" fill="#ffffff" stroke="#000000" style="-webkit-tap-highlight-color:transparent" stroke-width="2" class="flowchart" id="e" transform="matrix(1,0,0,1,63.5,713.75)"/><text x="10" y="18.5" text-anchor="start" font="10px &quot;Arial&quot;" stroke="none" fill="#000000" style="-webkit-tap-highlight-color:transparent;text-anchor:start;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;font-size:15px;line-height:normal;font-family:Arial" id="et" class="flowchartt" font-size="15px" transform="matrix(1,0,0,1,63.5,713.75)" stroke-width="1"><tspan style="-webkit-tap-highlight-color:transparent" dy="5.5">使用全局变量，在该步骤处”拨乱反正”</tspan><tspan dy="18" x="10" style="-webkit-tap-highlight-color:transparent"/></text><rect x="0" y="0" width="125" height="55" r="0" rx="0" ry="0" fill="#ffffff" stroke="#000000" style="-webkit-tap-highlight-color:transparent" stroke-width="2" class="flowchart" id="op3" transform="matrix(1,0,0,1,530.75,504.5)"/><text x="10" y="27.5" text-anchor="start" font="10px &quot;Arial&quot;" stroke="none" fill="#000000" style="-webkit-tap-highlight-color:transparent;text-anchor:start;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;font-size:15px;line-height:normal;font-family:Arial" id="op3t" class="flowchartt" font-size="15px" transform="matrix(1,0,0,1,530.75,504.5)" stroke-width="1"><tspan style="-webkit-tap-highlight-color:transparent" dy="-3.5">以包含该断点的</tspan><tspan dy="18" x="10" style="-webkit-tap-highlight-color:transparent">方法名为关键字</tspan></text><path fill="none" stroke="#000000" d="M198.5,104.625C198.5,104.625,198.5,184.60484662652016,198.5,201.24127956738812" stroke-width="2" marker-end="url(#raphael-marker-endblock33-obj66)" style="-webkit-tap-highlight-color:transparent"/><path fill="none" stroke="#000000" d="M198.5,259.25C198.5,259.25,198.5,347.3604063168168,198.5,364.8706286659108" stroke-width="2" marker-end="url(#raphael-marker-endblock33-obj66)" style="-webkit-tap-highlight-color:transparent"/><path fill="none" stroke="#000000" d="M198.5,404.875C198.5,404.875,198.5,444.52909994125366,198.5,455.87543908460066" stroke-width="2" marker-end="url(#raphael-marker-endblock33-obj66)" style="-webkit-tap-highlight-color:transparent"/><path fill="none" stroke="#000000" d="M198.5,605.125C198.5,605.125,198.5,693.2354063168168,198.5,710.7456286659108" stroke-width="2" marker-end="url(#raphael-marker-endblock33-obj66)" style="-webkit-tap-highlight-color:transparent"/><text x="203.5" y="615.125" text-anchor="start" font="10px &quot;Arial&quot;" stroke="none" fill="#000000" style="-webkit-tap-highlight-color:transparent;text-anchor:start;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;font-size:15px;line-height:normal;font-family:Arial" font-size="15px" stroke-width="1"><tspan style="-webkit-tap-highlight-color:transparent" dy="5.5">yes</tspan></text><path fill="none" stroke="#000000" d="M344.75,532C344.75,532,503.8290500640869,532,527.7530478276312,532" stroke-width="2" marker-end="url(#raphael-marker-endblock33-obj66)" style="-webkit-tap-highlight-color:transparent"/><text x="349.75" y="522" text-anchor="start" font="10px &quot;Arial&quot;" stroke="none" fill="#000000" style="-webkit-tap-highlight-color:transparent;text-anchor:start;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;font-size:15px;line-height:normal;font-family:Arial" font-size="15px" stroke-width="1"><tspan style="-webkit-tap-highlight-color:transparent" dy="5.5">no</tspan></text><path fill="none" stroke="#000000" d="M593.25,559.5C593.25,559.5,593.25,584.5,593.25,584.5C593.25,584.5,790.625,584.5,790.625,584.5C790.625,584.5,790.625,179.25,790.625,179.25C790.625,179.25,198.5,179.25,198.5,179.25C198.5,179.25,198.5,194.62344455718994,198.5,201.25924777425826" stroke-width="2" marker-end="url(#raphael-marker-endblock33-obj66)" style="-webkit-tap-highlight-color:transparent"/></svg><br><strong>总结</strong>:不清楚插件内部逻辑的情况下：搜索关键字，根据打的断点找到关键性代码</p><p>为了找到关键代码，断点是打了n遍，每次都发现外层的方法已经产生了bug，如此循环多次之后才找到。感觉方法很笨，但却很有效，经验大概就是这样起作用。不知道谁有好点的找bug的方法吗，请留言。</p><p><strong>[1]</strong> <code>hexo</code>竟然不支持<code>markdown</code>的流程图语法，上面的流程图是用其他<code>Markdown</code>编辑器生成的<code>html</code><br><strong>[2]</strong> 每次用<code>eclipse</code>打包、启动<code>maven</code>管理的项目都忍不住吐槽，各种报错，浪费时间。最近终于换了<code>idea</code>，和<code>webstorm</code>是一家公司的，真强大啊，再也不用每次更新代码就打包了，而且<code>tomcat</code>还可以配置两个<code>module</code>，不用切来切去，真爽。附上<a href>idea使用教程</a></p>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[不同浏览器通用的事件处理]]></title>
      <url>https://jintang.github.io/2016/10/08/%E4%B8%8D%E5%90%8C%E6%B5%8F%E8%A7%88%E5%99%A8%E9%80%9A%E7%94%A8%E7%9A%84%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86/</url>
      <content type="html"><![CDATA[<blockquote><p>摘抄自：<a href="https://github.com/markyun/Markyun.js/blob/master/markyunjs/WebContent/js/markyun.js" target="_blank" rel="noopener">马云云_理想青年</a></p></blockquote><p>封装的ie和其他浏览器的事件处理：<br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// event(事件)工具集</span></span><br><span class="line">markyun.Event = &#123;</span><br><span class="line">    <span class="comment">// 页面加载完成后</span></span><br><span class="line">    readyEvent : <span class="function"><span class="keyword">function</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (fn==<span class="literal">null</span>) &#123;</span><br><span class="line">            fn=<span class="built_in">document</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> oldonload = <span class="built_in">window</span>.onload;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">window</span>.onload != <span class="string">'function'</span>) &#123;</span><br><span class="line">            <span class="built_in">window</span>.onload = fn;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                oldonload();</span><br><span class="line">                fn();</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 视能力分别使用dom0||dom2||IE方式 来绑定事件</span></span><br><span class="line">    <span class="comment">// 参数： 操作的元素,事件名称 ,事件处理程序</span></span><br><span class="line">    addEvent : <span class="function"><span class="keyword">function</span>(<span class="params">element, type, handler</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (element.addEventListener) &#123;</span><br><span class="line">            element.addEventListener(type, handler, <span class="literal">false</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (element.attachEvent) &#123;</span><br><span class="line">            element.attachEvent(<span class="string">'on'</span> + type, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                handler.call(element);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            element[<span class="string">'on'</span> + type] = handler;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 移除事件</span></span><br><span class="line">    removeEvent : <span class="function"><span class="keyword">function</span>(<span class="params">element, type, handler</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (element.removeEventListener) &#123;</span><br><span class="line">            element.removeEventListener(type, handler, <span class="literal">false</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (element.datachEvent) &#123;</span><br><span class="line">            element.detachEvent(<span class="string">'on'</span> + type, handler);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            element[<span class="string">'on'</span> + type] = <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 阻止事件 (主要是事件冒泡，因为IE不支持事件捕获)</span></span><br><span class="line">    stopPropagation : <span class="function"><span class="keyword">function</span>(<span class="params">ev</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (ev.stopPropagation) &#123;</span><br><span class="line">            ev.stopPropagation();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            ev.cancelBubble = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 取消事件的默认行为</span></span><br><span class="line">    preventDefault : <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (event.preventDefault) &#123;</span><br><span class="line">            event.preventDefault();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            event.returnValue = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 获取事件目标</span></span><br><span class="line">    getTarget : <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> event.target || event.srcElement;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 获取event对象的引用，取到事件的所有信息，确保随时能使用event；</span></span><br><span class="line">    getEvent : <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> ev = e || <span class="built_in">window</span>.event;</span><br><span class="line">        <span class="keyword">if</span> (!ev) &#123;</span><br><span class="line">            <span class="keyword">var</span> c = <span class="keyword">this</span>.getEvent.caller;</span><br><span class="line">            <span class="keyword">while</span> (c) &#123;</span><br><span class="line">                ev = c.arguments[<span class="number">0</span>];</span><br><span class="line">                <span class="keyword">if</span> (ev &amp;&amp; Event == ev.constructor) &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                c = c.caller;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ev;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[浏览器中常用的存储]]></title>
      <url>https://jintang.github.io/2016/10/08/%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%AD%E5%B8%B8%E7%94%A8%E7%9A%84%E5%AD%98%E5%82%A8/</url>
      <content type="html"><![CDATA[<blockquote><p>本文参考:</p><ul><li><a href="http://jerryzou.com/posts/cookie-and-web-storage/" target="_blank" rel="noopener">邹润阳</a></li><li>Storage的用法：<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Storage" target="_blank" rel="noopener">Storage的API</a></li></ul></blockquote><h3 id="localStorage-与-sessionStorage"><a href="#localStorage-与-sessionStorage" class="headerlink" title="localStorage 与 sessionStorage"></a>localStorage 与 sessionStorage</h3><p><code>localStorage</code>与<code>sessionStorage</code>都是h5中出现的，都继承于<code>Storage</code>，用法完全相同</p><h4 id="localStorage"><a href="#localStorage" class="headerlink" title="localStorage"></a>localStorage</h4><ul><li>大小一般都是5M左右。</li><li>除非被手动清除，否则永久保存</li></ul><h4 id="sessionStorage"><a href="#sessionStorage" class="headerlink" title="sessionStorage"></a>sessionStorage</h4><ul><li>大小一般也是5M左右。</li><li>仅在当前会话下有效，关闭 tab 或 浏览器(window) 后被清除<ul><li>刷新页面时不会清除</li><li>页面跳转时，如果还在当前网站范围内则不清除。如果跳转到了其他网站则清除<a id="more"></a></li></ul></li></ul><h4 id="共同的属性与方法"><a href="#共同的属性与方法" class="headerlink" title="共同的属性与方法"></a>共同的属性与方法</h4><ul><li><code>Storage.length</code> : 返回一个整数，表示存储在 Storage 对象中的数据项数量。只读。</li><li><code>Storage.key()</code> ：该方法接受一个数值 n 作为参数，并返回存储中的第 n 个键名。</li><li><code>Storage.getItem()</code> ：该方法接受一个键名作为参数，返回键名对应的值。</li><li><code>Storage.setItem()</code> : 该方法接受一个键名和值作为参数，将会把键值对添加到存储中，如果键名存在，则更新其对应的值。</li><li><code>Storage.removeItem()</code>: 该方法接受一个键名作为参数，并把该键名从存储中删除。</li><li><code>Storage.clear()</code> :调用该方法会清空存储中的所有键名。</li></ul><h3 id="cookie"><a href="#cookie" class="headerlink" title="cookie"></a>cookie</h3><p><code>Cookie</code> 是小甜饼的意思。</p><ul><li><code>cookie</code> 确实非常小，它的大小限制为 4KB 左右。</li><li>一般由服务器生成，可设置失效时间。如果在浏览器端生成 <code>Cookie</code> ，默认是关闭浏览器后失效。</li></ul>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[html我们应该知道的]]></title>
      <url>https://jintang.github.io/2016/09/30/html%E6%88%91%E4%BB%AC%E5%BA%94%E8%AF%A5%E7%9F%A5%E9%81%93%E7%9A%84/</url>
      <content type="html"><![CDATA[<h3 id="document-documentElement"><a href="#document-documentElement" class="headerlink" title="document.documentElement"></a>document.documentElement</h3><p>html页面按大小排序：</p><ol><li>window:整个浏览器窗口，包含工具栏、菜单栏…</li><li>document:整个html，包含<code>&lt;DOCTYPE&gt;</code></li><li>html：根节点,<code>document.documentElement</code>就是<code>html</code>节点</li><li>body: 页面主体</li></ol><p>然后有这样一个问题：如何获取如图的高度?</p><p><img src="https://tang-blog-1257996120.cos-website.ap-chengdu.myqcloud.com/html_height.png" alt="高度"><br>这样获取：<br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.documentElement.clientHeight;</span><br><span class="line"><span class="comment">//document.documentElement.offsetHeight不可以，有时候会出错</span></span><br></pre></td></tr></table></figure><p></p><h3 id="调试鼠标hover时提示框的样式"><a href="#调试鼠标hover时提示框的样式" class="headerlink" title="调试鼠标hover时提示框的样式"></a>调试鼠标hover时提示框的样式</h3><p>我们经常需要设计提示框，在<code>hover</code>时浮现，但是如何在控制台调试这个提示框的样式呢，每次鼠标移开提示框就消失，不胜其烦，这儿有个小技巧</p><ol><li>在提示框上右键<em>检查</em>,找到对应的dom<img src="https://tang-blog-1257996120.cos-website.ap-chengdu.myqcloud.com/inspect.gif" alt="inspect"></li><li>添加dom断点给<code>node removal</code>:<img src="https://tang-blog-1257996120.cos-website.ap-chengdu.myqcloud.com/debug.gif" alt="debugger"></li></ol><p>然后就可以在断点阻塞到提示框显示的时候开心的调试样式了</p><h3 id="在location中传递中文参数"><a href="#在location中传递中文参数" class="headerlink" title="在location中传递中文参数"></a>在location中传递中文参数</h3><p>传递的时候：<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">location.href = <span class="built_in">window</span>.encodeURI(url + <span class="string">'?key=你妹'</span>);</span><br></pre></td></tr></table></figure><p></p><p>获取的时候:<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> search = <span class="built_in">window</span>.decodeURI(location.search);</span><br><span class="line"><span class="comment">// 结果是 ?key=你妹</span></span><br></pre></td></tr></table></figure><p></p>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[jq的promise]]></title>
      <url>https://jintang.github.io/2016/09/30/jq%E7%9A%84promise/</url>
      <content type="html"><![CDATA[<blockquote><p>之前用angular的$http向接口发起请求，里面的回调写法感觉很好看，最近用jquery，也找到相同的写法，展示于此处。</p></blockquote><h3 id="jq-Ajax中的Promise"><a href="#jq-Ajax中的Promise" class="headerlink" title="jq Ajax中的Promise"></a>jq Ajax中的Promise</h3><p>常规的<code>ajax</code>写法：<br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$.ajax(&#123;</span><br><span class="line">    type : <span class="string">"post"</span>,</span><br><span class="line">    dataType : <span class="string">"json"</span>,</span><br><span class="line">    url : <span class="string">"project_getProJect.action"</span>,</span><br><span class="line">    <span class="keyword">async</span> : <span class="literal">true</span>,<span class="comment">//默认就是true，表示异步</span></span><br><span class="line">    data:&#123;<span class="attr">proUuid</span>:uuid&#125;,</span><br><span class="line">    success : <span class="function"><span class="keyword">function</span>(<span class="params">result</span>) </span>&#123;</span><br><span class="line">    &#125;,</span><br><span class="line">    error: <span class="function"><span class="keyword">function</span>(<span class="params">error</span>)</span>&#123;</span><br><span class="line">    &#125;,</span><br><span class="line">    complete: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p></p><p>为了方便使用<code>ajax</code>，封装如下：<br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">AjaxServer</span>(<span class="params">url,data</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $.ajax(&#123;</span><br><span class="line">        type:<span class="string">'POST'</span>,</span><br><span class="line">        url:url,</span><br><span class="line">        data:data,</span><br><span class="line">        dataType:<span class="string">'json'</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><a id="more"></a><p>那么，这个<code>AjaxServer</code>返回的是什么呢？是一个<code>XMLHttpRequest</code>（<code>jqXHR</code>）对象，从jQuery1.5开始，该对象实现了<code>Promise</code>接口, 使它拥有了 <code>Promise</code> 的所有属性、方法和行为。可参考:<a href="http://www.css88.com/jqapi-1.9/category/deferred-object/" target="_blank" rel="noopener">jQuery.Deferred对象</a></p><p>然后就可以这样调用ajax:</p><p><strong>写法1</strong><br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">AjaxServer(url,data).done(<span class="function"><span class="keyword">function</span>(<span class="params">data, textStatus, jqXHR</span>)</span>&#123;</span><br><span class="line">    <span class="comment">//取代了的过时的jqXHR.success()</span></span><br><span class="line">&#125;).fail(<span class="function"><span class="keyword">function</span>(<span class="params">jqXHR, textStatus, errorThrown</span>)</span>&#123;</span><br><span class="line">    <span class="comment">//取代了的过时的jqXHR.error()</span></span><br><span class="line">&#125;).always(<span class="function"><span class="keyword">function</span>(<span class="params">data|jqXHR, textStatus, jqXHR|errorThrown</span>)</span>&#123;</span><br><span class="line">    <span class="comment">//取代了的过时的jqXHR.complete()方法</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//在响应一个成功的请求后，该函数的参数和.done()的参数是相同的。</span></span><br><span class="line">    <span class="comment">//对于失败的请求，参数和.fail()的参数是相同的*/</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p></p><p><strong>写法2</strong><br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">AjaxServer(url,data).then(<span class="function"><span class="keyword">function</span>(<span class="params">data, textStatus, jqXHR</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//封装的.done()</span></span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">jqXHR, textStatus, errorThrown</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//封装的.fail()</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p></p><p>从angular沿袭下来的习惯，我比较喜欢<strong>写法2</strong>。</p><p><strong>Tip:</strong>在调用接口失败时或者接口返回的值不是我们期望的值时，我们经常需要提示，但这两种情况的提示一般是相近的(如果要求不严格的话),所以为了简练，可以这样写：<br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">AjaxServer(url,data).always(<span class="function"><span class="keyword">function</span>(<span class="params">result,textStatus,obj</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(result.data&amp;&amp;result.data==<span class="literal">true</span>)&#123;</span><br><span class="line"></span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">//else里面全是不满足要求的情况，进行提示</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p></p><h3 id="jQuery-Deferred对象"><a href="#jQuery-Deferred对象" class="headerlink" title="jQuery.Deferred对象"></a><a href="http://www.css88.com/jqapi-1.9/category/deferred-object/" target="_blank" rel="noopener">jQuery.Deferred对象</a></h3><blockquote><p>对比参考：<a href="http://jintang.github.io/2016/04/19/angular%E4%B9%8Bpromise%E7%9A%84%E7%94%A8%E6%B3%95/">angular中promise与defer</a></p></blockquote><h4 id="基本用法：强制同步-以点击事件触发为例"><a href="#基本用法：强制同步-以点击事件触发为例" class="headerlink" title="基本用法：强制同步(以点击事件触发为例)"></a>基本用法：强制同步(以点击事件触发为例)</h4><p>html:<br></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">value</span>=<span class="string">"小明"</span> <span class="attr">id</span>=<span class="string">"name"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"查询"</span> <span class="attr">onclick</span>=<span class="string">"search()"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"点击"</span> <span class="attr">onclick</span>=<span class="string">"click1()"</span> <span class="attr">class</span>=<span class="string">"bt"</span> <span class="attr">id</span>=<span class="string">"click1"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"点击"</span> <span class="attr">onclick</span>=<span class="string">"click2()"</span> <span class="attr">class</span>=<span class="string">"bt"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"点击"</span> <span class="attr">onclick</span>=<span class="string">"click3()"</span> <span class="attr">class</span>=<span class="string">"bt"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"点击"</span> <span class="attr">onclick</span>=<span class="string">"click4()"</span> <span class="attr">class</span>=<span class="string">"bt"</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><p>js:<br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">search</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    delegateClick().done(<span class="function"><span class="keyword">function</span>(<span class="params">result</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'search:'</span>+result);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> defer;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">delegateClick</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    defer=$.Deferred();</span><br><span class="line">    $(<span class="string">'.bt'</span>).click();</span><br><span class="line">    <span class="keyword">return</span> defer.promise();<span class="comment">//将defer对象转为promise对象</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">click1</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'1'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">click2</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'2'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">click3</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'3'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">click4</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'模拟ajax的延迟'</span>);</span><br><span class="line">        defer.resolve(<span class="string">'click4执行完了'</span>);</span><br><span class="line">    &#125;,<span class="number">2000</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>点击”查询”按钮的输出结果为：<br><img src="https://tang-blog-1257996120.cos-website.ap-chengdu.myqcloud.com/jq/jq_promise1.png" alt="jq defer"></p><p>从结果可以看出：<code>resolve()</code>触发了<code>done(callback)</code>。其实：</p><ul><li>defer.resolve():触发 done 的回调执行,并传值给回调方法。</li><li>defer.reject():触发 fail 的回调,并传值给回调方法。</li><li>defer.notify():触发 progress 的回调,并传值给回调方法。<br>另外：上面这三个方法都会触发 always 的回调</li></ul><h4 id="链式调用"><a href="#链式调用" class="headerlink" title="链式调用"></a>链式调用</h4><p>有这样三个方法,让他们链式调用<br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">delay</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> defer=$.Deferred();</span><br><span class="line">    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'delay()'</span>);</span><br><span class="line">        defer.resolve();</span><br><span class="line">    &#125;,<span class="number">2000</span>);</span><br><span class="line">    <span class="keyword">return</span> defer.promise();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">animate</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $(<span class="string">'#name'</span>).animate(&#123;<span class="attr">height</span>:<span class="string">'100px'</span>&#125;,<span class="number">1000</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'动画执行完成'</span>);</span><br><span class="line">    &#125;).promise();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">click1</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> defer=$.Deferred();</span><br><span class="line">    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'click1()'</span>);</span><br><span class="line">        defer.resolve();</span><br><span class="line">    &#125;,<span class="number">500</span>);</span><br><span class="line">    <span class="keyword">return</span> defer.promise();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p><strong>写法1</strong><br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">search</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> promiseA=delay();</span><br><span class="line">    <span class="keyword">var</span> promiseB=promiseA.then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span>  animate();</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">var</span> promiseC=promiseB.then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> click1();</span><br><span class="line">    &#125;);</span><br><span class="line">    promiseC.then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'链式调用完成'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>结果如图：<br><img src="https://tang-blog-1257996120.cos-website.ap-chengdu.myqcloud.com/jq/jq_promise2.png" alt="链式调用结果"><br><strong>写法2</strong><br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">search</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//注意：then()里面是函数名，而不是animate()这种，这样then()里面得到的是一个匿名的函数体，</span></span><br><span class="line">    <span class="comment">//而该函数中返回的是 promise 对象，这样才符合了我们对 then 接受参数的要求</span></span><br><span class="line">    $.when(delay()).then(animate).then(click1).then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'链式调用完成'</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>结果同<strong>写法1</strong></p><p><code>$.when()</code>接受一个Promise对象，<a href="http://www.css88.com/jqapi-1.9/jQuery.when/" target="_blank" rel="noopener">$.when更多介绍</a></p><p>如果写作:<br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$.when(delay()).then(animate()).then(click1());</span><br></pre></td></tr></table></figure><p></p><p>那就相当于<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$.when(delay(),animate(),click1());</span><br></pre></td></tr></table></figure><p></p><p>其结果是：三个方法异步一起执行。</p><p><strong>备注：promise与defer的区别</strong><br>promise:promise 对象是没有 resolve , reject , notify 等方法的，也就意味着，你无法针对 promise 对象进行状态更改，只能在 done 或 fail 中进行回调配置。promise相当于defer对象的子集。</p>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[seajs使用中的坑]]></title>
      <url>https://jintang.github.io/2016/09/21/seajs%E4%BD%BF%E7%94%A8%E4%B8%AD%E7%9A%84%E5%9D%91/</url>
      <content type="html"><![CDATA[<blockquote><p>早有耳闻<code>模块化</code>的优点，最近在使用的过程中才慢慢加深了感触，恩…确实方便，下面讲讲我遇到的坑,提一下,seajs是CMD规范</p></blockquote><h3 id="seajs约定的书写规范："><a href="#seajs约定的书写规范：" class="headerlink" title="seajs约定的书写规范："></a>seajs约定的书写规范：</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> path=<span class="string">'./test'</span>;</span><br><span class="line"><span class="built_in">require</span>(path);</span><br></pre></td></tr></table></figure><p>恩，没错，这样是错误的。<code>require</code>只能使用<strong>直接量</strong>,即：字符串常量</p><p>替换的方案：<br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> moduleName=<span class="string">'test'</span>;</span><br><span class="line"><span class="built_in">require</span>.async(<span class="string">'./'</span>+moduleName,<span class="function"><span class="keyword">function</span>(<span class="params">m</span>)</span>&#123;</span><br><span class="line">    m.render();</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p></p><a id="more"></a><h3 id="同步加载多个模块"><a href="#同步加载多个模块" class="headerlink" title="同步加载多个模块"></a>同步加载多个模块</h3><p>在改写项目的时候，有这样一个插件：</p><p><img src="https://tang-blog-1257996120.cos-website.ap-chengdu.myqcloud.com/seajs/kendo.png" alt="kendo"></p><p>没错….要使用这个插件，必须加载这些模块：<code>kendo.button.min.js</code>、<code>kendo.core.min.js</code>、<code>kendo.draganddrop.min.js</code>、<code>kendo.userevents.min.js</code>、<code>kendo.window.min.js</code>。你又猜对了，这些模块间是有依赖关系的，原项目用的是<code>requirejs</code>，依赖如图：<br><img src="https://tang-blog-1257996120.cos-website.ap-chengdu.myqcloud.com/seajs/kendo_depend.png" alt="kendo_depend"></p><p>改写如下：<br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>.async(<span class="string">'kendoCore'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">require</span>.async(<span class="string">'kendoUserevents'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">require</span>.async(<span class="string">'kendoDraganddrop'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="built_in">require</span>.async(<span class="string">'kendoWindow'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                <span class="built_in">require</span>(<span class="string">'kendoButton'</span>);     </span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p></p><p>感觉好傻逼，有木有。。。谁有好点的方法请留言！</p><h3 id="路径解析"><a href="#路径解析" class="headerlink" title="路径解析"></a>路径解析</h3><p><code>seajs.user(&#39;path&#39;)</code> ： <code>seajs</code> 引用路径时默认给加后缀 <code>js</code>，除非路径有 <code>?</code> 或者 尾部以 <code>#</code> 结束 或者载入的是 <code>css</code> 模块。它的与普通的路径解析略有不同：</p><blockquote><p><code>seajs.use()</code> 一般用于载入入口模块，当只有一个入口模块时可以用 <code>data-main</code> 标签代替</p></blockquote><ul><li>相对路径: 以<code>.</code>开头</li><li>绝对路径：以<code>/</code>或<code>http://cdn.com/js/a</code>(这种类型)开头</li><li>顶级路径：不以<code>.</code>或<code>/</code>开头的路径都是顶级路径，此时以<code>Seajs</code>设定的<code>base</code>路径来解析</li></ul>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Grunt实例全解]]></title>
      <url>https://jintang.github.io/2016/08/29/Grunt%E5%AE%9E%E4%BE%8B%E5%85%A8%E8%A7%A3/</url>
      <content type="html"><![CDATA[<blockquote><p>早闻自动化部署大名，可惜我性子懒散，至今才了解了解。官网看了是一头雾水，直到跟着<a href="http://www.cnblogs.com/yexiaochai/p/3603389.html" target="_blank" rel="noopener">叶小钗</a>一笔一画，才了解这个<code>Grunt</code>是怎么一回事，回头再看<a href="http://www.gruntjs.net/sample-gruntfile" target="_blank" rel="noopener">官方案例</a>。对它也再无神秘的面纱，纸上得来终觉浅，绝知此事要躬行。</p></blockquote><h3 id="安装grunt的环境"><a href="#安装grunt的环境" class="headerlink" title="安装grunt的环境"></a>安装grunt的环境</h3><p>首先需要<code>node</code>环境，用<code>npm</code>安装<code>grunt</code><br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g grunt-cli</span><br></pre></td></tr></table></figure><p></p><h3 id="基础实例"><a href="#基础实例" class="headerlink" title="基础实例"></a>基础实例</h3><h4 id="新建一个空文件夹，并添加两个文件：package-json与Gruntfile-js"><a href="#新建一个空文件夹，并添加两个文件：package-json与Gruntfile-js" class="headerlink" title="新建一个空文件夹，并添加两个文件：package.json与Gruntfile.js"></a>新建一个空文件夹，并添加两个文件：<code>package.json</code>与<code>Gruntfile.js</code></h4><blockquote><p>这两个文件要在项目的根目录下</p></blockquote><p><img src="https://tang-blog-1257996120.cos-website.ap-chengdu.myqcloud.com/grunt/grunt1.png" alt="新建的grunt项目"></p><p><code>package.json</code>中添加如下代码，<code>Gruntfile.js</code>中暂且不管：<br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"name"</span>: <span class="string">"my-project-name"</span>,</span><br><span class="line">  <span class="string">"version"</span>: <span class="string">"0.1.0"</span>,</span><br><span class="line">  <span class="string">"devDependencies"</span>: &#123;</span><br><span class="line">    <span class="string">"grunt"</span>: <span class="string">"~0.4.5"</span>,</span><br><span class="line">    <span class="string">"grunt-contrib-jshint"</span>: <span class="string">"~0.10.0"</span>,</span><br><span class="line">    <span class="string">"grunt-contrib-nodeunit"</span>: <span class="string">"~0.4.1"</span>,</span><br><span class="line">    <span class="string">"grunt-contrib-uglify"</span>: <span class="string">"~0.5.0"</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>调用npm命令安装：<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install</span><br></pre></td></tr></table></figure><p></p><p>结果如图：<br><img src="https://tang-blog-1257996120.cos-website.ap-chengdu.myqcloud.com/grunt/grunt2.png" alt="npm install后结果图"><br><a id="more"></a></p><h4 id="创建测试的用例"><a href="#创建测试的用例" class="headerlink" title="创建测试的用例"></a>创建测试的用例</h4><p>如图：</p><p><img src="https://tang-blog-1257996120.cos-website.ap-chengdu.myqcloud.com/grunt/grunt3.png" alt="测试用例"></p><p>里面的代码也是随便写的，只用来演示,为了对比效果，将代码粘贴如下：</p><p><code>test.js</code>：<br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test1</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'test1'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test2</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'test2'</span>);</span><br><span class="line">&#125;</span><br><span class="line">test1();</span><br><span class="line">test2();</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++)&#123;</span><br><span class="line">    cosnole.log(i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p><code>event.js</code>:<br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addEvents1</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"添加event1"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addEvents2</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"添加event2"</span>);</span><br><span class="line">&#125;</span><br><span class="line">addEvents1();</span><br><span class="line"><span class="keyword">var</span> x=<span class="number">10</span>,</span><br><span class="line">    y=<span class="number">10</span>;</span><br><span class="line"><span class="built_in">console</span>.log(x*y);</span><br></pre></td></tr></table></figure><p></p><p><code>require.js</code>是从requirejs官网下载的</p><h4 id="编辑Gruntfile-js"><a href="#编辑Gruntfile-js" class="headerlink" title="编辑Gruntfile.js"></a>编辑<code>Gruntfile.js</code></h4><p>下面是对<code>grunt</code>插件<code>uglify</code>的简单实例<br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">grunt</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 项目配置</span></span><br><span class="line">  grunt.initConfig(&#123;</span><br><span class="line">    pkg: grunt.file.readJSON(<span class="string">'package.json'</span>),</span><br><span class="line">    uglify: &#123;<span class="comment">//任务，名称是插件名</span></span><br><span class="line">      build: &#123;<span class="comment">//目标：可以多个</span></span><br><span class="line">        src: [<span class="string">'src/test.js'</span>,<span class="string">'src/event.js'</span>],</span><br><span class="line">        dest: <span class="string">'dest/uglifyResult.min.js'</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">// 加载提供"uglify"任务的插件</span></span><br><span class="line">  grunt.loadNpmTasks(<span class="string">'grunt-contrib-uglify'</span>);</span><br><span class="line">  <span class="comment">// 默认任务</span></span><br><span class="line">  grunt.registerTask(<span class="string">'default'</span>, [<span class="string">'uglify'</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h4 id="运行grunt"><a href="#运行grunt" class="headerlink" title="运行grunt"></a>运行<code>grunt</code></h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grunt</span><br></pre></td></tr></table></figure><p>结果如图：</p><p><img src="https://tang-blog-1257996120.cos-website.ap-chengdu.myqcloud.com/grunt/grunt4.png" alt="uglify的结果"></p><p>查看<code>uglifyResult.min.js</code>的内容，已经将<code>test.js</code>和<code>event.js</code>的内容压缩到一起了，这儿就不放图了，有兴趣的自己试试。</p><p>经过上面的基础实例，想必已经对<code>grunt</code>的作用和工作原理有所理解,只需写个配置文件，运行下grunt命令，就可以压缩文件了，果然方便。上面只是对<code>grunt</code>插件<code>uglify</code>的演示，其他插件的用法，我们继续。</p><h3 id="Grunt相关配置"><a href="#Grunt相关配置" class="headerlink" title="Grunt相关配置"></a>Grunt相关配置</h3><p>从上面我们看到了<code>grunt</code>有种种插件，各种插件的用法也不尽相同，除此之外，<code>grunt</code>还有一些约定，使得每个<code>grunt</code>插件都可以配置公共属性：</p><h4 id="options"><a href="#options" class="headerlink" title="options"></a>options</h4><h4 id="files"><a href="#files" class="headerlink" title="files"></a>files</h4><blockquote><p>小技巧:</p><ul><li><code>src</code>匹配所有的<code>.styl</code>文件：设置<code>src: &#39;*.styl&#39;</code>是匹配不到的，因为<code>*</code>不匹配<code>/</code>。<code>**</code>可以匹配<code>/</code>，且一个路径中只可以出现一个<code>**</code>，所以可以设置为：<code>src: &#39;**/*.styl&#39;</code></li><li>生成多个<code>dest</code>文件：<code>dest</code>只能是一个字符串，表示单个文件，设置为[‘result/<em>.css</em>‘]会报错，只能用动态创建文件对象：<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">files: [</span><br><span class="line">    &#123;</span><br><span class="line">        expand: <span class="literal">true</span>,</span><br><span class="line">        src: [<span class="string">'*.styl'</span>],</span><br><span class="line">        cwd: <span class="string">'css/stylus/src/'</span>,</span><br><span class="line">        dest: <span class="string">'css/stylus/result/'</span>,</span><br><span class="line">        ext: <span class="string">'.css'</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure></li></ul></blockquote><h3 id="更多实例"><a href="#更多实例" class="headerlink" title="更多实例"></a>更多实例</h3><h4 id="实例1-单独使用concat插件"><a href="#实例1-单独使用concat插件" class="headerlink" title="实例1:单独使用concat插件"></a>实例1:单独使用concat插件</h4><h5 id="package-json不变，Gruntfile-js如下："><a href="#package-json不变，Gruntfile-js如下：" class="headerlink" title="package.json不变，Gruntfile.js如下："></a><code>package.json</code>不变，<code>Gruntfile.js</code>如下：</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">grunt.initConfig(&#123;</span><br><span class="line">    pkg:grunt.file.readJSON(<span class="string">'package.json'</span>),</span><br><span class="line">    concat:&#123;</span><br><span class="line">      options:&#123;</span><br><span class="line">        separator:<span class="string">';'</span><span class="comment">//文件连接处的分隔符</span></span><br><span class="line">      &#125;,</span><br><span class="line">      mytarget:&#123;</span><br><span class="line">        src:<span class="string">'src/*.js'</span>,</span><br><span class="line">        dest:<span class="string">'dest/concatResult.js'</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  grunt.loadNpmTasks(<span class="string">'grunt-contrib-concat'</span>);</span><br><span class="line">  grunt.registerTask(<span class="string">'default'</span>, [<span class="string">'concat'</span>]);</span><br></pre></td></tr></table></figure><h5 id="运行grunt-1"><a href="#运行grunt-1" class="headerlink" title="运行grunt"></a>运行<code>grunt</code></h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grunt</span><br></pre></td></tr></table></figure><p>结果如图：</p><p><img src="https://tang-blog-1257996120.cos-website.ap-chengdu.myqcloud.com/grunt/grunt5.png" alt="concat结果图"></p><p><code>concatResult.js</code>内容</p>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[.shtml中include标签的用法]]></title>
      <url>https://jintang.github.io/2016/07/13/shtml%E4%B8%ADinclude%E6%A0%87%E7%AD%BE%E7%9A%84%E7%94%A8%E6%B3%95/</url>
      <content type="html"><![CDATA[<blockquote><p>我们的<code>html</code>文件类似的有<code>.shtml</code>、<code>shtm</code>，这种和<code>html</code>文件的区别在于：</p></blockquote><ul><li>html是一种静态生成的页面</li><li>shtml是一种基于<code>SSI(Server Side Include)</code>技术的文件,它的机制是动态包含。<ul><li>SSI 就是在 HTML 文件中，可以通过注释行调用的命令;</li><li>当我们向 web服务器比如 apache 请求访问页面时，如果解析到其中有 SSI 包含指令时，就会自动包含被包含的页面;</li><li>包含动作是在每次用户请求页面时发生，所以如果被包含的页面内容有变化，也能实时的反应出来，正因为如此，就很容易用来实现静态页面的动态嵌入，我们就可以把<strong>出现很多的重复区域内容发布成一个独立静态页面</strong>，然后在需要的地方用SSI指令包含进去，比如像<strong>全站的头部和尾部</strong>，<strong>全站最新新闻</strong>等等;</li></ul></li></ul><p>深入理解参考：<a href="http://www.cnblogs.com/zichi/p/5111159.html" target="_blank" rel="noopener">http://www.cnblogs.com/zichi/p/5111159.html</a></p><p>那么，常用的SSI指令是什么呢？是<code>include</code>,用例如下：<br></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 通过注释的方法来嵌入 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--#include virtual="/modelExample/common/title.shtml"--&gt;</span></span><br></pre></td></tr></table></figure><p></p><a id="more"></a><h3 id="include标签的语法-lt-include-PathType-FilePath-gt"><a href="#include标签的语法-lt-include-PathType-FilePath-gt" class="headerlink" title="include标签的语法&lt;!-- #include PathType = FilePath --&gt;"></a>include标签的语法<code>&lt;!-- #include PathType = FilePath --&gt;</code></h3><ul><li><strong>FilePath:</strong>分为<code>绝对路径</code>与<code>相对路径</code><ul><li>绝对路径：以<code>/</code>开头</li><li>相对路径：不是以<code>/</code>开头的都是相对路径</li></ul></li><li><strong>pathType:</strong><code>virtual</code>与<code>file</code><ul><li>virtual:可以使用绝对路径，这样就可以使用指向上层目录</li><li>file:只能是相对路径，不能使用绝对路径，无法指向上层目录</li></ul></li></ul><p><strong>共同点：</strong><code>virtual</code>与<code>file</code>都使用相对路径时，效果一样；</p><p>可以参考：<a href="http://ttaale.iteye.com/blog/1030439" target="_blank" rel="noopener">http://ttaale.iteye.com/blog/1030439</a></p><p>但我测试他说的<code>virtual</code>通过相对路径访问上层目录是不行的</p><p><strong>Tip:</strong>假如<code>include</code>引入了公共头，而在公共头里又引入了其他文件，此时我们的路径是引入公共头的路径，而不是公共头所在的路径。这时候，如果公共头里引入的其他文件是相对路径，就有可能访问不到，所以公共头里引入的其他文件最好是绝对路径。</p>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[js我们应该知道的]]></title>
      <url>https://jintang.github.io/2016/07/08/js%E6%88%91%E4%BB%AC%E5%BA%94%E8%AF%A5%E7%9F%A5%E9%81%93%E7%9A%84/</url>
      <content type="html"><![CDATA[<h3 id="eval-方法的替换方法"><a href="#eval-方法的替换方法" class="headerlink" title="eval()方法的替换方法"></a>eval()方法的替换方法</h3><p>js里有个神奇的方法：<code>eval()</code>，但是不建议使用，原因看看<a href="https://www.zhihu.com/question/20591877" target="_blank" rel="noopener">知乎的回答</a>，但是有时候我们确实需要一个这样作用的方法，下面是替换的方法：<br>来源于<a href="http://blog.csdn.net/xundh/article/details/48153121" target="_blank" rel="noopener">这位前辈的文章</a><br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//计算表达式的值</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">evil</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> Fn = <span class="built_in">Function</span>;  <span class="comment">//一个变量指向Function，防止有些前端编译工具报错</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Fn(<span class="string">'return '</span> + fn)();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p><strong>解释一下</strong>：<br>我们创建方法通常有三种方式：<br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*1.函数声明*/</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fun</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line"><span class="comment">/*2.函数表达式*/</span></span><br><span class="line"><span class="keyword">var</span> aaa=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line"><span class="comment">/*3.用Function构造函数：</span></span><br><span class="line"><span class="comment">* 可接受多个参数，但最后一个参数总是函数体,前面的才是新方法的参数</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">var</span> aaa=<span class="keyword">new</span> <span class="built_in">Function</span>(arg1,arg2...argn);</span><br></pre></td></tr></table></figure><p></p><p>所以,利用<code>Function()</code>构造方法就可以实现<code>eval()</code>的功能<br><a id="more"></a></p><h3 id="对象的属性描述符"><a href="#对象的属性描述符" class="headerlink" title="对象的属性描述符"></a>对象的属性描述符</h3><p>对象有很多属性来描述这个对象的特点，这些属性就叫属性描述符。属性描述符有两种主要形式：<strong>数据描述符</strong> 和 <strong>存取描述符</strong> , 详细请参看 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty" target="_blank" rel="noopener">这儿</a></p><ul><li><strong>两者都是的描述符</strong>：<ul><li><code>configurable</code>: 当且仅当该属性为 <code>true</code> 时，该属性描述符才能够被改变，同时该属性也能从对应的对象上被删除。默认为 <code>false</code> , 当为 <code>false</code> 时, 除 <code>writable</code> 特性外的其他特性不可被修改</li><li><code>enumerable</code>: 当且仅当该属性为 <code>true</code> 时，该属性才能够出现在对象的枚举属性中。默认为 <code>false</code> , 当一个属性不可被枚举时，使用 <code>Object.keys(obj)</code> 是获取不到该属性的，此时可以用 <code>Object.getOwnPropertyNames(obj)</code></li></ul></li><li><strong>数据描述符</strong>：<ul><li><code>value</code>: 可以是任何有效的值（数值，对象，函数等）。默认为 <code>undefined</code></li><li><code>writable</code>: 当且仅当该属性为 <code>true</code> 时， <code>value</code> 才能被赋值运算符改变。默认为 <code>false</code></li></ul></li><li><strong>存取描述符</strong>:<ul><li><code>get</code>: 一个给属性提供 <code>getter</code> 的方法，如果没有 <code>getter</code> 则为 <code>undefined</code> 。该方法返回值被用作属性值。默认为 <code>undefined</code></li><li><code>set</code>: 一个给属性提供 <code>setter</code> 的方法，如果没有 <code>setter</code> 则为 <code>undefined</code> 。该方法将接受唯一参数，并将该参数的新值分配给该属性。默认为 <code>undefined</code></li></ul></li></ul><p><code>Object</code> 有两个方法可以操作属性描述符，分别是：<code>Object.defineProperties(obj, props)</code> 与 <code>Object.defineProperty(obj, prop, descriptor)</code> ,我们知道， <code>vue</code> 的双向绑定就是利用 <code>defineProperty</code> 定义 <code>get</code> 与 <code>set</code> 实现的。</p><p>操作的描述符必须是这两种形式之一，不能同时是两者。所以下面这种是错误的：<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span>.defineProperty(obj, <span class="string">"conflict"</span>, &#123;</span><br><span class="line">  value: <span class="number">0x9f91102</span>, </span><br><span class="line">  get: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0xdeadbeef</span>; </span><br><span class="line">  &#125; </span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// throws a TypeError: value appears only in data descriptors, get appears only in accessor descriptors</span></span><br></pre></td></tr></table></figure><p></p><p>我们默认新创建的对象那些 <code>configurable</code> 等描述符对应的值都是 <code>true</code>，他们继承自原型链。如果要自己定义描述符， 用 <code>Object.create(null)</code> 来创建对象</p><h3 id="setTimeout-fun-time-与setInterval-fun-time"><a href="#setTimeout-fun-time-与setInterval-fun-time" class="headerlink" title="setTimeout(fun,time)与setInterval(fun,time)"></a>setTimeout(fun,time)与setInterval(fun,time)</h3><p>返回值是个唯一标识符，通常是个数字。 用于清除定时器和gc回收，比如：<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> timer = setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;, <span class="number">500</span>)</span><br><span class="line">clearTimeout(timer); <span class="comment">// 清除定时器</span></span><br><span class="line">timer = <span class="literal">null</span>; <span class="comment">// 释放让gc回收</span></span><br></pre></td></tr></table></figure><p></p><p><strong>注意：</strong></p><ol><li><p>在<code>time</code>的延迟之后才可以执行第一次，而不是马上开始执行。即使是<code>setTimeout(fun, 0)</code>，也是在主线程执行后再执行<code>fun</code>.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'a'</span>)</span><br><span class="line">&#125;, <span class="number">0</span>)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'b'</span>)</span><br><span class="line"><span class="comment">// b</span></span><br><span class="line"><span class="comment">// a</span></span><br></pre></td></tr></table></figure></li><li><p>要想循环体立即执行，可以这样：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hand</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        hand()</span><br><span class="line">    &#125;, <span class="number">500</span>)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">new</span> <span class="built_in">Date</span>())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h3 id="方法内部的return-false"><a href="#方法内部的return-false" class="headerlink" title="方法内部的return false"></a>方法内部的<code>return false</code></h3><p>经常可以看到这样的语句:<br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">'a'</span>).bind(<span class="string">'click'</span>,test);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">123</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p><code>return false</code>等于<code>e.preventDefault()</code></p><h3 id="从一个数组中删除子数组"><a href="#从一个数组中删除子数组" class="headerlink" title="从一个数组中删除子数组"></a>从一个数组中删除子数组</h3><p>先看下<strong>第一版</strong>：<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">del</span>(<span class="params">arr, delArr</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; arr.length; i ++) &#123;</span><br><span class="line">      <span class="keyword">let</span> item = arr[i];  </span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; delArr.length; j++) &#123;</span><br><span class="line">        <span class="keyword">let</span> delItem = delArr[j];</span><br><span class="line">        <span class="keyword">if</span> (item === delItem) &#123; <span class="comment">// 满足某种条件</span></span><br><span class="line">            arr.splice(i , <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>乍看之下没问题，但有问题。<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>];</span><br><span class="line"><span class="keyword">let</span> delArr = [<span class="number">4</span>,<span class="number">5</span>];</span><br><span class="line">del(arr, delArr);</span><br><span class="line"><span class="built_in">console</span>.log(arr) <span class="comment">// [1,2,3,5]</span></span><br></pre></td></tr></table></figure><p></p><p>原因很简单，先删除了4，此时5的下标已经往前移动了1，然而循环的i已经到了5当前的下标，所以就跳过了5的判断。下面来个<strong>修复版1</strong>：<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">del</span>(<span class="params">arr, delArr</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; delArr.length; i ++) &#123;</span><br><span class="line">      <span class="keyword">let</span> delItem = delArr[i];  </span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; arr.length; j++) &#123;</span><br><span class="line">        <span class="keyword">let</span> item = arr[j];</span><br><span class="line">        <span class="keyword">if</span> (item === delItem) &#123; <span class="comment">// 满足某种条件</span></span><br><span class="line">            arr.splice(j , <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>只是换了两个循环的顺序，就ok了。因为两个数组里没有重复数据，所以在删除一个元素之后可以通过<code>break</code>直接进行下一次外层循环。得到正确的结果。试试下面的例子：<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">5</span>];</span><br><span class="line"><span class="keyword">let</span> delArr = [<span class="number">4</span>,<span class="number">5</span>];</span><br><span class="line">del(arr, delArr);</span><br><span class="line"><span class="built_in">console</span>.log(arr) <span class="comment">// [1,2,3,4]</span></span><br></pre></td></tr></table></figure><p></p><p>可能是<code>del</code>方法里用了<code>break</code>的原因，去掉之后发现还是同样的结果。原因同<strong>第一版</strong>。<br>再来看看<strong>修复版2</strong>：<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">del</span>(<span class="params">arr, delArr</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; delArr.length; i ++) &#123;</span><br><span class="line">      <span class="keyword">let</span> delItem = delArr[i];  </span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> j = arr.length - <span class="number">1</span>; j &gt; <span class="number">0</span> ; j--) &#123;</span><br><span class="line">        <span class="keyword">let</span> item = arr[j];</span><br><span class="line">        <span class="keyword">if</span> (item === delItem) &#123; <span class="comment">// 满足某种条件</span></span><br><span class="line">            arr.splice(j , <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>再试试上面的例子，得到的结果正确。不论是数组中有没有重复数据，都可以得到正确的结果。原因想必大家一看就明白了，对<code>arr</code>的循环一定要倒序，这样才不会跳过某一项。</p>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[git常用命令]]></title>
      <url>https://jintang.github.io/2016/06/24/git%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/</url>
      <content type="html"><![CDATA[<blockquote><p>仅以此记录自己常忘记的命令</p></blockquote><h3 id="基本配置"><a href="#基本配置" class="headerlink" title="基本配置"></a>基本配置</h3><p>安装完之后需要一些基本配置：</p><ol><li>生成公钥私钥： <code>ssh-keygen</code></li><li><p>在配置用户名和邮箱：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global user.name <span class="string">"用户名"</span></span><br><span class="line">$ git config --global user.email <span class="string">"邮箱"</span></span><br></pre></td></tr></table></figure></li><li><p>可以用 <code>git config --list</code> 查看配置，所有的自定义配置存放在 <code>~/.gitconfig</code> 里</p></li></ol><h3 id="本地仓库-关联-远程仓库"><a href="#本地仓库-关联-远程仓库" class="headerlink" title="本地仓库 关联 远程仓库"></a>本地仓库 关联 远程仓库</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote add origin 远程git仓库地址</span><br></pre></td></tr></table></figure><p>如果是 <code>git clone</code> 下来的仓库，本地仓库与远程仓库是自动关联的。有时候我们本地做了<code>demo</code>，做完之后想上传到<code>github</code>去，就在<code>github</code>上新建了一个仓库，但加上了<code>init README</code>，当我用上面的命令将本地仓库与远程仓库关联之后，由于远程仓库有 <code>README.md</code> 文件，所以需要先 <code>pull</code> ， 但报了下面的错误:<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fatal: refusing to merge unrelated histories</span><br><span class="line">Error redoing merge 1234deadbeef1234deadbeef</span><br></pre></td></tr></table></figure><p></p><p>解决方案:<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git pull origin master --allow-unrelated-histories # git 2.9后可用</span><br></pre></td></tr></table></figure><p></p><h3 id="本地分支-关联-远程分支"><a href="#本地分支-关联-远程分支" class="headerlink" title="本地分支 关联 远程分支"></a>本地分支 关联 远程分支</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch --set-upstream-to=origin/master master</span><br></pre></td></tr></table></figure><p>创建新分支并关联到远程分支，需要先commit或stash本地change<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout -b 本地分支名x origin/远程分支名x</span><br></pre></td></tr></table></figure><p></p><p>创建新分支并关联到远程分支，不需要先commit或stash本地change。直接以远程分支名生成本地分支名，本地的change依然存在<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout -t origin/远程分支名x</span><br></pre></td></tr></table></figure><p></p><p>查看本地分支与远程分支的关联关系<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch -vv</span><br></pre></td></tr></table></figure><p></p><p>如果关联错了先取消与远程仓库的关联，再重新关联分支<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote remove origin # 注意是取消了仓库的关联，还需要重新关联仓库</span><br></pre></td></tr></table></figure><p></p><a id="more"></a><h3 id="一般流程"><a href="#一般流程" class="headerlink" title="一般流程"></a>一般流程</h3><p>经过上面的步骤我们关联了远程仓库和远程分支，然后就可以用下面的步骤工作了。<br>每次操作完可以通过 <code>git status</code> 查看文件状态</p><ol><li><p>add</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git add . # .表示所有</span><br></pre></td></tr></table></figure><p>如果文件提交错了，想撤销：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git reset HEAD &lt;file&gt; # 不指定文件表示所有文件</span><br></pre></td></tr></table></figure><p>如果想要放弃文件修改:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout -- &lt;file&gt; #</span><br></pre></td></tr></table></figure></li><li><p>commit</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git commit -m "本次提交的备注，一般填写内容"</span><br></pre></td></tr></table></figure><p>如果 <code>commit</code> 错了，想撤销：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看 commit 历史，找到想撤销的commit_id</span></span><br><span class="line">git log</span><br><span class="line"><span class="meta">#</span><span class="bash"> 如果不加--hard只会撤销commit信息，而commit的代码不会撤销</span></span><br><span class="line">git reset --hard commit_id</span><br></pre></td></tr></table></figure></li><li><p>push</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 若当前分支有关联的远程分支,下面命令会自动提交到对应的远程分支</span></span><br><span class="line">git push</span><br><span class="line"><span class="meta">#</span><span class="bash"> 指定其他分支提交</span></span><br><span class="line">git push origin 远程分支名</span><br></pre></td></tr></table></figure><p>如果 <code>push</code> 错了，想撤销：<br>先用上面撤销 <code>commit</code> 的办法回退本地代码，然后强制提交覆盖远程代码：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push origin &lt;分支名&gt; --force</span><br></pre></td></tr></table></figure></li></ol><h3 id="分支切换流程"><a href="#分支切换流程" class="headerlink" title="分支切换流程"></a>分支切换流程</h3><p>当你正在进行项目中某一部分的工作，里面的东西处于一个比较杂乱的状态，而你想转到其他分支上进行一些工作。问题是，你不想提交进行了一半的工作，否则以后你无法回到这个工作点。</p><ol><li><p>储藏当前没做完的工作</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git stash</span><br><span class="line"><span class="meta">#</span><span class="bash"> 或</span></span><br><span class="line">git stash save "stash说明"</span><br></pre></td></tr></table></figure><p>查看储藏列表，可能会有多个储藏</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git stash list</span><br></pre></td></tr></table></figure></li><li><p>转到新分支</p><p>我们可以用 <code>git checkout 分支名</code> 切换到该分支 或者 上面提到的 <code>git checkout -b 分支名</code> 创建新分支并转到该分支</p></li><li><p>做完工作重新回到原来分支并恢复储藏</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git stash apply # 默认是最近的储藏</span><br></pre></td></tr></table></figure><p>若要应用更早的储藏</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git stash apply stash@&#123;2&#125; # stash@&#123;2&#125;是 git stash list 下列出的一条储藏id</span><br></pre></td></tr></table></figure></li><li><p>清除储藏<br>随着 <code>git stash list</code> 下的储藏越来越多，我们需要清理一下</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git stash drop stashId</span><br></pre></td></tr></table></figure><p>可以通过<code>git stash pop</code> 同时完成 <code>apply</code> 和 <code>drop</code> 的工作。</p><p>清除所有储藏：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git stash clear</span><br></pre></td></tr></table></figure><p>更多请参考 <a href="http://iissnan.com/progit/html/zh/ch6_3.html" target="_blank" rel="noopener">这儿</a></p></li></ol><h3 id="杂项"><a href="#杂项" class="headerlink" title="杂项"></a>杂项</h3><ol><li><p><code>git branch -a</code> 看不到所有的远程分支：</p><p>我之前克隆了项目的管理端仓库，今天开始写代码。发现同事和我不在一个分支上，他们在 <code>dev</code> 分支，而我在默认的分支。<br>于是我使用 <code>git branch -a</code><br>来查看所有分支，却只能看到 <code>master</code> 分支，远程的 <code>dev</code> 分支我并看不到，飞哥告诉我这个命令： <code>git fetch &lt;远程主机名：默认是origin&gt;</code></p><p>这条语句的作用是：取回远程仓库所有分支的更新。这样就可以看到 <code>origin/dev</code>分支了，然后就可以创建本地对应的分支并 <code>pull</code> 。</p></li></ol>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Ionic监听手机硬键盘的返回键]]></title>
      <url>https://jintang.github.io/2016/06/22/Ionic%E7%9B%91%E5%90%AC%E6%89%8B%E6%9C%BA%E7%A1%AC%E9%94%AE%E7%9B%98%E7%9A%84%E8%BF%94%E5%9B%9E%E9%94%AE/</url>
      <content type="html"><![CDATA[<blockquote><p>我们用ionic打包的app在真机上需要处理手机硬键盘的返回键,下面提供几种方法:</p></blockquote><p><strong>首先,放上<a href="http://ionicframework.com/docs/api/service/$ionicPlatform/" target="_blank" rel="noopener">官方文档</a>和<a href="https://github.com/driftyco/ionic/blob/master/js/angular/service/platform.js#L2" target="_blank" rel="noopener">源码地址</a>,懒得看英文的,就先看我这个吧</strong></p><h3 id="ionicPlatform-registerBackButtonAction-callback-priority-actionId"><a href="#ionicPlatform-registerBackButtonAction-callback-priority-actionId" class="headerlink" title="$ionicPlatform.registerBackButtonAction(callback, priority, [actionId])"></a>$ionicPlatform.registerBackButtonAction(callback, priority, [actionId])</h3><p>这个方法一般放在<code>app.js</code>文件下的<code>run()</code>中,<code>controller</code>中不起作用,实例如下:<br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$ionicPlatform.ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    $ionicPlatform.registerBackButtonAction(<span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">        <span class="comment">//1.可以通过$state.current或$location.href()来判断处于哪个页面</span></span><br><span class="line">        <span class="keyword">if</span>($state.current.name==<span class="string">"order"</span>)&#123;</span><br><span class="line">            <span class="comment">//2.因为run方法中无法注入$scope,只能注入$rootScope,此处通过$rootScope来判断子scope中的变量</span></span><br><span class="line">            <span class="keyword">if</span>($rootScope.$$childHead.button1.state)&#123;</span><br><span class="line">                e.preventDefault();</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                $<span class="built_in">window</span>.history.back();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>($state.current.name==<span class="string">"map"</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>($rootScope.$$childHead.locInterval)&#123;</span><br><span class="line">                $interval.cancel($rootScope.$$childHead.locInterval);</span><br><span class="line">                <span class="built_in">console</span>.debug(<span class="string">'清除map计时器'</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            $<span class="built_in">window</span>.history.back();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//3.阻止默认的行为</span></span><br><span class="line">        e.preventDefault();</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;,<span class="number">101</span>)<span class="comment">//101优先级常用于覆盖‘返回上一个页面’的默认行为  </span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p></p><a id="more"></a><table><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td>callback</td><td>回调方法</td></tr><tr><td>priority</td><td><strong>优先级</strong>:常用的优先级有:100=返回上一个页面;150=side menu;200=关闭modal;300=关闭action sheet;400=关闭popup;500=关闭loading overlay;<strong><em>大于哪个就会覆盖掉哪个默认行为</em></strong></td></tr><tr><td>actionId</td><td>唯一id(选填)</td></tr></tbody></table><h3 id="ionicPlatform-onHardwareBackButton-callback"><a href="#ionicPlatform-onHardwareBackButton-callback" class="headerlink" title="$ionicPlatform.onHardwareBackButton(callback)"></a>$ionicPlatform.onHardwareBackButton(callback)</h3><p>这个方法可以写在<code>controller</code>中,但有个很严重的bug,实例如下:<br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ionicPlatform.ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    $ionicPlatform.onHardwareBackButton(back);</span><br><span class="line">&#125;)</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">back</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'真机返回键事件'</span>);</span><br><span class="line">    <span class="comment">//严重的bug:无法阻止默认的返回事件:返回到上个页面,下面的语句都不起作用</span></span><br><span class="line">    e.preventDefault();</span><br><span class="line">    e.stopProgation();</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>取消注册的返回事件:<code>$ionicPlatform.offHardwareBackButton(callback)</code></p><p>我将此方法写入controller,在按返回键的时候,发生了很奇怪的事:</p><ul><li>第一次进入此页面按返回键:console打印了一遍</li><li>第二次进入此页面按返回键:console打印了二遍</li><li>第三次进入此页面按返回键:console打印了三遍</li></ul><p><strong><em>我分析的原因:</em></strong>虽然事件注册在这个controller里,但是此事件是全局的,每次进入此页面都会多注册一次</p><p><strong><em>解决方案:</em></strong>代码如下:<br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ionicPlatform.offHardwareBackButton($scope.goBack);</span><br><span class="line">$ionicPlatform.onHardwareBackButton($scope.goBack);</span><br><span class="line">$scope.goBack=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">/*这儿要先把之前注册的事件清掉*/</span></span><br><span class="line">    $ionicPlatform.offHardwareBackButton($scope.goBack);</span><br><span class="line">    <span class="comment">// do something...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h3 id="document-addEventListener-‘backbutton’-function-false"><a href="#document-addEventListener-‘backbutton’-function-false" class="headerlink" title="document.addEventListener(‘backbutton’,function,false)"></a>document.addEventListener(‘backbutton’,function,false)</h3><p>这个方法也有那个严重bug,跟上面的<code>onHardwareBackButton</code>的bug一样.<br><strong><em>因为</em></strong>:<code>onHardwareBackButton</code>的源码就是封装的document.addEventListener(‘backbutton’,function,false)</p>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[angular数据双向绑定bug]]></title>
      <url>https://jintang.github.io/2016/05/05/angular%E6%95%B0%E6%8D%AE%E5%8F%8C%E5%90%91%E7%BB%91%E5%AE%9A/</url>
      <content type="html"><![CDATA[<p>本文主要参考:<a href="http://www.ngnice.com/posts/2c8208220edb94" target="_blank" rel="noopener">http://www.ngnice.com/posts/2c8208220edb94</a></p><blockquote><p>angular不推荐直接操作dom,建议使用双向绑定的数据来操作</p></blockquote><h3 id="1-从controller绑定到html上-有时候数据改变了-但是html并不刷新"><a href="#1-从controller绑定到html上-有时候数据改变了-但是html并不刷新" class="headerlink" title="1.从controller绑定到html上,有时候数据改变了,但是html并不刷新"></a>1.从controller绑定到html上,有时候数据改变了,但是html并不刷新</h3><p><strong>原因:</strong>一般是$apply导致的,对于大多数操作，$apply都会自动执行，所以不用担心，但是如果使用了angular之外的功能，比如直接调用了setTimeout函数、挂接了jquery的事件、使用了jquery的ajax操作等等.那么系统就没有机会帮你调用$apply，界面也就没有机会刷新了，但是你如果之后又做了其他会导致$apply的操作，你会发现以前“欠下”的那次界面刷新被正常执行了</p><p><em>例:</em><br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//这种情况下你在页面中绑定的time变量将不会被自动刷新</span></span><br><span class="line">setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  $scope.time = <span class="keyword">new</span> <span class="built_in">Date</span>()</span><br><span class="line">&#125;, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure><p></p><p><strong>解决方案:</strong></p><p>(1). 手动刷新:<br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  $scope.$apply(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    $scope.time = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure><p></p><p>(2). 使用angular内置指令:<strong>因为angular内置指令最后会调用$apply()</strong><br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$timeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  $scope.time = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p></p><a id="more"></a><h3 id="2-从html绑定到controller里-html动态改变了数据-但是controller中数据并不改变"><a href="#2-从html绑定到controller里-html动态改变了数据-但是controller中数据并不改变" class="headerlink" title="2.从html绑定到controller里,html动态改变了数据,但是controller中数据并不改变"></a>2.从html绑定到controller里,html动态改变了数据,但是controller中数据并不改变</h3><p><em>例1:这段代码运行正常</em><br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;label&gt;<span class="xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">ng-model</span>=<span class="string">"color"</span> <span class="attr">value</span>=<span class="string">"red"</span>&gt;</span>  Red <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><span class="xml"><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span></span><br><span class="line">&lt;label&gt;<span class="xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">ng-model</span>=<span class="string">"color"</span> <span class="attr">value</span>=<span class="string">"green"</span>&gt;</span> Green<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><span class="xml"><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span></span><br><span class="line">&lt;label&gt;<span class="xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">ng-model</span>=<span class="string">"color"</span> <span class="attr">value</span>=<span class="string">"blue"</span>&gt;</span> Blue <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><span class="xml"><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span></span><br><span class="line">&lt;!-- color的值会随着选中的单选按钮而改变 --&gt;</span><br><span class="line">&#123;&#123;color&#125;&#125;</span><br></pre></td></tr></table></figure><p></p><p><em>例2:这段代码工作不正常，color值将不会随着选择而变化</em><br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;div ng-repeat=<span class="string">"value in ['red', 'green', 'blue']"</span>&gt;</span><br><span class="line">  &lt;label&gt;<span class="xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">ng-model</span>=<span class="string">"color"</span> <span class="attr">ng-value</span>=<span class="string">"value"</span>&gt;</span>  &#123;&#123;value&#125;&#125; <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line">&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&#123;&#123;color&#125;&#125;</span></span><br></pre></td></tr></table></figure><p></p><p><strong>原因:</strong>ng-repeat创建了一个子scope,对color值的修改，会去修改子级的变量，而父级的同名变量不会被修改。因为<code>angular的继承方式是js的原型继承,外层的color读到的是外层scope的变量,而不会读到子层scope的</code></p><p><strong>解决方案:</strong><br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">div ng-repeat=<span class="string">"value in ['red', 'green', 'blue']"</span>&gt;</span><br><span class="line">  &lt;label&gt;<span class="xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">ng-model</span>=<span class="string">"vm.color"</span> <span class="attr">ng-value</span>=<span class="string">"value"</span>&gt;</span>  &#123;&#123;value&#125;&#125; <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line">&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&#123;&#123;vm.color&#125;&#125;</span></span><br></pre></td></tr></table></figure><p></p><p><strong>分析:</strong>外层scope定义了对象$scope.vm={}(vm此处的寓意是ViewModel),根据js中基本类型与引用类型存储的堆栈方式,在子scope中绑定的是vm.color,改变的vm对象的属性,而不是vm这个对象,所以,赋值会正确的作用到父级scope上.</p><p><strong>关键理解:原型继承,基本类型与引用类型在堆栈中的存储方式</strong></p>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[兔子问题(斐波那契数列)]]></title>
      <url>https://jintang.github.io/2016/04/21/%E5%85%94%E5%AD%90%E9%97%AE%E9%A2%98-%E6%96%90%E6%B3%A2%E9%82%A3%E5%A5%91%E6%95%B0%E5%88%97/</url>
      <content type="html"><![CDATA[<p><strong>有这样一个题目:</strong>已知一对兔子每一个月可以生一对小兔子，而一对兔子出生后第三个月开始生小兔子假如一年内没有发生死亡，则一对兔子一年内能繁殖成多少对？</p><p>之前有人做过,我却怎么想都不明白,今天自己终于想出了方法,唉,这算是我的逻辑觉醒吗?</p><h3 id="方法1"><a href="#方法1" class="headerlink" title="方法1:"></a>方法1:</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr=<span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">12</span>);</span><br><span class="line"><span class="built_in">window</span>.onload=<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;<span class="number">12</span>;i++)&#123;</span><br><span class="line">        arr[i]=<span class="keyword">new</span> <span class="built_in">Object</span>();</span><br><span class="line">        arr[i].count=<span class="number">0</span>;</span><br><span class="line">        arr[i].birth=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    arr[<span class="number">0</span>].count=<span class="number">1</span>;</span><br><span class="line">    arr[<span class="number">1</span>].count=<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">12</span>; i++) &#123;</span><br><span class="line">        addBirth(i);</span><br><span class="line">        <span class="keyword">if</span>(i&gt;<span class="number">1</span>)&#123;</span><br><span class="line">            arr[i].count=dealCount(i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">console</span>.log(i+<span class="number">1</span>+<span class="string">"月为:"</span>+arr[i].count);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//增加兔子的月份</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addBirth</span> (<span class="params">x</span>) </span>&#123;</span><br><span class="line">     <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;x;i++)&#123;</span><br><span class="line">        arr[i].birth++;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//计算当前月的数量=初始时的一对兔子+当前月1个月前的所有能生小兔子的数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dealCount</span> (<span class="params">x</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> rabbit=arr[<span class="number">0</span>].count;</span><br><span class="line">     <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;x;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(arr[i].birth&gt;<span class="number">1</span>)&#123;</span><br><span class="line">            rabbit+=arr[i].count;</span><br><span class="line">        &#125;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> rabbit;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><a id="more"></a><p>这种方法其实不是正常的逻辑,我们知道,斐波那契数列的特征是:f(n)=f(n-1)+f(n-2),按照我的正常逻辑:当月的兔子数=当前月前一个月的兔子数+前一个月可以生育的兔子生下来的兔子数,而我在上面是这样计算的:当月的兔子数=刚开始的1对+1月到当月前一个月所有会生下的兔子数<br>最后的结果是正确的</p><h3 id="方法2"><a href="#方法2" class="headerlink" title="方法2:"></a>方法2:</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createRabbit</span> (<span class="params">birth</span>) </span>&#123;</span><br><span class="line">     <span class="keyword">var</span> obj=<span class="keyword">new</span> <span class="built_in">Object</span>();</span><br><span class="line">     obj.birth=birth || <span class="number">0</span>;</span><br><span class="line">     <span class="keyword">return</span> obj;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> arr=<span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">12</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">window</span>.onload=<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">12</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">var</span> item=<span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line">        <span class="keyword">if</span>(i==<span class="number">0</span>)&#123;</span><br><span class="line">            item.push(createRabbit());</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(i==<span class="number">1</span>)&#123;</span><br><span class="line">            item.push(createRabbit(<span class="number">1</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        arr[i]=item;</span><br><span class="line">        <span class="keyword">if</span>(i&gt;<span class="number">1</span>)&#123;</span><br><span class="line">            addBirth(i);</span><br><span class="line">            dealCount(i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">console</span>.log(i+<span class="number">1</span>+<span class="string">"月为:"</span>+arr[i].length);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addBirth</span> (<span class="params">x</span>) </span>&#123;</span><br><span class="line">     <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;arr[x<span class="number">-1</span>].length;i++)&#123;</span><br><span class="line">        arr[x<span class="number">-1</span>][i].birth++;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dealCount</span> (<span class="params">x</span>) </span>&#123;   </span><br><span class="line">    <span class="comment">//1.先把前一个月的对象赋给这个月, 然后对象里的月份加1</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> k=<span class="number">0</span>;k&lt;arr[x<span class="number">-1</span>].length;k++)&#123;</span><br><span class="line">        <span class="keyword">var</span> obj=createRabbit(arr[x<span class="number">-1</span>][k].birth);</span><br><span class="line">        arr[x].push(obj);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//2.判断里面的兔子月份,超出则判断生小兔子</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;arr[x].length;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(arr[x][i].birth&gt;<span class="number">1</span>)&#123;</span><br><span class="line">            arr[x].push(createRabbit());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>此方法就实现了正常的逻辑,注意里面对象的赋值,区分什么时候该新创建对象,因为对象的值在堆里,改动任何一个该对象的引用都会改变该对象的值</p>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[angular中promise的用法]]></title>
      <url>https://jintang.github.io/2016/04/19/angular%E4%B9%8Bpromise%E7%9A%84%E7%94%A8%E6%B3%95/</url>
      <content type="html"><![CDATA[<p>本文参考自<a href="http://www.cnblogs.com/mliudong/p/4151594.html" target="_blank" rel="noopener">http://www.cnblogs.com/mliudong/p/4151594.html</a></p><h2 id="实例演示"><a href="#实例演示" class="headerlink" title="实例演示"></a>实例演示</h2><p>Promise是一种模式，以同步操作的流程形式来操作异步事件，避免了层层嵌套，可以链式操作异步事件。</p><p><strong>Service:HelloWorld的定义如下:</strong><br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">.factory(<span class="string">'HelloWorld'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">$q, $timeout</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> getMessages = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> deferred = $q.defer();</span><br><span class="line">        $timeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            deferred.resolve([<span class="string">'Hello'</span>, <span class="string">'world'</span>]);</span><br><span class="line">        &#125;, <span class="number">500</span>);</span><br><span class="line">        <span class="keyword">return</span> deferred.promise;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        getMessages: getMessages</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p></p><a id="more"></a><p><strong>Controller代码:</strong><br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">async</span>(<span class="params">sex</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> defer = $q.defer();</span><br><span class="line">    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        $scope.$apply(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            defer.notify(<span class="string">"查询性别中"</span>);</span><br><span class="line">            <span class="keyword">if</span> (sex==<span class="string">'male'</span>) &#123;</span><br><span class="line">                defer.resolve(<span class="string">'性别是'</span> + sex );</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                defer.reject(<span class="string">'性别不是 '</span> + sex);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">    <span class="keyword">return</span> defer.promise;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> sex=<span class="string">'male'</span>;</span><br><span class="line"><span class="keyword">var</span> age=<span class="number">11</span>;</span><br><span class="line"><span class="keyword">var</span> promiseA = <span class="keyword">async</span>(sex);</span><br><span class="line">promiseB=promiseA.then(<span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"第一次promise:"</span>+response);</span><br><span class="line">    <span class="comment">//可以直接返回值</span></span><br><span class="line">    <span class="keyword">return</span> response;</span><br><span class="line">&#125;); </span><br><span class="line">promiseC=promiseB.then(<span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> defer=$q.defer();</span><br><span class="line">    HelloWorld.getMessages().then(<span class="function"><span class="keyword">function</span>(<span class="params">rrr</span>)</span>&#123;</span><br><span class="line">        defer.resolve(<span class="string">'rrr===='</span>+rrr);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"第二次promise:"</span>+rrr);</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">//如果promise里面有回调,不能直接返回,还是要用defer处理后返回defer.promise</span></span><br><span class="line">     <span class="keyword">return</span> defer.promise; </span><br><span class="line">&#125;)</span><br><span class="line">promiseC.then(<span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>&#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">     <span class="built_in">console</span>.log(<span class="string">"第三次promise:"</span>+response);</span><br><span class="line">    &#125;, <span class="number">800</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p></p><p><strong>结果如下:</strong><br>promiseA花费的时间为:1000ms;<br>promiseB花费的时间为:500ms;<br>promiseC花费的时间为:800ms;<br>虽然promiseB花费的时间最短,但是还是按链式执行,结果如下:<br><img src="https://tang-blog-1257996120.cos-website.ap-chengdu.myqcloud.com/promise.png" alt="结果"></p><h2 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h2><h4 id="1-通过调用-q-defferd-返回deffered对象以链式调用"><a href="#1-通过调用-q-defferd-返回deffered对象以链式调用" class="headerlink" title="1. 通过调用 $q.defferd 返回deffered对象以链式调用"></a>1. 通过调用 <code>$q.defferd</code> 返回<code>deffered</code>对象以链式调用</h4><p>获得<code>var defer = $q.defer()</code>;<br><strong>defer有三种方法:</strong></p><ul><li>resolve(value):表示promise执行成功</li><li>reject(reason):表示promise执行失败</li><li>notify(value): 通知promise的执行状态,会被调用0到多次</li></ul><p><strong>deffered 对象属性:</strong></p><p><code>promise</code> ：最后返回的是一个新的deferred对象 promise 属性，而不是原来的deferred对象。这个新的Promise对象只能观察原来Promise对象的状态，而无法修改deferred对象的内在状态。</p><h4 id="2-当创建-deferred-对象时会创建一个新的-promise-对象-并可以通过-deferred-promise-得到该引用。"><a href="#2-当创建-deferred-对象时会创建一个新的-promise-对象-并可以通过-deferred-promise-得到该引用。" class="headerlink" title="2. 当创建 deferred 对象时会创建一个新的 promise 对象,并可以通过 deferred.promise 得到该引用。"></a>2. 当创建 deferred 对象时会创建一个新的 promise 对象,并可以通过 deferred.promise 得到该引用。</h4><p>promise 对象的目的是在 deferred 任务完成时,允许感兴趣的部分取得其执行结果。</p><p><strong>promise的方法:</strong></p><ul><li><em>then(errorHandler, fulfilledHandler, progressHandler)</em> ：then方法用来监听一个Promise的不同状态。errorHandler监听failed状态，fulfilledHandler监听fulfilled状态，progressHandler监听unfulfilled（未完成）状态。此外,notify 回调可能被调用 0到多次，提供一个进度指示在解决或拒绝（resolve和rejected）之前</li><li><em>catch(errorCallback)</em> : promise.then(null, errorCallback) 的快捷方式</li><li><em>finally(callback)</em> : 让你可以观察到一个 promise 是被执行还是被拒绝, 但这样做不用修改最后的 value值。 这可以用来做一些释放资源或者清理无用对象的工作,不管promise 被拒绝还是解决</li></ul><p><strong>Tip:通过then()方法可以实现promise链式调用</strong><br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">promiseB = promiseA.then(<span class="function"><span class="keyword">function</span>(<span class="params">result</span>) </span>&#123;  </span><br><span class="line">  <span class="keyword">return</span> result + <span class="number">1</span>;  </span><br><span class="line">&#125;); </span><br><span class="line"><span class="comment">//promiseB 将会在处理完 promiseA 之后立刻被处理, 并且其result值是promiseA的返回值  </span></span><br><span class="line">promiseB.then(<span class="function"><span class="keyword">function</span>(<span class="params">result</span>)</span>&#123;</span><br><span class="line">    <span class="comment">//do something   </span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p></p>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[浮动闭合的css方法]]></title>
      <url>https://jintang.github.io/2016/04/17/%E5%89%8D%E7%AB%AF%E6%B5%AE%E5%8A%A8%E9%97%AD%E5%90%88%E7%9A%84css%E6%96%B9%E6%B3%95/</url>
      <content type="html"><![CDATA[<p>本文参考自：<a href="http://www.daqianduan.com/3606.html" target="_blank" rel="noopener">大前端</a><br></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="css">    <span class="selector-tag">ul</span>&#123;<span class="attribute">background</span>: <span class="number">#ff0</span>;&#125;</span></span><br><span class="line"><span class="css">    <span class="selector-tag">li</span>&#123;<span class="attribute">float</span>: left;&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>小明<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>小红<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>小白<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><h3 id="1-传统的万能清除方法"><a href="#1-传统的万能清除方法" class="headerlink" title="1.传统的万能清除方法:"></a>1.传统的万能清除方法:</h3><p>给末尾的li元素后面增加一个元素：<code>&lt;div class=&quot;clear&quot;&gt;&lt;/div&gt;</code><br>其样式为：<br></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.clear</span>&#123;<span class="attribute">clear</span>:both;<span class="attribute">height</span>:<span class="number">0</span>;<span class="attribute">overflow</span>:hidden;&#125;</span><br></pre></td></tr></table></figure><p></p><h3 id="2-常用的清除方法"><a href="#2-常用的清除方法" class="headerlink" title="2.常用的清除方法:"></a>2.常用的清除方法:</h3><p>在父类元素上面加类：<code>&lt;ul class=&quot;clearfix&quot;&gt;&lt;/ul&gt;</code>，后面的两个方法也是在父元素上加clearfix类<br>利用伪类,其样式为：<br></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.clearfix</span><span class="selector-pseudo">:before</span>,<span class="selector-class">.clearfix</span><span class="selector-pseudo">:after</span>&#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">''</span>;</span><br><span class="line">    <span class="attribute">display</span>: block;<span class="comment">/*table也可以*/</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.clearfix</span><span class="selector-pseudo">:after</span>&#123;</span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">    <span class="attribute">clear</span>: both;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h3 id="3-最优浮动闭合方案："><a href="#3-最优浮动闭合方案：" class="headerlink" title="3.最优浮动闭合方案："></a>3.最优浮动闭合方案：</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.clearfix&#123;*+height:1%;&#125;</span><br><span class="line"><span class="selector-class">.clearfix</span><span class="selector-pseudo">:after</span>&#123;</span><br><span class="line">    <span class="attribute">content</span>:<span class="string">"."</span>;</span><br><span class="line">    <span class="attribute">display</span>:block;</span><br><span class="line">    <span class="attribute">height</span>:<span class="number">0</span>;</span><br><span class="line">    <span class="attribute">clear</span>:both;</span><br><span class="line">    <span class="attribute">visibility</span>:hidden</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><a id="more"></a><h3 id="4-很拉轰的浮动闭合办法："><a href="#4-很拉轰的浮动闭合办法：" class="headerlink" title="4.很拉轰的浮动闭合办法："></a>4.很拉轰的浮动闭合办法：</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.clearfix</span>&#123;<span class="attribute">overflow</span>:auto;<span class="attribute">_height</span>:<span class="number">1%</span>&#125;</span><br></pre></td></tr></table></figure><h3 id="5-一位网友-radom-提供的"><a href="#5-一位网友-radom-提供的" class="headerlink" title="5.一位网友(radom)提供的:"></a>5.一位网友(radom)提供的:</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.clearfix</span>&#123;<span class="attribute">overflow</span>:hidden;<span class="attribute">_zoom</span>:<span class="number">1</span>;&#125;</span><br></pre></td></tr></table></figure>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Ionic.AngularJs下上传照片]]></title>
      <url>https://jintang.github.io/2016/03/15/angularJs%E3%80%81Ionic%E4%B8%8B%E4%B8%8A%E4%BC%A0%E7%85%A7%E7%89%87/</url>
      <content type="html"><![CDATA[<h3 id="1-安装上传照片需要的插件"><a href="#1-安装上传照片需要的插件" class="headerlink" title="1.安装上传照片需要的插件"></a>1.安装上传照片需要的插件</h3><p>1.先新建一个ionic项目<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ionic start <span class="built_in">test</span> tabs</span></span><br></pre></td></tr></table></figure><p></p><p>2.安装插件<br></p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cordova plugin <span class="keyword">add</span><span class="bash"> cordova-plugin-image-picker</span></span><br><span class="line"><span class="bash">$ cordova plugin add cordova-plugin-camera</span></span><br></pre></td></tr></table></figure><p></p><blockquote><p>我们的yongche项目之前使用的camera插件是org.apache.cordova.camera,此处更新为cordova-plugin-camera,目前老版本的还可以使用</p></blockquote><p>3.添加android环境<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ionic platform add android</span></span><br></pre></td></tr></table></figure><p></p><h3 id="2-配置ng-cordova-js"><a href="#2-配置ng-cordova-js" class="headerlink" title="2.配置ng-cordova.js"></a>2.配置ng-cordova.js</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//在index.html中cordova.js旁边引入ng-cordova.js</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"cordova.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"js/ng-cordova.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在app.js中注入ngCordova</span></span><br><span class="line">angular.module(<span class="string">'starter'</span>, [<span class="string">'ionic'</span>,<span class="string">'ngCordova'</span>]).run(...)</span><br></pre></td></tr></table></figure><h3 id="3-代码实现"><a href="#3-代码实现" class="headerlink" title="3.代码实现"></a>3.代码实现</h3><p>参考:<a href="https://cordova.apache.org/docs/en/latest/cordova-plugin-camera/index.html" target="_blank" rel="noopener">https://cordova.apache.org/docs/en/latest/cordova-plugin-camera/index.html</a><br><a id="more"></a><br>1.controller代码:</p><ul><li>照片被插件处理为base64编码</li><li>上传到处理照片的接口,返回照片的名称(这一步照片其实已经保存在了服务器)</li><li>将所有数据提交到接口,此时照片的字段为照片文件名<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">angular.module(<span class="string">'starter.controllers'</span>, [])</span><br><span class="line">.controller(<span class="string">'TestCtrl'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">$scope,$ionicActionSheet,$compile,$timeout,$ionicPopup,$window,uploadPictureService</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//此处有两个数组分别用来控制添加和删除照片的逻辑,这两个逻辑有冲突,所以要放两个数组</span></span><br><span class="line">    <span class="keyword">var</span> imageURIs= [];</span><br><span class="line">    <span class="keyword">var</span> finalImgUrls=[];</span><br><span class="line"></span><br><span class="line">    <span class="comment">//讲上传的照片动态编译到html上</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">showOnPage</span> (<span class="params">imageURI</span>) </span>&#123;</span><br><span class="line">        imageURIs.push(imageURI);</span><br><span class="line">        finalImgUrls.push(imageURI);<span class="comment">//</span></span><br><span class="line">        <span class="comment">//所以还需要引入jquery</span></span><br><span class="line">        jQuery(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">          <span class="keyword">var</span> im = $(<span class="string">'&lt;div class="col col-33" style="position:relative" id="img_'</span> + imageURIs.length + <span class="string">'"&gt;&lt;span class="delected" ng-click="rmEleApp('</span> + imageURIs.length + <span class="string">')" style="position:absolute;right:15px;top:-10px;font-size:18px;"&gt;x&lt;/span&gt;&lt;img  ng-src="data:image/jpeg;base64,'</span> + imageURI + <span class="string">'"  style="width:70px;height:70px;display:block;margin:0 auto;"  ng-click="scaleImg('</span> + finalImgUrls.length + <span class="string">')" /&gt;&lt;/div&gt;'</span>).prependTo(<span class="string">'#img_up'</span>);</span><br><span class="line">          $compile(im)($scope);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 点击弹出图片选择</span></span><br><span class="line">  $scope.showImageUploadChoices = <span class="function"><span class="keyword">function</span>(<span class="params">prop</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> hideSheet = $ionicActionSheet.show(&#123;</span><br><span class="line">      buttons: [&#123;</span><br><span class="line">        text: <span class="string">'拍照上传'</span></span><br><span class="line">      &#125;, &#123;</span><br><span class="line">        text: <span class="string">'从相册中选'</span></span><br><span class="line">      &#125;],</span><br><span class="line">      titleText: <span class="string">'图片上传'</span>,</span><br><span class="line">      cancelText: <span class="string">'取 消'</span>,</span><br><span class="line">      cancel: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;,</span><br><span class="line">      buttonClicked: <span class="function"><span class="keyword">function</span>(<span class="params">index</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (index == <span class="number">0</span>) &#123; <span class="comment">// 拍照上传</span></span><br><span class="line">          uploadPictureService.taskPicture(prop).then(<span class="function"><span class="keyword">function</span>(<span class="params">imageURI</span>) </span>&#123;</span><br><span class="line">              showOnPage(imageURI);</span><br><span class="line">          &#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">            alert(<span class="string">'wrong'</span>);</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (index == <span class="number">1</span>) &#123; <span class="comment">// 相册文件选择上传</span></span><br><span class="line">          uploadPictureService.readalbum(prop).then(<span class="function"><span class="keyword">function</span>(<span class="params">imageURI</span>) </span>&#123;</span><br><span class="line">            showOnPage(imageURI);</span><br><span class="line">          &#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">            alert(<span class="string">'wrong'</span>);</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">    </span><br><span class="line">  <span class="comment">//照片右上角的X号的触发事件</span></span><br><span class="line">  $scope.rmEleApp = <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> myEl = angular.element(<span class="built_in">document</span>.querySelector(<span class="string">'#img_'</span> + obj));</span><br><span class="line">    myEl.remove();</span><br><span class="line">    images.imageURIs[obj<span class="number">-1</span>]=<span class="string">''</span>;</span><br><span class="line">    <span class="keyword">if</span> ($(<span class="string">'#addPic'</span>).is(<span class="string">':hidden'</span>)) &#123;<span class="comment">//如果加号图片隐藏了,就显示</span></span><br><span class="line">      $(<span class="string">'#addPic'</span>).show();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//点击图片放大</span></span><br><span class="line">  $scope.scaleImg = <span class="function"><span class="keyword">function</span>(<span class="params">index</span>) </span>&#123;</span><br><span class="line">    $ionicPopup.alert(&#123;</span><br><span class="line">      template: <span class="string">'&lt;img src=data:image/jpeg;base64,'</span> + finalImgUrls[index - <span class="number">1</span>] + <span class="string">' style=" display: block; margin: 0 auto;"&gt;'</span>,</span><br><span class="line">      okText: <span class="string">'&lt;span style="background:#fff;"&gt;x&lt;/span&gt;'</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">/*上面的步骤将照片显示在了页面上,但并没有上传到接口-------------------*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//上面的imageURL是用base64加密的很长很长的字串,所以需要另外一个接口单独处理下才可以上传到正式接口</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li></ul><p>2.公共配置上传照片的service与factory<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">angular.module(<span class="string">'starter'</span>)</span><br><span class="line">  .factory(<span class="string">'Camera'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">$q</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        getPicture: <span class="function"><span class="keyword">function</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> q = $q.defer();</span><br><span class="line">            navigator.camera.getPicture(<span class="function"><span class="keyword">function</span>(<span class="params">result</span>) </span>&#123;</span><br><span class="line">                <span class="comment">// Do any magic you need</span></span><br><span class="line">                q.resolve(result);</span><br><span class="line">            &#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">                q.reject(err);</span><br><span class="line">            &#125;, options);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> q.promise;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">.factory(<span class="string">'uploadPictureService'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">$http,$timeout,$compile,Camera,$cordovaImagePicker</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span>&#123;</span><br><span class="line">    <span class="comment">// 读用户相册</span></span><br><span class="line">    readalbum : <span class="function"><span class="keyword">function</span>(<span class="params">prop</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> pictureSource;  <span class="comment">//设定图片来源</span></span><br><span class="line">          <span class="keyword">var</span> destinationType; <span class="comment">//选择返回数据的格式</span></span><br><span class="line">          <span class="built_in">document</span>.addEventListener(<span class="string">"deviceready"</span>,onDeviceReady,<span class="literal">false</span>);</span><br><span class="line">          <span class="comment">// Cordova准备好了可以使用了</span></span><br><span class="line">          <span class="function"><span class="keyword">function</span> <span class="title">onDeviceReady</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">              pictureSource=navigator.camera.PictureSourceType;</span><br><span class="line">              destinationType=navigator.camera.DestinationType;</span><br><span class="line">              encodingType = navigator.camera.EncodingType.JPEG;</span><br><span class="line">              sourceType=pictureSource.SAVEDPHOTOALBUM;</span><br><span class="line">          &#125;</span><br><span class="line">        <span class="keyword">var</span> options = &#123;</span><br><span class="line">          <span class="comment">// maximumImagesCount: 9,</span></span><br><span class="line">          quality: <span class="number">80</span>,</span><br><span class="line">          targetWidth: <span class="number">400</span>,</span><br><span class="line">          targetHeight: <span class="number">400</span>,</span><br><span class="line">          saveToPhotoAlbum: <span class="literal">false</span>,</span><br><span class="line">          destinationType: destinationType.DATA_URL,</span><br><span class="line">          encodingType: encodingType,</span><br><span class="line">          sourceType: sourceType</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">return</span> Camera.getPicture(options);</span><br><span class="line">         <span class="comment">// return $cordovaImagePicker.getPictures(options);</span></span><br><span class="line">         <span class="comment">// $cordovaImagePicker.getPictures(options)</span></span><br><span class="line">         <span class="comment">//    .then(function (results) &#123;</span></span><br><span class="line">         <span class="comment">//      for (var i = 0; i &lt; results.length; i++) &#123;</span></span><br><span class="line">         <span class="comment">//        console.log('Image URI: ' + results[i]);</span></span><br><span class="line">         <span class="comment">//      &#125;</span></span><br><span class="line">         <span class="comment">//    &#125;, function(error) &#123;</span></span><br><span class="line">         <span class="comment">//      // error getting photos</span></span><br><span class="line">         <span class="comment">//    &#125;);</span></span><br><span class="line"></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 拍照</span></span><br><span class="line">    taskPicture : <span class="function"><span class="keyword">function</span>(<span class="params">prop</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!navigator.camera) &#123;</span><br><span class="line">          <span class="built_in">window</span>.plugins.toast.show(<span class="string">'请在真机环境中使用拍照上传。'</span>, <span class="string">'short'</span>, <span class="string">'center'</span>);</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> pictureSource;  <span class="comment">//设定图片来源</span></span><br><span class="line">          <span class="keyword">var</span> destinationType; <span class="comment">//选择返回数据的格式</span></span><br><span class="line">          <span class="built_in">document</span>.addEventListener(<span class="string">"deviceready"</span>,onDeviceReady,<span class="literal">false</span>);</span><br><span class="line">          <span class="comment">// Cordova准备好了可以使用了</span></span><br><span class="line">          <span class="function"><span class="keyword">function</span> <span class="title">onDeviceReady</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">              pictureSource=navigator.camera.PictureSourceType;</span><br><span class="line">              destinationType=navigator.camera.DestinationType;</span><br><span class="line">              encodingType = navigator.camera.EncodingType.JPEG;</span><br><span class="line">              <span class="comment">// sourceType=pictureSource.SAVEDPHOTOALBUM;</span></span><br><span class="line">          &#125;</span><br><span class="line">        <span class="keyword">var</span> options = &#123;</span><br><span class="line">          quality: <span class="number">80</span>,</span><br><span class="line">          targetWidth: <span class="number">400</span>,</span><br><span class="line">          targetHeight: <span class="number">400</span>,</span><br><span class="line">          saveToPhotoAlbum: <span class="literal">false</span>,</span><br><span class="line">          destinationType: destinationType.DATA_URL,</span><br><span class="line">          encodingType: encodingType,</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">return</span> Camera.getPicture(options);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p></p><p>大功告成!</p>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[html屏幕自适应]]></title>
      <url>https://jintang.github.io/2016/02/19/html%E5%B1%8F%E5%B9%95%E8%87%AA%E9%80%82%E5%BA%94/</url>
      <content type="html"><![CDATA[<p>参考：<a href="http://www.ruanyifeng.com/blog/2012/05/responsive_web_design.html" target="_blank" rel="noopener">阮一峰的博客</a></p><h4 id="“自适应网页设计”的核心是：利用media属性判断不同的屏幕分辨率，并根据不同的分辨率适配不同的css"><a href="#“自适应网页设计”的核心是：利用media属性判断不同的屏幕分辨率，并根据不同的分辨率适配不同的css" class="headerlink" title="“自适应网页设计”的核心是：利用media属性判断不同的屏幕分辨率，并根据不同的分辨率适配不同的css"></a>“自适应网页设计”的核心是：利用media属性判断不同的屏幕分辨率，并根据不同的分辨率适配不同的css</h4><p>首先，在网页代码的头部，加入一行viewport元标签:允许网页宽度自动调整。</p><ul><li><p>主流浏览器：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1"</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 网页宽度默认等于屏幕宽度（width=device-width），原始缩放比例（initial-scale=1）为1.0，即网页初始大小占屏幕面积的100% --&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>老式浏览器（主要是IE6、7、8）：要用<a href="https://code.google.com/archive/p/css3-mediaqueries-js" target="_blank" rel="noopener">css3-mediaqueries.js</a></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--[if lt IE 9]&gt;</span></span><br><span class="line"><span class="comment">　　&lt;script src="http://css3-mediaqueries-js.googlecode.com/svn/trunk/css3-mediaqueries.js"&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="comment">&lt;![endif]--&gt;</span></span><br></pre></td></tr></table></figure></li></ul><a id="more"></a><p><strong>1.适配不同css文件</strong></p><p>html中：<br></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">media</span>=<span class="string">"screen and (max-device-width: 400px)"</span> <span class="attr">href</span>=<span class="string">"tinyScreen.css"</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 如果屏幕宽度 小于400像素（max-device-width: 400px），就加载tinyScreen.css文件 --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">media</span>=<span class="string">"screen and (min-width: 400px) and (max-device-width: 600px)"</span> <span class="attr">href</span>=<span class="string">"smallScreen.css"</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 如果屏幕宽度在400像素到600像素之间，则加载smallScreen.css文件 --&gt;</span></span><br></pre></td></tr></table></figure><p></p><p>css中：<br></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">import</span> url(<span class="string">"tinyScreen.css"</span>) screen and (max-device-width: <span class="number">400px</span>);</span><br><span class="line"><span class="comment">/*如果屏幕宽度 小于400像素（max-device-width: 400px），就加载tinyScreen.css文件*/</span></span><br></pre></td></tr></table></figure><p></p><p><strong>2.同一个css文件中也可以适配不同的分辨率</strong><br></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">media</span> screen and (max-device-width: <span class="number">400px</span>) &#123;</span><br><span class="line">　   <span class="comment">/*屏幕宽度 小于400像素（max-device-width: 400px）时采用的样式*/</span>　　　</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[angular下拉列表]]></title>
      <url>https://jintang.github.io/2016/01/07/angular%E4%B8%8B%E6%8B%89%E5%88%97%E8%A1%A8/</url>
      <content type="html"><![CDATA[<p>先自定义用的变量<br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$scope.list=[</span><br><span class="line">    &#123;<span class="attr">id</span>:<span class="number">1</span>,<span class="attr">name</span>:<span class="string">'小明'</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">id</span>:<span class="number">2</span>,<span class="attr">name</span>:<span class="string">'小红'</span>&#125;</span><br><span class="line">];</span><br><span class="line"><span class="comment">//select默认选中的值</span></span><br><span class="line">$scope.default=$scope.list[<span class="number">0</span>].id;</span><br></pre></td></tr></table></figure><p></p><a id="more"></a><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- as前的变量会实现为：&lt;option value="item.id"&gt;，是真实的值 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- as后的变量会实现为：&lt;option&gt;item.name&lt;/option&gt;，是显示的值 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- ng-model绑定的值是选中的&lt;option value&gt;，数据是双向绑定的，所以不再事件传值。值得注意的是：default的类型必须是as前变量的值一致 --&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">ng-options</span>=<span class="string">"item.id as item.name for item in list"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">ng-model</span>=<span class="string">"default"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 下面这个可以不要，有的话会多一个无用选项 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span>&gt;</span>请选择<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>上面的效果是：</strong><br><img src="https://tang-blog-1257996120.cos-website.ap-chengdu.myqcloud.com/angular_select.png" alt="select效果图"></p>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[CSS我们所应该知道的]]></title>
      <url>https://jintang.github.io/2015/12/24/CSS%E6%88%91%E4%BB%AC%E6%89%80%E5%BA%94%E8%AF%A5%E7%9F%A5%E9%81%93%E7%9A%84/</url>
      <content type="html"><![CDATA[<h3 id="文字换行属性-white-space"><a href="#文字换行属性-white-space" class="headerlink" title="文字换行属性:white-space"></a>文字换行属性:<code>white-space</code></h3><p>该属性的常用的值(容器的宽度固定)：</p><ul><li><code>normal</code>: 默认，超出容器范围时换行</li><li><code>nowrap</code>: 超出容器的范围也不换行</li></ul><h3 id="为什么要设置margin-0-padding-0"><a href="#为什么要设置margin-0-padding-0" class="headerlink" title="为什么要设置margin:0;padding:0;"></a>为什么要设置<code>margin:0;padding:0;</code></h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span>&#123;</span><br><span class="line">    <span class="attribute">margin</span>:<span class="number">0</span>;</span><br><span class="line">    <span class="attribute">padding</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">ul</span>&#123;</span><br><span class="line">    <span class="attribute">list-style-type</span>:none;<span class="comment">/*去除li前默认的小圆点*/</span></span><br><span class="line">    <span class="attribute">margin</span>:<span class="number">0</span>;</span><br><span class="line">    <span class="attribute">padding</span>:<span class="number">0</span>;</span><br><span class="line">    <span class="attribute">overflow</span>:hidden;<span class="comment">/*防止li出现再ul外*/</span></span><br><span class="line">&#125;</span><br><span class="line">*&#123;</span><br><span class="line">    <span class="attribute">margin</span>:<span class="number">0</span>;</span><br><span class="line">    <span class="attribute">padding</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>IE浏览器的内核Trident、 Mozilla的Gecko、google的WebKit、Opera内核Presto。不同的浏览器默认的margin和padding等属性都不相同，为了保证各浏览器的一致性，所以用下述办法：</p><ol><li>直接用<code>*{margin:0;padding:0;}</code>(不推荐)</li><li>使用<a href="https://github.com/necolas/normalize.css/blob/master/normalize.css" target="_blank" rel="noopener">normalize.css</a>，优于<code>Reset CSS</code>。</li></ol><p><em>淘宝的css初始化：</em><br></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span>, <span class="selector-tag">h1</span>, <span class="selector-tag">h2</span>, <span class="selector-tag">h3</span>, <span class="selector-tag">h4</span>, <span class="selector-tag">h5</span>, <span class="selector-tag">h6</span>, <span class="selector-tag">hr</span>, <span class="selector-tag">p</span>, <span class="selector-tag">blockquote</span>, <span class="selector-tag">dl</span>, <span class="selector-tag">dt</span>, <span class="selector-tag">dd</span>, <span class="selector-tag">ul</span>, <span class="selector-tag">ol</span>, <span class="selector-tag">li</span>, <span class="selector-tag">pre</span>, <span class="selector-tag">form</span>, <span class="selector-tag">fieldset</span>, <span class="selector-tag">legend</span>, <span class="selector-tag">button</span>, <span class="selector-tag">input</span>, <span class="selector-tag">textarea</span>, <span class="selector-tag">th</span>, <span class="selector-tag">td</span> &#123; <span class="attribute">margin</span>:<span class="number">0</span>; <span class="attribute">padding</span>:<span class="number">0</span>; &#125;</span><br><span class="line"><span class="selector-tag">body</span>, <span class="selector-tag">button</span>, <span class="selector-tag">input</span>, <span class="selector-tag">select</span>, <span class="selector-tag">textarea</span> &#123; <span class="attribute">font</span>:<span class="number">12px</span>/<span class="number">1.5</span>tahoma, arial, \<span class="number">5</span>b8b\<span class="number">4</span>f53; &#125;</span><br><span class="line"><span class="selector-tag">h1</span>, <span class="selector-tag">h2</span>, <span class="selector-tag">h3</span>, <span class="selector-tag">h4</span>, <span class="selector-tag">h5</span>, <span class="selector-tag">h6</span>&#123; <span class="attribute">font-size</span>:<span class="number">100%</span>; &#125;</span><br><span class="line"><span class="selector-tag">address</span>, <span class="selector-tag">cite</span>, <span class="selector-tag">dfn</span>, <span class="selector-tag">em</span>, <span class="selector-tag">var</span> &#123; <span class="attribute">font-style</span>:normal; &#125;</span><br><span class="line"><span class="selector-tag">code</span>, <span class="selector-tag">kbd</span>, <span class="selector-tag">pre</span>, <span class="selector-tag">samp</span> &#123; <span class="attribute">font-family</span>:couriernew, courier, monospace; &#125;</span><br><span class="line"><span class="selector-tag">small</span>&#123; <span class="attribute">font-size</span>:<span class="number">12px</span>; &#125;</span><br><span class="line"><span class="selector-tag">ul</span>, <span class="selector-tag">ol</span> &#123; <span class="attribute">list-style</span>:none; &#125;</span><br><span class="line"><span class="selector-tag">a</span> &#123; <span class="attribute">text-decoration</span>:none; &#125;</span><br><span class="line"><span class="selector-tag">a</span><span class="selector-pseudo">:hover</span> &#123; <span class="attribute">text-decoration</span>:underline; &#125;</span><br><span class="line"><span class="selector-tag">sup</span> &#123; <span class="attribute">vertical-align</span>:text-top; &#125;</span><br><span class="line"><span class="selector-tag">sub</span>&#123; <span class="attribute">vertical-align</span>:text-bottom; &#125;</span><br><span class="line"><span class="selector-tag">legend</span> &#123; <span class="attribute">color</span>:<span class="number">#000</span>; &#125;</span><br><span class="line"><span class="selector-tag">fieldset</span>, <span class="selector-tag">img</span> &#123; <span class="attribute">border</span>:<span class="number">0</span>; &#125;</span><br><span class="line"><span class="selector-tag">button</span>, <span class="selector-tag">input</span>, <span class="selector-tag">select</span>, <span class="selector-tag">textarea</span> &#123; <span class="attribute">font-size</span>:<span class="number">100%</span>; &#125;</span><br><span class="line"><span class="selector-tag">table</span> &#123; <span class="attribute">border-collapse</span>:collapse; <span class="attribute">border-spacing</span>:<span class="number">0</span>; &#125;</span><br></pre></td></tr></table></figure><p></p><a id="more"></a><h3 id="DOCTYPE"><a href="#DOCTYPE" class="headerlink" title="DOCTYPE"></a><code>DOCTYPE</code></h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br></pre></td></tr></table></figure><p><code>&lt;!DOCTYPE&gt;</code> 声明位于文档中的最前面，处于 <code>&lt;html&gt;</code> 标签之前。告知浏览器的解析器，用什么文档类型 规范来解析这个文档。</p><h3 id="权重"><a href="#权重" class="headerlink" title="权重"></a>权重</h3><p>翻译自：<a href="http://archives.molly.com/2005/10/06/css2-and-css21-specificity-clarified/" target="_blank" rel="noopener">这儿</a></p><table><thead><tr><th>例子</th><th>行内css</th><th>ID 选择器</th><th>class 选择器</th><th>节点 选择器</th></tr></thead><tbody><tr><td>#name p.warning</td><td>0</td><td>1</td><td>1</td><td>1</td></tr></tbody></table><p>每一项的默认值都是<code>0</code>，哪一项满足一次就<code>+1</code>，比较最终的值<br><em>特殊：</em></p><ul><li><code>*</code>选择器：<code>0 0 0 0</code></li><li>继承的权重，所有继承的权重都是<code>null</code>。若某项属性继承自多个父辈元素，那取最近的父辈元素的属性</li><li>伪元素的权重 <strong>=</strong> 节点选择器的权重，伪类的权重 <strong>=</strong> 属性选择器的权重 <strong>=</strong> class选择器的权重</li></ul><blockquote><p>伪元素的权重还有争议，有种说法是伪元素的权重忽略不计</p></blockquote><h3 id="多类选择器-class-quot-sty1-sty2-quot"><a href="#多类选择器-class-quot-sty1-sty2-quot" class="headerlink" title="多类选择器:class=&quot;sty1 sty2&quot;"></a>多类选择器:<code>class=&quot;sty1 sty2&quot;</code></h3><pre><code>在html中声明的`&lt;p class=&quot;sty1 sty2&quot;&gt;你好&lt;/p&gt;`的对应的css样式为:
</code></pre><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.sty1</span>&#123;</span><br><span class="line">    <span class="attribute">font-weight</span>:bold;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.sty2</span>&#123;</span><br><span class="line">    <span class="attribute">font-style</span>:italic;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.sty1</span><span class="selector-class">.sty2</span>&#123;<span class="comment">/*中间没有空格*/</span></span><br><span class="line">    <span class="attribute">background</span>:<span class="number">#FF00FF</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>结果如下:<br><img src="https://tang-blog-1257996120.cos-website.ap-chengdu.myqcloud.com/css-float-1.png" alt="多类选择器结果"></p><p>总结:<br><strong>多类选择器</strong>会匹配其所有<strong><em>子元素</em></strong>任意组合的样式，如：<br><code>class=&quot;sty1 sty2 sty3&quot;</code>会匹配<code>.sty1{}</code>,<code>.sty2{}</code>,<code>sty3{}</code>,<code>.sty1.sty2{}</code>,<code>.sty1.sty3{}</code>,<code>.sty2.sty3{}</code>,<code>.sty1.sty2.sty3{}</code>;</p><p><strong>当有属性重叠时,根据权重来适应</strong>.</p><h3 id="乱码问题"><a href="#乱码问题" class="headerlink" title="乱码问题:"></a>乱码问题:</h3><p>我们知道,乱码问题都是因为编码问题引起的,但是具体哪儿导致的问题,整个过程其实不清楚,现总结如下:</p><ul><li>编辑器的编码:我用的<code>sublime3</code>,下了<code>ConvertToUTF8</code>这个插件,可以让<strong>内容</strong>使用<code>utf-8</code>编码,当然,默认就是<code>utf-8</code>;</li><li>网页的源代码编码:html文件在头部声明了如下代码:<code>&lt;meta charset=&quot;utf-8&quot;&gt;</code>,浏览器的核心其实是渲染器与js解析器,那么,渲染器会根据网页源文件里面设定的编码渲染网页;</li></ul><p><strong>只要这两个地方统一了,一般浏览器上就不会再出现乱码.如果还有,看看是不是浏览器设定的编码格式不统一.</strong></p><h3 id="浏览器的滚动条"><a href="#浏览器的滚动条" class="headerlink" title="浏览器的滚动条:"></a>浏览器的滚动条:</h3><p><img src="https://tang-blog-1257996120.cos-website.ap-chengdu.myqcloud.com/jike_baidu_product_bug.jpg" alt="百度首页更多产品bug"> 在批改极客学院作业的过程中，有个小bug印象特别深刻，让我想了很久都没有想明白，表现为：<br>当移动到右侧的更多产品时，会向下弹出来该下拉列表，而且会向左偏移一段距离。原因是为了沾满整个屏幕，给此div设置了<code>min-height=667</code>，而这个高度大于我的屏幕高度，所以导致右侧出来了一个滚动条，这个滚动条是占宽度的。所以会向左偏移。</p><p>解决方案：设置滚动条的宽高为0，如下：<br></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-pseudo">::-webkit-scrollbar</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h3 id="calc"><a href="#calc" class="headerlink" title="calc()"></a>calc()</h3><p>这是css3中常用到的计算方法，但是当要使用<code>+ - * /</code>等运算符的时候，+、-运算符两边要使用<strong>空格</strong>隔开，否则不起作用，如下是正确的方法：<br></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span>&#123;</span><br><span class="line">    <span class="attribute">width</span>:<span class="built_in">calc</span>(100% - 10px);<span class="comment">/*运算的具体数值要带单位*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h3 id="box-shadow"><a href="#box-shadow" class="headerlink" title="box-shadow"></a>box-shadow</h3><p>此属性对 <strong>tr</strong> 不起作用，因为 <strong>tr</strong> 为<code>display:table-row;</code>,<code>box-shadow</code>只对<code>display:block;</code>生效</p><h3 id="常用的CSS-hack技巧"><a href="#常用的CSS-hack技巧" class="headerlink" title="常用的CSS hack技巧"></a>常用的<code>CSS hack</code>技巧</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.bb</span>&#123;</span><br><span class="line">       <span class="attribute">background-color</span>:<span class="number">#f1ee18</span>;<span class="comment">/*所有识别*/</span></span><br><span class="line">      <span class="attribute">.background-color</span>:<span class="number">#00deff</span>\<span class="number">9</span>; <span class="comment">/*IE6、7、8识别，ie8的最终样式*/</span></span><br><span class="line">      +background-color:#a200ff;/*IE6、7识别，ie7的最终样式*/</span><br><span class="line">      _<span class="selector-tag">background-color</span>:<span class="selector-id">#1e0bd1</span>;<span class="comment">/*IE6识别，ie6的最终样式*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="超链接访问过后hover样式就不出现了"><a href="#超链接访问过后hover样式就不出现了" class="headerlink" title="超链接访问过后hover样式就不出现了"></a>超链接访问过后hover样式就不出现了</h3><p>因为被点击访问过的超链接样式不在具有 <code>hover</code> 和 <code>active</code> 了。解决方法是改变 <code>CSS</code> 属性的排列顺序 <strong>L-V-H-A</strong>:<br></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">a</span><span class="selector-pseudo">:link</span> &#123;&#125; <span class="selector-tag">a</span><span class="selector-pseudo">:visited</span> &#123;&#125; <span class="selector-tag">a</span><span class="selector-pseudo">:hover</span> &#123;&#125; <span class="selector-tag">a</span><span class="selector-pseudo">:active</span> &#123;&#125;</span><br></pre></td></tr></table></figure><p></p><h3 id="子元素的宽度占满父元素剩余的宽度"><a href="#子元素的宽度占满父元素剩余的宽度" class="headerlink" title="子元素的宽度占满父元素剩余的宽度"></a>子元素的宽度占满父元素剩余的宽度</h3><h4 id="利用-BFC-block-formatting-context"><a href="#利用-BFC-block-formatting-context" class="headerlink" title="利用 BFC (block formatting context)"></a>利用 <a href="https://www.cnblogs.com/libin-1/p/7098468.html" target="_blank" rel="noopener">BFC</a> (block formatting context)</h4><p>右边子元素填充父元素剩余宽度：<br></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"left"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"right"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>:<span class="number">600px</span>;</span><br><span class="line">    <span class="attribute">height</span>:<span class="number">200px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.left</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>:<span class="number">200px</span>;</span><br><span class="line">    <span class="attribute">height</span>:<span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">background</span>:blue;</span><br><span class="line">    <span class="attribute">float</span>:left;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.right</span> &#123;</span><br><span class="line">    width:auto; // 重点</span><br><span class="line">    <span class="selector-tag">height</span><span class="selector-pseudo">:100</span>%;</span><br><span class="line">    <span class="selector-tag">background</span><span class="selector-pseudo">:red</span>;</span><br><span class="line">    overflow:hidden; // 重点，此属性使得盒子成为 BFC</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>左边子元素填充父元素剩余宽度：<br></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"right"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"left"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>:<span class="number">600px</span>;</span><br><span class="line">    <span class="attribute">height</span>:<span class="number">200px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.right</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>:<span class="number">200px</span>;</span><br><span class="line">    <span class="attribute">height</span>:<span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">background</span>:red;</span><br><span class="line">    <span class="attribute">float</span>: right;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.left</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>:auto;</span><br><span class="line">    <span class="attribute">height</span>:<span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">background</span>:blue;</span><br><span class="line">    <span class="attribute">overflow</span>:hidden;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>注意：</strong> <code>float</code> 的 元素放在前面， <code>BFC</code> 的元素放在后面以自适应父元素剩余宽度</p><h4 id="利用-flex-布局"><a href="#利用-flex-布局" class="headerlink" title="利用 flex 布局"></a>利用 <code>flex</code> 布局</h4><p>给要填充父元素剩余宽度的元素设置 <code>flex: 1</code></p>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[angularJs我们所应该知道的]]></title>
      <url>https://jintang.github.io/2015/12/23/angularJs%E6%88%91%E4%BB%AC%E6%89%80%E5%BA%94%E8%AF%A5%E7%9F%A5%E9%81%93%E7%9A%84/</url>
      <content type="html"><![CDATA[<h3 id="scope-on-name-function"><a href="#scope-on-name-function" class="headerlink" title="$scope.$on(name,function):"></a>$scope.$on(name,function):</h3><p>在<code>controller</code>里放了这样的语句:<br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$scope.$on(<span class="string">'$ionicView.enter'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="comment">//do something</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">$scope.$on(<span class="string">'$ionicView.beforeEnter'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="comment">//do something</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p></p><p>在刚进入controller的时候会先执行直接放在controller里的代码，然后再执行上面的<br>两个方法。所以，无法用上面的方法对进入controller前进行预处理。</p><blockquote><ul><li><a href="http://ionicframework.com/docs/api/directive/ionView/" target="_blank" rel="noopener">官方视图生命周期及事件集</a></li><li><a href="http://ngionic.com/2014/12/ionic-javascript-api-ion-view-%E8%A7%86%E5%9B%BE%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%8F%8A%E4%BA%8B%E4%BB%B6%E9%9B%86%E5%90%88/" target="_blank" rel="noopener">中文视图生命周期</a></li></ul></blockquote><p>视图生命周期:</p><table><thead><tr><th>事件名称</th><th>作用</th></tr></thead><tbody><tr><td><code>$ionicView.loaded</code></td><td>视图已经被加载了。这事件只发生一次当视图被创建并添加到Dom中。当跳出页面并且被缓存了的话，再次访问这个页面时这个时间将不会被激活。Loaded事件是个好方式让你为这个视图设置你的代码； 然而，他并不是我们推荐的时间去监听视图被激活。</td></tr><tr><td><code>$ionicView.enter</code></td><td>进入视图并被激活。这事件被激活来判断这个视图是第一个加载还是被缓存了的。</td></tr><tr><td><code>$ionicView.leave</code></td><td>离开这个视图并且不是活动页面。调用这个事件判断应该被缓存还是摧毁。</td></tr><tr><td><code>$ionicView.beforeEnter</code></td><td>视图即将被打开变成活动页面。</td></tr><tr><td><code>$ionicView.beforeLeave</code></td><td>视图将被关闭并且不是活动页面。</td></tr><tr><td><code>$ionicView.afterEnter</code></td><td>进入视图并是当前的活动页面</td></tr><tr><td><code>$ionicView.afterLeave</code></td><td>已经离开视图，并成为非激活页面</td></tr><tr><td><code>$ionicView.unloaded</code></td><td>视图的Controller已经被摧毁并且他的页面元素也从Dom中移除</td></tr></tbody></table><a id="more"></a><h3 id="run-注射器加载完所有模块时，此方法执行一次"><a href="#run-注射器加载完所有模块时，此方法执行一次" class="headerlink" title="run():注射器加载完所有模块时，此方法执行一次"></a>run():注射器加载完所有模块时，此方法执行一次</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">angular.module(<span class="string">'yongche'</span>,[])</span><br><span class="line">    .run(<span class="function"><span class="keyword">function</span>(<span class="params">param</span>)</span>&#123;</span><br><span class="line">        <span class="comment">//do something</span></span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[angularJs 常见错误]]></title>
      <url>https://jintang.github.io/2015/12/17/angularJs%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/</url>
      <content type="html"><![CDATA[<h4 id="ng-show和ng-hide作用相反了，即：ng-show-”true”时隐藏，ng-hide-”true”时显示。"><a href="#ng-show和ng-hide作用相反了，即：ng-show-”true”时隐藏，ng-hide-”true”时显示。" class="headerlink" title="ng-show和ng-hide作用相反了，即：ng-show=”true”时隐藏，ng-hide=”true”时显示。"></a>ng-show和ng-hide作用相反了，即：ng-show=”true”时隐藏，ng-hide=”true”时显示。</h4><p><strong>原因：</strong>指令前带ng的都是AngularJs的内置指令，对应的值不应该带”花括号”，以ng-show为例，而我是这样写的:</p><pre><code>&lt;div ng-show=&quot;{{myArg}}&quot;&gt;&lt;/div&gt;
</code></pre><p>应该这样写：</p><pre><code>&lt;div ng-show=&quot;myArg&quot;&gt;&lt;/div&gt;
</code></pre><p>当时百思不得其解，ng-show与ng-hide的规则竟然会相反，原来是因为这样。</p><p><strong>结论：AngularJs自带的指令不能使用”双花括号”</strong><br><a id="more"></a></p><h4 id="Unknown-Provider：某某1-←-某某2-←-某某3："><a href="#Unknown-Provider：某某1-←-某某2-←-某某3：" class="headerlink" title="Unknown Provider：某某1 ← 某某2 ← 某某3："></a>Unknown Provider：某某1 ← 某某2 ← 某某3：</h4><p><strong>原因：</strong>js文件中有不能识别的”依赖”，从属关系为：某某1出现在某某2中，某某2出现在某某3中，所以直接找某某3中依赖的东西，将不能识别的删除即可。以前老看不明白这是什么意思，今天明白了。</p><h4 id="打包在真机的app在三星手机上ng-click不触发"><a href="#打包在真机的app在三星手机上ng-click不触发" class="headerlink" title="打包在真机的app在三星手机上ng-click不触发"></a>打包在真机的app在三星手机上ng-click不触发</h4><p><strong>原因:</strong>无法触发<code>ng-click</code>的元素都是脱离了普通文档流的:<code>position:absolute;float</code>等。不知道三星的手机浏览器具体是什么内核,而其他品牌的手机都可以</p><p><strong>解决方案:</strong>既然知道了浅层次的原因,解决方法也呼之欲出。使用其他布局代替<code>position:absolute;float</code>就好了。</p>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[windows安装sublime3遇到的问题与设置风格]]></title>
      <url>https://jintang.github.io/2015/12/16/windows%E5%AE%89%E8%A3%85sublime3%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98%E4%B8%8E%E8%AE%BE%E7%BD%AE%E9%A3%8E%E6%A0%BC/</url>
      <content type="html"><![CDATA[<blockquote><p>工欲善其事必先利其器，家里的电脑太烂，网速太垃圾，游戏都玩不了，所以安安静静的配个环境吧。</p></blockquote><h3 id="一、开启debug模式"><a href="#一、开启debug模式" class="headerlink" title="一、开启debug模式"></a>一、开启debug模式</h3><p>如果你在安装<code>sublime</code>的过程中出现了错误，建议要开启sublime3的debug模式，虽然我并没体会到什么区别，但是网上大神都这样说，应该是没有错的。开启方法如下：</p><p>将PackageControl.sublime-settings文件中的debug参数设为true，默认是false，表现为：<strong>“debug”: true,</strong> ，配置是个json文件，所以注意格式，特别是前后的”，”。网上都说在安装目录的什么下，比如说</p><p><code>D:\Program Files\Sublime Text 2\Data\Packages\PackageControl\PackageControl.sublime-settings</code></p><p>说实话，我完全找不到，没有隐藏文件夹！而我的在这儿：</p><p><code>C:\Users\Administrator\AppData\Roaming\Sublime Text 3\Packages\User</code><br><a id="more"></a><br>正如大家所看到的，这个AppData文件里面有你所有安装程序的配置，具体的作用还不明确。所以不论你的sublime3装在那儿，这个文件都要在这个文件夹下去找你程序对应的配置文件。这儿有稍微便捷点的方式：</p><p>打开<code>sublime——Preference——Browse Packages..</code>就可以直接到刚刚那个目录下面，然后在进入到user文件夹，你就可以看到PackageControl.sublime-settings文件了。修改即可！<br>这儿还有更简单的方法，不过前提是你装了Package Controller：</p><p>打开<code>sublime——Preference——Packages setting——Package Controller——选择Settings-User</code>，里面加上”debug”: true,即可。细心的朋友相比注意到了旁边的Settings-Default，看英文单词你也可以明白意思，这个改不了，但是可以参考！哈哈，里面就可以找到”debug”这个属性，这个文件里设的false。</p><p>好的，debug模式已经打开了。</p><h3 id="二、错误：There-are-no-packages-available-for-installation"><a href="#二、错误：There-are-no-packages-available-for-installation" class="headerlink" title="二、错误：There are no packages available for installation"></a>二、错误：There are no packages available for installation</h3><p>之前在电脑上安装过sublime3，但是最强大的Package Controller功能用不了，具体表现为：ctrl+shift+p可以打开，选择install package的时候打不开，并报此错误：</p><pre><code>There are no packages available for installation
</code></pre><p>网上说是IPv6造成，要修改hosts文件，我也改了，但并没有起作用，不知道为什么。可能这个sublime3太久远了。这个给个链接吧，因为我觉得网上说的是有道理的，即使我的并没有起作用。<br>国外：<a href="http://stackoverflow.com/questions/25105139/sublime-text-2-there-are-no-packages-available-for-installation" target="_blank" rel="noopener">http://stackoverflow.com/questions/25105139/sublime-text-2-there-are-no-packages-available-for-installation</a><br>国内：<a href="http://www.w3cfuns.com/blog-5439979-5405518.html" target="_blank" rel="noopener">http://www.w3cfuns.com/blog-5439979-5405518.html</a></p><p>这两个链接对此问题的解决方案是一样的，国内的看着明白，那为什么放国外的呢，多看看总是有好处的。</p><p>上回说到，我并没有因为上面的措施而解决掉问题，那我是怎么解决的呢。很傻的办法，我把sublime3卸载了…重新安装了一遍….</p><p>汗！重新之后还是不行，我看到我还没有装Package Controller，但是重新安装后却已经存在了，于是，我把C盘下那个AppData里Sublime3文件夹整个删除了， 重启后Package Controller才消失的。然后按照官方的指导安装了Package Controller，链接如下：<br><a href="https://packagecontrol.io/installation#st3" target="_blank" rel="noopener">https://packagecontrol.io/installation#st3</a><br>网上虽然可以搜到一大堆这个教程，但是有时候官方会更新的，所以有时候就用不了，所以，尽量选择官方文档。</p><p>这下果然成功了，装完之后，我开始用Package Controller装其他插件，第一个jsFormat,好吧，第一个又报错了！错误如下：</p><pre><code>ignored packages updated to: [&quot;Vintage&quot;]
</code></pre><p>这个很好解决，首先给个链接：<br><a href="https://www.sublimetext.com/docs/3/vintage.html" target="_blank" rel="noopener">https://www.sublimetext.com/docs/3/vintage.html</a><br>恩，这个是官方的文档，然后按官方的改就可以！</p><p>懒得看的同学看这里：<br>打开<code>sublime——Preferences——选择Settings-User</code>，打开了这个文件，观察到，这也是个json文件，找到了这条语句：<code>&quot;ignored_packages&quot;: [&quot;Vintage&quot;]</code><br>将其改成：<code>&quot;ignored_packages&quot;: []</code> 即可！</p><h5 id="未完待续"><a href="#未完待续" class="headerlink" title="未完待续"></a>未完待续</h5>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[angularJs———directive创建自定义指令]]></title>
      <url>https://jintang.github.io/2015/12/13/angularJs-directive%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8C%87%E4%BB%A4/</url>
      <content type="html"><![CDATA[<p><strong>directive:中文是”指令”的意思。</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">angular.module(<span class="string">'myApp'</span>, [])</span><br><span class="line">.directive(<span class="string">'myDirective'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 接受两个参数，第一个参数是自定义指令名，第二个是一个方法</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        restrict:<span class="comment">//有E(element)、A(Attribute)、C(Class)、M(Mark)，默认为A。</span></span><br><span class="line">        priority: Numbmer,<span class="comment">//优先级</span></span><br><span class="line">        terminal: <span class="built_in">Boolean</span>,</span><br><span class="line">        template: <span class="built_in">String</span> or Template <span class="built_in">Function</span>:<span class="function"><span class="keyword">function</span>(<span class="params">tElement, tAttrs</span>) (<span class="params">...&#125;,</span></span></span><br><span class="line"><span class="function"><span class="params">        templateUrl: String,</span></span></span><br><span class="line"><span class="function"><span class="params">        replace: Boolean,</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="regexp">/*默认为false，表示模板会被当作子元素插入到调用此指令的元素内部；</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="regexp">        为true表示模板会代替调用次指令的元素；*/</span></span></span></span><br><span class="line"><span class="function"><span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">        transclude: Boolean,<span class="regexp">//</span>是否允许指令嵌入，默认为false(不允许嵌套</span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">        <span class="title">scope</span>: <span class="title">Boolean</span> <span class="title">or</span> <span class="title">Object</span>,</span></span><br><span class="line"><span class="function">        /*创建独立作用域。</span></span><br><span class="line"><span class="function">        当为<span class="title">Object</span>时，指令的作用域与<span class="title">dom</span>所对应的<span class="title">controller</span>绑定的规则有：</span></span><br><span class="line"><span class="function">            @(<span class="params">dom绑定到指令作用域</span>)、</span></span><br><span class="line"><span class="function">            =(<span class="params">dom与指令作用域双向绑定</span>)、</span></span><br><span class="line"><span class="function">            &amp;(<span class="params">将dom对方法的引用传到指定作用域</span>)。</span></span><br><span class="line"><span class="function">        */</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">        <span class="title">controller</span>: <span class="title">String</span> <span class="title">or</span> <span class="title">function</span>(<span class="params">$scope, $element, $attrs, $transclude,otherInjectables</span>) </span>&#123; ... &#125;,</span><br><span class="line">        <span class="comment">/*在此controller中定义的方法是暴露给外面，供外面调用的。</span></span><br><span class="line"><span class="comment">            String时表示controller的名字，会查找定义在应用中的controller；</span></span><br><span class="line"><span class="comment">            function时表示是一个内部的controller，直接定义在这儿；</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line"></span><br><span class="line">        controllerAs: <span class="built_in">String</span>,<span class="comment">//给controller起的别名</span></span><br><span class="line">        <span class="built_in">require</span>: <span class="built_in">String</span>,<span class="comment">//此指令依赖的对象，可以是另一个指令</span></span><br><span class="line">        link: <span class="function"><span class="keyword">function</span>(<span class="params">scope, element, attr, 父控制器(可选</span>)) </span>&#123; </span><br><span class="line">            <span class="comment">//给此指令绑定一个dom事件:滑动</span></span><br><span class="line">            element.bind(<span class="string">'mouseenter'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">'鼠标滑动了'</span>);</span><br><span class="line">                <span class="comment">//可直接调用controller中的$scope.test()</span></span><br><span class="line">                scope.test();</span><br><span class="line">                <span class="comment">//也可以这样写,作用和上面一样</span></span><br><span class="line">                scope.$apply(<span class="string">"test()"</span>);</span><br><span class="line">            &#125;);</span><br><span class="line">         &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><a id="more"></a><h3 id="指令的一些技巧："><a href="#指令的一些技巧：" class="headerlink" title="指令的一些技巧："></a>指令的一些技巧：</h3><h5 id="1-指令的复用"><a href="#1-指令的复用" class="headerlink" title="1.指令的复用"></a>1.指令的复用</h5><p>上面学会了如何在link()中调用controller中的方法，那指令在不同的地方如何调用不同的方法呢？<br></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 为自定义指令添加了一个自定义属性,自定义属性绑定了controller中的方法 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-controller</span>=<span class="string">"myCtrl1"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">myDirective</span> <span class="attr">whereUse</span>=<span class="string">"use1()"</span>&gt;</span><span class="tag">&lt;/<span class="name">myDirective</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-controller</span>=<span class="string">"myCtrl2"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">myDirective</span> <span class="attr">whereUse</span>=<span class="string">"use2()"</span>&gt;</span><span class="tag">&lt;/<span class="name">myDirective</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">.controller(<span class="string">'myCtrl1'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    $scope.use1=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"111111"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">.controller(<span class="string">'myCtrl2'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    $scope.use2=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"22222"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">.directive(<span class="string">'myDirective'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">       restrict:<span class="string">'EA'</span>,</span><br><span class="line">       link: <span class="function"><span class="keyword">function</span>(<span class="params">scope, element, attr</span>) </span>&#123; </span><br><span class="line">            element.bind(<span class="string">'mouseenter'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="comment">/*tip:若页面上是驼峰式写法，此处获取属性要用小写，因为directive是json格式的，至于json为什么要小写，我也不明白。这儿是个坑*/</span></span><br><span class="line">                <span class="comment">//attr.whereuse();//获取到绑定的方法</span></span><br><span class="line">                scope.$apply(attr.whereuse);<span class="comment">//调用该方法，里面不是whereuser()</span></span><br><span class="line">            &#125;);</span><br><span class="line">         &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="指令执行的机制："><a href="#指令执行的机制：" class="headerlink" title="指令执行的机制："></a>指令执行的机制：</h3><h4 id="1-加载阶段"><a href="#1-加载阶段" class="headerlink" title="1.加载阶段"></a>1.加载阶段</h4><p>加载angular.js，找到ng-app指令，确定应用边界。</p><h4 id="2-编译阶段-compile"><a href="#2-编译阶段-compile" class="headerlink" title="2.编译阶段(compile)"></a>2.编译阶段(compile)</h4><h5 id="（1）遍历dom，找到所有的指令"><a href="#（1）遍历dom，找到所有的指令" class="headerlink" title="（1）遍历dom，找到所有的指令"></a>（1）遍历dom，找到所有的指令</h5><h5 id="（2）-根据指令的属性，如replace、template等转换为dom结构"><a href="#（2）-根据指令的属性，如replace、template等转换为dom结构" class="headerlink" title="（2） 根据指令的属性，如replace、template等转换为dom结构"></a>（2） 根据指令的属性，如replace、template等转换为dom结构</h5><h5 id="（3）如果指令中存在compile-则调用。"><a href="#（3）如果指令中存在compile-则调用。" class="headerlink" title="（3）如果指令中存在compile( )则调用。"></a>（3）如果指令中存在compile( )则调用。</h5><p>但一般不在指令内部写compile()，因为要写的话里面还需要调用angular默认的compile()</p><h4 id="3-链接阶段-link"><a href="#3-链接阶段-link" class="headerlink" title="3.链接阶段(link)"></a>3.链接阶段(link)</h4><h5 id="（1）对每一条指令运行link"><a href="#（1）对每一条指令运行link" class="headerlink" title="（1）对每一条指令运行link()"></a>（1）对每一条指令运行link()</h5><h5 id="（2）link函数一般用来操作dom、绑定事件监听器"><a href="#（2）link函数一般用来操作dom、绑定事件监听器" class="headerlink" title="（2）link函数一般用来操作dom、绑定事件监听器"></a>（2）link函数一般用来操作dom、绑定事件监听器</h5><p>比如：指令和数据间的操作，就是在link()里面执行的。</p><p>tip：</p><blockquote><p>1.compile()用于对模板自身进行转换，而link()负责在模型和视图之间进行动态关联；<br>2.compile()仅在编译阶段运行一次，而对于指令的每个实例，link()都会执行一次；<br>3.如前所述，大多数时候我们不写compile()，只写link()；</p><p>以下几点先做留存，没有理解：<br>4.compile()可以返回preLink()与postLink()，而link()只会返回postLink();<br>5.如果需要修改dom，应该在postLink()中修改，在preLink()中修改会出错；<br>6.作用域在链接阶段才会绑定到编译之后的link()上；</p></blockquote>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[如何使用github与hexo建立个人博客]]></title>
      <url>https://jintang.github.io/2015/12/09/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8github%E4%B8%8Ehexo%E5%BB%BA%E7%AB%8B%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/</url>
      <content type="html"><![CDATA[<blockquote><p>刚刚用github与hexo搭建了个人博客，对于这么个专属于自己的东西还是蛮开心的，不过过程中也遇到了很多不懂的东西，所以还是想把这个过程写下来，希望对新人有些帮助！</p></blockquote><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p><a href="https://github.com/" target="_blank" rel="noopener">github</a>是全世界最大的”开源”社区，有很多神奇的功能，有许许多多的大牛，所有著名的大公司都收益于github，我们的博客就是依托于github，github可以给你一个二级免费域名，这就是我们的博客，名字是我们自己起的，比如我的: <a href="http://jintang.github.io/">堂的博客</a>，前面的jintang是我的名字，是不是很炫酷！那么<a href="https://hexo.io/zh-cn/" target="_blank" rel="noopener">hexo</a>是什么呢？hexo我简单理解为一个工具，就是用来发布博客的，你在本地电脑上写了文章，然后就可以通过hexo命令来发布你的文章。<br>了解了这是什么东西，我们就开始建立博客吧！！</p><h2 id="安装环境与工具"><a href="#安装环境与工具" class="headerlink" title="安装环境与工具"></a>安装环境与工具</h2><ol><li><a href="http://git-scm.com/" target="_blank" rel="noopener">git</a>：版本控制工具，可以向github推送你的代码，github是免费托管的</li><li><a href="https://nodejs.org/en/download/" target="_blank" rel="noopener">node.js</a>：一个js环境，很强大的，内置了许多对象与方法，我们在这儿只需要使用npm命令装一些东西，装了node.js就可以使用npm命令了。<br>下载安装你对应系统的即可，最新的node.js在安装的过程中会自动配置你的环境变量，所以这个就不用我们操心了。<a id="more"></a></li></ol><h2 id="注册github账号并发布博客页面"><a href="#注册github账号并发布博客页面" class="headerlink" title="注册github账号并发布博客页面"></a>注册github账号并发布博客页面</h2><p><strong>1.访问github网址：</strong><a href="https://github.com/" target="_blank" rel="noopener">https://github.com/</a></p><p>起个好听的username吧，虽然只能是英文数字连字符，唉，可惜了我的文艺细胞，可以起中文的话可以给博客起一个很好听的域名。对，你没理解错，起的名字就会成为你的博客域名，我的名字是jintang，然后域名就是<a href="http://jintang.github.io/">http://jintang.github.io/</a> ,其实说了些废话，现在github是可以改username的，单字的恐怕已经都被注册光了，唉…</p><p>注册了之后要另外绑定一个邮箱，不是创建账号绑定的那个，而是要在个人账号设置里另外在绑定一个，这个邮箱专门用来接受github的各种通知,比如建立博客时就会发送通知。如果你收不到激活的邮件，可以尝试下gamil等国外邮箱。</p><p><strong>2.新建Repository(仓库)：</strong>之前说我们的博客是依托于github的，准确的说，有两种博客页面：</p><ul><li>依托于Repository（仓库）</li><li>依托于Organization（组织）</li></ul><p>位置如下（暂不放图）：</p><p>推荐使用第一种方式，新建一个Repository，新建的过程如下图：（图片先不放了）</p><p><strong>tip：</strong>仓库的名字必须是：<strong>username.github.io</strong>，里面的username和你github账号的username一致，大小写不要紧。</p><p>点击确定即可，仓库已创建成功。</p><p><strong>3.发布你的博客：</strong></p><p>点击setting——点击Launch automatic page generator——点击Continue to layouts——选一个默认的模板点击Publish page即可。如图所示：</p><p><strong>tip:这只是将博客页面发布了出去，使用的github默认工具渲染的页面，选什么模板并不重要，之后都会用hexo修改掉</strong></p><p>现在已经可以访问你自己的博客页面了，网址是：<a href="http://username.github.io" target="_blank" rel="noopener">http://username.github.io</a> ，跟你的仓库名是一样的哦。第一次发布需要等几分钟才可以访问。如果404不要着急哦！如果一直访问不了，去github上绑定的邮箱上看看，不论你的github pages建立成功还是失败，github都会发邮件通知你的！我刚开始失败了，原因是没有给github账号绑定一个邮箱。</p>]]></content>
    </entry>
    
  
  
</search>
